<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data Wrangling</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
#rmd-source-code {
  display: none;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">GOCD2</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Overview</a>
</li>
<li>
  <a href="0_import_data.html">Import data</a>
</li>
<li>
  <a href="0_wrangle_data.html">Wrangle data</a>
</li>
<li>
  <a href="1_exclusion.html">Exclusion criteria</a>
</li>
<li>
  <a href="1_descriptives.html">Descriptives</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rubenarslan/gocd2">
    <span class="fa fa-github"></span>
     
    
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
<li role="separator" class="divider"></li>
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Data Wrangling</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#weekdays">Weekdays</a></li>
<li><a href="#menstrual-phase">Menstrual phase</a></li>
<li><a href="#fertility-estimation">Fertility estimation</a><ul>
<li><a href="#lh-surges-and-sex-hormones">LH surges and sex hormones</a><ul>
<li><a href="#center-sex-hormones">Center sex hormones</a></li>
</ul></li>
<li><a href="#fertility-awareness">Fertility awareness</a></li>
<li><a href="#compute-menstrual-onsets">Compute menstrual onsets</a></li>
<li><a href="#estimate-day-of-ovulation">Estimate day of ovulation</a></li>
<li><a href="#estimate-fertile-window-probability">Estimate fertile window probability</a></li>
<li><a href="#infer-menstruation">Infer menstruation</a></li>
</ul></li>
<li><a href="#contraception">Contraception</a><ul>
<li><a href="#other-hormonal-contraception">Other hormonal contraception</a></li>
</ul></li>
<li><a href="#singles-vs-couples">Singles vs couples</a><ul>
<li><a href="#soi">SOI</a></li>
<li><a href="#partner-attractiveness-items">Partner attractiveness items</a></li>
<li><a href="#relationship-satisfaction">Relationship satisfaction</a></li>
</ul></li>
<li><a href="#living-situation">Living situation</a></li>
<li><a href="#merge-surveys">Merge surveys</a></li>
<li><a href="#code-open-answer">Code open answer</a><ul>
<li><a href="#guessed-hypothesis">Guessed hypothesis?</a></li>
<li><a href="#app-awareness">app awareness</a></li>
<li><a href="#change-contraception">change contraception</a></li>
<li><a href="#medication">Medication</a></li>
</ul></li>
<li><a href="#cycle-length">cycle length</a></li>
<li><a href="#choice-of-contraception">choice of contraception</a></li>
<li><a href="#fix-variables">Fix variables</a><ul>
<li><a href="#diary-desire-scales">Diary desire scales</a></li>
<li><a href="#separation-from-partner">Separation from partner</a></li>
<li><a href="#age-groups">age groups</a></li>
</ul></li>
<li><a href="#fertility-awareness-1">Fertility awareness</a></li>
<li><a href="#merge-diary">Merge diary</a></li>
<li><a href="#singles">Singles</a></li>
<li><a href="#network">network</a></li>
<li><a href="#code-open-answers-diary">Code open answers diary</a><ul>
<li><a href="#answered-honestly-in-diary">Answered honestly in diary</a></li>
</ul></li>
<li><a href="#social-diary">Social diary</a><ul>
<li><a href="#genderize">Genderize</a></li>
<li><a href="#seenthought-about">Seen/thought about</a></li>
<li><a href="#nominations-for-conjoint-analysis">Nominations for conjoint analysis</a></li>
</ul></li>
<li><a href="#sex-dummy-variables">Sex dummy variables</a></li>
<li><a href="#final-edits">Final edits</a></li>
<li><a href="#sanity-checks">Sanity checks</a></li>
<li><a href="#save">save</a></li>
</ul>
</div>

<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">source</span>(<span class="st">&quot;0_helpers.R&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(tidylog)</span>
<span id="cb1-3"><a href="#cb1-3"></a>knitr<span class="op">::</span>opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">error =</span> <span class="ot">FALSE</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">load</span>(<span class="st">&quot;data/pretty_raw.rdata&quot;</span>)</span>
<span id="cb1-5"><a href="#cb1-5"></a>knit_print.alpha &lt;-<span class="st"> </span>knitr<span class="op">:::</span>knit_print.default</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">registerS3method</span>(<span class="st">&quot;knit_print&quot;</span>, <span class="st">&quot;alpha&quot;</span>, knit_print.alpha)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">message=</span>T, <span class="dt">warning =</span> F)</span></code></pre></div>
<div id="weekdays" class="section level2">
<h2>Weekdays</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>s3_daily<span class="op">$</span>weekday =<span class="st"> </span><span class="kw">format</span>(<span class="kw">as.POSIXct</span>(s3_daily<span class="op">$</span>created), <span class="dt">format =</span> <span class="st">&quot;%w&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>s3_daily<span class="op">$</span>weekend &lt;-<span class="st"> </span><span class="kw">ifelse</span>(s3_daily<span class="op">$</span>weekday <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">6</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a>s3_daily<span class="op">$</span>weekday &lt;-<span class="st"> </span>car<span class="op">::</span><span class="kw">Recode</span>(s3_daily<span class="op">$</span>weekday,                                               <span class="st">&quot;0=&#39;Sunday&#39;;1=&#39;Monday&#39;;2=&#39;Tuesday&#39;;3=&#39;Wednesday&#39;;4=&#39;Thursday&#39;;5=&#39;Friday&#39;;6=&#39;Saturday&#39;&quot;</span>,<span class="dt">as.factor =</span>T, <span class="dt">levels =</span>   <span class="kw">c</span>(<span class="st">&#39;Monday&#39;</span>,<span class="st">&#39;Tuesday&#39;</span>,<span class="st">&#39;Wednesday&#39;</span>,<span class="st">&#39;Thursday&#39;</span>,<span class="st">&#39;Friday&#39;</span>,<span class="st">&#39;Saturday&#39;</span>,<span class="st">&#39;Sunday&#39;</span>))</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a>hour_string_to_period =<span class="st"> </span><span class="cf">function</span>(hour_string) {</span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="kw">duration</span>(<span class="kw">as.numeric</span>(stringr<span class="op">::</span><span class="kw">str_sub</span>(hour_string, <span class="dv">1</span>,<span class="dv">2</span>)), <span class="dt">units =</span> <span class="st">&quot;hours&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">duration</span>(<span class="kw">as.numeric</span>(stringr<span class="op">::</span><span class="kw">str_sub</span>(hour_string, <span class="dv">4</span>,<span class="dv">5</span>)), <span class="dt">units =</span> <span class="st">&quot;minutes&quot;</span>) </span>
<span id="cb3-7"><a href="#cb3-7"></a>}</span>
<span id="cb3-8"><a href="#cb3-8"></a>s3_daily<span class="op">$</span>sleep_awoke_time =<span class="st"> </span><span class="kw">hour_string_to_period</span>(s3_daily<span class="op">$</span>sleep_awoke_time)</span>
<span id="cb3-9"><a href="#cb3-9"></a>s3_daily<span class="op">$</span>sleep_fell_asleep_time =<span class="st"> </span><span class="kw">hour_string_to_period</span>(s3_daily<span class="op">$</span>sleep_fell_asleep_time)</span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a>s3_daily<span class="op">$</span>sleep_duration =<span class="st"> </span><span class="kw">ifelse</span>(</span>
<span id="cb3-12"><a href="#cb3-12"></a>    s3_daily<span class="op">$</span>sleep_awoke_time <span class="op">&gt;=</span><span class="st"> </span>s3_daily<span class="op">$</span>sleep_fell_asleep_time, </span>
<span id="cb3-13"><a href="#cb3-13"></a>    s3_daily<span class="op">$</span>sleep_awoke_time <span class="op">-</span><span class="st"> </span>s3_daily<span class="op">$</span>sleep_fell_asleep_time, </span>
<span id="cb3-14"><a href="#cb3-14"></a>    <span class="kw">dhours</span>(<span class="dv">24</span>) <span class="op">-</span><span class="st"> </span>s3_daily<span class="op">$</span>sleep_fell_asleep_time <span class="op">+</span><span class="st"> </span>s3_daily<span class="op">$</span>sleep_awoke_time</span>
<span id="cb3-15"><a href="#cb3-15"></a>) <span class="op">/</span><span class="st"> </span><span class="dv">60</span> <span class="op">/</span><span class="st"> </span><span class="dv">60</span></span></code></pre></div>
<pre><code>## Note: method with signature &#39;Duration#ANY&#39; chosen for function &#39;-&#39;,
##  target signature &#39;Duration#Duration&#39;.
##  &quot;ANY#Duration&quot; would also be valid</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>s3_daily =<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">created_date =</span> <span class="kw">as.Date</span>(created <span class="op">-</span><span class="st"> </span><span class="kw">hours</span>(<span class="dv">10</span>))) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># don&#39;t count night time as next day</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">  </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">first_diary_day =</span> <span class="kw">min</span>(created_date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
<pre><code>## mutate: new variable &#39;created_date&#39; with 325 unique values and 0% NA</code></pre>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## mutate (grouped): new variable &#39;first_diary_day&#39; with 208 unique values and 0% NA</code></pre>
<pre><code>## ungroup: no grouping variables</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">stopifnot</span>(s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, created_date) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="st">            </span><span class="kw">group_by</span>(session, created_date) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>()<span class="op">&gt;</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>() <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## drop_na: no rows removed</code></pre>
<pre><code>## group_by: 2 grouping variables (session, created_date)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
</div>
<div id="menstrual-phase" class="section level2">
<h2>Menstrual phase</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>s1_demo =<span class="st"> </span>s1_demo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">ended_date =</span> <span class="kw">as.Date</span>(ended))</span></code></pre></div>
<pre><code>## mutate: new variable &#39;ended_date&#39; with 216 unique values and 3% NA</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># s1_demo %&gt;% </span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co">#   filter(menstruation_last &lt; ended_date - days(40)) %&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="co">#   select(menstruation_last, ended_date, menstruation_last_certainty, contraception_method)</span></span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a>s1_menstruation_start =<span class="st"> </span>s1_demo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(menstruation_last)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="st">  </span><span class="kw">filter</span>(menstruation_last <span class="op">&gt;=</span><span class="st"> </span>ended_date <span class="op">-</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">40</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># only last menstruation that weren&#39;t ages ago</span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">created_date =</span> <span class="kw">as.Date</span>(created)) <span class="op">%&gt;%</span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="st">  </span><span class="kw">select</span>(session, created_date, menstruation_last) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">menstrual_onset_date_inferred =</span> menstruation_last)</span></code></pre></div>
<pre><code>## filter: removed 355 rows (21%), 1,305 rows remaining</code></pre>
<pre><code>## filter: removed 19 rows (1%), 1,286 rows remaining</code></pre>
<pre><code>## mutate: new variable &#39;created_date&#39; with 202 unique values and 0% NA</code></pre>
<pre><code>## select: dropped 103 variables (created, modified, ended, expired, info_study, …)</code></pre>
<pre><code>## rename: renamed one variable (menstrual_onset_date_inferred)</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>s5_hadmenstruation =<span class="st"> </span>s5_hadmenstruation <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(last_menstrual_onset_date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">created_date =</span> <span class="kw">as.Date</span>(created)) <span class="op">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="st">  </span><span class="kw">select</span>(session, created_date, last_menstrual_onset_date) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">menstrual_onset_date_inferred =</span> last_menstrual_onset_date) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">duplicated</span>(session))</span></code></pre></div>
<pre><code>## filter: removed 127 rows (22%), 443 rows remaining</code></pre>
<pre><code>## mutate: new variable &#39;created_date&#39; with 153 unique values and 0% NA</code></pre>
<pre><code>## select: dropped 6 variables (created, modified, ended, expired, had_menstrual_bleeding, …)</code></pre>
<pre><code>## rename: renamed one variable (menstrual_onset_date_inferred)</code></pre>
<pre><code>## filter: removed one row (&lt;1%), 442 rows remaining</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">table</span>(<span class="kw">duplicated</span>(s5_hadmenstruation<span class="op">$</span>session))</span></code></pre></div>
<pre><code>## 
## FALSE 
##   442</code></pre>
</div>
<div id="fertility-estimation" class="section level2">
<h2>Fertility estimation</h2>
<div id="lh-surges-and-sex-hormones" class="section level3">
<h3>LH surges and sex hormones</h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>lab =<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_xlsx</span>(<span class="st">&quot;data/Datensatz_Zyklusstudie_Labor.xlsx&quot;</span>)</span>
<span id="cb30-2"><a href="#cb30-2"></a></span>
<span id="cb30-3"><a href="#cb30-3"></a>lab =<span class="st"> </span>lab <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">created_date =</span> <span class="st">`</span><span class="dt">Datum Lab Session</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(<span class="st">`</span><span class="dt">VPN-CODE</span><span class="st">`</span>), <span class="op">!</span><span class="kw">is.na</span>(created_date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">short =</span> <span class="kw">str_sub</span>(Tagebuchcode, <span class="dv">1</span>, <span class="dv">7</span>),</span>
<span id="cb30-7"><a href="#cb30-7"></a>         <span class="dt">lab_only_no_diary =</span> <span class="kw">is.na</span>(short),</span>
<span id="cb30-8"><a href="#cb30-8"></a>         <span class="dt">short =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(short), <span class="st">`</span><span class="dt">VPN-CODE</span><span class="st">`</span>, short),</span>
<span id="cb30-9"><a href="#cb30-9"></a>         <span class="dt">created_date =</span> <span class="kw">as.Date</span>(created_date),</span>
<span id="cb30-10"><a href="#cb30-10"></a>         <span class="st">`</span><span class="dt">Date LH surge</span><span class="st">`</span> =<span class="st"> </span><span class="kw">as.Date</span>(<span class="kw">if_else</span>(<span class="st">`</span><span class="dt">Date LH surge</span><span class="st">`</span> <span class="op">==</span><span class="st"> &quot;xxx&quot;</span>, <span class="ot">NA_real_</span>, <span class="kw">as.numeric</span>(<span class="st">`</span><span class="dt">Date LH surge</span><span class="st">`</span>)), <span class="dt">origin =</span> <span class="st">&quot;1899-12-30&quot;</span>)) <span class="co"># some excel problem, where nrs are repeated at end, so we shorten it</span></span></code></pre></div>
<pre><code>## rename: renamed one variable (created_date)</code></pre>
<pre><code>## filter: removed 37 rows (6%), 628 rows remaining</code></pre>
<pre><code>## mutate: converted &#39;created_date&#39; from double to Date (0 new NA)</code></pre>
<pre><code>##         converted &#39;Date LH surge&#39; from character to Date (33 new NA)</code></pre>
<pre><code>##         new variable &#39;short&#39; with 157 unique values and 0% NA</code></pre>
<pre><code>##         new variable &#39;lab_only_no_diary&#39; with 2 unique values and 0% NA</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>lab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">n_women =</span> <span class="kw">n_distinct</span>(<span class="st">`</span><span class="dt">VPN-CODE</span><span class="st">`</span>),</span>
<span id="cb37-2"><a href="#cb37-2"></a>               <span class="dt">n_diary_participants =</span> <span class="kw">n_distinct</span>(<span class="kw">str_sub</span>(Tagebuchcode, <span class="dv">1</span>, <span class="dv">7</span>), <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="st">  </span><span class="kw">group_by</span>(n_women,n_diary_participants, <span class="st">`</span><span class="dt">VPN-CODE</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">days =</span> <span class="kw">n</span>(), <span class="dt">surges =</span> <span class="kw">n_nonmissing</span>(<span class="st">`</span><span class="dt">Date LH surge</span><span class="st">`</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb37-5"><a href="#cb37-5"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="st">`</span><span class="dt">VPN-CODE</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb37-6"><a href="#cb37-6"></a><span class="st">  </span><span class="kw">summarise_all</span>(mean)</span></code></pre></div>
<pre><code>## mutate: new variable &#39;n_women&#39; with one unique value and 0% NA</code></pre>
<pre><code>##         new variable &#39;n_diary_participants&#39; with one unique value and 0% NA</code></pre>
<pre><code>## group_by: 3 grouping variables (n_women, n_diary_participants, VPN-CODE)</code></pre>
<pre><code>## summarise: now 159 rows and 5 columns, 2 group variables remaining (n_women, n_diary_participants)</code></pre>
<pre><code>## select: dropped one variable (VPN-CODE)</code></pre>
<pre><code>## summarise_all: now one row and 4 columns, one group variable remaining (n_women)</code></pre>
<pre><code>## # A tibble: 1 x 4
##   n_women n_diary_participants  days surges
##     &lt;int&gt;                &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1     159                  149  3.95   1.77</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="kw">setdiff</span>(lab<span class="op">$</span>short, s1_demo<span class="op">$</span>short) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">length</span>() <span class="co"># 7 didnt enter online study at all</span></span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="kw">setdiff</span>(lab<span class="op">$</span>short, s3_daily<span class="op">$</span>short) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">length</span>() <span class="co"># 18 didnt do diary</span></span></code></pre></div>
<pre><code>## [1] 19</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="kw">setdiff</span>(s3_daily<span class="op">$</span>short, lab<span class="op">$</span>short) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">length</span>() <span class="co"># 1235 didnt do lab</span></span></code></pre></div>
<pre><code>## [1] 1235</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># setdiff(lab$short, s1_demo$short_demo) %&gt;% unique() # all codes found</span></span>
<span id="cb51-2"><a href="#cb51-2"></a></span>
<span id="cb51-3"><a href="#cb51-3"></a>lab &lt;-<span class="st"> </span>lab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span>lab_only_no_diary) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>lab_only_no_diary)</span></code></pre></div>
<pre><code>## filter: removed 32 rows (5%), 596 rows remaining</code></pre>
<pre><code>## select: dropped one variable (lab_only_no_diary)</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>get_long_sess =<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, short) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>()</span></code></pre></div>
<pre><code>## select: dropped 152 variables (created, modified, ended, expired, browser, …)</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>testthat<span class="op">::</span><span class="kw">expect_equal</span>(lab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">is.na</span>(created_date)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>(), <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## filter: removed all rows (100%)</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>lab &lt;-<span class="st"> </span>get_long_sess <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inner_join</span>(lab, <span class="dt">by =</span> <span class="st">&quot;short&quot;</span>)</span></code></pre></div>
<pre><code>## inner_join: added 51 columns (VPN-CODE, Tagebuchcode, VPN-Zahl, created_date, Uhrzeit, …)</code></pre>
<pre><code>##             &gt; rows only in x  (1,235)</code></pre>
<pre><code>##             &gt; rows only in y  (   44)</code></pre>
<pre><code>##             &gt; matched rows       552    (includes duplicates)</code></pre>
<pre><code>##             &gt;                 =======</code></pre>
<pre><code>##             &gt; rows total         552</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>testthat<span class="op">::</span><span class="kw">expect_equal</span>(lab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">is.na</span>(created_date)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>(), <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## filter: removed all rows (100%)</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a>testthat<span class="op">::</span><span class="kw">expect_equal</span>(s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">is.na</span>(created_date)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>(), <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## filter: removed all rows (100%)</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a>s3_daily &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">full_join</span>(lab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="st">`</span><span class="dt">Date LH surge</span><span class="st">`</span>, <span class="op">-</span><span class="st">`</span><span class="dt">Menstrual Onset</span><span class="st">`</span>), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>, <span class="st">&quot;short&quot;</span>, <span class="st">&quot;created_date&quot;</span>), <span class="dt">suffixes =</span> <span class="kw">c</span>(<span class="st">&quot;_diary&quot;</span>, <span class="st">&quot;_lab&quot;</span>))</span></code></pre></div>
<pre><code>## select: dropped 2 variables (Date LH surge, Menstrual Onset)</code></pre>
<pre><code>## full_join: added 48 columns (VPN-CODE, Tagebuchcode, VPN-Zahl, Uhrzeit, exclude_luteal_too_long, …)</code></pre>
<pre><code>##            &gt; rows only in x   62,307</code></pre>
<pre><code>##            &gt; rows only in y      193</code></pre>
<pre><code>##            &gt; matched rows        359</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       62,859</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;_lab&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ncol</span>()</span></code></pre></div>
<pre><code>## select: dropped all variables</code></pre>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">IBL_Estradiol pg/ml</span><span class="st">`</span>, ended) <span class="op">%&gt;%</span><span class="st"> </span>codebook<span class="op">::</span><span class="kw">md_pattern</span>(<span class="dt">min_freq =</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## select: dropped 200 variables (session, created, modified, expired, browser, …)</code></pre>
<pre><code>## # A tibble: 5 x 5
##   description                   ended `IBL_Estradiol pg/ml` var_miss n_miss
##   &lt;chr&gt;                         &lt;dbl&gt;                 &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
## 1 Missing values per variable    1672                 62337    64009  64009
## 2 Missing values in 1 variables     1                     0        1  60851
## 3 Missing values in 2 variables     0                     0        2   1486
## 4 Missing values in 0 variables     1                     1        0    336
## 5 Missing values in 1 variables     0                     1        1    186</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a>s3_daily &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="st">  </span><span class="kw">full_join</span>(</span>
<span id="cb83-3"><a href="#cb83-3"></a>    lab <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb83-4"><a href="#cb83-4"></a><span class="st">      </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(<span class="st">`</span><span class="dt">Date LH surge</span><span class="st">`</span>), exclude_luteal_too_long <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb83-5"><a href="#cb83-5"></a><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">created_date =</span> <span class="st">`</span><span class="dt">Date LH surge</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb83-6"><a href="#cb83-6"></a><span class="st">      </span><span class="kw">select</span>(session, short, created_date, <span class="st">`</span><span class="dt">Date LH surge</span><span class="st">`</span>), </span>
<span id="cb83-7"><a href="#cb83-7"></a>    <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>, <span class="st">&quot;short&quot;</span>, <span class="st">&quot;created_date&quot;</span>), <span class="dt">suffixes =</span> <span class="kw">c</span>(<span class="st">&quot;_diary&quot;</span>, <span class="st">&quot;_lab&quot;</span>))</span></code></pre></div>
<pre><code>## filter: removed 322 rows (58%), 230 rows remaining</code></pre>
<pre><code>## mutate: changed 159 values (69%) of &#39;created_date&#39; (0 new NA)</code></pre>
<pre><code>## select: dropped 49 variables (VPN-CODE, Tagebuchcode, VPN-Zahl, Uhrzeit, exclude_luteal_too_long, …)</code></pre>
<pre><code>## full_join: added one column (Date LH surge)</code></pre>
<pre><code>##            &gt; rows only in x   62,684</code></pre>
<pre><code>##            &gt; rows only in y       55</code></pre>
<pre><code>##            &gt; matched rows        175</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       62,914</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a>testthat<span class="op">::</span><span class="kw">expect_equal</span>(s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">is.na</span>(created_date)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>(), <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## filter: removed all rows (100%)</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="co"># because of the typos in the lab session codes, we have to merge the long ones back on</span></span>
<span id="cb95-2"><a href="#cb95-2"></a><span class="kw">xtabs</span>(<span class="op">~</span><span class="st"> </span><span class="kw">is.na</span>(session) <span class="op">+</span><span class="st"> </span><span class="kw">is.na</span>(<span class="st">`</span><span class="dt">VPN-CODE</span><span class="st">`</span>), <span class="dt">data =</span> s3_daily)</span></code></pre></div>
<pre><code>##               is.na(`VPN-CODE`)
## is.na(session) FALSE  TRUE
##          FALSE   552 62362</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="kw">xtabs</span>(<span class="op">~</span><span class="st"> </span><span class="kw">is.na</span>(short) <span class="op">+</span><span class="st"> </span><span class="kw">is.na</span>(<span class="st">`</span><span class="dt">VPN-CODE</span><span class="st">`</span>), <span class="dt">data =</span> s3_daily)</span></code></pre></div>
<pre><code>##             is.na(`VPN-CODE`)
## is.na(short) FALSE  TRUE
##        FALSE   552 62362</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="kw">xtabs</span>(<span class="op">~</span><span class="st"> </span><span class="kw">is.na</span>(ended) <span class="op">+</span><span class="st"> </span><span class="kw">is.na</span>(<span class="st">`</span><span class="dt">VPN-CODE</span><span class="st">`</span>), <span class="dt">data =</span> s3_daily)</span></code></pre></div>
<pre><code>##             is.na(`VPN-CODE`)
## is.na(ended) FALSE  TRUE
##        FALSE   354 60833
##        TRUE    198  1529</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a><span class="kw">xtabs</span>(<span class="op">~</span><span class="st"> </span><span class="kw">is.na</span>(ended) <span class="op">+</span><span class="st"> </span><span class="kw">is.na</span>(<span class="st">`</span><span class="dt">Progesterone pg/ml</span><span class="st">`</span>), <span class="dt">data =</span> s3_daily)</span></code></pre></div>
<pre><code>##             is.na(`Progesterone pg/ml`)
## is.na(ended) FALSE  TRUE
##        FALSE   329 60858
##        TRUE    180  1547</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a><span class="co"># </span></span>
<span id="cb103-2"><a href="#cb103-2"></a><span class="co"># diary %&gt;% filter(!is.na(Age)) %&gt;% </span></span>
<span id="cb103-3"><a href="#cb103-3"></a><span class="co">#   select(short, Age, age, relationship_status, Relationship_status, `MEAN Größe`, `MEAN Gewicht`, height, weight) %&gt;%</span></span>
<span id="cb103-4"><a href="#cb103-4"></a><span class="co">#   group_by(short) %&gt;% </span></span>
<span id="cb103-5"><a href="#cb103-5"></a><span class="co">#   summarise_all(first) %&gt;% </span></span>
<span id="cb103-6"><a href="#cb103-6"></a><span class="co">#   distinct() %&gt;% </span></span>
<span id="cb103-7"><a href="#cb103-7"></a><span class="co">#   mutate(age_diff = abs(Age - age), </span></span>
<span id="cb103-8"><a href="#cb103-8"></a><span class="co">#          height_diff = abs(height- `MEAN Größe`), </span></span>
<span id="cb103-9"><a href="#cb103-9"></a><span class="co">#          weight_diff = abs(weight - `MEAN Gewicht`),</span></span>
<span id="cb103-10"><a href="#cb103-10"></a><span class="co">#          rel_diff = abs(relationship_status - Relationship_status)) %&gt;% </span></span>
<span id="cb103-11"><a href="#cb103-11"></a><span class="co">#   arrange(age_diff) %&gt;% View</span></span></code></pre></div>
<div id="center-sex-hormones" class="section level4">
<h4>Center sex hormones</h4>
<p>We remove outliers that are more than 3 SD from the mean and center within groups (logged and non-logged).</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a>outliers_to_missing &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">sd_multiplier =</span> <span class="dv">3</span>) {</span>
<span id="cb104-2"><a href="#cb104-2"></a>  <span class="kw">if_else</span>(x <span class="op">&gt;</span><span class="st"> </span>(<span class="kw">mean</span>(x, <span class="dt">na.rm =</span> T) <span class="op">+</span><span class="st"> </span>sd_multiplier <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(x, <span class="dt">na.rm =</span> T)) <span class="op">|</span></span>
<span id="cb104-3"><a href="#cb104-3"></a><span class="st">                                   </span>x <span class="op">&lt;</span><span class="st"> </span>(<span class="kw">mean</span>(x, <span class="dt">na.rm =</span> T) <span class="op">-</span><span class="st"> </span>sd_multiplier <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(x, <span class="dt">na.rm =</span> T)),</span>
<span id="cb104-4"><a href="#cb104-4"></a>                                   <span class="ot">NA_real_</span>, x)</span>
<span id="cb104-5"><a href="#cb104-5"></a>}</span>
<span id="cb104-6"><a href="#cb104-6"></a>s3_daily &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb104-7"><a href="#cb104-7"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb104-8"><a href="#cb104-8"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb104-9"><a href="#cb104-9"></a>    <span class="st">`</span><span class="dt">Progesterone pg/ml</span><span class="st">`</span> =<span class="st"> </span><span class="kw">outliers_to_missing</span>(<span class="st">`</span><span class="dt">Progesterone pg/ml</span><span class="st">`</span>),</span>
<span id="cb104-10"><a href="#cb104-10"></a>    <span class="st">`</span><span class="dt">Estradiol pg/ml</span><span class="st">`</span> =<span class="st"> </span><span class="kw">outliers_to_missing</span>(<span class="st">`</span><span class="dt">Estradiol pg/ml</span><span class="st">`</span>),</span>
<span id="cb104-11"><a href="#cb104-11"></a>    <span class="st">`</span><span class="dt">IBL_Estradiol pg/ml</span><span class="st">`</span> =<span class="st"> </span><span class="kw">outliers_to_missing</span>(<span class="st">`</span><span class="dt">IBL_Estradiol pg/ml</span><span class="st">`</span>),</span>
<span id="cb104-12"><a href="#cb104-12"></a>    <span class="st">`</span><span class="dt">Testosterone pg/ml</span><span class="st">`</span> =<span class="st"> </span><span class="kw">outliers_to_missing</span>(<span class="st">`</span><span class="dt">Testosterone pg/ml</span><span class="st">`</span>),</span>
<span id="cb104-13"><a href="#cb104-13"></a>    <span class="st">`</span><span class="dt">Cortisol nmol/l</span><span class="st">`</span> =<span class="st"> </span><span class="kw">outliers_to_missing</span>(<span class="st">`</span><span class="dt">Cortisol nmol/l</span><span class="st">`</span>)</span>
<span id="cb104-14"><a href="#cb104-14"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb104-15"><a href="#cb104-15"></a><span class="st">  </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb104-16"><a href="#cb104-16"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb104-17"><a href="#cb104-17"></a>    <span class="dt">progesterone_mean =</span> <span class="kw">mean</span>(<span class="st">`</span><span class="dt">Progesterone pg/ml</span><span class="st">`</span>, <span class="dt">na.rm =</span> T),</span>
<span id="cb104-18"><a href="#cb104-18"></a>    <span class="st">`</span><span class="dt">progesterone_diff</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">Progesterone pg/ml</span><span class="st">`</span> <span class="op">-</span><span class="st"> </span>progesterone_mean,</span>
<span id="cb104-19"><a href="#cb104-19"></a>    <span class="dt">progesterone_log_mean =</span> <span class="kw">mean</span>(<span class="kw">log</span>(<span class="st">`</span><span class="dt">Progesterone pg/ml</span><span class="st">`</span>), <span class="dt">na.rm =</span> T),</span>
<span id="cb104-20"><a href="#cb104-20"></a>    <span class="dt">progesterone_log_diff =</span> <span class="kw">log</span>(<span class="st">`</span><span class="dt">Progesterone pg/ml</span><span class="st">`</span>) <span class="op">-</span><span class="st"> </span>progesterone_log_mean,</span>
<span id="cb104-21"><a href="#cb104-21"></a>    </span>
<span id="cb104-22"><a href="#cb104-22"></a>    <span class="dt">estradiol_mean =</span> <span class="kw">mean</span>(<span class="st">`</span><span class="dt">Estradiol pg/ml</span><span class="st">`</span>, <span class="dt">na.rm =</span> T),</span>
<span id="cb104-23"><a href="#cb104-23"></a>    <span class="dt">estradiol_diff =</span> <span class="st">`</span><span class="dt">Estradiol pg/ml</span><span class="st">`</span> <span class="op">-</span><span class="st"> </span>estradiol_mean,</span>
<span id="cb104-24"><a href="#cb104-24"></a>    <span class="dt">estradiol_log_mean =</span> <span class="kw">mean</span>(<span class="kw">log</span>(<span class="st">`</span><span class="dt">Estradiol pg/ml</span><span class="st">`</span>), <span class="dt">na.rm =</span> T),</span>
<span id="cb104-25"><a href="#cb104-25"></a>    <span class="dt">estradiol_log_diff =</span> <span class="kw">log</span>(<span class="st">`</span><span class="dt">Estradiol pg/ml</span><span class="st">`</span>) <span class="op">-</span><span class="st"> </span>estradiol_log_mean,</span>
<span id="cb104-26"><a href="#cb104-26"></a></span>
<span id="cb104-27"><a href="#cb104-27"></a>    <span class="dt">ibl_estradiol_mean =</span> <span class="kw">mean</span>(<span class="st">`</span><span class="dt">IBL_Estradiol pg/ml</span><span class="st">`</span>, <span class="dt">na.rm =</span> T),</span>
<span id="cb104-28"><a href="#cb104-28"></a>    <span class="dt">ibl_estradiol_diff =</span> <span class="st">`</span><span class="dt">IBL_Estradiol pg/ml</span><span class="st">`</span> <span class="op">-</span><span class="st"> </span>ibl_estradiol_mean,</span>
<span id="cb104-29"><a href="#cb104-29"></a>    <span class="dt">ibl_estradiol_log_mean =</span> <span class="kw">mean</span>(<span class="kw">log</span>(<span class="st">`</span><span class="dt">IBL_Estradiol pg/ml</span><span class="st">`</span>), <span class="dt">na.rm =</span> T),</span>
<span id="cb104-30"><a href="#cb104-30"></a>    <span class="dt">ibl_estradiol_log_diff =</span> <span class="kw">log</span>(<span class="st">`</span><span class="dt">IBL_Estradiol pg/ml</span><span class="st">`</span>) <span class="op">-</span><span class="st"> </span>ibl_estradiol_log_mean,</span>
<span id="cb104-31"><a href="#cb104-31"></a>    </span>
<span id="cb104-32"><a href="#cb104-32"></a>    <span class="dt">testosterone_mean =</span> <span class="kw">mean</span>(<span class="st">`</span><span class="dt">Testosterone pg/ml</span><span class="st">`</span>, <span class="dt">na.rm =</span> T),</span>
<span id="cb104-33"><a href="#cb104-33"></a>    <span class="dt">testosterone_diff =</span> <span class="st">`</span><span class="dt">Testosterone pg/ml</span><span class="st">`</span> <span class="op">-</span><span class="st"> </span>testosterone_mean,</span>
<span id="cb104-34"><a href="#cb104-34"></a>    <span class="dt">testosterone_log_mean =</span> <span class="kw">mean</span>(<span class="kw">log</span>(<span class="st">`</span><span class="dt">Testosterone pg/ml</span><span class="st">`</span>), <span class="dt">na.rm =</span> T),</span>
<span id="cb104-35"><a href="#cb104-35"></a>    <span class="dt">testosterone_log_diff =</span> <span class="kw">log</span>(<span class="st">`</span><span class="dt">Testosterone pg/ml</span><span class="st">`</span>) <span class="op">-</span><span class="st"> </span>testosterone_log_mean,</span>
<span id="cb104-36"><a href="#cb104-36"></a>    </span>
<span id="cb104-37"><a href="#cb104-37"></a>    <span class="dt">cortisol_mean =</span> <span class="kw">mean</span>(<span class="st">`</span><span class="dt">Cortisol nmol/l</span><span class="st">`</span>, <span class="dt">na.rm =</span> T),</span>
<span id="cb104-38"><a href="#cb104-38"></a>    <span class="dt">cortisol_diff =</span> <span class="st">`</span><span class="dt">Cortisol nmol/l</span><span class="st">`</span> <span class="op">-</span><span class="st"> </span>cortisol_mean,</span>
<span id="cb104-39"><a href="#cb104-39"></a>    <span class="dt">cortisol_log_mean =</span> <span class="kw">mean</span>(<span class="kw">log</span>(<span class="st">`</span><span class="dt">Cortisol nmol/l</span><span class="st">`</span>), <span class="dt">na.rm =</span> T),</span>
<span id="cb104-40"><a href="#cb104-40"></a>    <span class="dt">cortisol_log_diff =</span> <span class="kw">log</span>(<span class="st">`</span><span class="dt">Cortisol nmol/l</span><span class="st">`</span>) <span class="op">-</span><span class="st"> </span>cortisol_log_mean</span>
<span id="cb104-41"><a href="#cb104-41"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb104-42"><a href="#cb104-42"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## mutate: changed 10 values (&lt;1%) of &#39;Cortisol nmol/l&#39; (10 new NA)</code></pre>
<pre><code>##         changed 5 values (&lt;1%) of &#39;Testosterone pg/ml&#39; (5 new NA)</code></pre>
<pre><code>##         changed 8 values (&lt;1%) of &#39;Progesterone pg/ml&#39; (8 new NA)</code></pre>
<pre><code>##         changed 4 values (&lt;1%) of &#39;Estradiol pg/ml&#39; (4 new NA)</code></pre>
<pre><code>##         changed 7 values (&lt;1%) of &#39;IBL_Estradiol pg/ml&#39; (7 new NA)</code></pre>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## mutate (grouped): new variable &#39;progesterone_mean&#39; with 139 unique values and 88% NA</code></pre>
<pre><code>##                   new variable &#39;progesterone_diff&#39; with 500 unique values and 99% NA</code></pre>
<pre><code>##                   new variable &#39;progesterone_log_mean&#39; with 139 unique values and 88% NA</code></pre>
<pre><code>##                   new variable &#39;progesterone_log_diff&#39; with 500 unique values and 99% NA</code></pre>
<pre><code>##                   new variable &#39;estradiol_mean&#39; with 75 unique values and 93% NA</code></pre>
<pre><code>##                   new variable &#39;estradiol_diff&#39; with 72 unique values and &gt;99% NA</code></pre>
<pre><code>##                   new variable &#39;estradiol_log_mean&#39; with 75 unique values and 93% NA</code></pre>
<pre><code>##                   new variable &#39;estradiol_log_diff&#39; with 72 unique values and &gt;99% NA</code></pre>
<pre><code>##                   new variable &#39;ibl_estradiol_mean&#39; with 139 unique values and 88% NA</code></pre>
<pre><code>##                   new variable &#39;ibl_estradiol_diff&#39; with 516 unique values and 99% NA</code></pre>
<pre><code>##                   new variable &#39;ibl_estradiol_log_mean&#39; with 139 unique values and 88% NA</code></pre>
<pre><code>##                   new variable &#39;ibl_estradiol_log_diff&#39; with 516 unique values and 99% NA</code></pre>
<pre><code>##                   new variable &#39;testosterone_mean&#39; with 139 unique values and 88% NA</code></pre>
<pre><code>##                   new variable &#39;testosterone_diff&#39; with 515 unique values and 99% NA</code></pre>
<pre><code>##                   new variable &#39;testosterone_log_mean&#39; with 139 unique values and 88% NA</code></pre>
<pre><code>##                   new variable &#39;testosterone_log_diff&#39; with 527 unique values and 99% NA</code></pre>
<pre><code>##                   new variable &#39;cortisol_mean&#39; with 139 unique values and 88% NA</code></pre>
<pre><code>##                   new variable &#39;cortisol_diff&#39; with 533 unique values and 99% NA</code></pre>
<pre><code>##                   new variable &#39;cortisol_log_mean&#39; with 139 unique values and 88% NA</code></pre>
<pre><code>##                   new variable &#39;cortisol_log_diff&#39; with 541 unique values and 99% NA</code></pre>
<pre><code>## ungroup: no grouping variables</code></pre>
</div>
</div>
<div id="fertility-awareness" class="section level3">
<h3>Fertility awareness</h3>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1"></a>tracked_windows &lt;-<span class="st">  </span>s4_followup <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(short, <span class="kw">starts_with</span>(<span class="st">&quot;aware_fertile&quot;</span>), <span class="op">-</span><span class="kw">ends_with</span>(<span class="st">&quot;block&quot;</span>), <span class="op">-</span>aware_fertile_reason_unusual, <span class="op">-</span>aware_fertile_effects) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-2"><a href="#cb133-2"></a><span class="st">  </span><span class="kw">filter</span>(aware_fertile_phases_number <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-3"><a href="#cb133-3"></a><span class="st">  </span><span class="kw">mutate_all</span>(as.character) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-4"><a href="#cb133-4"></a><span class="st">  </span><span class="kw">gather</span>(cycle, date, <span class="op">-</span>short, <span class="op">-</span>aware_fertile_phases_number) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-5"><a href="#cb133-5"></a><span class="st">  </span><span class="kw">tbl_df</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-6"><a href="#cb133-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cycle =</span> <span class="kw">str_sub</span>(cycle, <span class="kw">str_length</span>(<span class="st">&quot;aware_fertile_&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-7"><a href="#cb133-7"></a><span class="st">  </span><span class="kw">separate</span>(cycle, <span class="kw">c</span>(<span class="st">&quot;cycle&quot;</span>, <span class="st">&quot;startend&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-8"><a href="#cb133-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">as.Date</span>(date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-9"><a href="#cb133-9"></a><span class="st">  </span><span class="kw">spread</span>(startend, date) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-10"><a href="#cb133-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">window_length =</span> end <span class="op">-</span><span class="st"> </span>start,</span>
<span id="cb133-11"><a href="#cb133-11"></a>         <span class="dt">date_of_ovulation_awareness =</span> end <span class="op">-</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## select: dropped 37 variables (session, created, modified, ended, expired, …)</code></pre>
<pre><code>## filter: removed 867 rows (74%), 304 rows remaining</code></pre>
<pre><code>## mutate_all: converted &#39;aware_fertile_phases_number&#39; from double to character (0 new NA)</code></pre>
<pre><code>##             converted &#39;aware_fertile_1_start&#39; from Date to character (0 new NA)</code></pre>
<pre><code>##             converted &#39;aware_fertile_1_end&#39; from Date to character (0 new NA)</code></pre>
<pre><code>##             converted &#39;aware_fertile_2_start&#39; from Date to character (0 new NA)</code></pre>
<pre><code>##             converted &#39;aware_fertile_2_end&#39; from Date to character (0 new NA)</code></pre>
<pre><code>##             converted &#39;aware_fertile_3_start&#39; from Date to character (0 new NA)</code></pre>
<pre><code>##             converted &#39;aware_fertile_3_end&#39; from Date to character (0 new NA)</code></pre>
<pre><code>## gather: reorganized (aware_fertile_1_start, aware_fertile_1_end, aware_fertile_2_start, aware_fertile_2_end, aware_fertile_3_start, …) into (cycle, date) [was 304x8, now 1824x4]</code></pre>
<pre><code>## mutate: changed 1,824 values (100%) of &#39;cycle&#39; (0 new NA)</code></pre>
<pre><code>## mutate: converted &#39;date&#39; from character to Date (0 new NA)</code></pre>
<pre><code>## spread: reorganized (startend, date) into (end, start) [was 1824x5, now 912x5]</code></pre>
<pre><code>## mutate: new variable &#39;window_length&#39; with 44 unique values and 18% NA</code></pre>
<pre><code>##         new variable &#39;date_of_ovulation_awareness&#39; with 243 unique values and 18% NA</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1"></a>s3_daily &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>( tracked_windows <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb149-2"><a href="#cb149-2"></a><span class="st">                              </span><span class="kw">select</span>(short, window_length, date_of_ovulation_awareness) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb149-3"><a href="#cb149-3"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">created_date =</span> date_of_ovulation_awareness), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;short&quot;</span>, <span class="st">&quot;created_date&quot;</span>))</span></code></pre></div>
<pre><code>## select: dropped 4 variables (aware_fertile_phases_number, cycle, end, start)</code></pre>
<pre><code>## mutate: new variable &#39;created_date&#39; with 243 unique values and 18% NA</code></pre>
<pre><code>## left_join: added 2 columns (window_length, date_of_ovulation_awareness)</code></pre>
<pre><code>##            &gt; rows only in x   62,369</code></pre>
<pre><code>##            &gt; rows only in y  (   367)</code></pre>
<pre><code>##            &gt; matched rows        545</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       62,914</code></pre>
</div>
<div id="compute-menstrual-onsets" class="section level3">
<h3>Compute menstrual onsets</h3>
<p>To compute menstrual onsets from the diary data, we have to clear a few hurdles:</p>
<ul>
<li>diaries could be filled out until 3 am (and later in special cases), but participants will tend to count backwards from the preceding day when asked when the last menstruation occurred</li>
<li>we asked women only every ~3 days about menstruation (-&gt; interpolate)</li>
<li>women could report the same menstrual onset several times (-&gt; use the report closest to the onset, more accurate)</li>
<li>women reported a last menstrual onset in the demographic questionnaire preceding the diary and in the follow-up survey following the diary</li>
<li>we need to count backward and forward from each menstrual onset</li>
<li>we need to include the dates from the demographic and the follow-up questionnaire without overwriting more pertinent dates from the diary</li>
<li>we want to “bridge gaps” between reports of menstruation that are at most 40 days wide (because wider gaps probably mean that there was something going on with the menstrual cycle such as a miscarriage, menopause, etc.)</li>
</ul>
<p>Therefore we use a multi-step procedure:</p>
<ol style="list-style-type: decimal">
<li>Collect unique menstrual onsets reported by each woman from pre-survey, diary, and post-survey</li>
<li>Expand the onsets into time-series by participant.</li>
<li>“Merge”/prefer reports closer to the onset when several different reports were made</li>
<li>Count forward &amp; backward.</li>
<li>Assign cycle numbers.</li>
<li>Merge on participant &amp; created_date.</li>
</ol>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1"></a><span class="co"># step 1</span></span>
<span id="cb158-2"><a href="#cb158-2"></a>menstrual_onsets =<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb158-3"><a href="#cb158-3"></a><span class="st">  </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span></span>
<span id="cb158-4"><a href="#cb158-4"></a><span class="st">  </span><span class="kw">arrange</span>(created) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb158-5"><a href="#cb158-5"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb158-6"><a href="#cb158-6"></a>    <span class="dt">menstrual_onset_date =</span> <span class="kw">as.Date</span>(menstrual_onset_date),</span>
<span id="cb158-7"><a href="#cb158-7"></a>    <span class="dt">menstrual_onset_date_inferred =</span> <span class="kw">as.Date</span>(<span class="kw">ifelse</span>(<span class="op">!</span><span class="kw">is.na</span>(menstrual_onset_date), </span>
<span id="cb158-8"><a href="#cb158-8"></a>    menstrual_onset_date, <span class="co"># if date was given, take it</span></span>
<span id="cb158-9"><a href="#cb158-9"></a>     <span class="kw">ifelse</span>(<span class="op">!</span><span class="kw">is.na</span>(menstrual_onset), <span class="co"># if days ago was given</span></span>
<span id="cb158-10"><a href="#cb158-10"></a>            created_date <span class="op">-</span><span class="st"> </span><span class="kw">days</span>(menstrual_onset <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="co"># subtract them from current date</span></span>
<span id="cb158-11"><a href="#cb158-11"></a>            <span class="kw">as.Date</span>(<span class="ot">NA</span>)) </span>
<span id="cb158-12"><a href="#cb158-12"></a>     ), <span class="dt">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>)</span>
<span id="cb158-13"><a href="#cb158-13"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb158-14"><a href="#cb158-14"></a><span class="st">  </span><span class="kw">select</span>(session, created_date, menstrual_onset_date_inferred) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb158-15"><a href="#cb158-15"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(menstrual_onset_date_inferred)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb158-16"><a href="#cb158-16"></a><span class="st">  </span><span class="kw">unique</span>()</span></code></pre></div>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## mutate (grouped): changed 0 values (0%) of &#39;menstrual_onset_date&#39; (0 new NA)</code></pre>
<pre><code>##                   new variable &#39;menstrual_onset_date_inferred&#39; with 276 unique values and 93% NA</code></pre>
<pre><code>## select: dropped 223 variables (created, modified, ended, expired, browser, …)</code></pre>
<pre><code>## filter (grouped): removed 58,763 rows (93%), 4,151 rows remaining</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1"></a><span class="co">## add in the menstrual onsets we got from the pre and post survey and the lab</span></span>
<span id="cb164-2"><a href="#cb164-2"></a>lab_onsets &lt;-<span class="st"> </span>lab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, created_date, <span class="dt">menstrual_onset_date_inferred =</span> <span class="st">`</span><span class="dt">Menstrual Onset</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb164-3"><a href="#cb164-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">menstrual_onset_date_inferred =</span> <span class="kw">as.Date</span>(menstrual_onset_date_inferred)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb164-4"><a href="#cb164-4"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(menstrual_onset_date_inferred))</span></code></pre></div>
<pre><code>## select: renamed one variable (menstrual_onset_date_inferred) and dropped 50 variables</code></pre>
<pre><code>## mutate: converted &#39;menstrual_onset_date_inferred&#39; from double to Date (0 new NA)</code></pre>
<pre><code>## filter: no rows removed</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1"></a>mons =<span class="st"> </span>menstrual_onsets <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-2"><a href="#cb168-2"></a><span class="st">  </span><span class="kw">select</span>(session, created_date, menstrual_onset_date_inferred) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-3"><a href="#cb168-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_origin =</span> <span class="st">&quot;diary&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-4"><a href="#cb168-4"></a><span class="st">   </span><span class="kw">bind_rows</span>(</span>
<span id="cb168-5"><a href="#cb168-5"></a>      s1_menstruation_start <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">date_origin =</span> <span class="st">&quot;demo&quot;</span>), </span>
<span id="cb168-6"><a href="#cb168-6"></a>      s5_hadmenstruation <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">date_origin =</span> <span class="st">&quot;followup&quot;</span>),</span>
<span id="cb168-7"><a href="#cb168-7"></a>      lab_onsets <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">date_origin =</span> <span class="st">&quot;lab&quot;</span>)</span>
<span id="cb168-8"><a href="#cb168-8"></a>     ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-9"><a href="#cb168-9"></a><span class="st">  </span><span class="kw">filter</span>( <span class="op">!</span><span class="kw">is.na</span>(menstrual_onset_date_inferred)) <span class="op">%&gt;%</span></span>
<span id="cb168-10"><a href="#cb168-10"></a><span class="st">  </span><span class="kw">arrange</span>(session, menstrual_onset_date_inferred, created_date) <span class="op">%&gt;%</span></span>
<span id="cb168-11"><a href="#cb168-11"></a><span class="st">  </span><span class="kw">unique</span>() <span class="op">%&gt;%</span></span>
<span id="cb168-12"><a href="#cb168-12"></a><span class="st">  </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span></span>
<span id="cb168-13"><a href="#cb168-13"></a><span class="st">      </span><span class="co"># step 3: prefer reports closer to event if they conflict</span></span>
<span id="cb168-14"><a href="#cb168-14"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb168-15"><a href="#cb168-15"></a>    <span class="dt">onset_diff =</span> <span class="kw">abs</span>( <span class="kw">as.double</span>( <span class="kw">lag</span>(menstrual_onset_date_inferred) <span class="op">-</span><span class="st"> </span>menstrual_onset_date_inferred, <span class="dt">units =</span> <span class="st">&quot;days&quot;</span>)), <span class="co"># was there a change compared to the last reported menstrual onset (first one gets NA)</span></span>
<span id="cb168-16"><a href="#cb168-16"></a>    <span class="dt">menstrual_onset_date_inferred =</span> <span class="kw">if_else</span>(onset_diff <span class="op">&lt;</span><span class="st"> </span><span class="dv">7</span>, <span class="co"># if last date is known, but is slightly different from current date </span></span>
<span id="cb168-17"><a href="#cb168-17"></a>                 <span class="kw">as.Date</span>(<span class="ot">NA</span>), <span class="co"># attribute it to memory, not extremely short cycle, use fresher date</span></span>
<span id="cb168-18"><a href="#cb168-18"></a>                 menstrual_onset_date_inferred, <span class="co"># if it&#39;s a big difference, use the current date </span></span>
<span id="cb168-19"><a href="#cb168-19"></a>                 menstrual_onset_date_inferred <span class="co"># use current date if last date not known/first onset</span></span>
<span id="cb168-20"><a href="#cb168-20"></a>                 ) <span class="co"># if no date is assigned today, keep it like that</span></span>
<span id="cb168-21"><a href="#cb168-21"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># carry the last MO forward</span></span>
<span id="cb168-22"><a href="#cb168-22"></a><span class="st">  </span><span class="co"># mutate(created_date = menstrual_onset_date_inferred) %&gt;%</span></span>
<span id="cb168-23"><a href="#cb168-23"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(menstrual_onset_date_inferred))</span></code></pre></div>
<pre><code>## select: no changes</code></pre>
<pre><code>## mutate (grouped): new variable &#39;date_origin&#39; with one unique value and 0% NA</code></pre>
<pre><code>## mutate: new variable &#39;date_origin&#39; with one unique value and 0% NA
## mutate: new variable &#39;date_origin&#39; with one unique value and 0% NA
## mutate: new variable &#39;date_origin&#39; with one unique value and 0% NA</code></pre>
<pre><code>## filter (grouped): no rows removed</code></pre>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## mutate (grouped): changed 2,604 values (40%) of &#39;menstrual_onset_date_inferred&#39; (2604 new NA)</code></pre>
<pre><code>##                   new variable &#39;onset_diff&#39; with 104 unique values and 20% NA</code></pre>
<pre><code>## filter (grouped): removed 2,604 rows (40%), 3,827 rows remaining</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1"></a><span class="kw">nrow</span>(mons)</span></code></pre></div>
<pre><code>## [1] 3827</code></pre>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1"></a><span class="co"># mons %&gt;% filter(created_date &lt; menstrual_onset_date_inferred) %&gt;% View</span></span>
<span id="cb179-2"><a href="#cb179-2"></a>mons <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(session, created_date) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>()<span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## group_by: 2 grouping variables (session, created_date)</code></pre>
<pre><code>## filter (grouped): removed 3,823 rows (&gt;99%), 4 rows remaining</code></pre>
<pre><code>## # A tibble: 4 x 5
##   session                                         created_date menstrual_onset_date_in… date_origin onset_diff
##   &lt;chr&gt;                                           &lt;date&gt;       &lt;date&gt;                   &lt;chr&gt;            &lt;dbl&gt;
## 1 -QE3RufkOaQJi-Gdcfrron_w1D-1zp9PBFbVmbBgbiNS09… 2016-10-17   2016-10-05               demo                NA
## 2 -QE3RufkOaQJi-Gdcfrron_w1D-1zp9PBFbVmbBgbiNS09… 2016-10-17   2016-11-05               lab                 31
## 3 jWdPyo_IKd4KJfTpZNMQ_1vdfAvhO3-82Y7qnm-nHRE6Q9… 2016-09-19   2016-09-02               demo                NA
## 4 jWdPyo_IKd4KJfTpZNMQ_1vdfAvhO3-82Y7qnm-nHRE6Q9… 2016-09-19   2016-09-29               lab                 27</code></pre>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1"></a>mons <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(session, created_date) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>()</span></code></pre></div>
<pre><code>## distinct (grouped): removed 2 rows (&lt;1%), 3,825 rows remaining</code></pre>
<pre><code>## [1] 3825</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1"></a>mons <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="st">&quot;lab&quot;</span> <span class="op">%in%</span><span class="st"> </span>date_origin)</span></code></pre></div>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## filter (grouped): removed 3,293 rows (86%), 534 rows remaining</code></pre>
<pre><code>## # A tibble: 534 x 5
##    session                                        created_date menstrual_onset_date_in… date_origin onset_diff
##    &lt;chr&gt;                                          &lt;date&gt;       &lt;date&gt;                   &lt;chr&gt;            &lt;dbl&gt;
##  1 _EQ98zBViYQhrRRoVXVag6gA3YYU_xkE0kQaCOhlsV24N… 2016-10-27   2016-10-05               demo                NA
##  2 _EQ98zBViYQhrRRoVXVag6gA3YYU_xkE0kQaCOhlsV24N… 2016-11-03   2016-11-03               diary               29
##  3 _EQ98zBViYQhrRRoVXVag6gA3YYU_xkE0kQaCOhlsV24N… 2016-11-14   2016-12-01               lab                 27
##  4 _EQ98zBViYQhrRRoVXVag6gA3YYU_xkE0kQaCOhlsV24N… 2017-01-04   2016-12-31               diary               30
##  5 -QE3RufkOaQJi-Gdcfrron_w1D-1zp9PBFbVmbBgbiNS0… 2016-10-17   2016-10-05               demo                NA
##  6 -QE3RufkOaQJi-Gdcfrron_w1D-1zp9PBFbVmbBgbiNS0… 2016-10-17   2016-11-05               lab                 31
##  7 -QE3RufkOaQJi-Gdcfrron_w1D-1zp9PBFbVmbBgbiNS0… 2016-11-17   2016-12-03               lab                 28
##  8 -QE3RufkOaQJi-Gdcfrron_w1D-1zp9PBFbVmbBgbiNS0… 2017-01-02   2017-01-02               followup            30
##  9 10tuOUPxebpLQWXZk93kcys9TipSZaW1wqtXV30ynk8Ey… 2016-05-03   2016-04-02               demo                NA
## 10 10tuOUPxebpLQWXZk93kcys9TipSZaW1wqtXV30ynk8Ey… 2016-05-09   2016-05-09               diary               37
## # … with 524 more rows</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1"></a><span class="co"># mons %&gt;% filter(session %starts_with% &quot;2x-juq&quot;) %&gt;% View()</span></span>
<span id="cb190-2"><a href="#cb190-2"></a></span>
<span id="cb190-3"><a href="#cb190-3"></a></span>
<span id="cb190-4"><a href="#cb190-4"></a><span class="co"># now turn our dataset of menstrual onsets into full time series</span></span>
<span id="cb190-5"><a href="#cb190-5"></a>menstrual_days =<span class="st"> </span>mons <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(session, created_date) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb190-6"><a href="#cb190-6"></a><span class="st">  </span><span class="kw">arrange</span>(session, created_date) <span class="op">%&gt;%</span></span>
<span id="cb190-7"><a href="#cb190-7"></a><span class="st">  </span><span class="co"># step 2 expand into time-series for participant</span></span>
<span id="cb190-8"><a href="#cb190-8"></a><span class="st">  </span><span class="kw">full_join</span>(s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, created_date), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>, <span class="st">&quot;created_date&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb190-9"><a href="#cb190-9"></a><span class="st">  </span><span class="kw">full_join</span>(mons <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">created_date =</span> menstrual_onset_date_inferred), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>, <span class="st">&quot;created_date&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb190-10"><a href="#cb190-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_origin =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(date_origin), <span class="st">&quot;not_onset&quot;</span>, date_origin)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb190-11"><a href="#cb190-11"></a><span class="st">  </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span></span>
<span id="cb190-12"><a href="#cb190-12"></a><span class="st">  </span><span class="kw">complete</span>(<span class="dt">created_date =</span> <span class="kw">full_seq</span>(created_date, <span class="dt">period =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb190-13"><a href="#cb190-13"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_origin =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(date_origin), <span class="st">&quot;unobserved_day&quot;</span>, date_origin)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb190-14"><a href="#cb190-14"></a><span class="st">  </span><span class="kw">arrange</span>(created_date) <span class="op">%&gt;%</span></span>
<span id="cb190-15"><a href="#cb190-15"></a><span class="st">  </span><span class="kw">distinct</span>(session, created_date, menstrual_onset_date_inferred, <span class="dt">.keep_all =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb190-16"><a href="#cb190-16"></a><span class="st">  </span><span class="kw">arrange</span>(session, created_date, menstrual_onset_date_inferred) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb190-17"><a href="#cb190-17"></a><span class="st">  </span><span class="kw">distinct</span>(session, created_date, <span class="dt">.keep_all =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## distinct (grouped): removed 2 rows (&lt;1%), 3,825 rows remaining</code></pre>
<pre><code>## select: dropped 223 variables (created, modified, ended, expired, browser, …)</code></pre>
<pre><code>## full_join: added no columns</code></pre>
<pre><code>##            &gt; rows only in x    1,576</code></pre>
<pre><code>##            &gt; rows only in y   60,665</code></pre>
<pre><code>##            &gt; matched rows      2,249</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       64,490</code></pre>
<pre><code>## mutate (grouped): changed 3,377 values (88%) of &#39;created_date&#39; (0 new NA)</code></pre>
<pre><code>## full_join: added 3 columns (menstrual_onset_date_inferred, date_origin, onset_diff)</code></pre>
<pre><code>##            &gt; rows only in x   62,654</code></pre>
<pre><code>##            &gt; rows only in y    1,991</code></pre>
<pre><code>##            &gt; matched rows      1,836</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       66,481</code></pre>
<pre><code>## mutate (grouped): changed 62,654 values (94%) of &#39;date_origin&#39; (62654 fewer NA)</code></pre>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## mutate (grouped): changed 44,337 values (40%) of &#39;date_origin&#39; (44337 fewer NA)</code></pre>
<pre><code>## distinct (grouped): no rows removed
## distinct (grouped): no rows removed</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1"></a><span class="kw">table</span>(menstrual_days<span class="op">$</span>date_origin, <span class="dt">exclude =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<pre><code>## 
##           demo          diary       followup            lab      not_onset unobserved_day 
##           1243           1884            417            283          62654          44337</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1"></a>menstrual_days <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(date_origin <span class="op">!=</span><span class="st"> &quot;filledin&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="kw">mean</span>(n))</span></code></pre></div>
<pre><code>## filter (grouped): no rows removed</code></pre>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## summarise: now 1,545 rows and 2 columns, ungrouped</code></pre>
<pre><code>## summarise: now one row and one column, ungrouped</code></pre>
<pre><code>## # A tibble: 1 x 1
##   `mean(n)`
##       &lt;dbl&gt;
## 1      71.7</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1"></a>menstrual_days <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="kw">mean</span>(n))</span></code></pre></div>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## summarise: now 1,545 rows and 2 columns, ungrouped</code></pre>
<pre><code>## summarise: now one row and one column, ungrouped</code></pre>
<pre><code>## # A tibble: 1 x 1
##   `mean(n)`
##       &lt;dbl&gt;
## 1      71.7</code></pre>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1"></a>menstrual_days <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(n) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">qplot</span>()</span></code></pre></div>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## summarise: now 1,545 rows and 2 columns, ungrouped</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="0_wrangle_data_files/figure-html/menstrual_onsets-1.png" width="672" /></p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1"></a>menstrual_days <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, created_date) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb227-2"><a href="#cb227-2"></a><span class="st">            </span><span class="kw">group_by</span>(session, created_date) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>()<span class="op">&gt;</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>() <span class="op">%&gt;%</span><span class="st"> </span>{ . <span class="op">==</span><span class="st"> </span><span class="dv">0</span>} <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">stopifnot</span>()</span></code></pre></div>
<pre><code>## drop_na (grouped): no rows removed</code></pre>
<pre><code>## group_by: 2 grouping variables (session, created_date)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1"></a><span class="co"># menstrual_onsets %&gt;% filter(session == &quot;_2efChMgmsXAYmalYlRY9epxS_wse0ytWYttV6tLi6FUd2FRENkr9JgVnmtzaMCs&quot;)</span></span>
<span id="cb231-2"><a href="#cb231-2"></a><span class="co"># mons %&gt;% filter(session %starts_with% &quot;_2sufSUfIWjNXg6xfRzJaCid9jzkY&quot;) %&gt;% View()</span></span>
<span id="cb231-3"><a href="#cb231-3"></a><span class="co"># menstrual_onsets %&gt;% filter(session %starts_with% &quot;_2sufSUfIWjNXg6xfRzJaCid9jzkY&quot;) %&gt;% View()</span></span>
<span id="cb231-4"><a href="#cb231-4"></a></span>
<span id="cb231-5"><a href="#cb231-5"></a>menstrual_days =<span class="st"> </span>menstrual_days <span class="op">%&gt;%</span></span>
<span id="cb231-6"><a href="#cb231-6"></a><span class="st">  </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb231-7"><a href="#cb231-7"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb231-8"><a href="#cb231-8"></a>    <span class="co"># carry the last observation (the last observed menstrual onset) backward/forward (within person), but we don&#39;t do this if we&#39;d bridge more than 40 days this way</span></span>
<span id="cb231-9"><a href="#cb231-9"></a>    <span class="co"># first we carry it backward (because reporting is retrospective)</span></span>
<span id="cb231-10"><a href="#cb231-10"></a>    <span class="dt">next_menstrual_onset =</span> rcamisc<span class="op">::</span><span class="kw">repeat_last</span>(menstrual_onset_date_inferred, <span class="dt">forward =</span> <span class="ot">FALSE</span>),</span>
<span id="cb231-11"><a href="#cb231-11"></a>    <span class="co"># then we carry it forward</span></span>
<span id="cb231-12"><a href="#cb231-12"></a>    <span class="dt">last_menstrual_onset =</span> rcamisc<span class="op">::</span><span class="kw">repeat_last</span>(menstrual_onset_date_inferred),</span>
<span id="cb231-13"><a href="#cb231-13"></a>    <span class="co"># in the next cycle, count to the next onset, not the last</span></span>
<span id="cb231-14"><a href="#cb231-14"></a>    <span class="dt">next_menstrual_onset =</span> <span class="kw">if_else</span>(next_menstrual_onset <span class="op">==</span><span class="st"> </span>last_menstrual_onset,</span>
<span id="cb231-15"><a href="#cb231-15"></a>                                   <span class="kw">lead</span>(next_menstrual_onset),</span>
<span id="cb231-16"><a href="#cb231-16"></a>                                   next_menstrual_onset),</span>
<span id="cb231-17"><a href="#cb231-17"></a>    <span class="co"># calculate the diff to current date</span></span>
<span id="cb231-18"><a href="#cb231-18"></a>    <span class="dt">menstrual_onset_days_until =</span> <span class="kw">as.numeric</span>(created_date <span class="op">-</span><span class="st"> </span>next_menstrual_onset),</span>
<span id="cb231-19"><a href="#cb231-19"></a>    <span class="dt">menstrual_onset_days_since =</span> <span class="kw">as.numeric</span>(created_date <span class="op">-</span><span class="st"> </span>last_menstrual_onset)</span>
<span id="cb231-20"><a href="#cb231-20"></a>    )</span></code></pre></div>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## mutate (grouped): new variable &#39;next_menstrual_onset&#39; with 307 unique values and 29% NA</code></pre>
<pre><code>##                   new variable &#39;last_menstrual_onset&#39; with 338 unique values and 13% NA</code></pre>
<pre><code>##                   new variable &#39;menstrual_onset_days_until&#39; with 293 unique values and 29% NA</code></pre>
<pre><code>##                   new variable &#39;menstrual_onset_days_since&#39; with 293 unique values and 13% NA</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1"></a>menstrual_days <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, created_date) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb237-2"><a href="#cb237-2"></a><span class="st">            </span><span class="kw">group_by</span>(session, created_date) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>()<span class="op">&gt;</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>() <span class="op">%&gt;%</span><span class="st"> </span>{ . <span class="op">==</span><span class="st"> </span><span class="dv">0</span>} <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">stopifnot</span>()</span></code></pre></div>
<pre><code>## drop_na (grouped): no rows removed</code></pre>
<pre><code>## group_by: 2 grouping variables (session, created_date)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1"></a>avg_cycle_lengths =<span class="st"> </span>menstrual_days <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb241-2"><a href="#cb241-2"></a><span class="st">  </span><span class="kw">select</span>(session, last_menstrual_onset, next_menstrual_onset) <span class="op">%&gt;%</span></span>
<span id="cb241-3"><a href="#cb241-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">next_menstrual_onset_if_no_last =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(last_menstrual_onset), next_menstrual_onset, <span class="kw">as.Date</span>(<span class="ot">NA_character_</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb241-4"><a href="#cb241-4"></a><span class="st">  </span><span class="kw">arrange</span>(session, next_menstrual_onset_if_no_last, last_menstrual_onset) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb241-5"><a href="#cb241-5"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>next_menstrual_onset) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb241-6"><a href="#cb241-6"></a><span class="st">  </span><span class="kw">distinct</span>(session, last_menstrual_onset, next_menstrual_onset_if_no_last, <span class="dt">.keep_all =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb241-7"><a href="#cb241-7"></a><span class="st">  </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb241-8"><a href="#cb241-8"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb241-9"><a href="#cb241-9"></a>    <span class="dt">number_of_cycles =</span> <span class="kw">n</span>(),</span>
<span id="cb241-10"><a href="#cb241-10"></a>    <span class="dt">cycle_nr =</span> <span class="kw">row_number</span>(),</span>
<span id="cb241-11"><a href="#cb241-11"></a>    <span class="dt">cycle_length =</span> <span class="kw">as.double</span>(<span class="kw">lead</span>(last_menstrual_onset) <span class="op">-</span><span class="st"> </span>last_menstrual_onset, <span class="dt">units =</span> <span class="st">&quot;days&quot;</span>),</span>
<span id="cb241-12"><a href="#cb241-12"></a>    <span class="dt">cycle_nr_fully_observed =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(cycle_length)),</span>
<span id="cb241-13"><a href="#cb241-13"></a>    <span class="dt">mean_cycle_length_diary =</span> <span class="kw">mean</span>(cycle_length, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb241-14"><a href="#cb241-14"></a>    <span class="dt">median_cycle_length_diary =</span> <span class="kw">median</span>(cycle_length, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb241-15"><a href="#cb241-15"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(last_menstrual_onset) <span class="op">|</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(next_menstrual_onset_if_no_last))</span></code></pre></div>
<pre><code>## select: dropped 6 variables (created_date, menstrual_onset_date_inferred, date_origin, onset_diff, menstrual_onset_days_until, …)</code></pre>
<pre><code>## mutate (grouped): new variable &#39;next_menstrual_onset_if_no_last&#39; with one unique value and 100% NA</code></pre>
<pre><code>## select: dropped one variable (next_menstrual_onset)</code></pre>
<pre><code>## distinct (grouped): removed 106,696 rows (96%), 4,122 rows remaining</code></pre>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## mutate (grouped): new variable &#39;number_of_cycles&#39; with 7 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;cycle_nr&#39; with 7 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;cycle_length&#39; with 97 unique values and 39% NA</code></pre>
<pre><code>##                   new variable &#39;cycle_nr_fully_observed&#39; with 6 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;mean_cycle_length_diary&#39; with 176 unique values and 14% NA</code></pre>
<pre><code>##                   new variable &#39;median_cycle_length_diary&#39; with 110 unique values and 14% NA</code></pre>
<pre><code>## filter (grouped): removed 295 rows (7%), 3,827 rows remaining</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1"></a><span class="co"># avg_cycle_lengths %&gt;% filter(session %starts_with% &quot;_sqtMf5&quot;) %&gt;% View(&quot;cycles&quot;)</span></span>
<span id="cb254-2"><a href="#cb254-2"></a></span>
<span id="cb254-3"><a href="#cb254-3"></a><span class="kw">table</span>(<span class="kw">is.na</span>(avg_cycle_lengths<span class="op">$</span>cycle_nr))</span></code></pre></div>
<pre><code>## 
## FALSE 
##  3827</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1"></a><span class="co"># menstrual_onsets %&gt;% filter(session %starts_with% &quot;_2sufSUfIWjNXg6xfRzJaCid9jzkY&quot;) %&gt;% View()</span></span>
<span id="cb256-2"><a href="#cb256-2"></a></span>
<span id="cb256-3"><a href="#cb256-3"></a>gaps &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(session <span class="op">%starts_with%</span><span class="st"> &quot;--_MgFd&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tbl_df</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(created_date) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">diff</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>(.)</span></code></pre></div>
<pre><code>## filter: removed 62,864 rows (&gt;99%), 50 rows remaining</code></pre>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1"></a><span class="kw">stopifnot</span>(<span class="op">!</span><span class="kw">all</span>(gaps <span class="op">==</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb258-2"><a href="#cb258-2"></a></span>
<span id="cb258-3"><a href="#cb258-3"></a>s3_daily &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb258-4"><a href="#cb258-4"></a><span class="st">  </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb258-5"><a href="#cb258-5"></a><span class="st">  </span><span class="kw">complete</span>(<span class="dt">created_date =</span> <span class="kw">full_seq</span>(created_date, <span class="dt">period =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># include the gap days in the diary (happens by default in formr, this just to ensure)</span></span>
<span id="cb258-6"><a href="#cb258-6"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb258-7"><a href="#cb258-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">diary_day_observation =</span> <span class="kw">case_when</span>(</span>
<span id="cb258-8"><a href="#cb258-8"></a>    <span class="kw">is.na</span>(created) <span class="op">~</span><span class="st"> &quot;interpolated&quot;</span>,</span>
<span id="cb258-9"><a href="#cb258-9"></a>    <span class="kw">is.na</span>(modified) <span class="op">~</span><span class="st"> &quot;not_answered&quot;</span>,</span>
<span id="cb258-10"><a href="#cb258-10"></a>    <span class="op">!</span><span class="kw">is.na</span>(expired) <span class="op">~</span><span class="st"> &quot;started_not_finished&quot;</span>,</span>
<span id="cb258-11"><a href="#cb258-11"></a>    <span class="kw">is.na</span>(ended) <span class="op">~</span><span class="st"> &quot;not_finished&quot;</span>,</span>
<span id="cb258-12"><a href="#cb258-12"></a>    <span class="op">!</span><span class="kw">is.na</span>(ended) <span class="op">~</span><span class="st"> &quot;finished&quot;</span></span>
<span id="cb258-13"><a href="#cb258-13"></a>  )) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb258-14"><a href="#cb258-14"></a><span class="st">  </span><span class="kw">left_join</span>(menstrual_days <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb258-15"><a href="#cb258-15"></a><span class="st">    </span><span class="kw">select</span>(session, created_date, next_menstrual_onset, last_menstrual_onset, menstrual_onset_days_until, menstrual_onset_days_since, date_origin),</span>
<span id="cb258-16"><a href="#cb258-16"></a>    <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>, <span class="st">&quot;created_date&quot;</span>)</span>
<span id="cb258-17"><a href="#cb258-17"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb258-18"><a href="#cb258-18"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb258-19"><a href="#cb258-19"></a>  <span class="dt">menstruation_today =</span> <span class="kw">if_else</span>(menstruation_since_last_entry <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="kw">as.numeric</span>(menstruation_today), <span class="dv">0</span>),</span>
<span id="cb258-20"><a href="#cb258-20"></a>  <span class="dt">menstruation_labelled =</span> <span class="kw">factor</span>(<span class="kw">if_else</span>(<span class="op">!</span><span class="st"> </span><span class="kw">is.na</span>(menstruation_today),</span>
<span id="cb258-21"><a href="#cb258-21"></a>       <span class="kw">if_else</span>(menstruation_today <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>),</span>
<span id="cb258-22"><a href="#cb258-22"></a>       <span class="kw">if_else</span>(menstrual_onset_days_since <span class="op">&lt;=</span><span class="st"> </span><span class="dv">5</span>, </span>
<span id="cb258-23"><a href="#cb258-23"></a>              <span class="kw">if_else</span>(menstrual_onset_days_since <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;probably&quot;</span>, <span class="st">&quot;no&quot;</span>), </span>
<span id="cb258-24"><a href="#cb258-24"></a>                <span class="st">&quot;no&quot;</span>, <span class="st">&quot;no&quot;</span>)),</span>
<span id="cb258-25"><a href="#cb258-25"></a>                 <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&#39;yes&#39;</span>, <span class="st">&#39;probably&#39;</span>, <span class="st">&#39;no&#39;</span>))</span>
<span id="cb258-26"><a href="#cb258-26"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb258-27"><a href="#cb258-27"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">next_menstrual_onset_if_no_last =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(last_menstrual_onset), next_menstrual_onset, <span class="kw">as.Date</span>(<span class="ot">NA_character_</span>)))</span></code></pre></div>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## mutate: new variable &#39;diary_day_observation&#39; with 5 unique values and 0% NA</code></pre>
<pre><code>## select: dropped 2 variables (menstrual_onset_date_inferred, onset_diff)</code></pre>
<pre><code>## left_join: added 5 columns (next_menstrual_onset, last_menstrual_onset, menstrual_onset_days_until, menstrual_onset_days_since, date_origin)</code></pre>
<pre><code>##            &gt; rows only in x        0</code></pre>
<pre><code>##            &gt; rows only in y  (31,569)</code></pre>
<pre><code>##            &gt; matched rows     79,249</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       79,249</code></pre>
<pre><code>## mutate: changed 13,848 values (17%) of &#39;menstruation_today&#39; (13848 fewer NA)</code></pre>
<pre><code>##         new variable &#39;menstruation_labelled&#39; with 3 unique values and 0% NA</code></pre>
<pre><code>## mutate: new variable &#39;next_menstrual_onset_if_no_last&#39; with one unique value and 100% NA</code></pre>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1"></a>gaps &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(session <span class="op">%starts_with%</span><span class="st"> &quot;--_MgFd&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tbl_df</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(created_date) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">diff</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>(.)</span></code></pre></div>
<pre><code>## filter: removed 79,182 rows (&gt;99%), 67 rows remaining</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1"></a><span class="kw">stopifnot</span>(<span class="kw">all</span>(gaps <span class="op">==</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb274-2"><a href="#cb274-2"></a></span>
<span id="cb274-3"><a href="#cb274-3"></a>s3_daily &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb274-4"><a href="#cb274-4"></a><span class="st">  </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb274-5"><a href="#cb274-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">first_diary_day =</span> <span class="kw">first</span>(<span class="kw">na.omit</span>(first_diary_day)),</span>
<span id="cb274-6"><a href="#cb274-6"></a>         <span class="dt">day_number =</span> <span class="kw">round</span>(<span class="kw">as.numeric</span>(<span class="kw">as.Date</span>(created_date) <span class="op">-</span><span class="st"> </span>first_diary_day, <span class="dt">unit =</span> <span class="st">&#39;days&#39;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb274-7"><a href="#cb274-7"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## mutate (grouped): changed 16,583 values (21%) of &#39;first_diary_day&#39; (16583 fewer NA)</code></pre>
<pre><code>##                   new variable &#39;day_number&#39; with 408 unique values and 0% NA</code></pre>
<pre><code>## ungroup: no grouping variables</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1"></a><span class="co"># s3_daily %&gt;% filter(is.na(day_number)) %&gt;% select(session, short, created_date, ended, first_diary_day) %&gt;% arrange(short, created_date) %&gt;% View</span></span>
<span id="cb279-2"><a href="#cb279-2"></a><span class="kw">table</span>(s3_daily<span class="op">$</span>day_number, <span class="dt">exclude =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<pre><code>## 
## -263 -262 -261 -260 -259 -258 -257 -256 -255 -254 -253 -252 -251 -250 -249 -248 -247 -246 -245 -244 -243 -242 
##    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1 
## -241 -240 -239 -238 -237 -236 -235 -234 -233 -232 -231 -230 -229 -228 -227 -226 -225 -224 -223 -222 -221 -220 
##    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1 
## -219 -218 -217 -216 -215 -214 -213 -212 -211 -210 -209 -208 -207 -206 -205 -204 -203 -202 -201 -200 -199 -198 
##    1    1    1    1    1    1    1    1    1    1    2    2    2    2    2    2    2    2    2    2    2    2 
## -197 -196 -195 -194 -193 -192 -191 -190 -189 -188 -187 -186 -185 -184 -183 -182 -181 -180 -179 -178 -177 -176 
##    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2 
## -175 -174 -173 -172 -171 -170 -169 -168 -167 -166 -165 -164 -163 -162 -161 -160 -159 -158 -157 -156 -155 -154 
##    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2 
## -153 -152 -151 -150 -149 -148 -147 -146 -145 -144 -143 -142 -141 -140 -139 -138 -137 -136 -135 -134 -133 -132 
##    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2 
## -131 -130 -129 -128 -127 -126 -125 -124 -123 -122 -121 -120 -119 -118 -117 -116 -115 -114 -113 -112 -111 -110 
##    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2 
## -109 -108 -107 -106 -105 -104 -103 -102 -101 -100  -99  -98  -97  -96  -95  -94  -93  -92  -91  -90  -89  -88 
##    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2    2 
##  -87  -86  -85  -84  -83  -82  -81  -80  -79  -78  -77  -76  -75  -74  -73  -72  -71  -70  -69  -68  -67  -66 
##    2    2    2    2    2    2    2    2    2    2    2    2    2    2    4    4    4    4    4    4    4    4 
##  -65  -64  -63  -62  -61  -60  -59  -58  -57  -56  -55  -54  -53  -52  -51  -50  -49  -48  -47  -46  -45  -44 
##    4    4    4    4    4    4    5    5    5    5    5    5    5    5    6    6    6    6    6    6    6    7 
##  -43  -42  -41  -40  -39  -38  -37  -36  -35  -34  -33  -32  -31  -30  -29  -28  -27  -26  -25  -24  -23  -22 
##    7    8    8    8    9   10   11   11   11   11   11   11   11   12   13   13   13   13   14   14   15   17 
##  -21  -20  -19  -18  -17  -16  -15  -14  -13  -12  -11  -10   -9   -8   -7   -6   -5   -4   -3   -2   -1    0 
##   17   17   18   20   20   20   21   22   22   23   24   24   25   25   27   28   28   32   33   34   40 1373 
##    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16   17   18   19   20   21   22 
## 1339 1326 1314 1310 1303 1294 1288 1284 1277 1266 1256 1250 1242 1232 1227 1222 1212 1205 1199 1189 1175 1166 
##   23   24   25   26   27   28   29   30   31   32   33   34   35   36   37   38   39   40   41   42   43   44 
## 1162 1155 1150 1143 1138 1133 1131 1126 1123 1113 1110 1107 1104 1099 1094 1090 1084 1080 1075 1068 1065 1056 
##   45   46   47   48   49   50   51   52   53   54   55   56   57   58   59   60   61   62   63   64   65   66 
## 1049 1045 1040 1035 1030 1027 1025 1019 1014 1006 1001  996  989  981  974  969  964  953  940  932  909  873 
##   67   68   69   70   71   72   73   74   75   76   77   78   79   80   81   82   83   84   85   86   87   88 
##  838  737  575   88   30   29   29   28   26   25   24   22   22   22   20   20   20   18   16   14   13   13 
##   89   90   91   92   93   94   95   96   97   98   99  100  101  102  103  104  105  106  107  108  109  110 
##   13   13   12   11   11   10    8    8    8    7    7    7    7    7    7    7    7    6    6    6    5    5 
##  111  112  113  114  115  116  117  118  119  120  121  122  123  124  125  126  127  128  129  130  131  132 
##    5    5    4    3    3    3    3    3    3    3    3    2    2    2    2    2    2    2    2    2    2    2 
##  133  134  135  136  137  138  139  140  141  142  143  144 
##    2    2    1    1    1    1    1    1    1    1    1    1</code></pre>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1"></a><span class="kw">table</span>(s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(ended) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(day_number), <span class="dt">exclude =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<pre><code>## drop_na: removed 18,062 rows (23%), 61,187 rows remaining</code></pre>
<pre><code>## 
##    0    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16   17   18   19   20   21 
## 1324 1137 1132 1104 1121 1102 1092 1095 1057 1035 1027 1038 1028 1009 1001  982  975  997  959  940  965  933 
##   22   23   24   25   26   27   28   29   30   31   32   33   34   35   36   37   38   39   40   41   42   43 
##  935  893  903  911  886  893  878  891  854  872  857  863  859  839  834  798  819  808  826  814  809  775 
##   44   45   46   47   48   49   50   51   52   53   54   55   56   57   58   59   60   61   62   63   64   65 
##  784  777  781  786  793  767  756  761  749  761  758  767  740  733  736  739  739  737  746  734  718  718 
##   66   67   68   69   70 
##  706  723  703  549   56</code></pre>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1"></a>testthat<span class="op">::</span><span class="kw">expect_true</span>(<span class="kw">all</span>(s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(ended) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(day_number) <span class="op">%in%</span><span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">70</span>))</span></code></pre></div>
<pre><code>## drop_na: removed 18,062 rows (23%), 61,187 rows remaining</code></pre>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1"></a><span class="kw">stopifnot</span>(s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, day_number) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(session, day_number) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>() <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## drop_na: no rows removed</code></pre>
<pre><code>## group_by: 2 grouping variables (session, day_number)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1"></a>gaps &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb290-2"><a href="#cb290-2"></a><span class="st">  </span><span class="kw">drop_na</span>(session) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb290-3"><a href="#cb290-3"></a><span class="st">  </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb290-4"><a href="#cb290-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">no_gaps =</span> <span class="kw">all</span>(<span class="kw">as.numeric</span>(<span class="kw">diff</span>(created_date)) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>),</span>
<span id="cb290-5"><a href="#cb290-5"></a>            <span class="dt">n =</span> <span class="kw">n</span>(),</span>
<span id="cb290-6"><a href="#cb290-6"></a>            <span class="dt">range =</span> <span class="kw">paste</span>(<span class="kw">range</span>(day_number), <span class="dt">collapse =</span> <span class="st">&#39;-&#39;</span>))</span></code></pre></div>
<pre><code>## drop_na: no rows removed</code></pre>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## summarise: now 1,373 rows and 4 columns, ungrouped</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1"></a><span class="kw">stopifnot</span>(<span class="kw">all</span>(gaps<span class="op">$</span>no_gaps))</span>
<span id="cb294-2"><a href="#cb294-2"></a><span class="co"># sort(table(gaps$range))</span></span></code></pre></div>
</div>
<div id="estimate-day-of-ovulation" class="section level3">
<h3>Estimate day of ovulation</h3>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1"></a><span class="co"># s3_daily %&gt;% filter(short == &quot;_sqtMf5&quot;) %&gt;% select(short, created_date, ended, menstruation_labelled, next_menstrual_onset_if_no_last, last_menstrual_onset) %&gt;% View(&quot;days&quot;)</span></span>
<span id="cb295-2"><a href="#cb295-2"></a></span>
<span id="cb295-3"><a href="#cb295-3"></a>  </span>
<span id="cb295-4"><a href="#cb295-4"></a>s3_daily &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb295-5"><a href="#cb295-5"></a><span class="st">    </span><span class="kw">left_join</span>(avg_cycle_lengths, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>, <span class="st">&quot;last_menstrual_onset&quot;</span>, <span class="st">&quot;next_menstrual_onset_if_no_last&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb295-6"><a href="#cb295-6"></a><span class="st">  </span><span class="kw">left_join</span>(s1_demo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, menstruation_length), <span class="dt">by =</span> <span class="st">&#39;session&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb295-7"><a href="#cb295-7"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb295-8"><a href="#cb295-8"></a>        <span class="dt">next_menstrual_onset_inferred =</span> last_menstrual_onset <span class="op">+</span><span class="st"> </span><span class="kw">days</span>(menstruation_length),</span>
<span id="cb295-9"><a href="#cb295-9"></a>        <span class="dt">RCD_inferred =</span> <span class="kw">as.numeric</span>(created_date <span class="op">-</span><span class="st"> </span>next_menstrual_onset_inferred)</span>
<span id="cb295-10"><a href="#cb295-10"></a>  )</span></code></pre></div>
<pre><code>## left_join: added 6 columns (number_of_cycles, cycle_nr, cycle_length, cycle_nr_fully_observed, mean_cycle_length_diary, …)</code></pre>
<pre><code>##            &gt; rows only in x   13,745</code></pre>
<pre><code>##            &gt; rows only in y  (   670)</code></pre>
<pre><code>##            &gt; matched rows     65,504</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       79,249</code></pre>
<pre><code>## select: dropped 103 variables (created, modified, ended, expired, info_study, …)</code></pre>
<pre><code>## left_join: added one column (menstruation_length)</code></pre>
<pre><code>##            &gt; rows only in x        0</code></pre>
<pre><code>##            &gt; rows only in y  (   287)</code></pre>
<pre><code>##            &gt; matched rows     79,249</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       79,249</code></pre>
<pre><code>## mutate: new variable &#39;next_menstrual_onset_inferred&#39; with 304 unique values and 18% NA</code></pre>
<pre><code>##         new variable &#39;RCD_inferred&#39; with 186 unique values and 18% NA</code></pre>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1"></a>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(short <span class="op">==</span><span class="st"> &quot;_sqtMf5&quot;</span>, created_date <span class="op">==</span><span class="st"> &quot;2016-08-25&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(cycle_nr) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">is.na</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">isFALSE</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">stopifnot</span>()</span></code></pre></div>
<pre><code>## filter: removed 79,248 rows (&gt;99%), one row remaining</code></pre>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1"></a><span class="kw">xtabs</span>(<span class="op">~</span><span class="st"> </span>s3_daily<span class="op">$</span>diary_day_observation <span class="op">+</span><span class="st"> </span><span class="kw">is.na</span>(s3_daily<span class="op">$</span>cycle_nr))</span></code></pre></div>
<pre><code>##                               is.na(s3_daily$cycle_nr)
## s3_daily$diary_day_observation FALSE  TRUE
##           finished             51225  9962
##           interpolated         13074  3509
##           not_answered           501   122
##           not_finished             5     0
##           started_not_finished   699   152</code></pre>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1"></a>s3_daily &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb315-2"><a href="#cb315-2"></a><span class="st">  </span><span class="kw">group_by</span>(session, cycle_nr) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb315-3"><a href="#cb315-3"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb315-4"><a href="#cb315-4"></a>         <span class="dt">luteal_BC =</span> <span class="kw">if_else</span>(menstrual_onset_days_until <span class="op">&gt;=</span><span class="st"> </span><span class="dv">-15</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb315-5"><a href="#cb315-5"></a>         <span class="dt">follicular_FC =</span> <span class="kw">if_else</span>(menstrual_onset_days_since <span class="op">&lt;=</span><span class="st"> </span><span class="dv">15</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb315-6"><a href="#cb315-6"></a>         ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb315-7"><a href="#cb315-7"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb315-8"><a href="#cb315-8"></a>    <span class="dt">day_lh_surge =</span> <span class="kw">if_else</span>(created_date <span class="op">==</span><span class="st"> `</span><span class="dt">Date LH surge</span><span class="st">`</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb315-9"><a href="#cb315-9"></a>    <span class="dt">day_of_ovulation =</span> <span class="kw">if_else</span>(menstrual_onset_days_until <span class="op">==</span><span class="st"> </span><span class="dv">-15</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb315-10"><a href="#cb315-10"></a>    <span class="dt">day_of_ovulation_inferred =</span> <span class="kw">if_else</span>(RCD_inferred <span class="op">==</span><span class="st"> </span><span class="dv">-15</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb315-11"><a href="#cb315-11"></a>    <span class="dt">day_of_ovulation_forward_counted =</span> <span class="kw">if_else</span>(menstrual_onset_days_since <span class="op">==</span><span class="st"> </span><span class="dv">14</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb315-12"><a href="#cb315-12"></a>    <span class="dt">date_of_ovulation_BC =</span> <span class="kw">min</span>(<span class="kw">if_else</span>(day_of_ovulation <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, created_date, <span class="kw">structure</span>(<span class="ot">NA_real_</span>, <span class="dt">class=</span><span class="st">&quot;Date&quot;</span>)), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb315-13"><a href="#cb315-13"></a>    <span class="dt">date_of_ovulation_inferred =</span> <span class="kw">min</span>(<span class="kw">if_else</span>(day_of_ovulation_inferred <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, created_date, <span class="kw">structure</span>(<span class="ot">NA_real_</span>, <span class="dt">class=</span><span class="st">&quot;Date&quot;</span>)), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb315-14"><a href="#cb315-14"></a>    <span class="dt">date_of_ovulation_forward_counted =</span> <span class="kw">min</span>(<span class="kw">if_else</span>(day_of_ovulation_forward_counted <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, created_date, <span class="kw">structure</span>(<span class="ot">NA_real_</span>, <span class="dt">class=</span><span class="st">&quot;Date&quot;</span>)), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb315-15"><a href="#cb315-15"></a>    <span class="dt">date_of_ovulation_LH =</span> <span class="kw">min</span>(<span class="st">`</span><span class="dt">Date LH surge</span><span class="st">`</span> <span class="op">+</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">1</span>), <span class="dt">na.rm =</span> T),</span>
<span id="cb315-16"><a href="#cb315-16"></a>    <span class="dt">DRLH =</span> <span class="kw">as.numeric</span>(created_date <span class="op">-</span><span class="st"> </span>date_of_ovulation_LH),</span>
<span id="cb315-17"><a href="#cb315-17"></a>    <span class="dt">DRLH =</span> <span class="kw">if_else</span>(<span class="kw">between</span>(DRLH, <span class="dv">-15</span>, <span class="dv">15</span>), DRLH, <span class="ot">NA_real_</span>)</span>
<span id="cb315-18"><a href="#cb315-18"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb315-19"><a href="#cb315-19"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb315-20"><a href="#cb315-20"></a><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">starts_with</span>(<span class="st">&quot;date_of_ovulation_&quot;</span>)), <span class="kw">funs</span>(<span class="kw">if_else</span>(<span class="kw">is.infinite</span>(.), <span class="kw">as.Date</span>(<span class="ot">NA_character_</span>),.)))</span></code></pre></div>
<pre><code>## group_by: 2 grouping variables (session, cycle_nr)</code></pre>
<pre><code>## mutate (grouped): new variable &#39;luteal_BC&#39; with 3 unique values and 30% NA</code></pre>
<pre><code>##                   new variable &#39;follicular_FC&#39; with 3 unique values and 17% NA</code></pre>
<pre><code>## mutate (grouped): new variable &#39;day_lh_surge&#39; with 2 unique values and &gt;99% NA</code></pre>
<pre><code>##                   new variable &#39;day_of_ovulation&#39; with 3 unique values and 30% NA</code></pre>
<pre><code>##                   new variable &#39;day_of_ovulation_inferred&#39; with 3 unique values and 18% NA</code></pre>
<pre><code>##                   new variable &#39;day_of_ovulation_forward_counted&#39; with 3 unique values and 17% NA</code></pre>
<pre><code>##                   new variable &#39;date_of_ovulation_BC&#39; with 275 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;date_of_ovulation_inferred&#39; with 270 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;date_of_ovulation_forward_counted&#39; with 271 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;date_of_ovulation_LH&#39; with 148 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;DRLH&#39; with 32 unique values and 93% NA</code></pre>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## mutate_at: changed 29,892 values (38%) of &#39;date_of_ovulation_BC&#39; (29892 new NA)</code></pre>
<pre><code>##            changed 23,173 values (29%) of &#39;date_of_ovulation_inferred&#39; (23173 new NA)</code></pre>
<pre><code>##            changed 22,763 values (29%) of &#39;date_of_ovulation_forward_counted&#39; (22763 new NA)</code></pre>
<pre><code>##            changed 73,118 values (92%) of &#39;date_of_ovulation_LH&#39; (73118 new NA)</code></pre>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1"></a>s3_daily &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb333-2"><a href="#cb333-2"></a><span class="st">  </span><span class="kw">group_by</span>(short, cycle_nr) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb333-3"><a href="#cb333-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_of_ovulation_awareness_nr =</span> <span class="kw">n_nonmissing</span>(date_of_ovulation_awareness),</span>
<span id="cb333-4"><a href="#cb333-4"></a>         <span class="dt">date_of_ovulation_awareness =</span> <span class="kw">if_else</span>(date_of_ovulation_awareness_nr <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span></span>
<span id="cb333-5"><a href="#cb333-5"></a><span class="st">                                                 </span>window_length <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">&amp;</span><span class="st"> </span>window_length <span class="op">&lt;</span><span class="st"> </span><span class="dv">9</span>,</span>
<span id="cb333-6"><a href="#cb333-6"></a>                                     <span class="kw">first</span>(<span class="kw">na.omit</span>(date_of_ovulation_awareness)), <span class="kw">as.Date</span>(<span class="ot">NA_character_</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb333-7"><a href="#cb333-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fertile_awareness =</span> <span class="kw">case_when</span>(</span>
<span id="cb333-8"><a href="#cb333-8"></a>    <span class="kw">is.na</span>(date_of_ovulation_awareness) <span class="op">~</span><span class="st"> </span><span class="ot">NA_real_</span>,</span>
<span id="cb333-9"><a href="#cb333-9"></a>    created_date <span class="op">&lt;</span><span class="st"> </span>(date_of_ovulation_awareness <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>window_length) <span class="op">~</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb333-10"><a href="#cb333-10"></a>    created_date <span class="op">&gt;</span><span class="st"> </span>(date_of_ovulation_awareness <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb333-11"><a href="#cb333-11"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb333-12"><a href="#cb333-12"></a>  )) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb333-13"><a href="#cb333-13"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
<pre><code>## group_by: 2 grouping variables (short, cycle_nr)</code></pre>
<pre><code>## mutate (grouped): changed 238 values (&lt;1%) of &#39;date_of_ovulation_awareness&#39; (238 new NA)</code></pre>
<pre><code>##                   new variable &#39;date_of_ovulation_awareness_nr&#39; with 4 unique values and 0% NA</code></pre>
<pre><code>## mutate (grouped): new variable &#39;fertile_awareness&#39; with 2 unique values and &gt;99% NA</code></pre>
<pre><code>## ungroup: no grouping variables</code></pre>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1"></a><span class="kw">table</span>(<span class="op">!</span><span class="kw">is.na</span>(s3_daily<span class="op">$</span>date_of_ovulation_awareness))</span></code></pre></div>
<pre><code>## 
## FALSE  TRUE 
## 78942   307</code></pre>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1"></a><span class="kw">table</span>(tracked_windows<span class="op">$</span>window_length <span class="op">&gt;</span><span class="st"> </span><span class="dv">8</span>)</span></code></pre></div>
<pre><code>## 
## FALSE  TRUE 
##   634   118</code></pre>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1"></a><span class="kw">qplot</span>(tracked_windows<span class="op">$</span>window_length)</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type difftime. Defaulting to continuous.</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="0_wrangle_data_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1"></a>s3_daily &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb346-2"><a href="#cb346-2"></a><span class="st">  </span><span class="kw">left_join</span>(s4_followup <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, follicular_phase_length, luteal_phase_length), <span class="dt">by =</span> <span class="st">&#39;session&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb346-3"><a href="#cb346-3"></a><span class="kw">mutate</span>(</span>
<span id="cb346-4"><a href="#cb346-4"></a>  <span class="dt">date_of_ovulation_avg_follicular =</span> last_menstrual_onset <span class="op">+</span><span class="st"> </span><span class="kw">days</span>(follicular_phase_length),</span>
<span id="cb346-5"><a href="#cb346-5"></a>  <span class="dt">date_of_ovulation_avg_luteal =</span> next_menstrual_onset <span class="op">-</span><span class="st"> </span><span class="kw">days</span>(luteal_phase_length <span class="op">+</span><span class="st"> </span><span class="dv">1</span>),</span>
<span id="cb346-6"><a href="#cb346-6"></a>  <span class="dt">date_of_ovulation_avg_luteal_inferred =</span> next_menstrual_onset_inferred <span class="op">-</span><span class="st"> </span><span class="kw">days</span>(luteal_phase_length)</span>
<span id="cb346-7"><a href="#cb346-7"></a>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(</span>
<span id="cb346-8"><a href="#cb346-8"></a>  <span class="op">-</span>luteal_phase_length, <span class="op">-</span>follicular_phase_length</span>
<span id="cb346-9"><a href="#cb346-9"></a>)</span></code></pre></div>
<pre><code>## select: dropped 42 variables (created, modified, ended, expired, hypothesis_guess, …)</code></pre>
<pre><code>## left_join: added 2 columns (follicular_phase_length, luteal_phase_length)</code></pre>
<pre><code>##            &gt; rows only in x    4,500</code></pre>
<pre><code>##            &gt; rows only in y  (     9)</code></pre>
<pre><code>##            &gt; matched rows     74,749</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       79,249</code></pre>
<pre><code>## mutate: new variable &#39;date_of_ovulation_avg_follicular&#39; with 222 unique values and 84% NA</code></pre>
<pre><code>##         new variable &#39;date_of_ovulation_avg_luteal&#39; with 212 unique values and 87% NA</code></pre>
<pre><code>##         new variable &#39;date_of_ovulation_avg_luteal_inferred&#39; with 213 unique values and 85% NA</code></pre>
<pre><code>## select: dropped 2 variables (follicular_phase_length, luteal_phase_length)</code></pre>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1"></a>s3_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb358-2"><a href="#cb358-2"></a><span class="st">  </span><span class="kw">group_by</span>(short) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb358-3"><a href="#cb358-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">surges =</span> <span class="kw">n_distinct</span>(<span class="st">`</span><span class="dt">Date LH surge</span><span class="st">`</span>, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb358-4"><a href="#cb358-4"></a><span class="st">  </span><span class="kw">filter</span>(surges <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb358-5"><a href="#cb358-5"></a><span class="st">  </span><span class="kw">pull</span>(surges) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb358-6"><a href="#cb358-6"></a><span class="st">  </span><span class="kw">table</span>()</span></code></pre></div>
<pre><code>## group_by: one grouping variable (short)</code></pre>
<pre><code>## summarise: now 1,374 rows and 2 columns, ungrouped</code></pre>
<pre><code>## filter: removed 1,252 rows (91%), 122 rows remaining</code></pre>
<pre><code>## .
##   1   2 
##  14 108</code></pre>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1"></a><span class="co"># s3_daily %&gt;%</span></span>
<span id="cb363-2"><a href="#cb363-2"></a><span class="co">#   drop_na(session, cycle_nr) %&gt;%</span></span>
<span id="cb363-3"><a href="#cb363-3"></a><span class="co">#   group_by(short) %&gt;%</span></span>
<span id="cb363-4"><a href="#cb363-4"></a><span class="co">#   filter(4 == n_distinct(`Date LH surge`, na.rm = T)) %&gt;% select(short, ended, DRLH, day_number, cycle_nr, created_date,menstrual_onset_days_until, menstrual_onset_days_since, `Date LH surge`) %&gt;% View()</span></span>
<span id="cb363-5"><a href="#cb363-5"></a></span>
<span id="cb363-6"><a href="#cb363-6"></a><span class="co"># s3_daily %&gt;% </span></span>
<span id="cb363-7"><a href="#cb363-7"></a><span class="co">#   drop_na(session, cycle_nr) %&gt;% </span></span>
<span id="cb363-8"><a href="#cb363-8"></a><span class="co">#   group_by(short, cycle_nr) %&gt;% </span></span>
<span id="cb363-9"><a href="#cb363-9"></a><span class="co">#   filter(2 == n_distinct(`Date LH surge`, na.rm = T)) %&gt;% select(short, ended, day_number, DRLH, cycle_nr, created_date,menstrual_onset_days_until, menstrual_onset_days_since, `Date LH surge`) %&gt;% View()</span></span>
<span id="cb363-10"><a href="#cb363-10"></a></span>
<span id="cb363-11"><a href="#cb363-11"></a><span class="co"># one case of a woman who reported two surges (close together in one cycle, we use the first surge)</span></span>
<span id="cb363-12"><a href="#cb363-12"></a>s3_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb363-13"><a href="#cb363-13"></a><span class="st">  </span><span class="kw">group_by</span>(short, cycle_nr) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb363-14"><a href="#cb363-14"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">surges =</span> <span class="kw">n_distinct</span>(<span class="st">`</span><span class="dt">Date LH surge</span><span class="st">`</span>, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb363-15"><a href="#cb363-15"></a><span class="st">  </span><span class="kw">filter</span>(surges <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb363-16"><a href="#cb363-16"></a><span class="st">  </span><span class="kw">pull</span>(surges) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb363-17"><a href="#cb363-17"></a><span class="st">  </span><span class="kw">table</span>()</span></code></pre></div>
<pre><code>## group_by: 2 grouping variables (short, cycle_nr)</code></pre>
<pre><code>## summarise: now 3,441 rows and 3 columns, one group variable remaining (short)</code></pre>
<pre><code>## filter (grouped): removed 3,211 rows (93%), 230 rows remaining</code></pre>
<pre><code>## .
##   1 
## 230</code></pre>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1"></a><span class="kw">stopifnot</span>(s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, created) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb368-2"><a href="#cb368-2"></a><span class="st">            </span><span class="kw">group_by</span>(session, created) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>()<span class="op">&gt;</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>() <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## drop_na: removed 16,583 rows (21%), 62,666 rows remaining</code></pre>
<pre><code>## group_by: 2 grouping variables (session, created)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1"></a><span class="co"># s3_daily %&gt;% filter(session %starts_with% &quot;_2sufSUfIWjNXg6xfRzJaCid9jzkY&quot;) %&gt;% select(created_date, menstrual_onset, menstrual_onset_date, menstrual_onset_days_until, menstrual_onset_days_since) %&gt;% View()</span></span>
<span id="cb372-2"><a href="#cb372-2"></a><span class="co"># s3_daily %&gt;% filter(session %starts_with% &quot;2x-juq&quot;) %&gt;% select(created_date, menstrual_onset, menstrual_onset_date, menstrual_onset_days_until, menstrual_onset_days_since) %&gt;% View()</span></span>
<span id="cb372-3"><a href="#cb372-3"></a></span>
<span id="cb372-4"><a href="#cb372-4"></a>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">is.na</span>(cycle_nr), <span class="op">!</span><span class="kw">is.na</span>(next_menstrual_onset)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(short, cycle_nr, last_menstrual_onset, next_menstrual_onset) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>() <span class="op">%&gt;%</span><span class="st"> </span>{ . <span class="op">==</span><span class="st"> </span><span class="dv">0</span> } <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">stopifnot</span>()</span></code></pre></div>
<pre><code>## filter: removed all rows (100%)</code></pre>
<pre><code>## select: dropped 255 variables (session, created_date, created, modified, ended, …)</code></pre>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1"></a>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">is.na</span>(cycle_nr), <span class="op">!</span><span class="kw">is.na</span>(last_menstrual_onset)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(short, cycle_nr, last_menstrual_onset, next_menstrual_onset) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>() <span class="op">%&gt;%</span><span class="st"> </span>{ . <span class="op">==</span><span class="st"> </span><span class="dv">0</span> } <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">stopifnot</span>()</span></code></pre></div>
<pre><code>## filter: removed all rows (100%)
## select: dropped 255 variables (session, created_date, created, modified, ended, …)</code></pre>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1"></a><span class="co"># There are some 56 days across women for whom we have a last menstrual onset, but no cycle info. This happens when a last menstrual onset was reported that was more than 40 days before the beginning of the diary</span></span>
<span id="cb377-2"><a href="#cb377-2"></a><span class="kw">crosstabs</span>(<span class="op">~</span><span class="st"> </span><span class="kw">is.na</span>(cycle_nr) <span class="op">+</span><span class="st"> </span><span class="kw">is.na</span>(menstruation_length), s3_daily)</span></code></pre></div>
<pre><code>##                is.na(menstruation_length)
## is.na(cycle_nr) FALSE  TRUE
##           FALSE 65339   165
##           TRUE    630 13115</code></pre>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1"></a><span class="kw">crosstabs</span>(<span class="op">~</span><span class="st"> </span><span class="kw">is.na</span>(cycle_nr) <span class="op">+</span><span class="st"> </span><span class="kw">is.na</span>(menstruation_length), s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(diary_day_observation <span class="op">==</span><span class="st"> &quot;finished&quot;</span>))</span></code></pre></div>
<pre><code>## filter: removed 18,062 rows (23%), 61,187 rows remaining</code></pre>
<pre><code>##                is.na(menstruation_length)
## is.na(cycle_nr) FALSE  TRUE
##           FALSE 51137    88
##           TRUE    150  9812</code></pre>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1"></a><span class="co"># </span></span>
<span id="cb382-2"><a href="#cb382-2"></a><span class="co"># s3_daily %&gt;% filter(is.na(cycle_nr), !is.na(menstruation_length)) %&gt;% select(short, created_date, ended, cycle_nr, last_menstrual_onset, next_menstrual_onset) %&gt;% View</span></span>
<span id="cb382-3"><a href="#cb382-3"></a><span class="co"># s1_demo %&gt;% filter(short==&quot;-ontLSS&quot;) %&gt;% select(ended, contains(&quot;menst&quot;))</span></span></code></pre></div>
</div>
<div id="estimate-fertile-window-probability" class="section level3">
<h3>Estimate fertile window probability</h3>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="#cb383-1"></a>s3_daily =<span class="st"> </span>s3_daily <span class="op">%&gt;%</span></span>
<span id="cb383-2"><a href="#cb383-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb383-3"><a href="#cb383-3"></a>        <span class="dt">FCD =</span> menstrual_onset_days_since <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb383-4"><a href="#cb383-4"></a>        <span class="dt">RCD =</span> menstrual_onset_days_until,</span>
<span id="cb383-5"><a href="#cb383-5"></a>        <span class="dt">DAL =</span> created_date <span class="op">-</span><span class="st"> </span>date_of_ovulation_avg_luteal,</span>
<span id="cb383-6"><a href="#cb383-6"></a>        <span class="dt">RCD_squished =</span> <span class="kw">if_else</span>(</span>
<span id="cb383-7"><a href="#cb383-7"></a>          cycle_length <span class="op">-</span><span class="st"> </span>FCD <span class="op">&lt;</span><span class="st"> </span><span class="dv">14</span>,</span>
<span id="cb383-8"><a href="#cb383-8"></a>          <span class="dv">29</span> <span class="op">-</span><span class="st"> </span>(cycle_length <span class="op">-</span><span class="st"> </span>FCD),</span>
<span id="cb383-9"><a href="#cb383-9"></a>          ((FCD<span class="op">/</span><span class="st"> </span>(cycle_length <span class="op">-</span><span class="st"> </span><span class="dv">14</span>) ) <span class="op">*</span><span class="st"> </span><span class="dv">15</span>)),</span>
<span id="cb383-10"><a href="#cb383-10"></a>        <span class="dt">RCD_squished =</span> <span class="kw">if_else</span>(RCD_squished <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, RCD_squished),</span>
<span id="cb383-11"><a href="#cb383-11"></a>        <span class="dt">RCD_squished =</span> <span class="kw">if_else</span>(RCD <span class="op">&lt;</span><span class="st"> </span><span class="dv">-40</span>, <span class="ot">NA_real_</span>, RCD_squished) <span class="op">-</span><span class="st"> </span><span class="dv">30</span>,</span>
<span id="cb383-12"><a href="#cb383-12"></a>        <span class="dt">RCD_squished_rounded =</span> <span class="kw">round</span>(RCD_squished),</span>
<span id="cb383-13"><a href="#cb383-13"></a>        <span class="dt">RCD_inferred_squished =</span> <span class="kw">if_else</span>(</span>
<span id="cb383-14"><a href="#cb383-14"></a>          FCD <span class="op">&gt;</span><span class="st"> </span>menstruation_length,</span>
<span id="cb383-15"><a href="#cb383-15"></a>            <span class="ot">NA_real_</span>,</span>
<span id="cb383-16"><a href="#cb383-16"></a>            <span class="kw">if_else</span>(</span>
<span id="cb383-17"><a href="#cb383-17"></a>              <span class="kw">as.numeric</span>(menstruation_length) <span class="op">-</span><span class="st"> </span>FCD <span class="op">&lt;</span><span class="st"> </span><span class="dv">14</span>,</span>
<span id="cb383-18"><a href="#cb383-18"></a>              <span class="dv">29</span> <span class="op">-</span><span class="st"> </span>(<span class="kw">as.numeric</span>(menstruation_length) <span class="op">-</span><span class="st"> </span>FCD),</span>
<span id="cb383-19"><a href="#cb383-19"></a>              <span class="kw">round</span>((FCD<span class="op">/</span><span class="st"> </span>(<span class="kw">as.numeric</span>(menstruation_length) <span class="op">-</span><span class="st"> </span><span class="dv">14</span>) ) <span class="op">*</span><span class="st"> </span><span class="dv">15</span>))</span>
<span id="cb383-20"><a href="#cb383-20"></a>            ),</span>
<span id="cb383-21"><a href="#cb383-21"></a>        <span class="dt">RCD_inferred_squished =</span> <span class="kw">if_else</span>(RCD_inferred_squished <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, RCD_inferred_squished),</span>
<span id="cb383-22"><a href="#cb383-22"></a>        <span class="dt">RCD_inferred_squished =</span> <span class="kw">if_else</span>(RCD_inferred <span class="op">&lt;</span><span class="st"> </span><span class="dv">-40</span>, <span class="ot">NA_real_</span>, RCD_inferred_squished) <span class="op">-</span><span class="st"> </span><span class="dv">30</span>,</span>
<span id="cb383-23"><a href="#cb383-23"></a><span class="co"># add 15 days to the reverse cycle days to arrive at the estimated day of ovulation</span></span>
<span id="cb383-24"><a href="#cb383-24"></a>        <span class="dt">RCD_rel_to_ovulation =</span> RCD <span class="op">+</span><span class="st"> </span><span class="dv">15</span>,</span>
<span id="cb383-25"><a href="#cb383-25"></a>        <span class="dt">RCD_fab =</span> RCD_squished</span>
<span id="cb383-26"><a href="#cb383-26"></a>  )</span></code></pre></div>
<pre><code>## mutate: new variable &#39;FCD&#39; with 165 unique values and 17% NA</code></pre>
<pre><code>##         new variable &#39;RCD&#39; with 239 unique values and 30% NA</code></pre>
<pre><code>##         new variable &#39;DAL&#39; with 117 unique values and 87% NA</code></pre>
<pre><code>##         new variable &#39;RCD_squished&#39; with 778 unique values and 33% NA</code></pre>
<pre><code>##         new variable &#39;RCD_squished_rounded&#39; with 30 unique values and 33% NA</code></pre>
<pre><code>##         new variable &#39;RCD_inferred_squished&#39; with 30 unique values and 26% NA</code></pre>
<pre><code>##         new variable &#39;RCD_rel_to_ovulation&#39; with 239 unique values and 30% NA</code></pre>
<pre><code>##         new variable &#39;RCD_fab&#39; with 778 unique values and 33% NA</code></pre>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1"></a><span class="kw">table</span>(s3_daily<span class="op">$</span>RCD_inferred_squished)</span></code></pre></div>
<pre><code>## 
##  -29  -28  -27  -26  -25  -24  -23  -22  -21  -20  -19  -18  -17  -16  -15  -14  -13  -12  -11  -10   -9   -8 
## 2055 2103 1957 2044 2108 2076 1247 2569 2066 2182 2024 2233 1906 2207 2170 2145 2146 2159 2164 2163 2143 2116 
##   -7   -6   -5   -4   -3   -2   -1 
## 2068 2029 1958 1873 1732 1533 1286</code></pre>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1"></a><span class="kw">table</span>(s3_daily<span class="op">$</span>RCD_squished)</span></code></pre></div>
<pre><code>## 
##               -29 -28.9285714285714 -28.8888888888889 -28.8461538461538             -28.8            -28.75 
##               579               300                 3               192                 8               109 
##  -28.695652173913 -28.6363636363636 -28.5714285714286             -28.5 -28.4210526315789 -28.3928571428571 
##                15               123                28                89                51                 1 
## -28.3333333333333 -28.2692307692308 -28.2352941176471             -28.2           -28.125 -28.0434782608696 
##                81                 8                95                 8               157                16 
##               -28 -27.9545454545455 -27.9310344827586 -27.8571428571429 -27.7777777777778            -27.75 
##               143                23                 2               358                 3                32 
## -27.6923076923077 -27.6315789473684             -27.6             -27.5 -27.4137931034483 -27.3913043478261 
##               196                51                 8               180                 2                16 
## -27.3529411764706 -27.3214285714286 -27.2727272727273 -27.2222222222222          -27.1875 -27.1428571428571 
##                95                 1               127                 3               127                30 
## -27.1153846153846               -27 -26.8965517241379           -26.875 -26.8421052631579 -26.7857142857143 
##                 8               253                 2                 6                51               317 
## -26.7391304347826         -26.71875 -26.6666666666667 -26.5909090909091 -26.5384615384615             -26.5 
##                16                 4                81                23               200                 6 
## -26.4705882352941 -26.4285714285714             -26.4 -26.3793103448276 -26.3636363636364            -26.25 
##                95                33                 9                 2                 2               313 
## -26.1111111111111 -26.0869565217391 -26.0526315789474 -26.0294117647059               -26 -25.9615384615385 
##                 4                16                54                 6               155                 8 
## -25.9090909090909 -25.8620689655172 -25.8333333333333             -25.8         -25.78125 -25.7142857142857 
##               134                 2                59                 9                 5               379 
##           -25.625 -25.5882352941176 -25.5555555555556             -25.5 -25.4545454545455 -25.4347826086957 
##                 7               107                 4                97                 2                16 
## -25.4166666666667 -25.3846153846154 -25.3448275862069          -25.3125 -25.2857142857143 -25.2631578947368 
##                 5               202                 2               139                 3                54 
## -25.2272727272727             -25.2 -25.1785714285714 -25.1612903225806 -25.1470588235294 -25.1351351351351 
##                25                10                 1                 1                 6                 7 
##               -25 -24.8684210526316 -24.8571428571429         -24.84375 -24.8275862068966 -24.8076923076923 
##               413                 2                 3                 5                 2                 8 
## -24.7826086956522            -24.75 -24.7297297297297 -24.7058823529412 -24.6774193548387 -24.6428571428571 
##                16                32                 7               110                 1               327 
## -24.6153846153846             -24.6 -24.5833333333333 -24.5454545454545             -24.5 -24.4736842105263 
##                 2                10                 4               138                 6                56 
## -24.4444444444444 -24.4285714285714           -24.375 -24.3243243243243 -24.3103448275862 -24.2857142857143 
##                 4                 4               176                 8                 2                33 
## -24.2647058823529 -24.2307692307692 -24.1935483870968 -24.1666666666667 -24.1463414634146 -24.1304347826087 
##                 6               209                 1                68                 4                16 
## -24.1071428571429 -24.0909090909091 -24.0789473684211               -24 -23.9285714285714 -23.9189189189189 
##                 1                 3                 2               280                 7                 8 
##         -23.90625 -23.8888888888889 -23.8636363636364 -23.8461538461538 -23.8235294117647 -23.7931034482759 
##                 5                 4                25                 2               115                 2 
##  -23.780487804878            -23.75 -23.7209302325581 -23.7096774193548 -23.6842105263158 -23.6538461538462 
##                 4               123                 5                 1                57                 7 
## -23.6363636363636           -23.625 -23.5714285714286 -23.5135135135135             -23.5 -23.4782608695652 
##                 5                 3               397                 8                 7                16 
## -23.4615384615385          -23.4375 -23.4146341463415             -23.4 -23.3823529411765 -23.3720930232558 
##                 2               141                 4                11                 6                 5 
## -23.3333333333333 -23.2894736842105 -23.2758620689655            -23.25 -23.2258064516129 -23.2142857142857 
##                99                 3                 2                39                 1                 7 
## -23.1818181818182 -23.1521739130435 -23.1428571428571           -23.125 -23.1081081081081 -23.0769230769231 
##               140                 4                 4                 8                 8               213 
## -23.0487804878049 -23.0357142857143 -23.0232558139535               -23 -22.9787234042553         -22.96875 
##                 4                 1                 5               169                 1                 5 
## -22.9411764705882 -22.9166666666667 -22.8947368421053           -22.875 -22.8571428571429 -22.8260869565217 
##               117                 4                58                 3                41                21 
##          -22.8125             -22.8 -22.7777777777778 -22.7586206896552  -22.741935483871 -22.7272727272727 
##                 1                11                 4                 2                 1                 5 
## -22.7142857142857 -22.7027027027027 -22.6923076923077 -22.6829268292683 -22.6744186046512 -22.6666666666667 
##                 4                 8                 2                 4                 5                 3 
## -22.6595744680851             -22.5 -22.3529411764706 -22.3404255319149 -22.3333333333333 -22.3255813953488 
##                 1               879                 1                 1                 3                 5 
## -22.3170731707317 -22.3076923076923 -22.2972972972973 -22.2857142857143 -22.2727272727273  -22.258064516129 
##                 4                 2                 8                 4                 5                 1 
## -22.2413793103448 -22.2222222222222 -22.2115384615385             -22.2          -22.1875 -22.1739130434783 
##                 2                 4                 1                14                 1                22 
## -22.1428571428571           -22.125 -22.1052631578947 -22.0833333333333 -22.0588235294118         -22.03125 
##                43                 3                58                 4               119                 5 
## -22.0212765957447               -22 -21.9767441860465 -21.9642857142857 -21.9512195121951 -21.9230769230769 
##                 1               168                 5                 1                 4               219 
##             -21.9 -21.8918918918919           -21.875 -21.8571428571429 -21.8478260869565 -21.8181818181818 
##                 2                 8                 9                 4                 4               146 
## -21.7857142857143 -21.7741935483871 -21.7647058823529            -21.75 -21.7241379310345 -21.7105263157895 
##                 7                 1                 1                37                 2                 4 
## -21.7021276595745 -21.6666666666667 -21.6346153846154 -21.6279069767442 -21.6176470588235             -21.6 
##                 1               101                 1                 5                 5                14 
## -21.5853658536585          -21.5625 -21.5454545454545 -21.5384615384615 -21.5217391304348             -21.5 
##                 4               145                 3                 2                22                 7 
## -21.4864864864865 -21.4705882352941 -21.4285714285714 -21.3829787234043           -21.375 -21.3636363636364 
##                 8                 1               409                 1                 3                 5 
## -21.3461538461538 -21.3333333333333 -21.3157894736842             -21.3 -21.2903225806452 -21.2790697674419 
##                 9                 1                61                 2                 2                 5 
## -21.2727272727273            -21.25  -21.219512195122 -21.2068965517241  -21.195652173913 -21.1764705882353 
##                 3               134                 3                 2                 4               119 
## -21.1538461538462 -21.1363636363636 -21.1111111111111         -21.09375 -21.0810810810811 -21.0714285714286 
##                 2                26                 4                 5                 8                 7 
##  -21.063829787234 -21.0576923076923 -21.0483870967742               -21          -20.9375 -20.9302325581395 
##                 1                 1                 1               295                 1                 5 
## -20.9210526315789 -20.9090909090909 -20.8928571428571 -20.8823529411765 -20.8695652173913        -20.859375 
##                 4                 5                 1                 1                23                 1 
## -20.8536585365854 -20.8333333333333 -20.8064516129032 -20.7692307692308            -20.75 -20.7446808510638 
##                 3                73                 3               222                 2                 1 
## -20.7352941176471 -20.7272727272727 -20.7142857142857             -20.7 -20.6896551724138 -20.6756756756757 
##                 5                 3                45                 2                 2                 7 
## -20.6666666666667           -20.625 -20.5970149253731 -20.5882352941176 -20.5813953488372 -20.5714285714286 
##                 1               188                 1                 1                 4                 5 
## -20.5645161290323 -20.5555555555556 -20.5434782608696 -20.5263157894737             -20.5 -20.4878048780488 
##                 1                 4                 4                61                 9                 3 
## -20.4807692307692 -20.4545454545455 -20.4347826086957 -20.4255319148936 -20.4166666666667             -20.4 
##                 1               152                 1                 1                 5                14 
##        -20.390625 -20.3846153846154 -20.3731343283582 -20.3571428571429 -20.3333333333333 -20.3225806451613 
##                 1                 1                 1               353                 1                 3 
##          -20.3125 -20.2941176470588 -20.2702702702703            -20.25 -20.2325581395349 -20.2173913043478 
##                 1               120                 6                37                 4                25 
## -20.1923076923077 -20.1818181818182 -20.1724137931034         -20.15625 -20.1492537313433 -20.1428571428571 
##                 8                 3                 4                 6                 1                 6 
## -20.1369863013699 -20.1315789473684 -20.1219512195122 -20.1063829787234             -20.1 -20.0806451612903 
##                 1                 4                 3                 1                 1                 1 
##               -20 -19.9342105263158 -19.9315068493151 -19.9285714285714 -19.9253731343284        -19.921875 
##               473                 1                 1                 1                 1                 1 
## -19.9090909090909 -19.9038461538462 -19.8913043478261 -19.8837209302326           -19.875 -19.8648648648649 
##                 3                 1                 5                 4                 2                 6 
## -19.8529411764706 -19.8387096774194 -19.8214285714286             -19.8 -19.7872340425532 -19.7826086956522 
##                 5                 3                 1                13                 1                 1 
## -19.7727272727273 -19.7560975609756            -19.75  -19.746835443038 -19.7368421052632 -19.7260273972603 
##                26                 1                 1                 1                63                 1 
## -19.7142857142857 -19.7058823529412 -19.7014925373134          -19.6875 -19.6666666666667 -19.6551724137931 
##                 6                 1                 1               149                 1                 4 
## -19.6428571428571 -19.6363636363636 -19.6153846153846 -19.5967741935484 -19.5833333333333 -19.5652173913043 
##                 7                 3               230                 1                 5                25 
## -19.5569620253165 -19.5454545454545 -19.5394736842105 -19.5348837209302 -19.5205479452055             -19.5 
##                 1                 6                 1                 4                 1               110 
## -19.4776119402985  -19.468085106383 -19.4594594594595        -19.453125 -19.4444444444444 -19.4117647058824 
##                 1                 2                 6                 1                 4               124 
##  -19.390243902439           -19.375 -19.3670886075949 -19.3636363636364 -19.3548387096774 -19.3478260869565 
##                 1                10                 1                 3                 3                 1 
## -19.3421052631579 -19.3333333333333 -19.3269230769231 -19.3150684931507 -19.2857142857143 -19.2537313432836 
##                 5                 1                 1                 1               423                 1 
##            -19.25 -19.2391304347826 -19.2352941176471 -19.2307692307692         -19.21875             -19.2 
##                 1                 5                 1                 1                 6                13 
## -19.1860465116279 -19.1772151898734 -19.1666666666667 -19.1489361702128 -19.1447368421053 -19.1379310344828 
##                 4                 1                72                 2                 1                 4 
## -19.1304347826087           -19.125 -19.1176470588235 -19.1129032258065 -19.1095890410959 -19.0909090909091 
##                 1                 3                 1                 1                 1               152 
## -19.0714285714286          -19.0625 -19.0588235294118 -19.0540540540541 -19.0384615384615 -19.0298507462687 
##                 1                 1                 1                 6                 8                 1 
## -19.0243902439024               -19 -18.9873417721519        -18.984375 -18.9705882352941 -18.9473684210526 
##                 1               182                 1                 1                 5                66 
## -18.9285714285714 -18.9130434782609 -18.9041095890411             -18.9 -18.8888888888889 -18.8823529411765 
##                 7                25                 1                 1                 4                 1 
## -18.8709677419355 -18.8659793814433 -18.8571428571429 -18.8461538461538 -18.8372093023256 -18.8297872340426 
##                 3                 1                 6                 1                 4                 2 
## -18.8235294117647 -18.8181818181818 -18.8059701492537 -18.7974683544304            -18.75 -18.7113402061856 
##                 2                 3                 1                 1               369                 1 
## -18.7058823529412 -18.6986301369863  -18.695652173913 -18.6666666666667 -18.6585365853659 -18.6486486486486 
##                 1                 1                 1                 1                 1                 6 
## -18.6428571428571 -18.6363636363636 -18.6290322580645 -18.6206896551724 -18.6075949367089             -18.6 
##                 1                 6                 1                 4                 1                13 
## -18.5869565217391 -18.5820895522388 -18.5714285714286 -18.5567010309278 -18.5526315789474 -18.5454545454545 
##                 6                 1                46                 1                 5                 3 
## -18.5294117647059        -18.515625 -18.5106382978723             -18.5 -18.4931506849315 -18.4883720930233 
##               127                 1                 2                 9                 1                 4 
## -18.4782608695652 -18.4615384615385          -18.4375 -18.4285714285714 -18.4177215189873 -18.4090909090909 
##                 1               235                 1                 6                 1                27 
## -18.4020618556701 -18.3870967741935           -18.375 -18.3582089552239 -18.3552631578947 -18.3529411764706 
##                 1                 3                 5                 1                 1                 1 
## -18.3333333333333             -18.3 -18.2926829268293 -18.2876712328767         -18.28125 -18.2727272727273 
##               104                 1                 1                 1                 6                 3 
## -18.2608695652174            -18.25 -18.2474226804124 -18.2432432432432 -18.2352941176471 -18.2278481012658 
##                26                 1                 1                 6                 2                 1 
## -18.2142857142857 -18.1914893617021 -18.1818181818182 -18.1764705882353 -18.1730769230769 -18.1578947368421 
##               357                 2                 6                 1                 1                64 
## -18.1451612903226 -18.1395348837209  -18.134328358209           -18.125 -18.1034482758621 -18.0927835051546 
##                 1                 4                 1                11                 4                 1 
## -18.0882352941176 -18.0821917808219 -18.0769230769231        -18.046875 -18.0434782608696 -18.0379746835443 
##                 5                 1                 1                 1                 1                 1 
##               -18 -17.9605263157895 -17.9411764705882 -17.9381443298969 -17.9347826086957 -17.9268292682927 
##               321                 1                 2                 1                 6                 1 
## -17.9166666666667  -17.910447761194 -17.9032258064516 -17.8846153846154 -17.8767123287671 -17.8723404255319 
##                 5                 1                 3                 8                 1                 2 
## -17.8571428571429 -17.8481012658228 -17.8378378378378 -17.8260869565217 -17.8235294117647          -17.8125 
##                45                 1                 6                 1                 1               158 
## -17.7906976744186 -17.7857142857143 -17.7835051546392 -17.7777777777778 -17.7631578947368            -17.75 
##                 4                 1                 1                 4                 5                 1 
## -17.7272727272727             -17.7 -17.6923076923077 -17.6865671641791 -17.6785714285714 -17.6712328767123 
##               153                 1                 1                 1                 1                 1 
## -17.6666666666667 -17.6612903225806 -17.6582278481013 -17.6470588235294 -17.6288659793814           -17.625 
##                 1                 1                 1               130                 1                 5 
## -17.6086956521739 -17.5961538461538 -17.5862068965517        -17.578125 -17.5714285714286 -17.5657894736842 
##                25                 1                 4                 1                 6                 1 
## -17.5609756097561 -17.5531914893617             -17.5 -17.4742268041237 -17.4705882352941 -17.4683544303797 
##                 1                 2               235                 1                 1                 1 
## -17.4657534246575 -17.4626865671642 -17.4545454545455 -17.4418604651163 -17.4324324324324 -17.4193548387097 
##                 1                 1                 3                 4                 6                 3 
##             -17.4 -17.3913043478261 -17.3684210526316 -17.3571428571429 -17.3529411764706         -17.34375 
##                13                 1                64                 1                 2                 7 
## -17.3333333333333  -17.319587628866 -17.3076923076923 -17.2941176470588 -17.2826086956522 -17.2784810126582 
##                 1                 1               236                 1                 5                 1 
## -17.2727272727273 -17.2602739726027            -17.25 -17.2388059701493 -17.2340425531915 -17.2222222222222 
##                 6                 1                41                 1                 2                 4 
## -17.2058823529412 -17.1951219512195          -17.1875 -17.1818181818182 -17.1774193548387 -17.1739130434783 
##                 6                 1                 1                 3                 1                 1 
## -17.1710526315789 -17.1649484536082 -17.1428571428571 -17.1176470588235        -17.109375             -17.1 
##                 1                 1               420                 1                 1                 1 
##  -17.093023255814 -17.0886075949367 -17.0833333333333 -17.0689655172414 -17.0588235294118 -17.0547945205479 
##                 4                 1                 5                 4                 2                 1 
## -17.0454545454545  -17.027027027027 -17.0192307692308 -17.0149253731343 -17.0103092783505               -17 
##                27                 6                 1                 1                 1               188 
## -16.9736842105263 -16.9565217391304 -16.9411764705882 -16.9354838709677 -16.9285714285714 -16.9230769230769 
##                 5                26                 1                 3                 1                 1 
## -16.9148936170213 -16.9090909090909 -16.8987341772152           -16.875 -16.8556701030928 -16.8493150684932 
##                 2                 3                 1               205                 1                 1 
## -16.8292682926829 -16.8181818181818             -16.8 -16.7910447761194 -16.7857142857143 -16.7763157894737 
##                 1                 6                13                 1                 6                 1 
## -16.7647058823529            -16.75 -16.7441860465116 -16.7391304347826 -16.7307692307692 -16.7142857142857 
##               128                 1                 4                 1                 9                 6 
## -16.7088607594937 -16.7010309278351 -16.6935483870968 -16.6666666666667 -16.6438356164384        -16.640625 
##                 1                 1                 1               106                 1                 1 
## -16.6363636363636 -16.6304347826087 -16.6216216216216 -16.6071428571429 -16.5957446808511 -16.5882352941176 
##                 2                 5                 6                 2                 2                 1 
## -16.5789473684211 -16.5671641791045          -16.5625  -16.551724137931 -16.5384615384615 -16.5217391304348 
##                64                 1                 1                 4                 1                 1 
## -16.5189873417722             -16.5 -16.4705882352941 -16.4634146341463 -16.4516129032258 -16.4423076923077 
##                 1               118                 2                 1                 3                 1 
## -16.4383561643836 -16.4285714285714 -16.4117647058824         -16.40625 -16.3953488372093 -16.3815789473684 
##                 1                45                 1                 7                 4                 1 
## -16.3636363636364 -16.3432835820896 -16.3333333333333 -16.3291139240506 -16.3235294117647  -16.304347826087 
##               156                 1                 2                 1                 5                26 
## -16.2857142857143 -16.2765957446809            -16.25 -16.2352941176471 -16.2328767123288 -16.2162162162162 
##                 7                 2               148                 1                 1                 6 
## -16.2096774193548             -16.2 -16.1842105263158 -16.1764705882353        -16.171875 -16.1538461538462 
##                 1                13                 5                 2                 1               238 
## -16.1392405063291           -16.125 -16.1194029850746 -16.1111111111111 -16.0975609756098 -16.0909090909091 
##                 1                 6                 1                 5                 1                 2 
## -16.0869565217391 -16.0714285714286 -16.0588235294118  -16.046511627907 -16.0344827586207  -16.027397260274 
##                 1               357                 1                 4                 4                 1 
##               -16 -15.9868421052632 -15.9782608695652 -15.9677419354839 -15.9574468085106 -15.9493670886076 
##               194                 1                 5                 3                 2                 1 
##          -15.9375 -15.9090909090909             -15.9 -15.8955223880597 -15.8823529411765 -15.8695652173913 
##               158                 6                 1                 1               128                 1 
## -15.8653846153846 -15.8571428571429 -15.8333333333333 -15.8219178082192 -15.8181818181818 -15.8108108108108 
##                 1                 7                73                 1                 2                 6 
## -15.7894736842105 -15.7692307692308 -15.7594936708861            -15.75 -15.7317073170732 -15.7258064516129 
##                64                 1                 1                43                 1                 1 
## -15.7142857142857 -15.7058823529412        -15.703125 -15.6976744186047 -15.6818181818182 -15.6716417910448 
##                44                 1                 1                 4                29                 1 
## -15.6666666666667 -15.6521739130435 -15.6428571428571 -15.6382978723404           -15.625 -15.6164383561644 
##                 2                24                 1                 2                13                 1 
##             -15.6 -15.5921052631579 -15.5882352941176 -15.5769230769231 -15.5696202531646 -15.5555555555556 
##                14                 1                 2                 9                 1                 5 
## -15.5454545454545 -15.5357142857143 -15.5294117647059 -15.5172413793103             -15.5 -15.4838709677419 
##                 2                 2                 1                 4                 8                 4 
##         -15.46875 -15.4591836734694 -15.4545454545455 -15.4477611940298 -15.4411764705882 -15.4347826086957 
##                 7                 1                 6                 1                 5                 1 
## -15.4285714285714 -15.4166666666667 -15.4054054054054 -15.3947368421053 -15.3896103896104 -15.3846153846154 
##                 6                 5                 7                 5                 1                 1 
##  -15.379746835443           -15.375 -15.3658536585366 -15.3571428571429 -15.3529411764706 -15.3488372093023 
##                 1                 6                 1                 6                 1                 4 
## -15.3333333333333 -15.3260869565217 -15.3191489361702          -15.3125             -15.3 -15.2941176470588 
##                 2                 4                 2                 1                 1                 2 
## -15.2884615384615 -15.2727272727273  -15.241935483871        -15.234375 -15.2272727272727 -15.2238805970149 
##                 1                 2                 1                 1                 1                 1 
## -15.2173913043478 -15.2142857142857 -15.1973684210526 -15.1948051948052 -15.1898734177215 -15.1764705882353 
##                 1                 1                 1                 1                 1                 1 
##               -15               -14               -13               -12               -11               -10 
##              1848              1877              1904              1918              1936              1957 
##                -9                -8                -7                -6                -5                -4 
##              1975              2000              2028              2032              2049              2044 
##                -3                -2                -1 
##              2045              2054              2052</code></pre>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1"></a><span class="kw">table</span>(s3_daily<span class="op">$</span>RCD)</span></code></pre></div>
<pre><code>## 
## -292 -291 -290 -289 -288 -287 -286 -285 -284 -283 -282 -281 -280 -279 -278 -277 -276 -275 -274 -273 -272 -271 
##    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1 
## -270 -269 -268 -267 -266 -265 -264 -263 -262 -261 -260 -259 -258 -247 -246 -245 -244 -243 -242 -241 -240 -239 
##    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    2    2    2    1    1    1    1 
## -238 -237 -236 -235 -234 -233 -232 -195 -194 -193 -192 -191 -190 -189 -188 -187 -186 -185 -184 -183 -182 -181 
##    1    1    1    1    1    1    1    2    2    2    1    1    1    1    1    1    1    1    1    1    1    1 
## -180 -179 -178 -177 -176 -175 -167 -166 -165 -164 -163 -162 -161 -160 -159 -158 -157 -156 -155 -154 -153 -152 
##    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    2    2    2    2    2    2 
## -151 -150 -149 -148 -147 -146 -145 -144 -143 -142 -141 -139 -138 -137 -136 -135 -134 -133 -132 -131 -130 -129 
##    2    2    2    2    1    1    1    1    1    1    1    2    3    3    2    3    3    3    2    2    1    1 
## -128 -127 -126 -125 -124 -123 -122 -121 -120 -119 -118 -117 -116 -115 -114 -113 -112 -111 -110 -109 -108 -107 
##    1    1    1    2    1    1    1    1    2    2    2    3    2    2    2    2    2    2    2    2    2    2 
## -106 -105 -104 -103 -102 -101 -100  -99  -98  -97  -96  -95  -94  -93  -92  -91  -90  -89  -88  -87  -86  -85 
##    2    2    2    3    4    4    4    5    5    4    5    5    5    5    6    7    8    9    9    8    9    8 
##  -84  -83  -82  -81  -80  -79  -78  -77  -76  -75  -74  -73  -72  -71  -70  -69  -68  -67  -66  -65  -64  -63 
##   10   12   12   12   12   13   14   15   17   18   21   22   22   22   21   25   25   25   24   23   25   26 
##  -62  -61  -60  -59  -58  -57  -56  -55  -54  -53  -52  -51  -50  -49  -48  -47  -46  -45  -44  -43  -42  -41 
##   25   26   30   33   33   35   41   45   50   52   54   59   64   68   73   73   75   76   85   87   88   87 
##  -40  -39  -38  -37  -36  -35  -34  -33  -32  -31  -30  -29  -28  -27  -26  -25  -24  -23  -22  -21  -20  -19 
##   98  106  113  129  153  183  217  268  327  426  550  700 1003 1216 1351 1473 1558 1600 1641 1685 1726 1774 
##  -18  -17  -16  -15  -14  -13  -12  -11  -10   -9   -8   -7   -6   -5   -4   -3   -2   -1 
## 1801 1809 1833 1848 1877 1904 1918 1936 1957 1975 2000 2028 2032 2049 2044 2045 2054 2052</code></pre>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1"></a><span class="kw">table</span>(s3_daily<span class="op">$</span>RCD_inferred)</span></code></pre></div>
<pre><code>## 
##  -50  -49  -48  -47  -46  -45  -44  -43  -42  -41  -40  -39  -38  -37  -36  -35  -34  -33  -32  -31  -30  -29 
##    3    3    4    4    4    5    5    3    7    8   16   18   29   32   38   84  119  156  216  295  606  834 
##  -28  -27  -26  -25  -24  -23  -22  -21  -20  -19  -18  -17  -16  -15  -14  -13  -12  -11  -10   -9   -8   -7 
## 1516 1743 1873 2016 2051 2096 2112 2137 2142 2165 2166 2158 2162 2167 2145 2146 2159 2164 2163 2143 2116 2068 
##   -6   -5   -4   -3   -2   -1    0    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15 
## 2029 1958 1873 1732 1533 1286  958  732  565  428  360  295  265  234  202  187  171  160  151  142  134  124 
##   16   17   18   19   20   21   22   23   24   25   26   27   28   29   30   31   32   33   34   35   36   37 
##  118  113  104   99   92   81   75   71   66   61   54   53   45   42   41   39   36   31   28   28   26   25 
##   38   39   40   41   42   43   44   45   46   47   48   49   50   51   52   53   54   55   56   57   58   59 
##   23   22   21   19   18   17   16   15   14   13   13   14   13   12   11   10   10    9    9    7    6    6 
##   60   61   62   63   64   65   66   67   68   69   70   71   72   73   74   75   76   77   78   79   80   81 
##    5    4    4    3    3    4    2    2    2    2    1    1    1    1    1    1    1    1    1    1    1    1 
##   82   83   84   85   86   87   88   89   90   91   92   93   94   95   96   97   98   99  100  101  102  103 
##    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1 
##  104  105  106  107  108  109  110  111  112  113  114  115  116  117  118  119  120  121  122  123  124  125 
##    2    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1 
##  126  127  128  129  130  131  132  133  160 
##    1    1    1    1    1    1    1    1    1</code></pre>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1"></a><span class="kw">table</span>(s3_daily<span class="op">$</span>RCD_inferred_squished)</span></code></pre></div>
<pre><code>## 
##  -29  -28  -27  -26  -25  -24  -23  -22  -21  -20  -19  -18  -17  -16  -15  -14  -13  -12  -11  -10   -9   -8 
## 2055 2103 1957 2044 2108 2076 1247 2569 2066 2182 2024 2233 1906 2207 2170 2145 2146 2159 2164 2163 2143 2116 
##   -7   -6   -5   -4   -3   -2   -1 
## 2068 2029 1958 1873 1732 1533 1286</code></pre>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="#cb402-1"></a><span class="kw">table</span>(s3_daily<span class="op">$</span>RCD_inferred <span class="op">&gt;</span><span class="st"> </span><span class="dv">-1</span>)</span></code></pre></div>
<pre><code>## 
## FALSE  TRUE 
## 58508  6831</code></pre>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1"></a><span class="kw">crosstabs</span>(s3_daily<span class="op">$</span>RCD_inferred[<span class="kw">is.na</span>(s3_daily<span class="op">$</span>RCD_inferred_squished)]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sort</span>()</span></code></pre></div>
<pre><code>## s3_daily$RCD_inferred[is.na(s3_daily$RCD_inferred_squished)]
##    70    71    72    73    74    75    76    77    78    79    80    81    82    83    84    85    86    87 
##     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1 
##    88    89    90    91    92    93    94    95    96    97    98    99   100   101   102   103   105   106 
##     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1 
##   107   108   109   110   111   112   113   114   115   116   117   118   119   120   121   122   123   124 
##     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1 
##   125   126   127   128   129   130   131   132   133   160    66    67    68    69   104   -50   -49   -43 
##     1     1     1     1     1     1     1     1     1     1     2     2     2     2     2     3     3     3 
##    63    64   -48   -47   -46    61    62    65   -45   -44    60    58    59   -42    57   -41    55    56 
##     3     3     4     4     4     4     4     4     5     5     5     6     6     7     7     8     9     9 
##    53    54    52    51    47    48    50    46    49    45    44    43    42    41    40    39    38    37 
##    10    10    11    12    13    13    13    14    14    15    16    17    18    19    21    22    23    25 
##    36    34    35    33    32    31    30    29    28    27    26    25    24    23    22    21    20    19 
##    26    28    28    31    36    39    41    42    45    53    54    61    66    71    75    81    92    99 
##    18    17    16    15    14    13    12    11    10     9     8     7     6     5     4     3     2     1 
##   104   113   118   124   134   142   151   160   171   187   202   234   265   295   360   428   565   732 
##     0  &lt;NA&gt; 
##   958 13910</code></pre>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1"></a><span class="kw">crosstabs</span>(s3_daily<span class="op">$</span>RCD[<span class="kw">is.na</span>(s3_daily<span class="op">$</span>RCD_squished)]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sort</span>()</span></code></pre></div>
<pre><code>## s3_daily$RCD[is.na(s3_daily$RCD_squished)]
##  -292  -291  -290  -289  -288  -287  -286  -285  -284  -283  -282  -281  -280  -279  -278  -277  -276  -275 
##     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1 
##  -274  -273  -272  -271  -270  -269  -268  -267  -266  -265  -264  -263  -262  -261  -260  -259  -258  -247 
##     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1 
##  -246  -242  -241  -240  -239  -238  -237  -236  -235  -234  -233  -232  -192  -191  -190  -189  -188  -187 
##     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1 
##  -186  -185  -184  -183  -182  -181  -180  -179  -178  -177  -176  -175  -167  -166  -165  -164  -163  -162 
##     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1 
##  -161  -160  -159  -158  -147  -146  -145  -144  -143  -142  -141  -130  -129  -128  -127  -126  -124  -123 
##     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1     1 
##  -122  -121  -245  -244  -243  -195  -194  -193  -157  -156  -155  -154  -153  -152  -151  -150  -149  -148 
##     1     1     2     2     2     2     2     2     2     2     2     2     2     2     2     2     2     2 
##  -139  -136  -132  -131  -125  -120  -119  -118  -116  -115  -114  -113  -112  -111  -110  -109  -108  -107 
##     2     2     2     2     2     2     2     2     2     2     2     2     2     2     2     2     2     2 
##  -106  -105  -104  -138  -137  -135  -134  -133  -117  -103  -102  -101  -100   -97   -99   -98   -96   -95 
##     2     2     2     3     3     3     3     3     3     3     4     4     4     4     5     5     5     5 
##   -94   -93   -92   -91   -90   -87   -85   -89   -88   -86   -84   -83   -82   -81   -80   -79   -78   -77 
##     5     5     6     7     8     8     8     9     9     9    10    12    12    12    12    13    14    15 
##   -76   -75   -74   -70   -73   -72   -71   -65   -66   -69   -68   -67   -64   -62   -63   -61   -60   -59 
##    17    18    21    21    22    22    22    23    24    25    25    25    25    25    26    26    30    33 
##   -58   -57   -56   -55   -54   -53   -52   -51   -50   -49   -48   -47   -46   -45   -44   -43   -41   -42 
##    33    35    41    45    50    52    54    59    64    68    73    73    75    76    85    87    87    88 
##  &lt;NA&gt; 
## 23818</code></pre>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1"></a><span class="kw">crosstabs</span>(s3_daily<span class="op">$</span>RCD_inferred_squished)</span></code></pre></div>
<pre><code>## s3_daily$RCD_inferred_squished
##   -29   -28   -27   -26   -25   -24   -23   -22   -21   -20   -19   -18   -17   -16   -15   -14   -13   -12 
##  2055  2103  1957  2044  2108  2076  1247  2569  2066  2182  2024  2233  1906  2207  2170  2145  2146  2159 
##   -11   -10    -9    -8    -7    -6    -5    -4    -3    -2    -1  &lt;NA&gt; 
##  2164  2163  2143  2116  2068  2029  1958  1873  1732  1533  1286 20787</code></pre>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1"></a><span class="kw">table</span>(s3_daily<span class="op">$</span>FCD)</span></code></pre></div>
<pre><code>## 
##    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16   17   18   19   20   21   22 
## 2093 2107 2122 2124 2151 2166 2174 2166 2160 2172 2174 2174 2172 2177 2168 2162 2165 2167 2169 2150 2141 2102 
##   23   24   25   26   27   28   29   30   31   32   33   34   35   36   37   38   39   40   41   42   43   44 
## 2071 2007 1927 1787 1612 1349  976  775  619  492  421  343  311  262  230  208  186  169  158  152  146  137 
##   45   46   47   48   49   50   51   52   53   54   55   56   57   58   59   60   61   62   63   64   65   66 
##  127  118  108   99   92   86   80   70   67   65   58   55   48   47   46   45   40   34   32   31   27   24 
##   67   68   69   70   71   72   73   74   75   76   77   78   79   80   81   82   83   84   85   86   87   88 
##   21   21   21   19   17   14   14   14   13   12   11   12   13   13   12   10   10    9    9    9    8    8 
##   89   90   91   92   93   94   95   96   97   98   99  100  101  102  103  104  105  106  107  108  109  110 
##    8    8    6    5    5    4    6    4    4    4    1    1    1    1    1    1    1    1    1    1    1    1 
##  111  112  113  114  115  116  117  118  119  120  121  122  123  124  125  126  127  128  129  130  131  132 
##    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    2    1    1 
##  133  134  135  136  137  138  139  140  141  142  143  144  145  146  147  148  149  150  151  152  153  154 
##    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1 
##  155  156  157  158  159  160  161  162  163  189 
##    1    1    1    1    1    1    1    1    1    1</code></pre>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="#cb412-1"></a>days &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb412-2"><a href="#cb412-2"></a>    <span class="dt">RCD =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">28</span><span class="op">:-</span><span class="dv">1</span>, <span class="dv">-29</span><span class="op">:-</span><span class="dv">40</span>),</span>
<span id="cb412-3"><a href="#cb412-3"></a>    <span class="dt">FCD =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">40</span>),</span>
<span id="cb412-4"><a href="#cb412-4"></a>    <span class="dt">prc_stirn_b =</span> <span class="kw">c</span>(.<span class="dv">01</span>, <span class="fl">.01</span>, <span class="fl">.02</span>, <span class="fl">.03</span>, <span class="fl">.05</span>, <span class="fl">.09</span>, <span class="fl">.16</span>, <span class="fl">.27</span>, <span class="fl">.38</span>, <span class="fl">.48</span>, <span class="fl">.56</span>, <span class="fl">.58</span>, <span class="fl">.55</span>, <span class="fl">.48</span>, <span class="fl">.38</span>, <span class="fl">.28</span>, <span class="fl">.20</span>, <span class="fl">.14</span>, <span class="fl">.10</span>, <span class="fl">.07</span>, <span class="fl">.06</span>, <span class="fl">.04</span>, <span class="fl">.03</span>, <span class="fl">.02</span>, <span class="fl">.01</span>, <span class="fl">.01</span>, <span class="fl">.01</span>, <span class="fl">.01</span>, <span class="kw">rep</span>(.<span class="dv">01</span>, <span class="dt">times =</span> <span class="dv">12</span>)),</span>
<span id="cb412-5"><a href="#cb412-5"></a><span class="co">#                   rep(.01, times = 70)), # gangestad uses .01 here, but I think such cases are better thrown than kept, since we might simply have missed a mens</span></span>
<span id="cb412-6"><a href="#cb412-6"></a>    <span class="dt">prc_wcx_b =</span> <span class="kw">c</span>(.<span class="dv">000</span>, <span class="fl">.000</span>, <span class="fl">.001</span>, <span class="fl">.002</span>, <span class="fl">.004</span>, <span class="fl">.009</span>, <span class="fl">.018</span>, <span class="fl">.032</span>, <span class="fl">.050</span>, <span class="fl">.069</span>, <span class="fl">.085</span>, <span class="fl">.094</span>, <span class="fl">.093</span>, <span class="fl">.085</span>, <span class="fl">.073</span>, <span class="fl">.059</span>, <span class="fl">.047</span>, <span class="fl">.036</span>, <span class="fl">.028</span>, <span class="fl">.021</span>, <span class="fl">.016</span>, <span class="fl">.013</span>, <span class="fl">.010</span>, <span class="fl">.008</span>, <span class="fl">.007</span>, <span class="fl">.006</span>, <span class="fl">.005</span>, <span class="fl">.005</span>, <span class="kw">rep</span>(.<span class="dv">005</span>, <span class="dt">times =</span> <span class="dv">12</span>))</span>
<span id="cb412-7"><a href="#cb412-7"></a>)</span>
<span id="cb412-8"><a href="#cb412-8"></a>                  <span class="co"># rep(NA_real_, times = 70))  # gangestad uses .005 here, but I think such cases are better thrown than kept, since we might simply have missed a mens</span></span>
<span id="cb412-9"><a href="#cb412-9"></a>days =<span class="st"> </span>days <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(</span>
<span id="cb412-10"><a href="#cb412-10"></a> <span class="dt">fertile_narrow =</span> <span class="kw">if_else</span>(<span class="kw">between</span>(RCD,<span class="op">-</span><span class="dv">18</span>, <span class="dv">-14</span>), <span class="kw">mean</span>(prc_stirn_b[<span class="kw">between</span>(RCD, <span class="dv">-18</span>, <span class="dv">-14</span>)], <span class="dt">na.rm =</span> T), </span>
<span id="cb412-11"><a href="#cb412-11"></a>                     <span class="kw">if_else</span>(<span class="kw">between</span>(RCD, <span class="dv">-11</span>, <span class="dv">-3</span>), <span class="kw">mean</span>(prc_stirn_b[<span class="kw">between</span>(RCD,<span class="op">-</span><span class="dv">11</span>, <span class="dv">-3</span>)], <span class="dt">na.rm =</span> T), <span class="ot">NA_real_</span>)), <span class="co"># these days are likely infertile</span></span>
<span id="cb412-12"><a href="#cb412-12"></a> </span>
<span id="cb412-13"><a href="#cb412-13"></a>  <span class="dt">fertile_broad =</span> <span class="kw">if_else</span>(<span class="kw">between</span>(RCD,<span class="op">-</span><span class="dv">21</span>,<span class="op">-</span><span class="dv">13</span>), <span class="kw">mean</span>(prc_stirn_b[<span class="kw">between</span>(RCD,<span class="op">-</span><span class="dv">21</span>,<span class="op">-</span><span class="dv">13</span>)], <span class="dt">na.rm =</span> T), </span>
<span id="cb412-14"><a href="#cb412-14"></a>                     <span class="kw">if_else</span>(<span class="kw">between</span>(RCD,<span class="op">-</span><span class="dv">11</span>,<span class="op">-</span><span class="dv">3</span>), <span class="kw">mean</span>(prc_stirn_b[<span class="kw">between</span>(RCD,<span class="op">-</span><span class="dv">11</span>,<span class="op">-</span><span class="dv">3</span>)], <span class="dt">na.rm =</span> T), <span class="ot">NA_real_</span>)), <span class="co"># these days are likely infertile</span></span>
<span id="cb412-15"><a href="#cb412-15"></a> <span class="dt">fertile_window =</span> <span class="kw">factor</span>(<span class="kw">if_else</span>(fertile_broad <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.1</span>, <span class="kw">if_else</span>(<span class="op">!</span><span class="kw">is.na</span>(fertile_narrow), <span class="st">&quot;narrow&quot;</span>, <span class="st">&quot;broad&quot;</span>),<span class="st">&quot;infertile&quot;</span>), <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;infertile&quot;</span>,<span class="st">&quot;broad&quot;</span>, <span class="st">&quot;narrow&quot;</span>)),</span>
<span id="cb412-16"><a href="#cb412-16"></a> <span class="dt">premenstrual_phase =</span> <span class="kw">ifelse</span>(<span class="kw">between</span>(RCD,  <span class="dv">-6</span>, <span class="dv">-1</span>), <span class="ot">TRUE</span>, <span class="ot">FALSE</span>)</span>
<span id="cb412-17"><a href="#cb412-17"></a>)</span></code></pre></div>
<pre><code>## mutate: new variable &#39;fertile_narrow&#39; with 3 unique values and 65% NA</code></pre>
<pre><code>##         new variable &#39;fertile_broad&#39; with 3 unique values and 55% NA</code></pre>
<pre><code>##         new variable &#39;fertile_window&#39; with 4 unique values and 55% NA</code></pre>
<pre><code>##         new variable &#39;premenstrual_phase&#39; with 2 unique values and 0% NA</code></pre>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="#cb417-1"></a><span class="co"># lh_days = days %&gt;% mutate(</span></span>
<span id="cb417-2"><a href="#cb417-2"></a><span class="co">#   DRLH = </span></span>
<span id="cb417-3"><a href="#cb417-3"></a><span class="co">#     FCD </span></span>
<span id="cb417-4"><a href="#cb417-4"></a><span class="co">#   - 1 # because FCD starts counting at 1</span></span>
<span id="cb417-5"><a href="#cb417-5"></a><span class="co">#   - 15 # because ovulation happens on ~14.6 days after menstrual onset</span></span>
<span id="cb417-6"><a href="#cb417-6"></a><span class="co">#   # + 1 # we already added 1 to the date of the LH surge above, as it happens 24-48 hours before ovulation</span></span>
<span id="cb417-7"><a href="#cb417-7"></a><span class="co">#   ) %&gt;% select(-FCD, -RCD_for_merge) </span></span>
<span id="cb417-8"><a href="#cb417-8"></a></span>
<span id="cb417-9"><a href="#cb417-9"></a><span class="co"># from Jünger et al. 2018 Supplementary Material</span></span>
<span id="cb417-10"><a href="#cb417-10"></a><span class="co"># Day relative to ovulation Schwartz et al., (1980) Wilcox et al., (1998)   Colombo &amp; Masarotto (2000)  Weighted average</span></span>
<span id="cb417-11"><a href="#cb417-11"></a>lh_days &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb417-12"><a href="#cb417-12"></a>  <span class="dt">conception_risk_lh =</span> <span class="kw">c</span>(<span class="fl">0.00</span>, <span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.06</span>, <span class="fl">0.16</span>, <span class="fl">0.20</span>, <span class="fl">0.25</span>, <span class="fl">0.24</span>, <span class="fl">0.10</span>, <span class="fl">0.02</span>, <span class="fl">0.02</span> ),</span>
<span id="cb417-13"><a href="#cb417-13"></a>  <span class="dt">DRLH =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">8</span>, <span class="dv">-7</span>, <span class="dv">-6</span>, <span class="dv">-5</span>, <span class="dv">-4</span>, <span class="dv">-3</span>, <span class="dv">-2</span>, <span class="dv">-1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb417-14"><a href="#cb417-14"></a>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb417-15"><a href="#cb417-15"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fertile_lh =</span> conception_risk_lh<span class="op">/</span><span class="kw">max</span>(conception_risk_lh))</span></code></pre></div>
<pre><code>## mutate: new variable &#39;fertile_lh&#39; with 9 unique values and 0% NA</code></pre>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="#cb419-1"></a><span class="co"># from blake et al. supplement (unweighted)  </span></span>
<span id="cb419-2"><a href="#cb419-2"></a>blake_meta &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="dt">DRLH =</span> <span class="dv">-10</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">CR =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.00267</span>,</span>
<span id="cb419-3"><a href="#cb419-3"></a><span class="fl">0.00998</span>,</span>
<span id="cb419-4"><a href="#cb419-4"></a><span class="fl">0.02600</span>,</span>
<span id="cb419-5"><a href="#cb419-5"></a><span class="fl">0.06180</span>,</span>
<span id="cb419-6"><a href="#cb419-6"></a><span class="fl">0.11600</span>,</span>
<span id="cb419-7"><a href="#cb419-7"></a><span class="fl">0.15917</span>,</span>
<span id="cb419-8"><a href="#cb419-8"></a><span class="fl">0.20717</span>,</span>
<span id="cb419-9"><a href="#cb419-9"></a><span class="fl">0.21633</span>,</span>
<span id="cb419-10"><a href="#cb419-10"></a><span class="fl">0.15667</span>,</span>
<span id="cb419-11"><a href="#cb419-11"></a><span class="fl">0.06540</span>,</span>
<span id="cb419-12"><a href="#cb419-12"></a><span class="fl">0.05250</span>,</span>
<span id="cb419-13"><a href="#cb419-13"></a><span class="fl">0.01550</span>,</span>
<span id="cb419-14"><a href="#cb419-14"></a><span class="fl">0.00300</span>,</span>
<span id="cb419-15"><a href="#cb419-15"></a><span class="fl">0.00000</span>, <span class="dv">0</span>)) </span>
<span id="cb419-16"><a href="#cb419-16"></a>blake_meta <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(lh_days) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb419-17"><a href="#cb419-17"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">conception_risk_lh =</span> <span class="kw">na_if</span>(conception_risk_lh, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb419-18"><a href="#cb419-18"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">cor</span>(conception_risk_lh, CR, <span class="dt">use =</span> <span class="st">&#39;pairwise.complete.obs&#39;</span>))</span></code></pre></div>
<pre><code>## Joining, by = &quot;DRLH&quot;</code></pre>
<pre><code>## left_join: added 2 columns (conception_risk_lh, fertile_lh)</code></pre>
<pre><code>##            &gt; rows only in x    6</code></pre>
<pre><code>##            &gt; rows only in y  ( 0)</code></pre>
<pre><code>##            &gt; matched rows     11</code></pre>
<pre><code>##            &gt;                 ====</code></pre>
<pre><code>##            &gt; rows total       17</code></pre>
<pre><code>## mutate: changed one value (6%) of &#39;conception_risk_lh&#39; (1 new NA)</code></pre>
<pre><code>## summarise: now one row and one column, ungrouped</code></pre>
<pre><code>## # A tibble: 1 x 1
##   `cor(conception_risk_lh, CR, use = &quot;pairwise.complete.obs&quot;)`
##                                                          &lt;dbl&gt;
## 1                                                        0.938</code></pre>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="#cb430-1"></a><span class="co"># blake and juenger values are very close, I&#39;ll use Juenger</span></span>
<span id="cb430-2"><a href="#cb430-2"></a></span>
<span id="cb430-3"><a href="#cb430-3"></a>s3_daily =<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(lh_days, <span class="dt">by =</span> <span class="st">&quot;DRLH&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb430-4"><a href="#cb430-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fertile_lh =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(fertile_lh) <span class="op">&amp;</span></span>
<span id="cb430-5"><a href="#cb430-5"></a><span class="st">                                </span><span class="kw">between</span>(DRLH, <span class="dv">-15</span>, <span class="dv">15</span>), <span class="dv">0</span>, fertile_lh))</span></code></pre></div>
<pre><code>## left_join: added 2 columns (conception_risk_lh, fertile_lh)</code></pre>
<pre><code>##            &gt; rows only in x   76,906</code></pre>
<pre><code>##            &gt; rows only in y  (     0)</code></pre>
<pre><code>##            &gt; matched rows      2,343</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       79,249</code></pre>
<pre><code>## mutate: changed 3,262 values (4%) of &#39;fertile_lh&#39; (3262 fewer NA)</code></pre>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="#cb438-1"></a>rcd_days =<span class="st"> </span>days <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>FCD)</span></code></pre></div>
<pre><code>## select: dropped one variable (FCD)</code></pre>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="#cb440-1"></a>s3_daily =<span class="st"> </span><span class="kw">left_join</span>(s3_daily, rcd_days, <span class="dt">by =</span> <span class="st">&quot;RCD&quot;</span>)</span></code></pre></div>
<pre><code>## left_join: added 6 columns (prc_stirn_b, prc_wcx_b, fertile_narrow, fertile_broad, fertile_window, …)</code></pre>
<pre><code>##            &gt; rows only in x   25,790</code></pre>
<pre><code>##            &gt; rows only in y  (     0)</code></pre>
<pre><code>##            &gt; matched rows     53,459</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       79,249</code></pre>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="#cb447-1"></a>rcd_squished =<span class="st"> </span>days <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>FCD)</span></code></pre></div>
<pre><code>## select: dropped one variable (FCD)</code></pre>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="#cb449-1"></a><span class="kw">names</span>(rcd_squished) =<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">names</span>(rcd_squished), <span class="st">&quot;_squished&quot;</span>)</span>
<span id="cb449-2"><a href="#cb449-2"></a>s3_daily =<span class="st"> </span><span class="kw">left_join</span>(s3_daily, rcd_squished, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;RCD_squished_rounded&quot;</span> =<span class="st"> &quot;RCD_squished&quot;</span>))</span></code></pre></div>
<pre><code>## left_join: added 6 columns (prc_stirn_b_squished, prc_wcx_b_squished, fertile_narrow_squished, fertile_broad_squished, fertile_window_squished, …)</code></pre>
<pre><code>##            &gt; rows only in x   25,790</code></pre>
<pre><code>##            &gt; rows only in y  (    11)</code></pre>
<pre><code>##            &gt; matched rows     53,459</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       79,249</code></pre>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="#cb456-1"></a>rcd_inferred_squished =<span class="st"> </span>days <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>FCD)</span></code></pre></div>
<pre><code>## select: dropped one variable (FCD)</code></pre>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="#cb458-1"></a><span class="kw">names</span>(rcd_inferred_squished) =<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">names</span>(rcd_inferred_squished), <span class="st">&quot;_inferred_squished&quot;</span>)</span>
<span id="cb458-2"><a href="#cb458-2"></a>s3_daily =<span class="st"> </span><span class="kw">left_join</span>(s3_daily, rcd_inferred_squished, <span class="dt">by =</span> <span class="st">&quot;RCD_inferred_squished&quot;</span>)</span></code></pre></div>
<pre><code>## left_join: added 6 columns (prc_stirn_b_inferred_squished, prc_wcx_b_inferred_squished, fertile_narrow_inferred_squished, fertile_broad_inferred_squished, fertile_window_inferred_squished, …)</code></pre>
<pre><code>##            &gt; rows only in x   20,787</code></pre>
<pre><code>##            &gt; rows only in y  (    11)</code></pre>
<pre><code>##            &gt; matched rows     58,462</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       79,249</code></pre>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="#cb465-1"></a>fcd_days =<span class="st"> </span>days <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>RCD)</span></code></pre></div>
<pre><code>## select: dropped one variable (RCD)</code></pre>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="#cb467-1"></a><span class="kw">names</span>(fcd_days) =<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">names</span>(fcd_days), <span class="st">&quot;_forward_counted&quot;</span>)</span>
<span id="cb467-2"><a href="#cb467-2"></a>fcd_days =<span class="st"> </span>fcd_days <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">FCD =</span> FCD_forward_counted)</span></code></pre></div>
<pre><code>## rename: renamed one variable (FCD)</code></pre>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="#cb469-1"></a>s3_daily =<span class="st"> </span><span class="kw">left_join</span>(s3_daily, fcd_days, <span class="dt">by =</span> <span class="st">&quot;FCD&quot;</span>)</span></code></pre></div>
<pre><code>## left_join: added 6 columns (prc_stirn_b_forward_counted, prc_wcx_b_forward_counted, fertile_narrow_forward_counted, fertile_broad_forward_counted, fertile_window_forward_counted, …)</code></pre>
<pre><code>##            &gt; rows only in x   16,148</code></pre>
<pre><code>##            &gt; rows only in y  (     0)</code></pre>
<pre><code>##            &gt; matched rows     63,101</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       79,249</code></pre>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="#cb476-1"></a>aware_luteal_squished =<span class="st"> </span>days <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>FCD) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">RCD =</span> RCD <span class="op">+</span><span class="st"> </span><span class="dv">15</span>)</span></code></pre></div>
<pre><code>## select: dropped one variable (FCD)</code></pre>
<pre><code>## mutate: converted &#39;RCD&#39; from integer to double (0 new NA)</code></pre>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="#cb479-1"></a><span class="kw">names</span>(aware_luteal_squished) =<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">names</span>(aware_luteal_squished), <span class="st">&quot;_aware_luteal&quot;</span>)</span>
<span id="cb479-2"><a href="#cb479-2"></a>s3_daily<span class="op">$</span>DAL &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(s3_daily<span class="op">$</span>DAL)</span>
<span id="cb479-3"><a href="#cb479-3"></a>s3_daily =<span class="st"> </span><span class="kw">left_join</span>(s3_daily, aware_luteal_squished, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;DAL&quot;</span> =<span class="st"> &quot;RCD_aware_luteal&quot;</span>))</span></code></pre></div>
<pre><code>## left_join: added 6 columns (prc_stirn_b_aware_luteal, prc_wcx_b_aware_luteal, fertile_narrow_aware_luteal, fertile_broad_aware_luteal, fertile_window_aware_luteal, …)</code></pre>
<pre><code>##            &gt; rows only in x   69,482</code></pre>
<pre><code>##            &gt; rows only in y  (     0)</code></pre>
<pre><code>##            &gt; matched rows      9,767</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       79,249</code></pre>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="#cb486-1"></a>rcd_inferred_days =<span class="st"> </span>days <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>FCD)</span></code></pre></div>
<pre><code>## select: dropped one variable (FCD)</code></pre>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="#cb488-1"></a><span class="kw">names</span>(rcd_inferred_days) =<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">names</span>(rcd_inferred_days), <span class="st">&quot;_inferred&quot;</span>)</span>
<span id="cb488-2"><a href="#cb488-2"></a>s3_daily =<span class="st"> </span><span class="kw">left_join</span>(s3_daily, rcd_inferred_days, <span class="dt">by =</span> <span class="st">&quot;RCD_inferred&quot;</span>)</span></code></pre></div>
<pre><code>## left_join: added 6 columns (prc_stirn_b_inferred, prc_wcx_b_inferred, fertile_narrow_inferred, fertile_broad_inferred, fertile_window_inferred, …)</code></pre>
<pre><code>##            &gt; rows only in x   20,787</code></pre>
<pre><code>##            &gt; rows only in y  (     0)</code></pre>
<pre><code>##            &gt; matched rows     58,462</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       79,249</code></pre>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="#cb495-1"></a><span class="kw">table</span>(s3_daily<span class="op">$</span>prc_stirn_b_inferred)</span></code></pre></div>
<pre><code>## 
##  0.01  0.02  0.03  0.04  0.05  0.06  0.07  0.09   0.1  0.14  0.16   0.2  0.27  0.28  0.38  0.48  0.55  0.56 
## 12126  3831  4045  2068  2051  2116  2143  2096  2163  2164  2112  2159  2137  2146  4287  4332  2162  2166 
##  0.58 
##  2158</code></pre>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="#cb497-1"></a><span class="co"># s3_daily %&gt;% filter(is.na(prc_stirn_b_inferred_squished), !is.na(prc_stirn_b_inferred)) %&gt;% select(short, menstruation_length, cycle_nr, cycle_length, day_number, created_date, last_menstrual_onset, next_menstrual_onset, next_menstrual_onset_inferred, FCD, RCD, RCD_squished, RCD_inferred, RCD_inferred_squished, RCD_inferred, prc_stirn_b_inferred_squished, prc_stirn_b) %&gt;% rcamisc::view_in_excel()</span></span>
<span id="cb497-2"><a href="#cb497-2"></a><span class="kw">xtabs</span>(<span class="op">~</span><span class="st"> </span><span class="kw">is.na</span>(prc_stirn_b_inferred_squished) <span class="op">+</span><span class="st"> </span><span class="kw">is.na</span>(prc_stirn_b_inferred), <span class="dt">data =</span> s3_daily)</span></code></pre></div>
<pre><code>##                                     is.na(prc_stirn_b_inferred)
## is.na(prc_stirn_b_inferred_squished) FALSE  TRUE
##                                FALSE 58462     0
##                                TRUE      0 20787</code></pre>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="#cb499-1"></a><span class="kw">xtabs</span>(<span class="op">~</span><span class="st"> </span><span class="kw">is.na</span>(prc_stirn_b_squished) <span class="op">+</span><span class="st"> </span><span class="kw">is.na</span>(prc_stirn_b), <span class="dt">data =</span> s3_daily)</span></code></pre></div>
<pre><code>##                            is.na(prc_stirn_b)
## is.na(prc_stirn_b_squished) FALSE  TRUE
##                       FALSE 53459     0
##                       TRUE      0 25790</code></pre>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="#cb501-1"></a><span class="kw">xtabs</span>(<span class="op">~</span><span class="st"> </span><span class="kw">is.na</span>(prc_stirn_b_squished) <span class="op">+</span><span class="st"> </span><span class="kw">is.na</span>(RCD_squished), <span class="dt">data =</span> s3_daily)</span></code></pre></div>
<pre><code>##                            is.na(RCD_squished)
## is.na(prc_stirn_b_squished) FALSE  TRUE
##                       FALSE 53459     0
##                       TRUE      0 25790</code></pre>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="#cb503-1"></a><span class="kw">xtabs</span>(<span class="op">~</span><span class="st"> </span><span class="kw">is.na</span>(prc_stirn_b_inferred_squished) <span class="op">+</span><span class="st"> </span><span class="kw">is.na</span>(prc_stirn_b_squished), <span class="dt">data =</span> s3_daily)</span></code></pre></div>
<pre><code>##                                     is.na(prc_stirn_b_squished)
## is.na(prc_stirn_b_inferred_squished) FALSE  TRUE
##                                FALSE 48348 10114
##                                TRUE   5111 15676</code></pre>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="#cb505-1"></a>s3_daily =<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb505-2"><a href="#cb505-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fertile_fab =</span> prc_stirn_b, </span>
<span id="cb505-3"><a href="#cb505-3"></a>         <span class="dt">premenstrual_phase_fab =</span> premenstrual_phase</span>
<span id="cb505-4"><a href="#cb505-4"></a>  )</span></code></pre></div>
<pre><code>## mutate: new variable &#39;fertile_fab&#39; with 20 unique values and 33% NA</code></pre>
<pre><code>##         new variable &#39;premenstrual_phase_fab&#39; with 3 unique values and 33% NA</code></pre>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="#cb508-1"></a><span class="kw">var_label</span>(s3_daily<span class="op">$</span>fertile_fab) &lt;-<span class="st"> &quot;Est. fertile window prob. (BC+i)&quot;</span></span>
<span id="cb508-2"><a href="#cb508-2"></a><span class="kw">var_label</span>(s3_daily<span class="op">$</span>premenstrual_phase_fab) &lt;-<span class="st"> &quot;Est. premenstrual phase (BC+i)&quot;</span></span>
<span id="cb508-3"><a href="#cb508-3"></a></span>
<span id="cb508-4"><a href="#cb508-4"></a>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(fertile_fab, premenstrual_phase_fab, menstruation_labelled) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>()</span></code></pre></div>
<pre><code>## select: dropped 304 variables (session, created_date, created, modified, ended, …)</code></pre>
<pre><code>## [1] 53459</code></pre>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="#cb511-1"></a>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(fertile_fab, premenstrual_phase_fab, menstruation_labelled) <span class="op">%&gt;%</span><span class="st"> </span>codebook<span class="op">::</span><span class="kw">md_pattern</span>()</span></code></pre></div>
<pre><code>## select: dropped 304 variables (session, created_date, created, modified, ended, …)</code></pre>
<pre><code>## # A tibble: 3 x 5
##   description                   fertile_fab premenstrual_phase_fab var_miss n_miss
##   &lt;chr&gt;                               &lt;dbl&gt;                  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
## 1 Missing values in 0 variables           1                      1        0  53459
## 2 Missing values per variable         25790                  25790    51580  51580
## 3 Missing values in 2 variables           0                      0        2  25790</code></pre>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="#cb514-1"></a><span class="co"># s3_daily %&gt;% filter(is.na(menstruation_labelled), !is.na(fertile_fab)) %&gt;% select(short, created_date, ended, menstruation_labelled, menstrual_onset, menstrual_onset_date, menstrual_onset_days_until, menstrual_onset_days_since)  %&gt;% View()</span></span></code></pre></div>
<p>test some special corner cases</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="#cb515-1"></a><span class="co"># we did correctly infer FCDs from onset reported before the diary</span></span>
<span id="cb515-2"><a href="#cb515-2"></a>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(session <span class="op">%starts_with%</span><span class="st"> &quot;_2efChM&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(FCD) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">is.na</span>() <span class="op">%&gt;%</span><span class="st"> </span>isFALSE <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">stopifnot</span>()</span></code></pre></div>
<pre><code>## filter: removed 79,180 rows (&gt;99%), 69 rows remaining</code></pre>
<pre><code>## slice: removed 68 rows (99%), one row remaining</code></pre>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="#cb518-1"></a><span class="co"># we did correctly add cycle nrs even when we didnt observe the cycle&#39;s end</span></span>
<span id="cb518-2"><a href="#cb518-2"></a>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(short <span class="op">==</span><span class="st"> &quot;_sqtMf5&quot;</span>, created_date <span class="op">==</span><span class="st"> &quot;2016-08-25&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(cycle_nr) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">is.na</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">isFALSE</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">stopifnot</span>()</span></code></pre></div>
<pre><code>## filter: removed 79,248 rows (&gt;99%), one row remaining</code></pre>
</div>
<div id="infer-menstruation" class="section level3">
<h3>Infer menstruation</h3>
<p>We did not ask about menstruation on every day, so as not to give away the purpose of the study. We can estimate the probability of menstruation quite well from other variables.</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="#cb520-1"></a>infer_mens_df &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(short) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb520-2"><a href="#cb520-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb520-3"><a href="#cb520-3"></a>    <span class="dt">premenstrual_phase =</span> <span class="kw">if_else</span>(premenstrual_phase_fab <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>, <span class="st">&quot;unknown&quot;</span>),</span>
<span id="cb520-4"><a href="#cb520-4"></a>    <span class="dt">postmenstrual_phase =</span> <span class="kw">if_else</span>(menstrual_onset_days_since <span class="op">&lt;</span><span class="st"> </span><span class="dv">6</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>, <span class="st">&quot;unknown&quot;</span>),</span>
<span id="cb520-5"><a href="#cb520-5"></a>    <span class="dt">cycle_length =</span> <span class="kw">if_else</span>(cycle_length <span class="op">&gt;</span><span class="st"> </span><span class="dv">34</span>, <span class="st">&quot;35+&quot;</span>, <span class="kw">as.character</span>(cycle_length), <span class="st">&quot;unknown&quot;</span>),</span>
<span id="cb520-6"><a href="#cb520-6"></a>    <span class="dt">menstrual_onset_days_since =</span> <span class="kw">if_else</span>(menstrual_onset_days_since <span class="op">&gt;</span><span class="st"> </span><span class="dv">9</span>, <span class="st">&quot;10+&quot;</span>, <span class="kw">as.character</span>(menstrual_onset_days_since), <span class="st">&quot;unknown&quot;</span>),</span>
<span id="cb520-7"><a href="#cb520-7"></a>    <span class="dt">menstrual_pain =</span> <span class="kw">if_else</span>(menstrual_pain <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>, <span class="st">&quot;0&quot;</span>),</span>
<span id="cb520-8"><a href="#cb520-8"></a>    <span class="dt">menstruation_lag3 =</span> <span class="kw">if_else</span>(<span class="kw">lag</span>(menstruation_today, <span class="dv">3</span>) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>, <span class="st">&quot;unknown&quot;</span>),</span>
<span id="cb520-9"><a href="#cb520-9"></a>    <span class="dt">menstruation_lead3 =</span> <span class="kw">if_else</span>(<span class="kw">lead</span>(menstruation_today, <span class="dv">3</span>) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>, <span class="st">&quot;unknown&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb520-10"><a href="#cb520-10"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb520-11"><a href="#cb520-11"></a><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(menstruation_lag3, menstruation_lead3, menstrual_pain, premenstrual_phase, postmenstrual_phase), <span class="kw">funs</span>(factor)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb520-12"><a href="#cb520-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">menstrual_onset_days_since =</span> <span class="kw">factor</span>(menstrual_onset_days_since, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;unknown&quot;</span>, <span class="dv">0</span><span class="op">:</span><span class="dv">9</span>, <span class="st">&quot;10+&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb520-13"><a href="#cb520-13"></a><span class="st">  </span><span class="kw">select</span>(short, menstruation_today, menstrual_onset_days_since, cycle_length,</span>
<span id="cb520-14"><a href="#cb520-14"></a>         menstruation_lag3, menstruation_lead3, menstrual_pain, premenstrual_phase, postmenstrual_phase)</span></code></pre></div>
<pre><code>## group_by: one grouping variable (short)</code></pre>
<pre><code>## mutate (grouped): converted &#39;menstrual_pain&#39; from double to character (27819 fewer NA)</code></pre>
<pre><code>##                   converted &#39;menstrual_onset_days_since&#39; from double to character (13745 fewer NA)</code></pre>
<pre><code>##                   converted &#39;cycle_length&#39; from double to character (23818 fewer NA)</code></pre>
<pre><code>##                   converted &#39;premenstrual_phase&#39; from logical to character (25790 fewer NA)</code></pre>
<pre><code>##                   new variable &#39;postmenstrual_phase&#39; with 3 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;menstruation_lag3&#39; with 3 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;menstruation_lead3&#39; with 3 unique values and 0% NA</code></pre>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## mutate_at: converted &#39;menstrual_pain&#39; from character to factor (0 new NA)</code></pre>
<pre><code>##            converted &#39;premenstrual_phase&#39; from character to factor (0 new NA)</code></pre>
<pre><code>##            converted &#39;postmenstrual_phase&#39; from character to factor (0 new NA)</code></pre>
<pre><code>##            converted &#39;menstruation_lag3&#39; from character to factor (0 new NA)</code></pre>
<pre><code>##            converted &#39;menstruation_lead3&#39; from character to factor (0 new NA)</code></pre>
<pre><code>## mutate: converted &#39;menstrual_onset_days_since&#39; from character to factor (0 new NA)</code></pre>
<pre><code>## select: dropped 301 variables (session, created_date, created, modified, ended, …)</code></pre>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="#cb537-1"></a>infer_mens_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>menstruation_today, <span class="op">-</span>short) <span class="op">%&gt;%</span><span class="st"> </span>drop_na <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>()</span></code></pre></div>
<pre><code>## select: dropped 2 variables (short, menstruation_today)</code></pre>
<pre><code>## drop_na: no rows removed</code></pre>
<pre><code>## [1] 79249</code></pre>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="#cb541-1"></a>infer_mens_noran &lt;-<span class="st"> </span><span class="kw">glm</span>(menstruation_today <span class="op">~</span><span class="st"> </span>premenstrual_phase <span class="op">*</span><span class="st"> </span>menstrual_pain <span class="op">+</span><span class="st"> </span>menstrual_onset_days_since, <span class="dt">data =</span> infer_mens_df, <span class="dt">family =</span> binomial)</span>
<span id="cb541-2"><a href="#cb541-2"></a>infer_mens_noran</span></code></pre></div>
<pre><code>## 
## Call:  glm(formula = menstruation_today ~ premenstrual_phase * menstrual_pain + 
##     menstrual_onset_days_since, family = binomial, data = infer_mens_df)
## 
## Coefficients:
##                               (Intercept)                        premenstrual_phase1  
##                                  -15.6359                                    -3.1864  
##                 premenstrual_phaseunknown                            menstrual_pain1  
##                                    0.0698                                     1.2299  
##               menstrual_onset_days_since0                menstrual_onset_days_since1  
##                                   16.0521                                    17.8833  
##               menstrual_onset_days_since2                menstrual_onset_days_since3  
##                                   18.3055                                    17.6788  
##               menstrual_onset_days_since4                menstrual_onset_days_since5  
##                                   16.5923                                    15.4897  
##               menstrual_onset_days_since6                menstrual_onset_days_since7  
##                                   14.4082                                    13.0418  
##               menstrual_onset_days_since8                menstrual_onset_days_since9  
##                                   12.4953                                    11.9101  
##             menstrual_onset_days_since10+        premenstrual_phase1:menstrual_pain1  
##                                    9.7591                                     2.5986  
## premenstrual_phaseunknown:menstrual_pain1  
##                                   -0.2626  
## 
## Degrees of Freedom: 17996 Total (i.e. Null);  17980 Residual
##   (61252 observations deleted due to missingness)
## Null Deviance:       16300 
## Residual Deviance: 4900  AIC: 4930</code></pre>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="#cb543-1"></a>DescTools<span class="op">::</span><span class="kw">PseudoR2</span>(infer_mens_noran, <span class="dt">which =</span> <span class="st">&quot;Nagelkerke&quot;</span>)</span></code></pre></div>
<pre><code>## Nagelkerke 
##     0.7884</code></pre>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="#cb545-1"></a>infer_mens &lt;-<span class="st"> </span>lme4<span class="op">::</span><span class="kw">glmer</span>(menstruation_today <span class="op">~</span><span class="st"> </span>premenstrual_phase <span class="op">*</span><span class="st"> </span>menstrual_pain <span class="op">+</span><span class="st"> </span>menstrual_onset_days_since <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>menstrual_pain <span class="op">|</span><span class="st"> </span>short), <span class="dt">data =</span> infer_mens_df, <span class="dt">family =</span> binomial, <span class="dt">na.action =</span> na.exclude)</span></code></pre></div>
<pre><code>## Registered S3 methods overwritten by &#39;lme4&#39;:
##   method                          from
##   cooks.distance.influence.merMod car 
##   influence.merMod                car 
##   dfbeta.influence.merMod         car 
##   dfbetas.influence.merMod        car</code></pre>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="#cb547-1"></a><span class="co"># plot(allEffects(infer_mens))</span></span>
<span id="cb547-2"><a href="#cb547-2"></a>menstruation_imputed_noran &lt;-<span class="st"> </span><span class="kw">predict</span>(infer_mens_noran, <span class="dt">newdata =</span> infer_mens_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>menstruation_today), <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, <span class="dt">allow.new.levels =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## select: dropped one variable (menstruation_today)</code></pre>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="#cb549-1"></a>s3_daily<span class="op">$</span>menstruation_imputed &lt;-<span class="st"> </span><span class="kw">predict</span>(infer_mens, <span class="dt">newdata =</span> infer_mens_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>menstruation_today), <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, <span class="dt">allow.new.levels =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## select: dropped one variable (menstruation_today)</code></pre>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="#cb551-1"></a><span class="kw">cor.test</span>(s3_daily<span class="op">$</span>menstruation_imputed, s3_daily<span class="op">$</span>menstruation_today)</span></code></pre></div>
<pre><code>
    Pearson&#39;s product-moment correlation

data:  s3_daily$menstruation_imputed and s3_daily$menstruation_today
t = 242, df = 17995, p-value &lt;2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.8712 0.8781
sample estimates:
   cor 
0.8747 
</code></pre>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="#cb553-1"></a><span class="kw">cor.test</span>(menstruation_imputed_noran, s3_daily<span class="op">$</span>menstruation_today)</span></code></pre></div>
<pre><code>
    Pearson&#39;s product-moment correlation

data:  menstruation_imputed_noran and s3_daily$menstruation_today
t = 209, df = 17995, p-value &lt;2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.8374 0.8459
sample estimates:
   cor 
0.8417 
</code></pre>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="#cb555-1"></a>s3_daily<span class="op">$</span>menstruation &lt;-<span class="st"> </span><span class="kw">if_else</span>(<span class="kw">is.na</span>(s3_daily<span class="op">$</span>menstruation_today), s3_daily<span class="op">$</span>menstruation_imputed, <span class="kw">as.double</span>(s3_daily<span class="op">$</span>menstruation_today))</span>
<span id="cb555-2"><a href="#cb555-2"></a><span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(s3_daily<span class="op">$</span>menstruation_imputed))</span></code></pre></div>
<pre><code>## [1] 79249</code></pre>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="#cb557-1"></a><span class="kw">qplot</span>(s3_daily<span class="op">$</span>menstruation_imputed, <span class="dt">fill =</span> <span class="kw">if_else</span>(s3_daily<span class="op">$</span>menstruation_today <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>, <span class="st">&quot;unknown&quot;</span>),) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_colorblind</span>(<span class="st">&quot;Actual&quot;</span>)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="0_wrangle_data_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="#cb559-1"></a><span class="kw">qplot</span>(menstrual_onset_days_since, menstruation, <span class="dt">data =</span> s3_daily, <span class="dt">geom =</span> <span class="st">&quot;blank&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">stat =</span> <span class="st">&#39;summary&#39;</span>, <span class="dt">fun.data =</span> <span class="st">&#39;mean_se&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlim</span>(<span class="dv">0</span>,<span class="dv">15</span>)</span></code></pre></div>
<p><img src="0_wrangle_data_files/figure-html/unnamed-chunk-7-2.png" width="672" /></p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="#cb560-1"></a>s3_daily &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>menstruation_length)</span></code></pre></div>
<pre><code>## select: dropped one variable (menstruation_length)</code></pre>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="#cb562-1"></a><span class="kw">var_label</span>(s3_daily<span class="op">$</span>menstruation) &lt;-<span class="st"> &quot;Est. menstruation&quot;</span></span></code></pre></div>
</div>
</div>
<div id="contraception" class="section level2">
<h2>Contraception</h2>
<div id="other-hormonal-contraception" class="section level3">
<h3>Other hormonal contraception</h3>
<p>For pills and other hormonal contraception that was not in our list.</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="#cb563-1"></a>s1_demo <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb563-2"><a href="#cb563-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(other_pill_name) <span class="op">|</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(contraception_hormonal_other) <span class="op">|</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(contraception_method_other)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb563-3"><a href="#cb563-3"></a><span class="st">  </span><span class="kw">select</span>(other_pill_name, contraception_hormonal_other, contraception_method_other) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb563-4"><a href="#cb563-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">other_pill_name =</span> <span class="kw">str_to_lower</span>(other_pill_name)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb563-5"><a href="#cb563-5"></a><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb563-6"><a href="#cb563-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">contraception_other_pill_estrogen =</span> <span class="ot">NA_real_</span>,</span>
<span id="cb563-7"><a href="#cb563-7"></a>         <span class="dt">contraception_other_pill_gestagen =</span> <span class="ot">NA_real_</span>,</span>
<span id="cb563-8"><a href="#cb563-8"></a>         <span class="dt">contraception_other_pill_gestagen_type =</span> <span class="ot">NA_real_</span></span>
<span id="cb563-9"><a href="#cb563-9"></a>         ) -&gt;<span class="st"> </span></span>
<span id="cb563-10"><a href="#cb563-10"></a><span class="st">  </span>other_pill_name</span></code></pre></div>
<pre><code>## filter: removed 1,475 rows (89%), 185 rows remaining</code></pre>
<pre><code>## select: dropped 102 variables (session, created, modified, ended, expired, …)</code></pre>
<pre><code>## mutate: changed 71 values (38%) of &#39;other_pill_name&#39; (0 new NA)</code></pre>
<pre><code>## distinct: removed 126 rows (68%), 59 rows remaining</code></pre>
<pre><code>## mutate: new variable &#39;contraception_other_pill_estrogen&#39; with one unique value and 100% NA</code></pre>
<pre><code>##         new variable &#39;contraception_other_pill_gestagen&#39; with one unique value and 100% NA</code></pre>
<pre><code>##         new variable &#39;contraception_other_pill_gestagen_type&#39; with one unique value and 100% NA</code></pre>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="#cb571-1"></a>rcamisc<span class="op">:::</span><span class="kw">view_in_excel</span>(other_pill_name)</span>
<span id="cb571-2"><a href="#cb571-2"></a></span>
<span id="cb571-3"><a href="#cb571-3"></a></span>
<span id="cb571-4"><a href="#cb571-4"></a>rio<span class="op">::</span><span class="kw">export</span>(other_pill_name, <span class="st">&quot;codings/other_pill_name.xlsx&quot;</span>)</span>
<span id="cb571-5"><a href="#cb571-5"></a>other_pill_name =<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_xlsx</span>(<span class="st">&quot;codings/other_pill_name_coded.xlsx&quot;</span>,<span class="dv">1</span>)</span>
<span id="cb571-6"><a href="#cb571-6"></a></span>
<span id="cb571-7"><a href="#cb571-7"></a>s1_demo &lt;-<span class="st"> </span>s1_demo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(</span>
<span id="cb571-8"><a href="#cb571-8"></a>  other_pill_name <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>())</span></code></pre></div>
<pre><code>## distinct: removed 2 rows (3%), 57 rows remaining</code></pre>
<pre><code>## Joining, by = c(&quot;contraception_method_other&quot;, &quot;other_pill_name&quot;, &quot;contraception_hormonal_other&quot;)</code></pre>
<pre><code>## left_join: added 3 columns (contraception_other_pill_estrogen, contraception_other_pill_gestagen, contraception_other_pill_gestagen_type)</code></pre>
<pre><code>##            &gt; rows only in x   1,547</code></pre>
<pre><code>##            &gt; rows only in y  (   34)</code></pre>
<pre><code>##            &gt; matched rows       113</code></pre>
<pre><code>##            &gt;                 =======</code></pre>
<pre><code>##            &gt; rows total       1,660</code></pre>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="#cb580-1"></a>s1_demo =<span class="st"> </span>s1_demo <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb580-2"><a href="#cb580-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hormonal_contraception =</span> <span class="kw">if_else</span>(contraception_method <span class="op">%contains%</span><span class="st"> &quot;hormonal&quot;</span>, T, F, <span class="dt">missing =</span> F),</span>
<span id="cb580-3"><a href="#cb580-3"></a>  <span class="dt">contraception_method_broad =</span> stringr<span class="op">::</span><span class="kw">str_split_fixed</span>(contraception_method, <span class="st">&quot;_&quot;</span>, <span class="dv">2</span>)[,<span class="dv">1</span>]</span>
<span id="cb580-4"><a href="#cb580-4"></a>)</span></code></pre></div>
<pre><code>## mutate: new variable &#39;hormonal_contraception&#39; with 2 unique values and 0% NA</code></pre>
<pre><code>##         new variable &#39;contraception_method_broad&#39; with 7 unique values and 0% NA</code></pre>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="#cb583-1"></a><span class="kw">sort</span>(<span class="kw">table</span>(s1_demo<span class="op">$</span>contraception_method))</span></code></pre></div>
<pre><code>## 
##                                                                                              awareness_temperature_billings 
##                                                                                                                           1 
##                                                                          awareness_temperature_billings, awareness_computer 
##                                                                                                                           1 
##                                              barrier_coitus_interruptus, awareness_calendar, awareness_temperature_billings 
##                                                                                                                           1 
##                                                  barrier_coitus_interruptus, barrier_no_penetrative_sex, awareness_calendar 
##                                                                                                                           1 
##                                     barrier_condoms, awareness_calendar, awareness_temperature_billings, awareness_computer 
##                                                                                                                           1 
##                                                                  barrier_condoms, awareness_temperature_billings, infertile 
##                                                                                                                           1 
##                                                                 barrier_condoms, awareness_temperature_billings, not_listed 
##                                                                                                                           1 
##                                                          barrier_condoms, awareness_temperature_billings, partner_infertile 
##                                                                                                                           1 
##                                barrier_condoms, barrier_coitus_interruptus, awareness_calendar, hormonal_morning_after_pill 
##                                                                                                                           1 
##                                barrier_condoms, barrier_coitus_interruptus, awareness_computer, hormonal_morning_after_pill 
##                                                                                                                           1 
##                             barrier_condoms, barrier_coitus_interruptus, awareness_temperature_billings, awareness_computer 
##                                                                                                                           1 
## barrier_condoms, barrier_coitus_interruptus, barrier_no_penetrative_sex, awareness_calendar, awareness_temperature_billings 
##                                                                                                                           1 
##                        barrier_condoms, barrier_coitus_interruptus, barrier_no_penetrative_sex, hormonal_morning_after_pill 
##                                                                                                                           1 
##                                                                 barrier_condoms, barrier_coitus_interruptus, breast_feeding 
##                                                                                                                           1 
##                                                    barrier_condoms, barrier_coitus_interruptus, hormonal_morning_after_pill 
##                                                                                                                           1 
##                             barrier_condoms, barrier_no_penetrative_sex, awareness_calendar, awareness_temperature_billings 
##                                                                                                                           1 
##                                                 barrier_condoms, barrier_no_penetrative_sex, awareness_temperature_billings 
##                                                                                                                           1 
##                                                    barrier_condoms, barrier_no_penetrative_sex, hormonal_morning_after_pill 
##                                                                                                                           1 
##                                                              barrier_condoms, barrier_other, awareness_temperature_billings 
##                                                                                                                           1 
##                                                                            barrier_condoms, barrier_other, barrier_chemical 
##                                                                                                                           1 
##                                                             barrier_condoms, hormonal_morning_after_pill, partner_infertile 
##                                                                                                                           1 
##                                                                                                  barrier_condoms, infertile 
##                                                                                                                           1 
##                          barrier_no_penetrative_sex, awareness_calendar, awareness_temperature_billings, awareness_computer 
##                                                                                                                           1 
##                                                                              barrier_no_penetrative_sex, partner_sterilised 
##                                                                                                                           1 
##                                                                                           barrier_other, awareness_calendar 
##                                                                                                                           1 
##                                                                               barrier_other, awareness_temperature_billings 
##                                                                                                                           1 
##                                                               barrier_other, barrier_coitus_interruptus, barrier_spermicide 
##                                                                                                                           1 
##                                                                                          hormonal_other, awareness_calendar 
##                                                                                                                           1 
##                                                                                             hormonal_pill, barrier_chemical 
##                                                                                                                           1 
##                                                              hormonal_pill, barrier_condoms, awareness_temperature_billings 
##                                                                                                                           1 
##                                     hormonal_pill, barrier_condoms, barrier_coitus_interruptus, hormonal_morning_after_pill 
##                                                                                                                           1 
##                                                                  hormonal_pill, barrier_condoms, barrier_no_penetrative_sex 
##                                                                                                                           1 
##                                                                                   hormonal_pill, barrier_no_penetrative_sex 
##                                                                                                                           1 
##                                                                              hormonal_pill, hormonal_other, barrier_condoms 
##                                                                                                                           1 
##                                                                  barrier_coitus_interruptus, awareness_temperature_billings 
##                                                                                                                           2 
##                             barrier_condoms, barrier_coitus_interruptus, awareness_calendar, awareness_temperature_billings 
##                                                                                                                           2 
##                                 barrier_condoms, barrier_coitus_interruptus, barrier_no_penetrative_sex, awareness_calendar 
##                                                                                                                           2 
##                                                                                barrier_condoms, hormonal_morning_after_pill 
##                                                                                                                           2 
##                                                                                                  barrier_no_penetrative_sex 
##                                                                                                                           2 
##                                                                 hormonal_other, barrier_condoms, barrier_coitus_interruptus 
##                                                                                                                           2 
##                                                                                   hormonal_pill, barrier_coitus_interruptus 
##                                                                                                                           2 
##                                                                                                                  sterilised 
##                                                                                                                           2 
##                                                                                                          awareness_calendar 
##                                                                                                                           3 
##                                                             barrier_condoms, barrier_no_penetrative_sex, awareness_calendar 
##                                                                                                                           3 
##                                                                                                 barrier_condoms, not_listed 
##                                                                                                                           3 
##                                                                                                               barrier_other 
##                                                                                                                           3 
##                                                                  hormonal_pill, barrier_condoms, barrier_coitus_interruptus 
##                                                                                                                           3 
##                                                                 hormonal_pill, barrier_condoms, hormonal_morning_after_pill 
##                                                                                                                           3 
##                                                                                         barrier_condoms, awareness_computer 
##                                                                                                                           4 
##                                                                                 barrier_condoms, barrier_no_penetrative_sex 
##                                                                                                                           4 
##                                                                          hormonal_pill, barrier_condoms, awareness_calendar 
##                                                                                                                           4 
##                                                 barrier_condoms, barrier_coitus_interruptus, awareness_temperature_billings 
##                                                                                                                           5 
##                                                                                              barrier_condoms, barrier_other 
##                                                                                                                           5 
##                                                                                                                  not_listed 
##                                                                                                                           5 
##                                                     barrier_condoms, barrier_coitus_interruptus, barrier_no_penetrative_sex 
##                                                                                                                           6 
##                                                                                                          partner_sterilised 
##                                                                                                                           6 
##                                                         barrier_condoms, awareness_calendar, awareness_temperature_billings 
##                                                                                                                           8 
##                                                                              barrier_coitus_interruptus, awareness_calendar 
##                                                                                                                          11 
##                                                             barrier_condoms, barrier_coitus_interruptus, awareness_calendar 
##                                                                                                                          12 
##                                                                                                  barrier_coitus_interruptus 
##                                                                                                                          17 
##                                                                                barrier_condoms, barrier_intrauterine_pessar 
##                                                                                                                          17 
##                                                                                             hormonal_other, barrier_condoms 
##                                                                                                                          18 
##                                                                                 barrier_condoms, barrier_coitus_interruptus 
##                                                                                                                          27 
##                                                                             barrier_condoms, awareness_temperature_billings 
##                                                                                                                          31 
##                                                                                         barrier_condoms, awareness_calendar 
##                                                                                                                          33 
##                                                                                                              hormonal_other 
##                                                                                                                          75 
##                                                                                                 barrier_intrauterine_pessar 
##                                                                                                                          76 
##                                                                                              hormonal_pill, barrier_condoms 
##                                                                                                                         221 
##                                                                                                               hormonal_pill 
##                                                                                                                         335 
##                                                                                                             barrier_condoms 
##                                                                                                                         399</code></pre>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="#cb585-1"></a><span class="kw">unique</span>(s1_demo<span class="op">$</span>contraception_method_other) <span class="co"># todo: code manually</span></span></code></pre></div>
<pre><code>##  [1] NA                                                        
##  [2] &quot;Klimakterium&quot;                                            
##  [3] &quot;ich verhüte zur Zeit nicht, da ich schwanger werden will&quot;
##  [4] &quot;Nuvaring&quot;                                                
##  [5] &quot;Single ohne One-night-Stand&quot;                             
##  [6] &quot;ich habe keinen/kaum Geschlechtsverkehr&quot;                 
##  [7] &quot;NFP&quot;                                                     
##  [8] &quot;NFP natürliche Verhütung&quot;                                
##  [9] &quot;Hormonspirale&quot;                                           
## [10] &quot;Gynefix &quot;</code></pre>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="#cb587-1"></a><span class="kw">sort</span>(<span class="kw">table</span>(s1_demo<span class="op">$</span>contraception_combi))</span></code></pre></div>
<pre><code>## 
##                                      fallback_if_fertile, barrier_if_partner_sick, different_methods_for_different_partners 
##                                                                                                                           1 
##                                                                                                  fallback_if_fertile, other 
##                                                                                                                           1 
##                                        fallback_if_forgotten, fallback_if_fertile, different_methods_for_different_partners 
##                                                                                                                           1 
##                                                                                                fallback_if_forgotten, other 
##                                                                                                                           1 
##                                                               multiple_to_decrease_conception_risk, barrier_if_partner_sick 
##                                                                                                                           1 
##                                              multiple_to_decrease_conception_risk, different_methods_for_different_partners 
##                                                                                                                           1 
##                                            multiple_to_decrease_conception_risk, fallback_if_forgotten, fallback_if_fertile 
##                                                                                                                           1 
##                                                                                 multiple_to_decrease_conception_risk, other 
##                                                                                                                           1 
##                      multiple_to_decrease_infection_risk, barrier_if_partner_sick, different_methods_for_different_partners 
##                                                                                                                           1 
## multiple_to_decrease_infection_risk, fallback_if_fertile, barrier_if_partner_sick, different_methods_for_different_partners 
##                                                                                                                           1 
##     multiple_to_decrease_infection_risk, multiple_to_decrease_conception_risk, fallback_if_fertile, barrier_if_partner_sick 
##                                                                                                                           1 
##                                            multiple_to_decrease_infection_risk, multiple_to_decrease_conception_risk, other 
##                                                                                                                           1 
##                                                                                  multiple_to_decrease_infection_risk, other 
##                                                                                                                           1 
##                                                           barrier_if_partner_sick, different_methods_for_different_partners 
##                                                                                                                           2 
##                                                                              fallback_if_forgotten, barrier_if_partner_sick 
##                                                                                                                           2 
##                          multiple_to_decrease_infection_risk, fallback_if_fertile, different_methods_for_different_partners 
##                                                                                                                           2 
##                        multiple_to_decrease_infection_risk, fallback_if_forgotten, different_methods_for_different_partners 
##                                                                                                                           2 
##                                             multiple_to_decrease_infection_risk, fallback_if_forgotten, fallback_if_fertile 
##                                                                                                                           2 
##                          multiple_to_decrease_infection_risk, multiple_to_decrease_conception_risk, barrier_if_partner_sick 
##                                                                                                                           2 
##                              multiple_to_decrease_infection_risk, multiple_to_decrease_conception_risk, fallback_if_fertile 
##                                                                                                                           2 
##                                                                multiple_to_decrease_infection_risk, barrier_if_partner_sick 
##                                                                                                                           3 
##                                                                    multiple_to_decrease_infection_risk, fallback_if_fertile 
##                                                                                                                           4 
##                                               multiple_to_decrease_infection_risk, different_methods_for_different_partners 
##                                                                                                                           5 
##                            multiple_to_decrease_infection_risk, multiple_to_decrease_conception_risk, fallback_if_forgotten 
##                                                                                                                           6 
##                                                               fallback_if_fertile, different_methods_for_different_partners 
##                                                                                                                           7 
##                                                             fallback_if_forgotten, different_methods_for_different_partners 
##                                                                                                                           7 
##                                                                 multiple_to_decrease_conception_risk, fallback_if_forgotten 
##                                                                                                                           7 
##         multiple_to_decrease_infection_risk, multiple_to_decrease_conception_risk, different_methods_for_different_partners 
##                                                                                                                           7 
##                                                                                                     barrier_if_partner_sick 
##                                                                                                                           8 
##                                                                                  fallback_if_forgotten, fallback_if_fertile 
##                                                                                                                           8 
##                                                                   multiple_to_decrease_conception_risk, fallback_if_fertile 
##                                                                                                                          10 
##                                                                                                                       other 
##                                                                                                                          19 
##                                                                                    different_methods_for_different_partners 
##                                                                                                                          34 
##                                                                                        multiple_to_decrease_conception_risk 
##                                                                                                                          48 
##                                                   multiple_to_decrease_infection_risk, multiple_to_decrease_conception_risk 
##                                                                                                                          54 
##                                                                                                       fallback_if_forgotten 
##                                                                                                                          62 
##                                                                                         multiple_to_decrease_infection_risk 
##                                                                                                                          73 
##                                                                                                         fallback_if_fertile 
##                                                                                                                          74</code></pre>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb589-1"><a href="#cb589-1"></a><span class="kw">unique</span>(s1_demo<span class="op">$</span>contraception_method_combination_other)</span></code></pre></div>
<pre><code>##  [1] NA                                                                                                                                                                                                                                                                                                                                                                                                                         
##  [2] &quot;Eher nach dem Lustprinzip und ob ich meine Regelblutung habe oder nicht. Mal mit Kondom, wenn wir beide es wollen, dass mein Partner in mir kommt z.B.. Oder wenn ich meine Regelblutung habe, dann kommt der \&quot;Verzicht auf penetrativen Geschlechtsverkehr\&quot; infrage. Hauptsächlich \&quot;nutzen\&quot; wir die Methode des \&quot;Coitus interruptus\&quot; bzw. gehen rechtzeitig dann vor der Ejakulation auf Oralverkehr bspw. über.  &quot;
##  [3] &quot;Kondome zur Verhütung und Pille gegen Menstruationsbeschwerden&quot;                                                                                                                                                                                                                                                                                                                                                           
##  [4] &quot;Wenn ich derzeit Sex habe, dann nur mit Männern, mit denen ich nicht in einer Beziehung bin. Da fehlt dann das Vertrauen und ich möchte nur ohne Kondom mit jemandem schlafen, wenn ich diesen Mann auch liebe (was bisher nie der Fall war).&quot;                                                                                                                                                                            
##  [5] &quot;Wir wollen von Kondum zum Diaphragma wechseln, aber müssen noch etwas mit der Gynäkologin abklären. Außerdem ist das Spermozid vom Diaphragma nur 3 Monate haltbar, eine neue Packung anzubrechen muss sich in einer Fernbeziehung \&quot;lohnen\&quot; &quot;                                                                                                                                                                           
##  [6] &quot;Ich nehme zurzeit Johanniskraut ein, durch das die Wirkung der Pille beeinflusst wird.&quot;                                                                                                                                                                                                                                                                                                                                   
##  [7] &quot;Ich nehme Medikamente, die einem ungeborenen Kind während der Schwangerschaft schaden könnten.&quot;                                                                                                                                                                                                                                                                                                                           
##  [8] &quot;Früher immer nur die Pille genommen. Aktuell \&quot;Pillen-Pause\&quot; eingelegt (seit Februar) und seit dem vor allem Kondome verwendet und den Kalender zur Orientierung wann ich/wir noch mehr aufpassen müssen.&quot;                                                                                                                                                                                                               
##  [9] &quot;bei Schmierblutungen zusätzlich Kondom, aus hygienischen Gründen&quot;                                                                                                                                                                                                                                                                                                                                                         
## [10] &quot;Nur bei möglichem Anzeichen (Verspätete Periode; bisher nur zweimal)&quot;                                                                                                                                                                                                                                                                                                                                                     
## [11] &quot;Pille zur Verhütung und Kondom da es \&quot;sauberer\&quot; ist &quot;                                                                                                                                                                                                                                                                                                                                                                   
## [12] &quot;ohne Kondom umständlich wegen des Spermas&quot;                                                                                                                                                                                                                                                                                                                                                                                
## [13] &quot;ZT angenehmer&quot;                                                                                                                                                                                                                                                                                                                                                                                                            
## [14] &quot;wir greifen auf das Kondom zurück, wenn wir nicht sicher sind, dass die Pille wirkt (z.B. Zeitumstellung bei Fernreisen, Einnahme von Medikamenten etc.) &quot;                                                                                                                                                                                                                                                                
## [15] &quot;Seit der Geburt meiner Tochter vertrage ich Orale Kontrazeptiva nicht mehr, bzw. habe keine Lust auf deren Nebenwirkungen. Derzeit denke ich über Sterilisation nach.&quot;                                                                                                                                                                                                                                                    
## [16] &quot;Kondom als Schutz vor Austrocknung bei mehrmaligen Sex am Tag&quot;                                                                                                                                                                                                                                                                                                                                                            
## [17] &quot;Pille immer, Kondom nur manchmal &quot;                                                                                                                                                                                                                                                                                                                                                                                        
## [18] &quot;Kondom standard, ab und zu KI wenn nicht fruchtbar und wir Lust auf Sex ohne Kondom haben&quot;                                                                                                                                                                                                                                                                                                                                
## [19] &quot;Nehme momentan 3 Monate lang ein Antibiotikum wegen einer Augenerkrankung, daher verhüten wir mit Pille und Kondom. Sonst nur mit der Pille. &quot;                                                                                                                                                                                                                                                                            
## [20] &quot;Je nach Phase des Zyklus&quot;                                                                                                                                                                                                                                                                                                                                                                                                 
## [21] &quot;ich benutze immer ein kondom,manchmal ist es für meinen losen freund jedoch nichtso aufregend und dann lassen wir es weg&quot;                                                                                                                                                                                                                                                                                                 
## [22] &quot;Aufgrund von chronischer Migräne phasenweise häufiges Erbrechen und damit mögliche Unwirksamkeit der Pille&quot;                                                                                                                                                                                                                                                                                                               
## [23] &quot;Pille gegen Hypermenorrhoe (mit Pausen zwischendrin), Kondom zur Verhütung&quot;                                                                                                                                                                                                                                                                                                                                               
## [24] &quot;Einfach je nach Laune\n&quot;                                                                                                                                                                                                                                                                                                                                                                                                  
## [25] &quot;falls ich Magen-Darm-Probleme habe, verwenden wir zu der Pille noch Kondome&quot;</code></pre>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb591-1"><a href="#cb591-1"></a>s1_demo =<span class="st"> </span>s1_demo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(</span>
<span id="cb591-2"><a href="#cb591-2"></a>  <span class="dt">contraception_calendar_abstinence =</span> stringr<span class="op">::</span><span class="kw">str_replace</span>(contraception_calendar_abstinence, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;abstinence&quot;</span>),</span>
<span id="cb591-3"><a href="#cb591-3"></a>  <span class="dt">contraception_calendar_abstinence =</span> stringr<span class="op">::</span><span class="kw">str_replace</span>(contraception_calendar_abstinence, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;no_penetration&quot;</span>),</span>
<span id="cb591-4"><a href="#cb591-4"></a>  <span class="dt">contraception_calendar_abstinence =</span> stringr<span class="op">::</span><span class="kw">str_replace</span>(contraception_calendar_abstinence, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;less_sex&quot;</span>),</span>
<span id="cb591-5"><a href="#cb591-5"></a>  <span class="dt">contraception_calendar_abstinence =</span> stringr<span class="op">::</span><span class="kw">str_replace</span>(contraception_calendar_abstinence, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;other_method&quot;</span>)</span>
<span id="cb591-6"><a href="#cb591-6"></a>)</span></code></pre></div>
<pre><code>## mutate: changed 140 values (8%) of &#39;contraception_calendar_abstinence&#39; (0 new NA)</code></pre>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="#cb593-1"></a>choices &lt;-<span class="st"> </span>rio<span class="op">::</span><span class="kw">import</span>(<span class="st">&quot;https://docs.google.com/spreadsheets/d/1tLQDVyYUAXLBkblTT8BXow_rcg5G6xK9Vi3xTGieN20/edit#gid=1116762580&quot;</span>, <span class="dt">which =</span> <span class="dv">2</span>)</span>
<span id="cb593-2"><a href="#cb593-2"></a>pills &lt;-<span class="st"> </span>choices <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb593-3"><a href="#cb593-3"></a><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">182</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb593-4"><a href="#cb593-4"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(name), name <span class="op">!=</span><span class="st"> &quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb593-5"><a href="#cb593-5"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb593-6"><a href="#cb593-6"></a>    <span class="dt">list_name =</span> <span class="kw">na_if</span>(list_name, <span class="st">&quot;&quot;</span>),</span>
<span id="cb593-7"><a href="#cb593-7"></a>    <span class="dt">list_name =</span> zoo<span class="op">::</span><span class="kw">na.locf</span>(list_name)</span>
<span id="cb593-8"><a href="#cb593-8"></a>    ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb593-9"><a href="#cb593-9"></a><span class="st">  </span><span class="kw">filter</span>(list_name <span class="op">==</span><span class="st"> &quot;pills&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb593-10"><a href="#cb593-10"></a><span class="st">  </span><span class="kw">select</span>(<span class="dt">contraception_hormonal_pill =</span> name, </span>
<span id="cb593-11"><a href="#cb593-11"></a>         <span class="dt">contraception_hormonal_pill_estrogen =</span> </span>
<span id="cb593-12"><a href="#cb593-12"></a>           <span class="st">`</span><span class="dt">Östrogenmikrogramm pro Zyklus</span><span class="st">`</span>,</span>
<span id="cb593-13"><a href="#cb593-13"></a>         <span class="dt">contraception_hormonal_pill_gestagen_type =</span> </span>
<span id="cb593-14"><a href="#cb593-14"></a>           <span class="st">`</span><span class="dt">Art des Gestagens</span><span class="st">`</span></span>
<span id="cb593-15"><a href="#cb593-15"></a>         ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb593-16"><a href="#cb593-16"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">contraception_hormonal_pill_estrogen =</span></span>
<span id="cb593-17"><a href="#cb593-17"></a>           <span class="kw">as.numeric</span>(contraception_hormonal_pill_estrogen)<span class="op">/</span><span class="dv">21</span>)</span></code></pre></div>
<pre><code>## slice: removed 30 rows (14%), 182 rows remaining</code></pre>
<pre><code>## filter: removed 14 rows (8%), 168 rows remaining</code></pre>
<pre><code>## mutate: changed 159 values (95%) of &#39;list_name&#39; (0 new NA)</code></pre>
<pre><code>## filter: removed 71 rows (42%), 97 rows remaining</code></pre>
<pre><code>## select: renamed 3 variables (contraception_hormonal_pill, contraception_hormonal_pill_estrogen, contraception_hormonal_pill_gestagen_type) and dropped 9 variables</code></pre>
<pre><code>## mutate: converted &#39;contraception_hormonal_pill_estrogen&#39; from character to double (12 new NA)</code></pre>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="#cb600-1"></a>s1_demo &lt;-<span class="st"> </span>s1_demo <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb600-2"><a href="#cb600-2"></a><span class="st">  </span><span class="kw">left_join</span>(pills, <span class="dt">by =</span> <span class="st">&quot;contraception_hormonal_pill&quot;</span>)</span></code></pre></div>
<pre><code>## left_join: added 2 columns (contraception_hormonal_pill_estrogen, contraception_hormonal_pill_gestagen_type)</code></pre>
<pre><code>##            &gt; rows only in x   1,086</code></pre>
<pre><code>##            &gt; rows only in y  (   28)</code></pre>
<pre><code>##            &gt; matched rows       574</code></pre>
<pre><code>##            &gt;                 =======</code></pre>
<pre><code>##            &gt; rows total       1,660</code></pre>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="#cb607-1"></a>s1_demo &lt;-<span class="st"> </span>s1_demo <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb607-2"><a href="#cb607-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">contraception_hormonal_pill_estrogen =</span> <span class="kw">if_na</span>(contraception_hormonal_pill_estrogen, contraception_pill_estrogen),</span>
<span id="cb607-3"><a href="#cb607-3"></a>         <span class="dt">contraception_hormonal_pill_gestagen_type =</span> <span class="kw">if_na</span>(contraception_hormonal_pill_gestagen_type, contraception_pill_gestagen_type))</span></code></pre></div>
<pre><code>## mutate: changed 79 values (5%) of &#39;contraception_hormonal_pill_estrogen&#39; (79 fewer NA)</code></pre>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="#cb609-1"></a>s1_demo &lt;-<span class="st"> </span>s1_demo <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb609-2"><a href="#cb609-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">estrogen_progestogen =</span> <span class="kw">case_when</span>(</span>
<span id="cb609-3"><a href="#cb609-3"></a>      contraception_hormonal_other <span class="op">==</span><span class="st"> &quot;depo_clinovir&quot;</span> <span class="op">~</span><span class="st"> &quot;progestogen_only&quot;</span>,</span>
<span id="cb609-4"><a href="#cb609-4"></a>    contraception_hormonal_other <span class="op">==</span><span class="st"> &quot;implanon&quot;</span> <span class="op">~</span><span class="st"> &quot;progestogen_only&quot;</span>,</span>
<span id="cb609-5"><a href="#cb609-5"></a>    contraception_hormonal_other_name <span class="op">%contains%</span><span class="st"> &quot;aydess&quot;</span> <span class="op">~</span><span class="st"> &quot;progestogen_only&quot;</span>,</span>
<span id="cb609-6"><a href="#cb609-6"></a>    contraception_hormonal_other_name <span class="op">%contains%</span><span class="st"> &quot;Mirena&quot;</span> <span class="op">~</span><span class="st"> &quot;progestogen_only&quot;</span>,</span>
<span id="cb609-7"><a href="#cb609-7"></a>    contraception_hormonal_other_name <span class="op">%contains%</span><span class="st"> &quot;Lisvy&quot;</span> <span class="op">~</span><span class="st"> &quot;progestogen_and_estrogen&quot;</span>,</span>
<span id="cb609-8"><a href="#cb609-8"></a>    contraception_hormonal_other <span class="op">%contains%</span><span class="st"> &quot;mirena&quot;</span> <span class="op">~</span><span class="st"> &quot;progestogen_only&quot;</span>,</span>
<span id="cb609-9"><a href="#cb609-9"></a>    contraception_hormonal_other <span class="op">!=</span><span class="st"> &quot;mirena&quot;</span> <span class="op">~</span><span class="st"> &quot;progestogen_and_estrogen&quot;</span>,</span>
<span id="cb609-10"><a href="#cb609-10"></a>    contraception_hormonal_pill <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;28_mini&quot;</span>, <span class="st">&quot;cerazette&quot;</span>, </span>
<span id="cb609-11"><a href="#cb609-11"></a>                                       <span class="st">&quot;cyprella&quot;</span>, <span class="st">&quot;damara&quot;</span>,</span>
<span id="cb609-12"><a href="#cb609-12"></a>                                       <span class="st">&quot;desirett&quot;</span>,</span>
<span id="cb609-13"><a href="#cb609-13"></a>                                       <span class="st">&quot;diamilla&quot;</span>, <span class="st">&quot;jubrele&quot;</span>, <span class="st">&quot;microlut&quot;</span>,</span>
<span id="cb609-14"><a href="#cb609-14"></a>                                       <span class="st">&quot;seculact&quot;</span>) <span class="op">~</span><span class="st"> &quot;progestogen_only&quot;</span>,</span>
<span id="cb609-15"><a href="#cb609-15"></a>    contraception_pill_estrogen <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>contraception_pill_gestagen <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> &quot;progestogen_only&quot;</span>,</span>
<span id="cb609-16"><a href="#cb609-16"></a>    contraception_method <span class="op">%contains%</span><span class="st"> &quot;hormonal_pill&quot;</span> <span class="op">~</span><span class="st"> &quot;progestogen_and_estrogen&quot;</span>,</span>
<span id="cb609-17"><a href="#cb609-17"></a>    contraception_method <span class="op">%contains%</span><span class="st"> &quot;hormonal_morning_after_pill&quot;</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA_character_</span>,</span>
<span id="cb609-18"><a href="#cb609-18"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;non_hormonal&quot;</span></span>
<span id="cb609-19"><a href="#cb609-19"></a>  )</span>
<span id="cb609-20"><a href="#cb609-20"></a>  )</span></code></pre></div>
<pre><code>## mutate: new variable &#39;estrogen_progestogen&#39; with 4 unique values and &lt;1% NA</code></pre>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="#cb611-1"></a><span class="kw">crosstabs</span>(<span class="op">~</span><span class="st"> </span>estrogen_progestogen <span class="op">+</span><span class="st"> </span>hormonal_contraception, s1_demo)</span></code></pre></div>
<pre><code>##                           hormonal_contraception
## estrogen_progestogen       FALSE TRUE
##   non_hormonal               982    0
##   progestogen_and_estrogen     0  583
##   progestogen_only             0   87
##   &lt;NA&gt;                         0    8</code></pre>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="#cb613-1"></a><span class="co"># s1_demo %&gt;% drop_na(other_pill_name) %&gt;% select(other_pill_name, contraception_pill_estrogen,</span></span>
<span id="cb613-2"><a href="#cb613-2"></a><span class="co">#                    contraception_pill_gestagen, contraception_pill_gestagen_type) %&gt;% View()</span></span>
<span id="cb613-3"><a href="#cb613-3"></a></span>
<span id="cb613-4"><a href="#cb613-4"></a><span class="co"># s1_demo %&gt;% drop_na(contraception_hormonal_other_name) %&gt;% select(contraception_hormonal_other_name, contraception_other_estrogen,</span></span>
<span id="cb613-5"><a href="#cb613-5"></a>                   <span class="co"># contraception_other_gestagen, contraception_other_gestagen_type) %&gt;% View()</span></span>
<span id="cb613-6"><a href="#cb613-6"></a><span class="kw">sort</span>(<span class="kw">table</span>(s1_demo<span class="op">$</span>estrogen_progestogen))</span></code></pre></div>
<pre><code>## 
##         progestogen_only progestogen_and_estrogen             non_hormonal 
##                       87                      583                      982</code></pre>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="#cb615-1"></a><span class="kw">sort</span>(<span class="kw">table</span>(s1_demo<span class="op">$</span>contraception_calendar_abstinence))</span></code></pre></div>
<pre><code>## 
##             abstinence, no_penetration               abstinence, other_method 
##                                      1                                      1 
## no_penetration, less_sex, other_method                             abstinence 
##                                      2                                      3 
##               no_penetration, less_sex                 less_sex, other_method 
##                                      5                                      8 
##           no_penetration, other_method                               less_sex 
##                                      8                                      9 
##                         no_penetration                           other_method 
##                                      9                                     94</code></pre>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="#cb617-1"></a><span class="kw">sort</span>(<span class="kw">table</span>(s1_demo<span class="op">$</span>contraception_hormonal_other))</span></code></pre></div>
<pre><code>## 
##          evra       circlet depo_clinovir      implanon        mirena         other      nuvaring 
##             1             3             3             4            22            26            38</code></pre>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="#cb619-1"></a><span class="kw">sort</span>(<span class="kw">table</span>(s1_demo<span class="op">$</span>contraception_hormonal_other_name))</span></code></pre></div>
<pre><code>## 
##                        Jaydess  Jaydess (3 Jahre Hormonspirale)    Jaydess (Mini-Hormonspirale) 
##                               1                               1                               1 
##        Lisvy Verhütungspflaster                          Mirena                 Spirale jaydess 
##                               1                               1                               1 
##                         Yaydess                 Jaydess Spirale           Jaydess Hormonspirale 
##                               1                               2                               3 
##                         Jaydess 
##                              14</code></pre>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="#cb621-1"></a><span class="kw">table</span>(s1_demo<span class="op">$</span>contraception_app)</span></code></pre></div>
<pre><code>## 
##    0    1 
## 1213  411</code></pre>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="#cb623-1"></a>common_apps =<span class="st"> </span><span class="kw">table</span>(<span class="kw">tolower</span>(stringr<span class="op">::</span><span class="kw">str_trim</span>(s1_demo<span class="op">$</span>contraception_app_name)))</span>
<span id="cb623-2"><a href="#cb623-2"></a><span class="kw">sort</span>(common_apps[common_apps <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>])</span></code></pre></div>
<pre><code>## 
##             cycles        my calendar     p tracker lite       pillen alarm        pillenalarm 
##                  4                  4                  4                  4                  4 
##             mypill      pill reminder       pillreminder    period calendar                flo 
##                  5                  5                  5                  6                  7 
##             mydays     period tracker       denk an mich               life              mynfp 
##                  7                  9                 10                 10                 10 
## lady pill reminder          p tracker            ovuview           womanlog      mein kalender 
##                 11                 13                 21                 24                 52 
##               clue 
##                 64</code></pre>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="#cb625-1"></a><span class="kw">table</span>(s1_demo<span class="op">$</span>pregnant_trying)</span></code></pre></div>
<pre><code>## 
##    1    2    3    4    5    6 
## 1385  103   52   30    7   24</code></pre>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="#cb627-1"></a><span class="kw">sort</span>(<span class="kw">table</span>(s1_demo<span class="op">$</span>wish_for_children))</span></code></pre></div>
<pre><code>## 
##           partner_doesnt_want                  rather_adopt         not_with_this_partner 
##                            28                            38                            58 
##           not_actively_trying             dont_have_partner      cant_imagine_having_kids 
##                            76                           144                           175 
## not_in_current_life_situation 
##                          1021</code></pre>
</div>
</div>
<div id="singles-vs-couples" class="section level2">
<h2>Singles vs couples</h2>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="#cb629-1"></a>s1_demo =<span class="st"> </span>s1_demo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">hetero_relationship =</span> <span class="kw">as.numeric</span>(hetero_relationship))</span></code></pre></div>
<pre><code>## mutate: converted &#39;hetero_relationship&#39; from character to double (0 new NA)</code></pre>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="#cb631-1"></a>s1_demo <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb631-2"><a href="#cb631-2"></a><span class="st">    </span><span class="kw">count</span>(hetero_relationship)</span></code></pre></div>
<pre><code>## count: now 3 rows and 2 columns, ungrouped</code></pre>
<pre><code>## # A tibble: 3 x 2
##   hetero_relationship     n
##                 &lt;dbl&gt; &lt;int&gt;
## 1                   0   533
## 2                   1  1091
## 3                  NA    36</code></pre>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="#cb634-1"></a>s1_demo <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb634-2"><a href="#cb634-2"></a><span class="st">    </span><span class="kw">left_join</span>(s1_filter <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, gets_paid)) <span class="op">%&gt;%</span></span>
<span id="cb634-3"><a href="#cb634-3"></a><span class="st">    </span><span class="kw">count</span>(gets_paid, hetero_relationship) <span class="op">%&gt;%</span></span>
<span id="cb634-4"><a href="#cb634-4"></a><span class="st">    </span><span class="kw">na.omit</span>()</span></code></pre></div>
<pre><code>## select: dropped 6 variables (created, modified, ended, expired, agree_to_conditions, …)</code></pre>
<pre><code>## Joining, by = &quot;session&quot;</code></pre>
<pre><code>## left_join: added one column (gets_paid)</code></pre>
<pre><code>##            &gt; rows only in x      53</code></pre>
<pre><code>##            &gt; rows only in y  (    0)</code></pre>
<pre><code>##            &gt; matched rows     1,607</code></pre>
<pre><code>##            &gt;                 =======</code></pre>
<pre><code>##            &gt; rows total       1,660</code></pre>
<pre><code>## count: now 7 rows and 3 columns, ungrouped</code></pre>
<pre><code>## # A tibble: 4 x 3
##   gets_paid hetero_relationship     n
##   &lt;chr&gt;                   &lt;dbl&gt; &lt;int&gt;
## 1 0                           0   302
## 2 0                           1   748
## 3 1                           0   223
## 4 1                           1   334</code></pre>
<div id="soi" class="section level3">
<h3>SOI</h3>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="#cb645-1"></a>old_labels &lt;-<span class="st"> </span>s2_initial<span class="op">$</span>soi_r_desire_<span class="dv">7</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">val_labels</span>()</span>
<span id="cb645-2"><a href="#cb645-2"></a>new_labels &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span></span>
<span id="cb645-3"><a href="#cb645-3"></a><span class="kw">names</span>(new_labels) &lt;-<span class="st"> </span><span class="kw">names</span>(old_labels)</span>
<span id="cb645-4"><a href="#cb645-4"></a>s2_initial &lt;-<span class="st"> </span>s2_initial <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(soi_r_desire_<span class="dv">7</span>, soi_r_desire_<span class="dv">9</span>, soi_r_desire_<span class="dv">8</span>), <span class="kw">funs</span>(</span>
<span id="cb645-5"><a href="#cb645-5"></a>  <span class="kw">recode</span>(., <span class="st">&quot;never&quot;</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;rarely&quot;</span> =<span class="st"> </span><span class="dv">2</span>, <span class="st">&quot;monthly&quot;</span> =<span class="st"> </span><span class="dv">3</span>, <span class="st">&quot;weekly&quot;</span>  =<span class="st"> </span><span class="dv">4</span>, <span class="st">&quot;daily&quot;</span> =<span class="st"> </span><span class="dv">5</span>)</span>
<span id="cb645-6"><a href="#cb645-6"></a>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb645-7"><a href="#cb645-7"></a><span class="st">  </span>labelled<span class="op">::</span><span class="kw">set_value_labels</span>(<span class="dt">soi_r_desire_7 =</span> new_labels, <span class="dt">soi_r_desire_9 =</span> new_labels, <span class="dt">soi_r_desire_8 =</span> new_labels)</span></code></pre></div>
<pre><code>## mutate_at: converted &#39;soi_r_desire_9&#39; from character to double (0 new NA)</code></pre>
<pre><code>##            converted &#39;soi_r_desire_7&#39; from character to double (0 new NA)</code></pre>
<pre><code>##            converted &#39;soi_r_desire_8&#39; from character to double (0 new NA)</code></pre>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="#cb649-1"></a>s2_initial<span class="op">$</span>soi_r_desire =<span class="st"> </span>s2_initial <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(soi_r_desire_<span class="dv">7</span>, soi_r_desire_<span class="dv">9</span>, soi_r_desire_<span class="dv">8</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">aggregate_and_document_scale</span>(<span class="dt">fun =</span> robust_rowmeans)</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## select: dropped 178 variables (session, created, modified, ended, expired, …)</code></pre>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="#cb652-1"></a><span class="kw">var_label</span>(s2_initial<span class="op">$</span>soi_r_desire_<span class="dv">8</span>) &lt;-<span class="st"> &quot;Sociosexual inventory-revised: Desire Subscale&quot;</span></span>
<span id="cb652-2"><a href="#cb652-2"></a></span>
<span id="cb652-3"><a href="#cb652-3"></a>cutpoints &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;0&quot;</span> =<span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb652-4"><a href="#cb652-4"></a>               <span class="st">&quot;1&quot;</span> =<span class="st"> </span><span class="dv">2</span>,</span>
<span id="cb652-5"><a href="#cb652-5"></a>               <span class="st">&quot;2-3&quot;</span> =<span class="st"> </span><span class="dv">3</span>,</span>
<span id="cb652-6"><a href="#cb652-6"></a>               <span class="st">&quot;4-7&quot;</span> =<span class="st"> </span><span class="dv">4</span>,</span>
<span id="cb652-7"><a href="#cb652-7"></a>               <span class="st">&quot;8 or more&quot;</span> =<span class="st"> </span><span class="dv">5</span>)</span>
<span id="cb652-8"><a href="#cb652-8"></a>s2_initial &lt;-<span class="st"> </span>s2_initial <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(soi_r_behavior_<span class="dv">1</span>, soi_r_behavior_<span class="dv">2</span>, soi_r_behavior_<span class="dv">3</span>),</span>
<span id="cb652-9"><a href="#cb652-9"></a>                                       <span class="kw">funs</span>(<span class="dt">discrete =</span> <span class="kw">case_when</span>(</span>
<span id="cb652-10"><a href="#cb652-10"></a>                                         . <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb652-11"><a href="#cb652-11"></a>                                         . <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="dv">2</span>,</span>
<span id="cb652-12"><a href="#cb652-12"></a>                                         . <span class="op">%in%</span><span class="st"> </span><span class="dv">2</span><span class="op">:</span><span class="dv">3</span> <span class="op">~</span><span class="st"> </span><span class="dv">3</span>,</span>
<span id="cb652-13"><a href="#cb652-13"></a>                                         . <span class="op">%in%</span><span class="st"> </span><span class="dv">4</span><span class="op">:</span><span class="dv">7</span> <span class="op">~</span><span class="st"> </span><span class="dv">4</span>,</span>
<span id="cb652-14"><a href="#cb652-14"></a>                                         . <span class="op">%in%</span><span class="st"> </span><span class="dv">8</span><span class="op">:</span><span class="fl">1e4</span> <span class="op">~</span><span class="st"> </span><span class="dv">5</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb652-15"><a href="#cb652-15"></a><span class="st">  </span>labelled<span class="op">::</span><span class="kw">set_value_labels</span>(<span class="dt">soi_r_behavior_1_discrete =</span> cutpoints, <span class="dt">soi_r_behavior_2_discrete =</span> cutpoints, <span class="dt">soi_r_behavior_3_discrete =</span> cutpoints)</span></code></pre></div>
<pre><code>## mutate_at: new variable &#39;soi_r_behavior_1_discrete&#39; with 6 unique values and 7% NA</code></pre>
<pre><code>##            new variable &#39;soi_r_behavior_2_discrete&#39; with 6 unique values and 7% NA</code></pre>
<pre><code>##            new variable &#39;soi_r_behavior_3_discrete&#39; with 6 unique values and 7% NA</code></pre>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb656-1"><a href="#cb656-1"></a><span class="kw">var_label</span>(s2_initial<span class="op">$</span>soi_r_behavior_<span class="dv">1</span>_discrete) &lt;-<span class="st"> </span><span class="kw">var_label</span>(s2_initial<span class="op">$</span>soi_r_behavior_<span class="dv">1</span>)</span>
<span id="cb656-2"><a href="#cb656-2"></a><span class="kw">var_label</span>(s2_initial<span class="op">$</span>soi_r_behavior_<span class="dv">2</span>_discrete) &lt;-<span class="st"> </span><span class="kw">var_label</span>(s2_initial<span class="op">$</span>soi_r_behavior_<span class="dv">2</span>)</span>
<span id="cb656-3"><a href="#cb656-3"></a><span class="kw">var_label</span>(s2_initial<span class="op">$</span>soi_r_behavior_<span class="dv">3</span>_discrete) &lt;-<span class="st"> </span><span class="kw">var_label</span>(s2_initial<span class="op">$</span>soi_r_behavior_<span class="dv">3</span>)</span>
<span id="cb656-4"><a href="#cb656-4"></a></span>
<span id="cb656-5"><a href="#cb656-5"></a>s2_initial<span class="op">$</span>soi_r_behavior =<span class="st"> </span>s2_initial <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(soi_r_behavior_<span class="dv">1</span>_discrete, soi_r_behavior_<span class="dv">2</span>_discrete, soi_r_behavior_<span class="dv">3</span>_discrete) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">aggregate_and_document_scale</span>(<span class="dt">fun =</span> robust_rowmeans)</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## select: dropped 182 variables (session, created, modified, ended, expired, …)</code></pre>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="#cb659-1"></a><span class="kw">var_label</span>(s2_initial<span class="op">$</span>soi_r_behavior) &lt;-<span class="st"> &quot;Sociosexual inventory-revised: Behaviour Subscale&quot;</span></span>
<span id="cb659-2"><a href="#cb659-2"></a></span>
<span id="cb659-3"><a href="#cb659-3"></a></span>
<span id="cb659-4"><a href="#cb659-4"></a>s2_initial<span class="op">$</span>soi_r =<span class="st"> </span>s2_initial <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(soi_r_attitude_6r, soi_r_attitude_<span class="dv">4</span>, soi_r_attitude_<span class="dv">5</span>, soi_r_desire_<span class="dv">7</span>, soi_r_desire_<span class="dv">9</span>, soi_r_desire_<span class="dv">8</span>, soi_r_behavior_<span class="dv">1</span>_discrete, soi_r_behavior_<span class="dv">2</span>_discrete, soi_r_behavior_<span class="dv">3</span>_discrete) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">aggregate_and_document_scale</span>(<span class="dt">fun =</span> robust_rowmeans)</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## select: dropped 177 variables (session, created, modified, ended, expired, …)</code></pre>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb662-1"><a href="#cb662-1"></a><span class="kw">var_label</span>(s2_initial<span class="op">$</span>soi_r) &lt;-<span class="st"> &quot;Sociosexual inventory-revised&quot;</span></span></code></pre></div>
</div>
<div id="partner-attractiveness-items" class="section level3">
<h3>Partner attractiveness items</h3>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb663-1"><a href="#cb663-1"></a>s2_initial &lt;-<span class="st"> </span>s2_initial <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb663-2"><a href="#cb663-2"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">partner_sexiness =</span> attractiveness_sexy,</span>
<span id="cb663-3"><a href="#cb663-3"></a>         <span class="dt">partner_attractiveness_body =</span> attractiveness_body,</span>
<span id="cb663-4"><a href="#cb663-4"></a>         <span class="dt">partner_attractiveness_face =</span> attractiveness_face,</span>
<span id="cb663-5"><a href="#cb663-5"></a>        <span class="dt">partner_attractiveness_shortterm =</span> attractiveness_stp,</span>
<span id="cb663-6"><a href="#cb663-6"></a>        <span class="dt">partner_attractiveness_longterm =</span> attractiveness_ltp,</span>
<span id="cb663-7"><a href="#cb663-7"></a>        <span class="dt">partner_attractiveness_trust =</span> attractiveness_trustworthiness</span>
<span id="cb663-8"><a href="#cb663-8"></a>        ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb663-9"><a href="#cb663-9"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb663-10"><a href="#cb663-10"></a>    <span class="dt">spms_rel =</span> spms_self <span class="op">-</span><span class="st"> </span>spms_partner</span>
<span id="cb663-11"><a href="#cb663-11"></a>  )</span></code></pre></div>
<pre><code>## rename: renamed 6 variables (partner_attractiveness_longterm, partner_attractiveness_shortterm, partner_attractiveness_face, partner_attractiveness_body, partner_attractiveness_trust, …)</code></pre>
<pre><code>## mutate: new variable &#39;spms_rel&#39; with 62 unique values and 38% NA</code></pre>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb666-1"><a href="#cb666-1"></a>s2_initial<span class="op">$</span>partner_attractiveness_sexual &lt;-<span class="st"> </span>s2_initial <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(partner_sexiness, partner_attractiveness_shortterm, partner_attractiveness_face, partner_attractiveness_body) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">aggregate_and_document_scale</span>(<span class="dt">fun =</span> robust_rowmeans)</span></code></pre></div>
<pre><code>## select: dropped 184 variables (session, created, modified, ended, expired, …)</code></pre>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="#cb668-1"></a><span class="kw">var_label</span>(s2_initial<span class="op">$</span>partner_attractiveness_sexual) &lt;-<span class="st"> &quot;Partner&#39;s sexual attractiveness&quot;</span></span></code></pre></div>
</div>
<div id="relationship-satisfaction" class="section level3">
<h3>Relationship satisfaction</h3>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb669-1"><a href="#cb669-1"></a>s2_initial<span class="op">$</span>relationship_conflict_R =<span class="st"> </span><span class="dv">6</span> <span class="op">-</span><span class="st"> </span>s2_initial<span class="op">$</span>relationship_conflict</span>
<span id="cb669-2"><a href="#cb669-2"></a>s2_initial<span class="op">$</span>relationship_problems_R =<span class="st"> </span><span class="dv">6</span> <span class="op">-</span><span class="st"> </span>s2_initial<span class="op">$</span>relationship_problems</span>
<span id="cb669-3"><a href="#cb669-3"></a>psych<span class="op">::</span><span class="kw">alpha</span>(s2_initial <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(relationship_problems_R, relationship_satisfaction_overall, relationship_conflict_R, relationship_satisfaction_<span class="dv">2</span>, relationship_satisfaction_<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.frame</span>())</span></code></pre></div>
<pre><code>## select: dropped 186 variables (session, created, modified, ended, expired, …)</code></pre>
<pre><code>## 
## Reliability analysis   
## Call: psych::alpha(x = s2_initial %&gt;% select(relationship_problems_R, 
##     relationship_satisfaction_overall, relationship_conflict_R, 
##     relationship_satisfaction_2, relationship_satisfaction_3) %&gt;% 
##     data.frame())
## 
##   raw_alpha std.alpha G6(smc) average_r S/N    ase mean   sd median_r
##       0.87      0.88    0.88      0.59 7.3 0.0052    4 0.87     0.64
## 
##  lower alpha upper     95% confidence boundaries
## 0.86 0.87 0.88 
## 
##  Reliability if an item is dropped:
##                                   raw_alpha std.alpha G6(smc) average_r S/N alpha se  var.r med.r
## relationship_problems_R                0.83      0.84    0.83      0.57 5.4   0.0073 0.0302  0.57
## relationship_satisfaction_overall      0.83      0.83    0.82      0.56 5.0   0.0072 0.0150  0.58
## relationship_conflict_R                0.88      0.89    0.87      0.67 8.0   0.0050 0.0075  0.67
## relationship_satisfaction_2            0.86      0.86    0.86      0.61 6.2   0.0062 0.0197  0.64
## relationship_satisfaction_3            0.83      0.84    0.82      0.56 5.1   0.0071 0.0169  0.60
## 
##  Item statistics 
##                                     n raw.r std.r r.cor r.drop mean   sd
## relationship_problems_R           940  0.86  0.85  0.81   0.76  3.9 1.16
## relationship_satisfaction_overall 940  0.87  0.88  0.86   0.79  4.3 0.99
## relationship_conflict_R           940  0.73  0.71  0.61   0.56  3.7 1.15
## relationship_satisfaction_2       940  0.79  0.80  0.73   0.67  4.0 1.05
## relationship_satisfaction_3       940  0.85  0.87  0.84   0.77  4.2 0.95
## 
## Non missing response frequency for each item
##                                      1    2    3    4    5 miss
## relationship_problems_R           0.06 0.08 0.17 0.33 0.36 0.38
## relationship_satisfaction_overall 0.02 0.04 0.11 0.25 0.58 0.38
## relationship_conflict_R           0.05 0.12 0.21 0.34 0.29 0.38
## relationship_satisfaction_2       0.03 0.08 0.15 0.38 0.36 0.38
## relationship_satisfaction_3       0.01 0.05 0.12 0.31 0.50 0.38</code></pre>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb672-1"><a href="#cb672-1"></a>s2_initial<span class="op">$</span>relationship_satisfaction =<span class="st"> </span>s2_initial <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(relationship_problems_R, relationship_satisfaction_overall, relationship_conflict_R, relationship_satisfaction_<span class="dv">2</span>, relationship_satisfaction_<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">aggregate_and_document_scale</span>(<span class="dt">fun =</span> robust_rowmeans)</span></code></pre></div>
<pre><code>## ungroup: no grouping variables
## select: dropped 186 variables (session, created, modified, ended, expired, …)</code></pre>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb674-1"><a href="#cb674-1"></a><span class="kw">var_label</span>(s2_initial<span class="op">$</span>relationship_satisfaction) &lt;-<span class="st"> &quot;Relationship satisfaction&quot;</span></span></code></pre></div>
</div>
</div>
<div id="living-situation" class="section level2">
<h2>Living situation</h2>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="#cb675-1"></a>s1_demo &lt;-<span class="st"> </span>s1_demo <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb675-2"><a href="#cb675-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb675-3"><a href="#cb675-3"></a>    <span class="dt">living_situation =</span> <span class="kw">case_when</span>(</span>
<span id="cb675-4"><a href="#cb675-4"></a>      abode_alone <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &quot;alone&quot;</span>,</span>
<span id="cb675-5"><a href="#cb675-5"></a>      abode_with_partner <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &quot;with partner&quot;</span>,</span>
<span id="cb675-6"><a href="#cb675-6"></a>      abode_flat_share <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;flatshare&quot;</span>,</span>
<span id="cb675-7"><a href="#cb675-7"></a>      abode_flat_share <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> &quot;with family&quot;</span>,</span>
<span id="cb675-8"><a href="#cb675-8"></a>      nr_children <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &quot;with children&quot;</span>,</span>
<span id="cb675-9"><a href="#cb675-9"></a>      hetero_relationship <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> &quot;alone&quot;</span>,</span>
<span id="cb675-10"><a href="#cb675-10"></a>      abode_flat_share <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &quot;other&quot;</span>,</span>
<span id="cb675-11"><a href="#cb675-11"></a>      <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;missing&quot;</span></span>
<span id="cb675-12"><a href="#cb675-12"></a>    )</span>
<span id="cb675-13"><a href="#cb675-13"></a>  )</span></code></pre></div>
<pre><code>## mutate: new variable &#39;living_situation&#39; with 7 unique values and 0% NA</code></pre>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="#cb677-1"></a><span class="kw">table</span>(s1_demo<span class="op">$</span>living_situation)</span></code></pre></div>
<pre><code>## 
##         alone     flatshare       missing         other with children   with family  with partner 
##           393           578            21            13            14           133           508</code></pre>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="#cb679-1"></a><span class="co"># s1_demo %&gt;% filter(living_situation == &quot;other&quot;) %&gt;% select(starts_with(&quot;abode&quot;)) %&gt;% View</span></span></code></pre></div>
</div>
<div id="merge-surveys" class="section level2">
<h2>Merge surveys</h2>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb680-1"><a href="#cb680-1"></a>pre_surveys =<span class="st"> </span>s1_demo <span class="op">%&gt;%</span></span>
<span id="cb680-2"><a href="#cb680-2"></a><span class="st">  </span><span class="kw">left_join</span>(s2_initial, <span class="dt">by =</span> <span class="st">&quot;session&quot;</span>, <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;_demo&quot;</span>, <span class="st">&quot;_initial&quot;</span>)) <span class="co"># merge demo and personality stuff</span></span></code></pre></div>
<pre><code>## left_join: added 196 columns (created_demo, modified_demo, ended_demo, expired_demo, free_not_covered_demo, …)</code></pre>
<pre><code>##            &gt; rows only in x     148</code></pre>
<pre><code>##            &gt; rows only in y  (    0)</code></pre>
<pre><code>##            &gt; matched rows     1,512</code></pre>
<pre><code>##            &gt;                 =======</code></pre>
<pre><code>##            &gt; rows total       1,660</code></pre>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb687-1"><a href="#cb687-1"></a>all_surveys =<span class="st"> </span>pre_surveys <span class="op">%&gt;%</span></span>
<span id="cb687-2"><a href="#cb687-2"></a><span class="st">  </span><span class="kw">left_join</span>(s4_followup, <span class="dt">by =</span> <span class="st">&quot;session&quot;</span>) <span class="co"># add follow up survey</span></span></code></pre></div>
<pre><code>## left_join: added 44 columns (created, modified, ended, expired, hypothesis_guess, …)</code></pre>
<pre><code>##            &gt; rows only in x     489</code></pre>
<pre><code>##            &gt; rows only in y  (    0)</code></pre>
<pre><code>##            &gt; matched rows     1,171</code></pre>
<pre><code>##            &gt;                 =======</code></pre>
<pre><code>##            &gt; rows total       1,660</code></pre>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="#cb694-1"></a><span class="kw">stopifnot</span>(<span class="op">!</span><span class="kw">any</span>(<span class="kw">duplicated</span>(all_surveys<span class="op">$</span>session)))</span></code></pre></div>
</div>
<div id="code-open-answer" class="section level2">
<h2>Code open answer</h2>
<div id="guessed-hypothesis" class="section level3">
<h3>Guessed hypothesis?</h3>
<div class="sourceCode" id="cb695"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb695-1"><a href="#cb695-1"></a>s4_followup <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(hypothesis_guess) <span class="op">&amp;</span><span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_trim</span>(hypothesis_guess) <span class="op">!=</span><span class="st"> &quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, hypothesis_guess) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb695-2"><a href="#cb695-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb695-3"><a href="#cb695-3"></a>    <span class="co"># if they mention hormones or menstruation or PMS, but not the cycle, fertile window, ovulation</span></span>
<span id="cb695-4"><a href="#cb695-4"></a>        <span class="dt">hypothesis_hormones_mentioned =</span> <span class="ot">NA_real_</span>,</span>
<span id="cb695-5"><a href="#cb695-5"></a>    <span class="co"># if they mention cycle/fertile window, but only generally or in combination with generics like &quot;mood&quot;</span></span>
<span id="cb695-6"><a href="#cb695-6"></a>        <span class="dt">hypothesis_cycle_mentioned =</span> <span class="dv">0</span>,</span>
<span id="cb695-7"><a href="#cb695-7"></a>    <span class="co"># if they mention the cycle and sex/libido/attractiveness</span></span>
<span id="cb695-8"><a href="#cb695-8"></a>         <span class="dt">hypothesis_cycle_sex =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb695-9"><a href="#cb695-9"></a><span class="st">  </span><span class="kw">data.frame</span>() -&gt;<span class="st"> </span>hypothesis_guessed</span></code></pre></div>
<pre><code>## filter: removed 633 rows (54%), 538 rows remaining</code></pre>
<pre><code>## select: dropped 43 variables (created, modified, ended, expired, wont_leak, …)</code></pre>
<pre><code>## mutate: new variable &#39;hypothesis_hormones_mentioned&#39; with one unique value and 100% NA</code></pre>
<pre><code>##         new variable &#39;hypothesis_cycle_mentioned&#39; with one unique value and 0% NA</code></pre>
<pre><code>##         new variable &#39;hypothesis_cycle_sex&#39; with one unique value and 0% NA</code></pre>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb701-1"><a href="#cb701-1"></a>writexl<span class="op">::</span><span class="kw">write_xlsx</span>(hypothesis_guessed, <span class="st">&quot;codings/hypothesis_guessed.xlsx&quot;</span>)</span>
<span id="cb701-2"><a href="#cb701-2"></a>hypothesis_guessed =<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_xlsx</span>(<span class="st">&quot;codings/hypothesis_guessed_coded.xlsx&quot;</span>,<span class="dv">1</span>)</span>
<span id="cb701-3"><a href="#cb701-3"></a></span>
<span id="cb701-4"><a href="#cb701-4"></a>all_surveys =<span class="st"> </span>all_surveys <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(hypothesis_guessed <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>hypothesis_guess), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>))</span></code></pre></div>
<pre><code>## select: dropped one variable (hypothesis_guess)</code></pre>
<pre><code>## left_join: added 3 columns (hypothesis_hormones_mentioned, hypothesis_cycle_mentioned, hypothesis_cycle_sex)</code></pre>
<pre><code>##            &gt; rows only in x   1,122</code></pre>
<pre><code>##            &gt; rows only in y  (    2)</code></pre>
<pre><code>##            &gt; matched rows       538</code></pre>
<pre><code>##            &gt;                 =======</code></pre>
<pre><code>##            &gt; rows total       1,660</code></pre>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="#cb709-1"></a>all_surveys<span class="op">$</span>hypothesis_guess_topic &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb709-2"><a href="#cb709-2"></a>all_surveys &lt;-<span class="st"> </span>all_surveys <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb709-3"><a href="#cb709-3"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb709-4"><a href="#cb709-4"></a>  <span class="dt">hypothesis_guess_topic =</span> <span class="kw">replace</span>(hypothesis_guess_topic, hypothesis_hormones_mentioned <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb709-5"><a href="#cb709-5"></a>  <span class="dt">hypothesis_guess_topic =</span> <span class="kw">replace</span>(hypothesis_guess_topic, hypothesis_cycle_mentioned <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb709-6"><a href="#cb709-6"></a>  <span class="dt">hypothesis_guess_topic =</span> <span class="kw">replace</span>(hypothesis_guess_topic, hypothesis_cycle_sex <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb709-7"><a href="#cb709-7"></a>  <span class="dt">hypothesis_guess_topic =</span> <span class="kw">factor</span>(hypothesis_guess_topic, <span class="dt">level=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&#39;no_guess&#39;</span>,<span class="st">&#39;hormones&#39;</span>, <span class="st">&#39;cycle&#39;</span>, <span class="st">&#39;cycle_sex&#39;</span>))</span>
<span id="cb709-8"><a href="#cb709-8"></a>  )</span></code></pre></div>
<pre><code>## mutate: converted &#39;hypothesis_guess_topic&#39; from double to factor (0 new NA)</code></pre>
</div>
<div id="app-awareness" class="section level3">
<h3>app awareness</h3>
<p>Did they use a menstrual cycle or pill app and was it one that would foster awareness of the menstrual cycle?</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="#cb711-1"></a>awareness &lt;-<span class="st"> </span>rio<span class="op">::</span><span class="kw">import</span>(<span class="st">&quot;codings/awareness_coded.xlsx&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tbl_df</span>()</span>
<span id="cb711-2"><a href="#cb711-2"></a>rio<span class="op">::</span><span class="kw">export</span>(all_surveys <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, contraception_app_name, aware_fertile_reason_unusual, feedback_for_us) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">full_join</span>(awareness <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, cycle_awareness_app, cycle_awareness_other) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb711-3"><a href="#cb711-3"></a><span class="st">    </span><span class="kw">distinct</span>(), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(contraception_app_name <span class="op">!=</span><span class="st"> &quot;&quot;</span> <span class="op">|</span><span class="st"> </span>aware_fertile_reason_unusual <span class="op">!=</span><span class="st"> &quot;&quot;</span>  <span class="op">|</span><span class="st"> </span>feedback_for_us <span class="op">!=</span><span class="st"> &quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, contraception_app_name, aware_fertile_reason_unusual, feedback_for_us, cycle_awareness_app, cycle_awareness_other), <span class="st">&quot;codings/awareness.xlsx&quot;</span>)</span></code></pre></div>
<pre><code>## select: dropped 348 variables (created_demo, modified_demo, ended_demo, expired_demo, info_study, …)</code></pre>
<pre><code>## select: dropped 3 variables (contraception_app_name, aware_fertile_reason_unusual, feedback_for_us)</code></pre>
<pre><code>## distinct: no rows removed</code></pre>
<pre><code>## full_join: added 2 columns (cycle_awareness_app, cycle_awareness_other)</code></pre>
<pre><code>##            &gt; rows only in x   1,089</code></pre>
<pre><code>##            &gt; rows only in y       0</code></pre>
<pre><code>##            &gt; matched rows       571</code></pre>
<pre><code>##            &gt;                 =======</code></pre>
<pre><code>##            &gt; rows total       1,660</code></pre>
<pre><code>## filter: removed 1,089 rows (66%), 571 rows remaining</code></pre>
<pre><code>## select: no changes</code></pre>
<div class="sourceCode" id="cb723"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb723-1"><a href="#cb723-1"></a>all_surveys &lt;-<span class="st"> </span>all_surveys <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(</span>
<span id="cb723-2"><a href="#cb723-2"></a>  awareness <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, cycle_awareness_app, cycle_awareness_other) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb723-3"><a href="#cb723-3"></a><span class="st">    </span><span class="kw">distinct</span>(), <span class="dt">by =</span> <span class="st">&quot;session&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb723-4"><a href="#cb723-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cycle_awareness_app =</span> <span class="kw">recode</span>(cycle_awareness_app,</span>
<span id="cb723-5"><a href="#cb723-5"></a>            <span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> &quot;cycle_phase_aware&quot;</span>,</span>
<span id="cb723-6"><a href="#cb723-6"></a>            <span class="st">`</span><span class="dt">2</span><span class="st">`</span> =<span class="st"> &quot;symptom_diaries&quot;</span>,</span>
<span id="cb723-7"><a href="#cb723-7"></a>            <span class="st">`</span><span class="dt">3</span><span class="st">`</span> =<span class="st"> &quot;unclear&quot;</span>,</span>
<span id="cb723-8"><a href="#cb723-8"></a>            <span class="st">`</span><span class="dt">0</span><span class="st">`</span> =<span class="st"> &quot;reminder&quot;</span>,</span>
<span id="cb723-9"><a href="#cb723-9"></a>            <span class="dt">.missing =</span> <span class="st">&quot;none&quot;</span>))</span></code></pre></div>
<pre><code>## select: dropped 3 variables (contraception_app_name, aware_fertile_reason_unusual, feedback_for_us)</code></pre>
<pre><code>## distinct: no rows removed</code></pre>
<pre><code>## left_join: added 2 columns (cycle_awareness_app, cycle_awareness_other)</code></pre>
<pre><code>##            &gt; rows only in x   1,089</code></pre>
<pre><code>##            &gt; rows only in y  (    0)</code></pre>
<pre><code>##            &gt; matched rows       571</code></pre>
<pre><code>##            &gt;                 =======</code></pre>
<pre><code>##            &gt; rows total       1,660</code></pre>
<pre><code>## mutate: converted &#39;cycle_awareness_app&#39; from double to character (1266 fewer NA)</code></pre>
<div class="sourceCode" id="cb733"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb733-1"><a href="#cb733-1"></a><span class="kw">crosstabs</span>(<span class="op">~</span><span class="st"> </span>cycle_awareness_app, all_surveys)</span></code></pre></div>
<pre><code>## cycle_awareness_app
## cycle_phase_aware              none          reminder   symptom_diaries           unclear              &lt;NA&gt; 
##               320              1267                20                34                18                 1</code></pre>
<div class="sourceCode" id="cb735"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb735-1"><a href="#cb735-1"></a><span class="kw">crosstabs</span>(<span class="op">~</span><span class="st"> </span>cycle_awareness_app <span class="op">+</span><span class="st"> </span>hormonal_contraception, all_surveys)</span></code></pre></div>
<pre><code>##                    hormonal_contraception
## cycle_awareness_app FALSE TRUE
##   cycle_phase_aware   278   42
##   none                689  578
##   reminder              0   20
##   symptom_diaries       0   34
##   unclear              15    3
##   &lt;NA&gt;                  0    1</code></pre>
<div class="sourceCode" id="cb737"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb737-1"><a href="#cb737-1"></a><span class="kw">crosstabs</span>(<span class="op">~</span><span class="st"> </span>cycle_awareness_app <span class="op">+</span><span class="st"> </span>hormonal_contraception, all_surveys)</span></code></pre></div>
<pre><code>##                    hormonal_contraception
## cycle_awareness_app FALSE TRUE
##   cycle_phase_aware   278   42
##   none                689  578
##   reminder              0   20
##   symptom_diaries       0   34
##   unclear              15    3
##   &lt;NA&gt;                  0    1</code></pre>
<div class="sourceCode" id="cb739"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb739-1"><a href="#cb739-1"></a>all_surveys <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(<span class="kw">tolower</span>(<span class="kw">str_trim</span>(contraception_app_name)), cycle_awareness_app) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb739-2"><a href="#cb739-2"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</span></code></pre></div>
<pre><code>## group_by: 2 grouping variables (tolower(str_trim(contraception_app_name)), cycle_awareness_app)</code></pre>
<pre><code>## summarise: now 142 rows and 3 columns, one group variable remaining (tolower(str_trim(contraception_app_name)))</code></pre>
<pre><code>## # A tibble: 142 x 3
##    `tolower(str_trim(contraception_app_name))` cycle_awareness_app     n
##    &lt;chr&gt;                                       &lt;chr&gt;               &lt;int&gt;
##  1 &lt;NA&gt;                                        none                 1249
##  2 clue                                        cycle_phase_aware      61
##  3 mein kalender                               cycle_phase_aware      47
##  4 womanlog                                    cycle_phase_aware      24
##  5 ovuview                                     cycle_phase_aware      20
##  6 p tracker                                   cycle_phase_aware      12
##  7 lady pill reminder                          reminder               10
##  8 life                                        cycle_phase_aware      10
##  9 mynfp                                       cycle_phase_aware      10
## 10 period tracker                              cycle_phase_aware       8
## # … with 132 more rows</code></pre>
</div>
<div id="change-contraception" class="section level3">
<h3>change contraception</h3>
<div class="sourceCode" id="cb743"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb743-1"><a href="#cb743-1"></a>all_surveys <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, change_contraception, change_contraception_to) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(change_contraception <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)-&gt;<span class="st"> </span>contraception_change</span></code></pre></div>
<pre><code>## select: dropped 351 variables (created_demo, modified_demo, ended_demo, expired_demo, info_study, …)</code></pre>
<pre><code>## filter: removed 1,622 rows (98%), 38 rows remaining</code></pre>
<div class="sourceCode" id="cb746"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb746-1"><a href="#cb746-1"></a>s1_demo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, contraception_method) -&gt;<span class="st"> </span>contraception</span></code></pre></div>
<pre><code>## select: dropped 112 variables (created, modified, ended, expired, info_study, …)</code></pre>
<div class="sourceCode" id="cb748"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb748-1"><a href="#cb748-1"></a>contraception_change &lt;-<span class="st"> </span><span class="kw">merge</span>(contraception_change, contraception, <span class="dt">by=</span><span class="st">&#39;session&#39;</span>)</span>
<span id="cb748-2"><a href="#cb748-2"></a></span>
<span id="cb748-3"><a href="#cb748-3"></a></span>
<span id="cb748-4"><a href="#cb748-4"></a>contraception_change <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>( </span>
<span id="cb748-5"><a href="#cb748-5"></a>  <span class="co"># contraception change does not influence group membership</span></span>
<span id="cb748-6"><a href="#cb748-6"></a>  <span class="dt">no_relevant_change =</span> <span class="ot">NA_real_</span>,</span>
<span id="cb748-7"><a href="#cb748-7"></a>  <span class="co"># nonhormonal to hormonal contraception</span></span>
<span id="cb748-8"><a href="#cb748-8"></a>  <span class="dt">change_to_hormonal_contraception =</span> <span class="dv">0</span>,</span>
<span id="cb748-9"><a href="#cb748-9"></a>  <span class="co"># hormonal to nonhormonal contraception </span></span>
<span id="cb748-10"><a href="#cb748-10"></a>  <span class="dt">change_to_nonhormonal =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb748-11"><a href="#cb748-11"></a><span class="st">  </span><span class="kw">data.frame</span>() -&gt;<span class="st"> </span>change_contraception_to</span></code></pre></div>
<pre><code>## mutate: new variable &#39;no_relevant_change&#39; with one unique value and 100% NA</code></pre>
<pre><code>##         new variable &#39;change_to_hormonal_contraception&#39; with one unique value and 0% NA</code></pre>
<pre><code>##         new variable &#39;change_to_nonhormonal&#39; with one unique value and 0% NA</code></pre>
<div class="sourceCode" id="cb752"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb752-1"><a href="#cb752-1"></a>writexl<span class="op">::</span><span class="kw">write_xlsx</span>(change_contraception_to, <span class="st">&quot;codings/change_contraception_to.xlsx&quot;</span>)</span>
<span id="cb752-2"><a href="#cb752-2"></a>change_contraception_to =<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_xlsx</span>(<span class="st">&quot;codings/change_contraception_to_coded.xlsx&quot;</span>,<span class="dv">1</span>)</span>
<span id="cb752-3"><a href="#cb752-3"></a></span>
<span id="cb752-4"><a href="#cb752-4"></a>all_surveys =<span class="st"> </span>all_surveys <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(change_contraception_to <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, no_relevant_change, change_to_hormonal_contraception, change_to_nonhormonal), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>))</span></code></pre></div>
<pre><code>## select: dropped 3 variables (change_contraception, change_contraception_to, contraception_method)</code></pre>
<pre><code>## left_join: added 3 columns (no_relevant_change, change_to_hormonal_contraception, change_to_nonhormonal)</code></pre>
<pre><code>##            &gt; rows only in x   1,622</code></pre>
<pre><code>##            &gt; rows only in y  (    0)</code></pre>
<pre><code>##            &gt; matched rows        38</code></pre>
<pre><code>##            &gt;                 =======</code></pre>
<pre><code>##            &gt; rows total       1,660</code></pre>
</div>
<div id="medication" class="section level3">
<h3>Medication</h3>
<div class="sourceCode" id="cb760"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb760-1"><a href="#cb760-1"></a>all_surveys <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(medication_name) <span class="op">&amp;</span><span class="st"> </span>medication_name <span class="op">!=</span><span class="st"> &quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, medication_name) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb760-2"><a href="#cb760-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb760-3"><a href="#cb760-3"></a>    <span class="co"># if they mention hormones or menstruation or PMS, but not the cycle, fertile window, ovulation</span></span>
<span id="cb760-4"><a href="#cb760-4"></a>        <span class="dt">medication_hormonal =</span> <span class="ot">NA_real_</span>,</span>
<span id="cb760-5"><a href="#cb760-5"></a>    <span class="co"># if they mention cycle/fertile window, but only generally or in combination with generics like &quot;mood&quot;</span></span>
<span id="cb760-6"><a href="#cb760-6"></a>        <span class="dt">medication_psychopharmacological =</span> <span class="dv">0</span>,</span>
<span id="cb760-7"><a href="#cb760-7"></a>        <span class="dt">medication_antibiotics =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb760-8"><a href="#cb760-8"></a><span class="st">  </span><span class="kw">data.frame</span>() -&gt;<span class="st"> </span>medication</span></code></pre></div>
<pre><code>## filter: removed 1,117 rows (67%), 543 rows remaining</code></pre>
<pre><code>## select: dropped 355 variables (created_demo, modified_demo, ended_demo, expired_demo, info_study, …)</code></pre>
<pre><code>## distinct: no rows removed</code></pre>
<pre><code>## mutate: new variable &#39;medication_hormonal&#39; with one unique value and 100% NA</code></pre>
<pre><code>##         new variable &#39;medication_psychopharmacological&#39; with one unique value and 0% NA</code></pre>
<pre><code>##         new variable &#39;medication_antibiotics&#39; with one unique value and 0% NA</code></pre>
<div class="sourceCode" id="cb767"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb767-1"><a href="#cb767-1"></a>writexl<span class="op">::</span><span class="kw">write_xlsx</span>(medication, <span class="st">&quot;codings/medication.xlsx&quot;</span>)</span>
<span id="cb767-2"><a href="#cb767-2"></a> medication =<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_xlsx</span>(<span class="st">&quot;codings/medication_coded.xlsx&quot;</span>,<span class="dv">1</span>)</span>
<span id="cb767-3"><a href="#cb767-3"></a> </span>
<span id="cb767-4"><a href="#cb767-4"></a></span>
<span id="cb767-5"><a href="#cb767-5"></a> </span>
<span id="cb767-6"><a href="#cb767-6"></a>all_surveys =<span class="st"> </span>all_surveys <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(medication <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>medication_name), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>))</span></code></pre></div>
<pre><code>## select: dropped one variable (medication_name)</code></pre>
<pre><code>## left_join: added 3 columns (medication_hormonal, medication_psychopharmacological, medication_antibiotics)</code></pre>
<pre><code>##            &gt; rows only in x   1,117</code></pre>
<pre><code>##            &gt; rows only in y  (    0)</code></pre>
<pre><code>##            &gt; matched rows       543</code></pre>
<pre><code>##            &gt;                 =======</code></pre>
<pre><code>##            &gt; rows total       1,660</code></pre>
</div>
</div>
<div id="cycle-length" class="section level2">
<h2>cycle length</h2>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb775-1"><a href="#cb775-1"></a>all_surveys<span class="op">$</span>menstruation_length_groups &lt;-<span class="st"> </span><span class="ot">NA</span> </span>
<span id="cb775-2"><a href="#cb775-2"></a></span>
<span id="cb775-3"><a href="#cb775-3"></a>all_surveys =<span class="st"> </span>all_surveys <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb775-4"><a href="#cb775-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">menstruation_length_groups =</span> (<span class="kw">ifelse</span>(menstruation_length <span class="op">&gt;=</span><span class="st"> </span><span class="dv">20</span> <span class="op">&amp;</span><span class="st"> </span>menstruation_length <span class="op">&lt;=</span><span class="st"> </span><span class="dv">40</span>, <span class="dv">1</span>,</span>
<span id="cb775-5"><a href="#cb775-5"></a>           <span class="kw">ifelse</span>(menstruation_length <span class="op">&gt;</span><span class="st"> </span><span class="dv">40</span> , <span class="dv">2</span>,</span>
<span id="cb775-6"><a href="#cb775-6"></a>                  <span class="kw">ifelse</span>(menstruation_length  <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span>, <span class="dv">3</span>, <span class="ot">NA</span>)))))</span></code></pre></div>
<pre><code>## mutate: converted &#39;menstruation_length_groups&#39; from logical to double (1305 fewer NA)</code></pre>
<div class="sourceCode" id="cb777"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb777-1"><a href="#cb777-1"></a>all_surveys<span class="op">$</span>menstruation_length_groups &lt;-<span class="st"> </span><span class="kw">factor</span>(all_surveys<span class="op">$</span>menstruation_length_groups, <span class="dt">level=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&#39;normal&#39;</span>, <span class="st">&#39;long&#39;</span>, <span class="st">&#39;short&#39;</span>))</span></code></pre></div>
</div>
<div id="choice-of-contraception" class="section level2">
<h2>choice of contraception</h2>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb778-1"><a href="#cb778-1"></a>all_surveys =<span class="st"> </span>all_surveys <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(</span>
<span id="cb778-2"><a href="#cb778-2"></a>    <span class="dt">contraception_method =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(contraception_method), <span class="st">&quot;&quot;</span>, <span class="kw">as.character</span>(contraception_method)),</span>
<span id="cb778-3"><a href="#cb778-3"></a>    <span class="dt">com =</span> contraception_method,</span>
<span id="cb778-4"><a href="#cb778-4"></a>    <span class="dt">contraception_approach =</span> <span class="kw">if_else</span>(</span>
<span id="cb778-5"><a href="#cb778-5"></a>        <span class="dt">condition =</span> com <span class="op">%contains%</span><span class="st"> &quot;hormonal_pill&quot;</span> <span class="op">|</span><span class="st"> </span>com <span class="op">%contains%</span><span class="st"> &quot;hormonal_other&quot;</span>, <span class="co"># condition</span></span>
<span id="cb778-6"><a href="#cb778-6"></a>        <span class="co"># true</span></span>
<span id="cb778-7"><a href="#cb778-7"></a>        <span class="dt">true =</span> <span class="kw">if_else</span>(</span>
<span id="cb778-8"><a href="#cb778-8"></a>            <span class="dt">condition =</span> com <span class="op">==</span><span class="st"> &quot;hormonal_pill&quot;</span> <span class="op">|</span><span class="st"> </span>com <span class="op">==</span><span class="st"> &quot;hormonal_other&quot;</span> <span class="op">|</span><span class="st"> </span>com <span class="op">==</span><span class="st"> &quot;hormonal_morning_after_pill&quot;</span>, <span class="co"># condition</span></span>
<span id="cb778-9"><a href="#cb778-9"></a>            <span class="dt">true =</span> <span class="kw">if_else</span>(com <span class="op">==</span><span class="st"> &quot;hormonal_pill&quot;</span>, </span>
<span id="cb778-10"><a href="#cb778-10"></a>                                            <span class="dt">true =</span> <span class="st">&quot;hormonal_pill_only&quot;</span>, </span>
<span id="cb778-11"><a href="#cb778-11"></a>                                            <span class="dt">false =</span> <span class="st">&quot;hormonal_other_only&quot;</span></span>
<span id="cb778-12"><a href="#cb778-12"></a>            ),</span>
<span id="cb778-13"><a href="#cb778-13"></a>                                            <span class="dt">false =</span> <span class="st">&quot;hormonal+barrier&quot;</span></span>
<span id="cb778-14"><a href="#cb778-14"></a>            ),</span>
<span id="cb778-15"><a href="#cb778-15"></a>        <span class="kw">if_else</span>(</span>
<span id="cb778-16"><a href="#cb778-16"></a>            <span class="dt">condition =</span> <span class="op">!</span><span class="st"> </span>com <span class="op">%contains%</span><span class="st"> &quot;awareness&quot;</span>, </span>
<span id="cb778-17"><a href="#cb778-17"></a>            <span class="dt">true =</span> <span class="kw">if_else</span>(<span class="dt">condition =</span> com <span class="op">!=</span><span class="st"> &quot;&quot;</span>,</span>
<span id="cb778-18"><a href="#cb778-18"></a>                <span class="dt">true =</span> <span class="kw">if_else</span>(<span class="dt">condition =</span> com <span class="op">%contains%</span><span class="st"> &quot;barrier_intrauterine_pessar&quot;</span>, </span>
<span id="cb778-19"><a href="#cb778-19"></a>                               <span class="dt">true =</span> <span class="st">&quot;barrier_pessar&quot;</span>,</span>
<span id="cb778-20"><a href="#cb778-20"></a>                                <span class="kw">if_else</span>(<span class="dt">condition =</span> com <span class="op">%contains%</span><span class="st"> &quot;barrier_condoms&quot;</span>, <span class="dt">true =</span> <span class="st">&quot;condoms&quot;</span>, <span class="dt">false =</span> <span class="st">&quot;other&quot;</span>)),</span>
<span id="cb778-21"><a href="#cb778-21"></a>                <span class="dt">false =</span> <span class="st">&quot;nothing&quot;</span>),</span>
<span id="cb778-22"><a href="#cb778-22"></a>                <span class="dt">false =</span> <span class="st">&quot;awareness&quot;</span>)</span>
<span id="cb778-23"><a href="#cb778-23"></a>        )</span>
<span id="cb778-24"><a href="#cb778-24"></a>          <span class="co"># false</span></span>
<span id="cb778-25"><a href="#cb778-25"></a>    )</span></code></pre></div>
<pre><code>## mutate: changed 273 values (16%) of &#39;contraception_method&#39; (273 fewer NA)</code></pre>
<pre><code>##         new variable &#39;com&#39; with 71 unique values and 0% NA</code></pre>
<pre><code>##         new variable &#39;contraception_approach&#39; with 8 unique values and 0% NA</code></pre>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb782-1"><a href="#cb782-1"></a>all_surveys<span class="op">$</span>contraception_approach =<span class="st"> </span><span class="kw">factor</span>( all_surveys<span class="op">$</span>contraception_approach, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;condoms&quot;</span>, <span class="st">&quot;barrier_pessar&quot;</span>, <span class="st">&quot;hormonal+barrier&quot;</span>, <span class="st">&quot;hormonal_pill_only&quot;</span>, <span class="st">&quot;hormonal_other_only&quot;</span>, <span class="st">&quot;awareness&quot;</span>, <span class="st">&quot;nothing&quot;</span>, <span class="st">&quot;other&quot;</span>) )</span>
<span id="cb782-2"><a href="#cb782-2"></a><span class="kw">qplot</span>(all_surveys<span class="op">$</span>contraception_approach) <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="0_wrangle_data_files/figure-html/choice%20of%20contraception-1.png" width="672" /></p>
<div class="sourceCode" id="cb783"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb783-1"><a href="#cb783-1"></a>all_surveys &lt;-<span class="st"> </span>all_surveys <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb783-2"><a href="#cb783-2"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">contraception_awareness_approach =</span> </span>
<span id="cb783-3"><a href="#cb783-3"></a>                 <span class="kw">case_when</span>(</span>
<span id="cb783-4"><a href="#cb783-4"></a>                   contraception_approach <span class="op">%contains%</span><span class="st"> &quot;hormonal&quot;</span> <span class="op">~</span><span class="st"> </span>estrogen_progestogen,</span>
<span id="cb783-5"><a href="#cb783-5"></a>                   contraception_approach <span class="op">%contains%</span><span class="st"> &quot;awareness&quot;</span> <span class="op">|</span><span class="st">  </span></span>
<span id="cb783-6"><a href="#cb783-6"></a><span class="st">                     </span>cycle_awareness_app <span class="op">==</span><span class="st"> &quot;cycle_phase_aware&quot;</span> <span class="op">~</span><span class="st"> &quot;awareness&quot;</span>,</span>
<span id="cb783-7"><a href="#cb783-7"></a>                   <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.character</span>(contraception_approach))</span>
<span id="cb783-8"><a href="#cb783-8"></a>               )</span></code></pre></div>
<pre><code>## mutate: new variable &#39;contraception_awareness_approach&#39; with 7 unique values and 0% NA</code></pre>
</div>
<div id="fix-variables" class="section level2">
<h2>Fix variables</h2>
<div class="sourceCode" id="cb785"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb785-1"><a href="#cb785-1"></a><span class="kw">val_labels</span>(all_surveys<span class="op">$</span>relationship_status) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Single&quot;</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;loose relationship&quot;</span> =<span class="st"> </span><span class="dv">2</span>, <span class="st">&quot;steady relationship&quot;</span> =<span class="st"> </span><span class="dv">3</span>, <span class="st">&quot;engaged&quot;</span> =<span class="st"> </span><span class="dv">4</span>, <span class="st">&quot;married&quot;</span> =<span class="st"> </span><span class="dv">5</span>, <span class="st">&quot;other&quot;</span> =<span class="st"> </span><span class="dv">6</span>)</span></code></pre></div>
<div id="diary-desire-scales" class="section level3">
<h3>Diary desire scales</h3>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb786-1"><a href="#cb786-1"></a><span class="kw">library</span>(codebook)</span>
<span id="cb786-2"><a href="#cb786-2"></a></span>
<span id="cb786-3"><a href="#cb786-3"></a>s3_daily<span class="op">$</span>extra_pair_desire_and_behaviour &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;extra_pair_desire_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">aggregate_and_document_scale</span>(<span class="dt">fun =</span> robust_rowmeans)</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## select: dropped 293 variables (session, created_date, created, modified, ended, …)</code></pre>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb789-1"><a href="#cb789-1"></a><span class="kw">var_label</span>(s3_daily<span class="op">$</span>extra_pair_desire_and_behaviour) &lt;-<span class="st"> &quot;Extra-pair desire and behaviour&quot;</span></span>
<span id="cb789-2"><a href="#cb789-2"></a></span>
<span id="cb789-3"><a href="#cb789-3"></a>s3_daily<span class="op">$</span>extra_pair_desire &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>( extra_pair_desire_<span class="dv">7</span>, extra_pair_desire_<span class="dv">8</span>, extra_pair_desire_<span class="dv">10</span>, extra_pair_desire_<span class="dv">11</span>, extra_pair_desire_<span class="dv">13</span>, extra_pair_desire_<span class="dv">14</span>, extra_pair_desire_<span class="dv">16</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">aggregate_and_document_scale</span>(<span class="dt">fun =</span> robust_rowmeans)</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## select: dropped 302 variables (session, created_date, created, modified, ended, …)</code></pre>
<div class="sourceCode" id="cb792"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb792-1"><a href="#cb792-1"></a><span class="kw">var_label</span>(s3_daily<span class="op">$</span>extra_pair_desire) &lt;-<span class="st"> &quot;Extra-pair desire&quot;</span></span>
<span id="cb792-2"><a href="#cb792-2"></a></span>
<span id="cb792-3"><a href="#cb792-3"></a>s3_daily<span class="op">$</span>extra_pair_interest &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(extra_pair_desire_<span class="dv">4</span>, extra_pair_desire_<span class="dv">9</span>, extra_pair_desire_<span class="dv">12</span>, extra_pair_desire_5R) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">aggregate_and_document_scale</span>(<span class="dt">fun =</span> robust_rowmeans)</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## select: dropped 305 variables (session, created_date, created, modified, ended, …)</code></pre>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb795-1"><a href="#cb795-1"></a><span class="kw">var_label</span>(s3_daily<span class="op">$</span>extra_pair_interest) &lt;-<span class="st"> &quot;Extra-pair interest&quot;</span></span>
<span id="cb795-2"><a href="#cb795-2"></a></span>
<span id="cb795-3"><a href="#cb795-3"></a></span>
<span id="cb795-4"><a href="#cb795-4"></a>s3_daily<span class="op">$</span>in_pair_desire_and_behaviour =<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;in_pair_desire_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">aggregate_and_document_scale</span>(<span class="dt">fun =</span> robust_rowmeans)</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## select: dropped 296 variables (session, created_date, created, modified, ended, …)</code></pre>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb798-1"><a href="#cb798-1"></a><span class="kw">var_label</span>(s3_daily<span class="op">$</span>in_pair_desire_and_behaviour) &lt;-<span class="st"> &quot;In-pair desire and behaviour&quot;</span></span>
<span id="cb798-2"><a href="#cb798-2"></a></span>
<span id="cb798-3"><a href="#cb798-3"></a>s3_daily<span class="op">$</span>in_pair_desire =<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(in_pair_desire_<span class="dv">7</span>, in_pair_desire_<span class="dv">8</span>, in_pair_desire_<span class="dv">10</span>, in_pair_desire_<span class="dv">11</span>, in_pair_desire_<span class="dv">13</span>, in_pair_desire_<span class="dv">14</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">aggregate_and_document_scale</span>(<span class="dt">fun =</span> robust_rowmeans)</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## select: dropped 305 variables (session, created_date, created, modified, ended, …)</code></pre>
<div class="sourceCode" id="cb801"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb801-1"><a href="#cb801-1"></a><span class="kw">var_label</span>(s3_daily<span class="op">$</span>in_pair_desire) &lt;-<span class="st"> &quot;In-pair desire&quot;</span></span>
<span id="cb801-2"><a href="#cb801-2"></a></span>
<span id="cb801-3"><a href="#cb801-3"></a>s3_daily<span class="op">$</span>in_pair_interest &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(in_pair_desire_<span class="dv">4</span>, in_pair_desire_<span class="dv">9</span>, in_pair_desire_<span class="dv">12</span>, in_pair_desire_5R) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">aggregate_and_document_scale</span>(<span class="dt">fun =</span> robust_rowmeans)</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## select: dropped 307 variables (session, created_date, created, modified, ended, …)</code></pre>
<div class="sourceCode" id="cb804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb804-1"><a href="#cb804-1"></a><span class="kw">var_label</span>(s3_daily<span class="op">$</span>in_pair_interest) &lt;-<span class="st"> &quot;In-pair interest&quot;</span></span>
<span id="cb804-2"><a href="#cb804-2"></a></span>
<span id="cb804-3"><a href="#cb804-3"></a>s3_daily<span class="op">$</span>grooming =<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="st">&quot;^grooming_</span><span class="ch">\\</span><span class="st">d$&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">aggregate_and_document_scale</span>(<span class="dt">fun =</span> robust_rowmeans)</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## select: dropped 310 variables (session, created_date, created, modified, ended, …)</code></pre>
<div class="sourceCode" id="cb807"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb807-1"><a href="#cb807-1"></a><span class="kw">var_label</span>(s3_daily<span class="op">$</span>grooming) &lt;-<span class="st"> &quot;Self-grooming&quot;</span></span>
<span id="cb807-2"><a href="#cb807-2"></a></span>
<span id="cb807-3"><a href="#cb807-3"></a><span class="co"># grooming time spent doesn&#39;t fit so well with the other items</span></span>
<span id="cb807-4"><a href="#cb807-4"></a>grooming_vars &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="st">&quot;^grooming_</span><span class="ch">\\</span><span class="st">d&quot;</span>), grooming_time_spent,</span>
<span id="cb807-5"><a href="#cb807-5"></a>                                  grooming_activities) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">grooming_time_spent =</span> <span class="kw">log1p</span>(<span class="kw">as.numeric</span>(grooming_time_spent)),</span>
<span id="cb807-6"><a href="#cb807-6"></a>        <span class="dt">grooming_activities =</span> <span class="kw">if_else</span>(<span class="kw">str_length</span>(grooming_activities) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="kw">str_count</span>(grooming_activities, <span class="st">&quot;,&quot;</span>), 0L)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_all</span>(<span class="kw">funs</span>(scale))</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## select: dropped 308 variables (session, created_date, created, modified, ended, …)</code></pre>
<pre><code>## mutate: changed 17,331 values (22%) of &#39;grooming_time_spent&#39; (0 new NA)</code></pre>
<pre><code>##         converted &#39;grooming_activities&#39; from character to integer (0 new NA)</code></pre>
<pre><code>## mutate_all: changed 18,404 values (23%) of &#39;grooming_1&#39; (0 new NA)</code></pre>
<pre><code>##             changed 18,747 values (24%) of &#39;grooming_2&#39; (0 new NA)</code></pre>
<pre><code>##             changed 18,555 values (23%) of &#39;grooming_time_spent&#39; (0 new NA)</code></pre>
<pre><code>##             converted &#39;grooming_activities&#39; from integer to double (0 new NA)</code></pre>
<div class="sourceCode" id="cb816"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb816-1"><a href="#cb816-1"></a><span class="co"># grooming_vars %&gt;% psych::alpha()</span></span>
<span id="cb816-2"><a href="#cb816-2"></a>s3_daily<span class="op">$</span>grooming_broad =<span class="st"> </span>grooming_vars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">aggregate_and_document_scale</span>(<span class="dt">fun =</span> robust_rowmeans)</span>
<span id="cb816-3"><a href="#cb816-3"></a><span class="kw">var_label</span>(s3_daily<span class="op">$</span>grooming) &lt;-<span class="st"> &quot;Self-grooming (broad)&quot;</span></span>
<span id="cb816-4"><a href="#cb816-4"></a></span>
<span id="cb816-5"><a href="#cb816-5"></a></span>
<span id="cb816-6"><a href="#cb816-6"></a>s3_daily<span class="op">$</span>vanity =<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="st">&quot;^vanity_</span><span class="ch">\\</span><span class="st">d$&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">aggregate_and_document_scale</span>(<span class="dt">fun =</span> robust_rowmeans)</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## select: dropped 310 variables (session, created_date, created, modified, ended, …)</code></pre>
<div class="sourceCode" id="cb819"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb819-1"><a href="#cb819-1"></a><span class="kw">var_label</span>(s3_daily<span class="op">$</span>vanity) &lt;-<span class="st"> &quot;Satisfied with looks&quot;</span></span>
<span id="cb819-2"><a href="#cb819-2"></a></span>
<span id="cb819-3"><a href="#cb819-3"></a></span>
<span id="cb819-4"><a href="#cb819-4"></a>s3_daily<span class="op">$</span>mate_retention =<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="st">&quot;^mate_retention</span><span class="ch">\\</span><span class="st">d$&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">aggregate_and_document_scale</span>(<span class="dt">fun =</span> robust_rowmeans)</span></code></pre></div>
<pre><code>## ungroup: no grouping variables
## select: dropped 310 variables (session, created_date, created, modified, ended, …)</code></pre>
<div class="sourceCode" id="cb821"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb821-1"><a href="#cb821-1"></a><span class="kw">var_label</span>(s3_daily<span class="op">$</span>mate_retention) &lt;-<span class="st"> &quot;Partner mate retention&quot;</span></span></code></pre></div>
</div>
<div id="separation-from-partner" class="section level3">
<h3>Separation from partner</h3>
<div class="sourceCode" id="cb822"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb822-1"><a href="#cb822-1"></a>s3_daily &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb822-2"><a href="#cb822-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">saw_partner =</span> <span class="kw">if_else</span>(contact_partner <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb822-3"><a href="#cb822-3"></a><span class="st">  </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb822-4"><a href="#cb822-4"></a><span class="st">  </span><span class="kw">arrange</span>(session, created_date) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb822-5"><a href="#cb822-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">last_saw_partner_date =</span> <span class="kw">if_else</span>(saw_partner <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, created_date, <span class="kw">as.Date</span>(<span class="ot">NA_character_</span>)),</span>
<span id="cb822-6"><a href="#cb822-6"></a>         <span class="dt">last_saw_partner_date =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(saw_partner_last), last_saw_partner_date,</span>
<span id="cb822-7"><a href="#cb822-7"></a>                                         created_date <span class="op">-</span><span class="st"> </span><span class="kw">recode</span>(<span class="kw">as.numeric</span>(saw_partner_last),</span>
<span id="cb822-8"><a href="#cb822-8"></a>                                                               <span class="st">`</span><span class="dt">7</span><span class="st">`</span> =<span class="st"> </span><span class="dv">8</span>,</span>
<span id="cb822-9"><a href="#cb822-9"></a>                                                               <span class="st">`</span><span class="dt">8</span><span class="st">`</span> =<span class="st"> </span><span class="dv">15</span>,</span>
<span id="cb822-10"><a href="#cb822-10"></a>                                                               <span class="dt">.default =</span> <span class="kw">as.numeric</span>(saw_partner_last))),</span>
<span id="cb822-11"><a href="#cb822-11"></a>         <span class="dt">last_saw_partner_date =</span> zoo<span class="op">::</span><span class="kw">na.locf</span>(last_saw_partner_date, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>),</span>
<span id="cb822-12"><a href="#cb822-12"></a>         <span class="dt">days_since_seeing_partner =</span> <span class="kw">as.numeric</span>(created_date <span class="op">-</span><span class="st"> </span>last_saw_partner_date),</span>
<span id="cb822-13"><a href="#cb822-13"></a>         <span class="dt">time_since_seeing_partner =</span> <span class="kw">if_else</span>(<span class="op">!</span><span class="kw">is.na</span>(saw_partner_last),</span>
<span id="cb822-14"><a href="#cb822-14"></a>                                             <span class="kw">as.numeric</span>(saw_partner_last),</span>
<span id="cb822-15"><a href="#cb822-15"></a>                                             <span class="kw">case_when</span>(</span>
<span id="cb822-16"><a href="#cb822-16"></a>                                               <span class="kw">between</span>(days_since_seeing_partner, <span class="dv">0</span>, <span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb822-17"><a href="#cb822-17"></a>                                               days_since_seeing_partner <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> </span><span class="dv">2</span>,</span>
<span id="cb822-18"><a href="#cb822-18"></a>                                               days_since_seeing_partner <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> </span><span class="dv">3</span>,</span>
<span id="cb822-19"><a href="#cb822-19"></a>                                               days_since_seeing_partner <span class="op">==</span><span class="st"> </span><span class="dv">4</span> <span class="op">~</span><span class="st"> </span><span class="dv">4</span>,</span>
<span id="cb822-20"><a href="#cb822-20"></a>                                               days_since_seeing_partner <span class="op">==</span><span class="st"> </span><span class="dv">5</span> <span class="op">~</span><span class="st"> </span><span class="dv">5</span>,</span>
<span id="cb822-21"><a href="#cb822-21"></a>                                               days_since_seeing_partner <span class="op">==</span><span class="st"> </span><span class="dv">6</span> <span class="op">~</span><span class="st"> </span><span class="dv">6</span>,</span>
<span id="cb822-22"><a href="#cb822-22"></a>                                               <span class="kw">between</span>(days_since_seeing_partner, <span class="dv">7</span>, <span class="dv">14</span>) <span class="op">~</span><span class="st"> </span><span class="dv">7</span>,</span>
<span id="cb822-23"><a href="#cb822-23"></a>                                               days_since_seeing_partner <span class="op">&gt;</span><span class="st"> </span><span class="dv">14</span> <span class="op">~</span><span class="st"> </span><span class="dv">8</span></span>
<span id="cb822-24"><a href="#cb822-24"></a>                                             )))</span></code></pre></div>
<pre><code>## mutate: new variable &#39;saw_partner&#39; with 3 unique values and 49% NA</code></pre>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## mutate (grouped): new variable &#39;last_saw_partner_date&#39; with 325 unique values and 37% NA</code></pre>
<pre><code>##                   new variable &#39;days_since_seeing_partner&#39; with 99 unique values and 37% NA</code></pre>
<pre><code>##                   new variable &#39;time_since_seeing_partner&#39; with 9 unique values and 37% NA</code></pre>
<div class="sourceCode" id="cb828"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb828-1"><a href="#cb828-1"></a><span class="co">#note: days_since_seeing_partner is minimal where inferred, not accurate</span></span>
<span id="cb828-2"><a href="#cb828-2"></a><span class="co"># time_since_seeing_partner is ordinal only</span></span>
<span id="cb828-3"><a href="#cb828-3"></a></span>
<span id="cb828-4"><a href="#cb828-4"></a><span class="co"># s3_daily %&gt;% select(short, created_date, last_saw_partner_date, saw_partner,saw_partner_last, days_since_seeing_partner, time_since_seeing_partner) %&gt;% View()</span></span>
<span id="cb828-5"><a href="#cb828-5"></a><span class="co"># crosstabs(~ saw_partner + days_since_seeing_partner, s3_daily)</span></span>
<span id="cb828-6"><a href="#cb828-6"></a><span class="co"># crosstabs(~ saw_partner_last + is.na(days_since_seeing_partner), s3_daily)</span></span>
<span id="cb828-7"><a href="#cb828-7"></a><span class="kw">crosstabs</span>(<span class="op">~</span><span class="st"> </span>saw_partner_last <span class="op">+</span><span class="st"> </span>time_since_seeing_partner, s3_daily)</span></code></pre></div>
<pre><code>##                 time_since_seeing_partner
## saw_partner_last     1     2     3     4     5     6     7     8  &lt;NA&gt;
##             1     3735     0     0     0     0     0     0     0     0
##             2        0   376     0     0     0     0     0     0     0
##             3        0     0   248     0     0     0     0     0     0
##             4        0     0     0   154     0     0     0     0     0
##             5        0     0     0     0   129     0     0     0     0
##             6        0     0     0     0     0   136     0     0     0
##             7        0     0     0     0     0     0   345     0     0
##             8        0     0     0     0     0     0     0   361     0
##             &lt;NA&gt; 27926  3606  2264  1636  1214   910  3727  3105 29377</code></pre>
</div>
<div id="age-groups" class="section level3">
<h3>age groups</h3>
<div class="sourceCode" id="cb830"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb830-1"><a href="#cb830-1"></a>all_surveys<span class="op">$</span>age_group &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb830-2"><a href="#cb830-2"></a>all_surveys &lt;-<span class="st"> </span>all_surveys <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">age_group =</span> <span class="kw">replace</span>(age_group, age <span class="op">&gt;=</span><span class="st"> </span><span class="dv">18</span> <span class="op">&amp;</span><span class="st"> </span>age <span class="op">&lt;</span><span class="st"> </span><span class="dv">25</span>, <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## mutate: converted &#39;age_group&#39; from logical to double (802 fewer NA)</code></pre>
<div class="sourceCode" id="cb832"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb832-1"><a href="#cb832-1"></a>all_surveys &lt;-<span class="st"> </span>all_surveys <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">age_group =</span> <span class="kw">replace</span>(age_group, age <span class="op">&gt;=</span><span class="st"> </span><span class="dv">25</span>, <span class="dv">2</span>))</span></code></pre></div>
<pre><code>## mutate: changed 837 values (50%) of &#39;age_group&#39; (837 fewer NA)</code></pre>
<div class="sourceCode" id="cb834"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb834-1"><a href="#cb834-1"></a>all_surveys<span class="op">$</span>age_group &lt;-<span class="st"> </span><span class="kw">factor</span>(all_surveys<span class="op">$</span>age_group, <span class="dt">levels=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&#39;18-25&#39;</span>, <span class="st">&#39;&gt;25&#39;</span>))</span></code></pre></div>
</div>
</div>
<div id="fertility-awareness-1" class="section level2">
<h2>Fertility awareness</h2>
<div class="sourceCode" id="cb835"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb835-1"><a href="#cb835-1"></a>all_surveys &lt;-<span class="st"> </span>all_surveys <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb835-2"><a href="#cb835-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb835-3"><a href="#cb835-3"></a>    <span class="dt">aware =</span> <span class="kw">if_else</span>(hormonal_contraception <span class="op">==</span><span class="st"> &quot;FALSE&quot;</span> <span class="op">&amp;</span></span>
<span id="cb835-4"><a href="#cb835-4"></a><span class="st">                      </span>(pregnant_trying <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">|</span></span>
<span id="cb835-5"><a href="#cb835-5"></a><span class="st">                      </span>hypothesis_guess_topic <span class="op">!=</span><span class="st"> &quot;no_guess&quot;</span> <span class="op">|</span></span>
<span id="cb835-6"><a href="#cb835-6"></a><span class="st">                      </span>(contraception_approach <span class="op">==</span><span class="st"> &quot;awareness&quot;</span> <span class="op">|</span><span class="st"> </span></span>
<span id="cb835-7"><a href="#cb835-7"></a><span class="st">                      </span>contraception_app <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb835-8"><a href="#cb835-8"></a><span class="st">                      </span><span class="op">!</span>(cycle_awareness_other <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fertile_aware_invalid&quot;</span>, <span class="st">&quot;fertility_awareness_did_not_use&quot;</span>, <span class="st">&quot;not_fertile_aware&quot;</span>))), <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## mutate: new variable &#39;aware&#39; with 2 unique values and 0% NA</code></pre>
</div>
<div id="merge-diary" class="section level2">
<h2>Merge diary</h2>
<div class="sourceCode" id="cb837"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb837-1"><a href="#cb837-1"></a>s3_daily =<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">short =</span> stringr<span class="op">::</span><span class="kw">str_sub</span>(session, <span class="dv">1</span>, <span class="dv">7</span>))</span></code></pre></div>
<pre><code>## mutate (grouped): changed 16,335 values (21%) of &#39;short&#39; (16335 fewer NA)</code></pre>
<div class="sourceCode" id="cb839"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb839-1"><a href="#cb839-1"></a>all_surveys =<span class="st"> </span>all_surveys <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">short =</span> stringr<span class="op">::</span><span class="kw">str_sub</span>(session, <span class="dv">1</span>, <span class="dv">7</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>short_demo, <span class="op">-</span>short_initial)</span></code></pre></div>
<pre><code>## mutate: changed 489 values (29%) of &#39;short&#39; (489 fewer NA)</code></pre>
<pre><code>## select: dropped 2 variables (short_demo, short_initial)</code></pre>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb842-1"><a href="#cb842-1"></a>diary =<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">full_join</span>(all_surveys, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>,<span class="st">&quot;short&quot;</span>), <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;_diary&quot;</span>, <span class="st">&quot;_followup&quot;</span>))</span></code></pre></div>
<pre><code>## full_join: added 367 columns (created_diary, modified_diary, ended_diary, expired_diary, relationship_satisfaction_diary, …)</code></pre>
<pre><code>##            &gt; rows only in x        0</code></pre>
<pre><code>##            &gt; rows only in y      287</code></pre>
<pre><code>##            &gt; matched rows     79,249</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       79,536</code></pre>
</div>
<div id="singles" class="section level2">
<h2>Singles</h2>
<div class="sourceCode" id="cb849"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb849-1"><a href="#cb849-1"></a>s4_timespent =<span class="st"> </span>s4_timespent <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb849-2"><a href="#cb849-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>session <span class="op">%contains%</span><span class="st"> &#39;XXX&#39;</span>)</span></code></pre></div>
<pre><code>## filter: no rows removed</code></pre>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb851-1"><a href="#cb851-1"></a>Singles =<span class="st"> </span><span class="kw">nrow</span>(singles &lt;-<span class="st"> </span><span class="kw">filter</span>(s1_demo, relationship_status <span class="op">==</span><span class="st"> </span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## filter: removed 1,133 rows (68%), 527 rows remaining</code></pre>
<div class="sourceCode" id="cb853"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb853-1"><a href="#cb853-1"></a>Paid =<span class="st"> </span><span class="kw">nrow</span>(paid &lt;-<span class="st"> </span><span class="kw">filter</span>(s1_filter, gets_paid <span class="op">==</span><span class="st"> </span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## filter: removed 1,050 rows (65%), 557 rows remaining</code></pre>
<div class="sourceCode" id="cb855"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb855-1"><a href="#cb855-1"></a>Paid_Single =<span class="st"> </span><span class="kw">nrow</span>(paid_singles &lt;-<span class="st"> </span><span class="kw">inner_join</span>(singles, paid, <span class="dt">by=</span> <span class="st">&#39;session&#39;</span>))</span></code></pre></div>
<pre><code>## inner_join: added 12 columns (created.x, modified.x, ended.x, expired.x, short.x, …)</code></pre>
<pre><code>##             &gt; rows only in x  (305)</code></pre>
<pre><code>##             &gt; rows only in y  (335)</code></pre>
<pre><code>##             &gt; matched rows     222</code></pre>
<pre><code>##             &gt;                 =====</code></pre>
<pre><code>##             &gt; rows total       222</code></pre>
<div class="sourceCode" id="cb862"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb862-1"><a href="#cb862-1"></a>with_FU =<span class="st"> </span><span class="kw">nrow</span>(withfollowup &lt;-<span class="st"> </span><span class="kw">inner_join</span>(paid_singles, s4_followup, <span class="dt">by=</span><span class="st">&#39;session&#39;</span>))</span></code></pre></div>
<pre><code>## inner_join: added 44 columns (created, modified, ended, expired, hypothesis_guess, …)</code></pre>
<pre><code>##             &gt; rows only in x  ( 32)</code></pre>
<pre><code>##             &gt; rows only in y  (981)</code></pre>
<pre><code>##             &gt; matched rows     190</code></pre>
<pre><code>##             &gt;                 =====</code></pre>
<pre><code>##             &gt; rows total       190</code></pre>
<ol style="list-style-type: decimal">
<li><strong>527</strong> number of single women.</li>
<li><strong>557</strong> number of women getting paid for participation.</li>
<li><strong>222</strong> number of Singles getting paid for participation.</li>
<li><strong>190</strong> number of single women getting paid and answering follow-up questionnaire.</li>
</ol>
</div>
<div id="network" class="section level2">
<h2>network</h2>
<div class="sourceCode" id="cb869"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb869-1"><a href="#cb869-1"></a>network &lt;-<span class="st"> </span>s4_timespent</span>
<span id="cb869-2"><a href="#cb869-2"></a></span>
<span id="cb869-3"><a href="#cb869-3"></a><span class="kw">nrow</span>(network)</span></code></pre></div>
<pre><code>## [1] 2337</code></pre>
<div class="sourceCode" id="cb871"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb871-1"><a href="#cb871-1"></a><span class="kw">summary</span>(<span class="kw">as.factor</span>(network<span class="op">$</span>person_relationship_status))</span></code></pre></div>
<pre><code>##      dont_know        engaged        married      partnered         single unclear_status           NA&#39;s 
##            141             13            259            668            854            186            216</code></pre>
<div class="sourceCode" id="cb873"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb873-1"><a href="#cb873-1"></a>network =<span class="st"> </span>network <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb873-2"><a href="#cb873-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb873-3"><a href="#cb873-3"></a>    <span class="dt">person_is_unrelated_man =</span> <span class="kw">if_else</span>(person_sex <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">&amp;</span><span class="st">     </span>person_relationship_to_anchor <span class="op">!=</span><span class="st"> &quot;biological_relative&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb873-4"><a href="#cb873-4"></a>    <span class="dt">person_is_related_man =</span> <span class="kw">if_else</span>(person_sex <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">&amp;</span><span class="st">     </span>person_relationship_to_anchor <span class="op">==</span><span class="st"> &quot;biological_relative&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb873-5"><a href="#cb873-5"></a>    )</span></code></pre></div>
<pre><code>## mutate: new variable &#39;person_is_unrelated_man&#39; with 3 unique values and 9% NA</code></pre>
<pre><code>##         new variable &#39;person_is_related_man&#39; with 3 unique values and 9% NA</code></pre>
<div class="sourceCode" id="cb876"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb876-1"><a href="#cb876-1"></a><span class="kw">summary</span>(<span class="kw">as.factor</span>(network<span class="op">$</span>person_sex))</span></code></pre></div>
<pre><code>##    1    2    3 NA&#39;s 
## 1162  798  161  216</code></pre>
<div class="sourceCode" id="cb878"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb878-1"><a href="#cb878-1"></a>network <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb878-2"><a href="#cb878-2"></a><span class="st">    </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb878-3"><a href="#cb878-3"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">female =</span> <span class="kw">sum</span>(person_sex <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">na.rm=</span>T), <span class="dt">male =</span> <span class="kw">sum</span>(person_sex <span class="op">==</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">na.rm=</span>T), <span class="dt">n=</span> <span class="kw">n</span>(),</span>
<span id="cb878-4"><a href="#cb878-4"></a>              <span class="dt">unrelated_males =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(person_attractiveness_short_term))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb878-5"><a href="#cb878-5"></a><span class="st">    </span><span class="kw">select</span>(female, male,n, unrelated_males) -&gt;</span>
<span id="cb878-6"><a href="#cb878-6"></a><span class="st">  </span>reported_persons</span></code></pre></div>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## summarise: now 355 rows and 5 columns, ungrouped</code></pre>
<pre><code>## select: dropped one variable (session)</code></pre>
<div class="sourceCode" id="cb882"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb882-1"><a href="#cb882-1"></a><span class="kw">table</span>(reported_persons<span class="op">$</span>unrelated_males <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## 
## FALSE  TRUE 
##    76   279</code></pre>
<div class="sourceCode" id="cb884"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb884-1"><a href="#cb884-1"></a><span class="co"># Kontakt zu 280 Männern </span></span>
<span id="cb884-2"><a href="#cb884-2"></a><span class="co"># qplot(network$person_relationship_to_anchor)</span></span>
<span id="cb884-3"><a href="#cb884-3"></a><span class="co"># was sind die maenner fuer beziehungstypen</span></span>
<span id="cb884-4"><a href="#cb884-4"></a></span>
<span id="cb884-5"><a href="#cb884-5"></a><span class="co"># qplot(network[network$person_sex == 2,]$person_relationship_to_anchor , xlab = &#39;Beziehungsstatus zu Männern&#39;)</span></span>
<span id="cb884-6"><a href="#cb884-6"></a><span class="kw">summary</span>(network<span class="op">$</span>person_relationship_to_anchor)</span></code></pre></div>
<pre><code>##    Length     Class      Mode 
##      2337 character character</code></pre>
<div class="sourceCode" id="cb886"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb886-1"><a href="#cb886-1"></a><span class="co"># 425 Verwandte </span></span>
<span id="cb886-2"><a href="#cb886-2"></a></span>
<span id="cb886-3"><a href="#cb886-3"></a><span class="kw">sort</span>(<span class="kw">table</span>(<span class="kw">na.omit</span>(network<span class="op">$</span>person_kinship)))</span></code></pre></div>
<pre><code>## 
## Ehefrau von meinem Cousen                    eltern                    Eltern                   familie 
##                         1                         1                         1                         1 
##                großeltern               Grossmutter                großmutter                 Großvater 
##                         1                         1                         1                         1 
##                       oma               Schwägerin                Stiefmutter                Stiefvater 
##                         1                         1                         1                         1 
##                Großmutter                     Neffe                       Oma                    Nichte 
##                         2                         2                         3                         4 
##                     Onkel                      Sohn                     Tante                   Tochter 
##                         4                         5                         9                        11 
##                 Cousin(e)                    Bruder                     Vater                 Schwester 
##                        13                        55                        69                        75 
##                    Mutter 
##                       177</code></pre>
<div class="sourceCode" id="cb888"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb888-1"><a href="#cb888-1"></a><span class="co"># qplot(na.omit(haven::as_factor(network$person_kinship))) + coord_flip()</span></span>
<span id="cb888-2"><a href="#cb888-2"></a><span class="co"># qplot(haven::as_factor(network$person_romantic_experience,&quot;both&quot;)) + coord_flip()</span></span>
<span id="cb888-3"><a href="#cb888-3"></a></span>
<span id="cb888-4"><a href="#cb888-4"></a></span>
<span id="cb888-5"><a href="#cb888-5"></a><span class="co"># xtabs(~ person_relationship_to_anchor + person_sex, network)</span></span>
<span id="cb888-6"><a href="#cb888-6"></a></span>
<span id="cb888-7"><a href="#cb888-7"></a></span>
<span id="cb888-8"><a href="#cb888-8"></a></span>
<span id="cb888-9"><a href="#cb888-9"></a>network <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(person_kinship)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, created, person_kinship) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">kinship_cleaned =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.frame</span>() -&gt;<span class="st"> </span>kinship</span></code></pre></div>
<pre><code>## filter: removed 1,896 rows (81%), 441 rows remaining</code></pre>
<pre><code>## select: dropped 29 variables (modified, ended, expired, person_nr, person, …)</code></pre>
<pre><code>## mutate: new variable &#39;kinship_cleaned&#39; with one unique value and 0% NA</code></pre>
<div class="sourceCode" id="cb892"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb892-1"><a href="#cb892-1"></a>writexl<span class="op">::</span><span class="kw">write_xlsx</span>(kinship, <span class="st">&quot;codings/kinship.xlsx&quot;</span>)</span>
<span id="cb892-2"><a href="#cb892-2"></a> kinship_cleaned =<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_xlsx</span>(<span class="st">&quot;codings/kinship_cleaned.xlsx&quot;</span>,<span class="dv">1</span>)</span>
<span id="cb892-3"><a href="#cb892-3"></a> network =<span class="st"> </span>network <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(kinship_cleaned, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span> , <span class="st">&#39;created&#39;</span>))</span></code></pre></div>
<pre><code>## left_join: added 3 columns (person_kinship.x, person_kinship.y, kinship_cleaned)</code></pre>
<pre><code>##            &gt; rows only in x   1,896</code></pre>
<pre><code>##            &gt; rows only in y  (    0)</code></pre>
<pre><code>##            &gt; matched rows       441</code></pre>
<pre><code>##            &gt;                 =======</code></pre>
<pre><code>##            &gt; rows total       2,337</code></pre>
</div>
<div id="code-open-answers-diary" class="section level2">
<h2>Code open answers diary</h2>
<div id="answered-honestly-in-diary" class="section level3">
<h3>Answered honestly in diary</h3>
<div class="sourceCode" id="cb899"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb899-1"><a href="#cb899-1"></a>diary <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(answered_honestly_today <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>, <span class="op">!</span><span class="kw">is.na</span>(dishonest_answers)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, created_diary, dishonest_answers) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">dishonest_discard =</span> <span class="ot">NA_real_</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.frame</span>() -&gt;<span class="st"> </span>dishonest</span></code></pre></div>
<pre><code>## filter (grouped): removed 79,452 rows (&gt;99%), 84 rows remaining</code></pre>
<pre><code>## select: dropped 676 variables (created_date, modified_diary, ended_diary, expired_diary, browser, …)</code></pre>
<pre><code>## mutate (grouped): new variable &#39;dishonest_discard&#39; with one unique value and 100% NA</code></pre>
<div class="sourceCode" id="cb903"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb903-1"><a href="#cb903-1"></a>writexl<span class="op">::</span><span class="kw">write_xlsx</span>(dishonest, <span class="st">&quot;codings/dishonest.xlsx&quot;</span>)</span>
<span id="cb903-2"><a href="#cb903-2"></a></span>
<span id="cb903-3"><a href="#cb903-3"></a>dishonest =<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_xlsx</span>(<span class="st">&quot;codings/dishonest_coded.xlsx&quot;</span>,<span class="dv">1</span>)</span>
<span id="cb903-4"><a href="#cb903-4"></a>diary =<span class="st"> </span>diary <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(dishonest <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>dishonest_answers), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>, <span class="st">&quot;created_diary&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb903-5"><a href="#cb903-5"></a><span class="kw">mutate</span>(<span class="dt">dishonest_discard =</span> <span class="kw">if_else</span>( answered_honestly_today <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb903-6"><a href="#cb903-6"></a>                                    <span class="kw">if_else</span>(dishonest_discard <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dv">0</span>, <span class="dv">0</span> ))</span></code></pre></div>
<pre><code>## select: dropped one variable (dishonest_answers)</code></pre>
<pre><code>## left_join: added one column (dishonest_discard)</code></pre>
<pre><code>##            &gt; rows only in x   79,452</code></pre>
<pre><code>##            &gt; rows only in y  (     0)</code></pre>
<pre><code>##            &gt; matched rows         84</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       79,536</code></pre>
<pre><code>## mutate (grouped): changed 79,452 values (&gt;99%) of &#39;dishonest_discard&#39; (79452 fewer NA)</code></pre>
</div>
</div>
<div id="social-diary" class="section level2">
<h2>Social diary</h2>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb912-1"><a href="#cb912-1"></a><span class="co"># for now, we don&#39;t care whether people were seen or thought about</span></span>
<span id="cb912-2"><a href="#cb912-2"></a>diary_social =<span class="st"> </span>diary <span class="op">%&gt;%</span></span>
<span id="cb912-3"><a href="#cb912-3"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb912-4"><a href="#cb912-4"></a>    <span class="dt">social_life_thought_about =</span> <span class="kw">as.character</span>(social_life_thought_about),</span>
<span id="cb912-5"><a href="#cb912-5"></a>    <span class="dt">social_life_saw_people =</span> <span class="kw">as.character</span>(social_life_saw_people),</span>
<span id="cb912-6"><a href="#cb912-6"></a>    <span class="dt">person =</span> </span>
<span id="cb912-7"><a href="#cb912-7"></a>           <span class="kw">if_else</span>(<span class="kw">is.na</span>(social_life_saw_people),</span>
<span id="cb912-8"><a href="#cb912-8"></a>                   <span class="kw">if_else</span>(<span class="kw">is.na</span>(social_life_thought_about), <span class="ot">NA_character_</span>, social_life_thought_about),</span>
<span id="cb912-9"><a href="#cb912-9"></a>                   <span class="kw">if_else</span>(<span class="kw">is.na</span>(social_life_thought_about), social_life_saw_people, </span>
<span id="cb912-10"><a href="#cb912-10"></a>                           <span class="kw">paste0</span>(social_life_saw_people, <span class="st">&quot;,&quot;</span>, social_life_thought_about))</span>
<span id="cb912-11"><a href="#cb912-11"></a>                   )</span>
<span id="cb912-12"><a href="#cb912-12"></a>           ) <span class="op">%&gt;%</span></span>
<span id="cb912-13"><a href="#cb912-13"></a><span class="st">  </span><span class="kw">separate_rows</span>(person, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb912-14"><a href="#cb912-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">person =</span> stringr<span class="op">::</span><span class="kw">str_trim</span>(person)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb912-15"><a href="#cb912-15"></a><span class="st">  </span><span class="kw">group_by</span>(session, created_diary, person) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb912-16"><a href="#cb912-16"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">row_number</span>() <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb912-17"><a href="#cb912-17"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="co"># brute way of ensuring that there are no duplicated persons</span></span></code></pre></div>
<pre><code>## mutate (grouped): changed 0 values (0%) of &#39;social_life_saw_people&#39; (0 new NA)</code></pre>
<pre><code>##                   changed 0 values (0%) of &#39;social_life_thought_about&#39; (0 new NA)</code></pre>
<pre><code>##                   new variable &#39;person&#39; with 11,975 unique values and 79% NA</code></pre>
<pre><code>## mutate (grouped): changed 638 values (1%) of &#39;person&#39; (0 new NA)</code></pre>
<pre><code>## group_by: 3 grouping variables (session, created_diary, person)</code></pre>
<pre><code>## filter (grouped): removed 16,213 rows (14%), 98,132 rows remaining</code></pre>
<pre><code>## ungroup: no grouping variables</code></pre>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb920-1"><a href="#cb920-1"></a><span class="kw">stopifnot</span>(diary_social <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, created_diary, person) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb920-2"><a href="#cb920-2"></a><span class="st">            </span><span class="kw">group_by</span>(session, created_diary, person) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>() <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## drop_na: removed 47,466 rows (48%), 50,666 rows remaining</code></pre>
<pre><code>## group_by: 3 grouping variables (session, created_diary, person)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
<div id="genderize" class="section level3">
<h3>Genderize</h3>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb924-1"><a href="#cb924-1"></a>unique_names_df =<span class="st"> </span>diary_social <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(person) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(person) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">freq =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(freq)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(person)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">str_length</span>(person) <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span> <span class="op">|</span><span class="st"> </span><span class="kw">str_to_upper</span>(person) <span class="op">!=</span><span class="st"> </span>person)</span></code></pre></div>
<pre><code>## select: dropped 680 variables (session, created_date, created_diary, modified_diary, ended_diary, …)</code></pre>
<pre><code>## group_by: one grouping variable (person)</code></pre>
<pre><code>## summarise: now 5,751 rows and 2 columns, ungrouped</code></pre>
<pre><code>## filter: removed one row (&lt;1%), 5,750 rows remaining</code></pre>
<pre><code>## filter: removed 255 rows (4%), 5,495 rows remaining</code></pre>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb930-1"><a href="#cb930-1"></a><span class="cf">if</span> (<span class="kw">file.exists</span>(<span class="st">&#39;codings/coded_genders.rds&#39;</span>)) {</span>
<span id="cb930-2"><a href="#cb930-2"></a>  genders_df =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&#39;codings/coded_genders.rds&#39;</span>)</span>
<span id="cb930-3"><a href="#cb930-3"></a>} <span class="cf">else</span> {</span>
<span id="cb930-4"><a href="#cb930-4"></a>  <span class="kw">library</span>(genderizeR)</span>
<span id="cb930-5"><a href="#cb930-5"></a>  <span class="kw">Encoding</span>(diary_social<span class="op">$</span>person) =<span class="st"> &quot;UTF-8&quot;</span></span>
<span id="cb930-6"><a href="#cb930-6"></a>  <span class="kw">Encoding</span>(unique_names_df<span class="op">$</span>person) =<span class="st"> &quot;UTF-8&quot;</span></span>
<span id="cb930-7"><a href="#cb930-7"></a>  givenNames =<span class="st"> </span><span class="kw">findGivenNames</span>(unique_names_df<span class="op">$</span>person, <span class="dt">apikey =</span> genderize_apikey) <span class="co"># extract, code possible first names</span></span>
<span id="cb930-8"><a href="#cb930-8"></a>  <span class="kw">Encoding</span>(givenNames<span class="op">$</span>name) =<span class="st"> &quot;UTF-8&quot;</span></span>
<span id="cb930-9"><a href="#cb930-9"></a>  genders =<span class="st"> </span><span class="kw">genderize</span>(unique_names_df<span class="op">$</span>person, givenNames) <span class="co"># assign genders to strings</span></span>
<span id="cb930-10"><a href="#cb930-10"></a>  <span class="kw">Encoding</span>(genders<span class="op">$</span>text) =<span class="st"> &quot;UTF-8&quot;</span></span>
<span id="cb930-11"><a href="#cb930-11"></a>  <span class="kw">Encoding</span>(genders<span class="op">$</span>givenName) =<span class="st"> &quot;UTF-8&quot;</span></span>
<span id="cb930-12"><a href="#cb930-12"></a>  genders_df =<span class="st"> </span><span class="kw">full_join</span>(genders, unique_names_df, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;text&quot;</span> =<span class="st"> &quot;person&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(givenNames <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">firstname_gender =</span> gender), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;givenName&quot;</span> =<span class="st"> &#39;name&#39;</span>))</span>
<span id="cb930-13"><a href="#cb930-13"></a>  <span class="kw">saveRDS</span>(genders_df, <span class="dt">file =</span> <span class="st">&#39;codings/coded_genders.rds&#39;</span>)</span>
<span id="cb930-14"><a href="#cb930-14"></a>}</span>
<span id="cb930-15"><a href="#cb930-15"></a>writexl<span class="op">::</span><span class="kw">write_xlsx</span>(genders_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(freq <span class="op">&gt;</span><span class="st"> </span><span class="dv">30</span>, <span class="kw">is.na</span>(gender)), <span class="st">&quot;codings/genders_to_code.xlsx&quot;</span>)</span></code></pre></div>
<pre><code>## filter: removed 5,430 rows (99%), 65 rows remaining</code></pre>
<div class="sourceCode" id="cb932"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb932-1"><a href="#cb932-1"></a>genders_hand_coded =<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_xlsx</span>(<span class="st">&#39;codings/genders_coded.xlsx&#39;</span>, <span class="dv">1</span>)</span>
<span id="cb932-2"><a href="#cb932-2"></a>genders_df =<span class="st"> </span><span class="kw">bind_rows</span>(genders_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(freq <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span> <span class="op">|</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(gender)), genders_hand_coded)</span></code></pre></div>
<pre><code>## filter: removed 65 rows (1%), 5,430 rows remaining</code></pre>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb934-1"><a href="#cb934-1"></a>genders_df =<span class="st"> </span>genders_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb934-2"><a href="#cb934-2"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>givenName, <span class="op">-</span>genderIndicators, <span class="op">-</span>firstname_gender) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb934-3"><a href="#cb934-3"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">person =</span> text, <span class="dt">person_sex_inferred =</span> gender, <span class="dt">person_name_count =</span> count, <span class="dt">person_name_freq_in_diary =</span> freq, <span class="dt">person_multiple =</span> multiple, <span class="dt">person_is_related_inferred =</span> related) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb934-4"><a href="#cb934-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">person_prob_male =</span> <span class="kw">if_else</span>(person_sex_inferred <span class="op">==</span><span class="st"> &quot;male&quot;</span>, <span class="kw">as.numeric</span>(probability), <span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">as.numeric</span>(probability))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb934-5"><a href="#cb934-5"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>probability)</span></code></pre></div>
<pre><code>## select: dropped 3 variables (givenName, genderIndicators, firstname_gender)</code></pre>
<pre><code>## rename: renamed 6 variables (person, person_sex_inferred, person_name_freq_in_diary, person_name_count, person_multiple, …)</code></pre>
<pre><code>## mutate: new variable &#39;person_prob_male&#39; with 102 unique values and 27% NA</code></pre>
<pre><code>## select: dropped one variable (probability)</code></pre>
<div class="sourceCode" id="cb939"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb939-1"><a href="#cb939-1"></a>diary_social =<span class="st"> </span>diary_social <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(genders_df , <span class="dt">by =</span> <span class="st">&quot;person&quot;</span>)</span></code></pre></div>
<pre><code>## left_join: added 6 columns (person_sex_inferred, person_name_freq_in_diary, person_name_count, person_multiple, person_is_related_inferred, …)</code></pre>
<pre><code>##            &gt; rows only in x   51,141</code></pre>
<pre><code>##            &gt; rows only in y  (     0)</code></pre>
<pre><code>##            &gt; matched rows     46,991</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       98,132</code></pre>
<div class="sourceCode" id="cb946"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb946-1"><a href="#cb946-1"></a><span class="kw">stopifnot</span>(diary_social <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, created_diary, person) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb946-2"><a href="#cb946-2"></a><span class="st">            </span><span class="kw">group_by</span>(session, created_diary, person) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>() <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## drop_na: removed 47,466 rows (48%), 50,666 rows remaining</code></pre>
<pre><code>## group_by: 3 grouping variables (session, created_diary, person)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
</div>
<div id="seenthought-about" class="section level3">
<h3>Seen/thought about</h3>
<div class="sourceCode" id="cb950"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb950-1"><a href="#cb950-1"></a><span class="co"># but we want to make a variable saying whether that person was seen or thought about or both</span></span>
<span id="cb950-2"><a href="#cb950-2"></a><span class="co"># dummy dataset seen</span></span>
<span id="cb950-3"><a href="#cb950-3"></a>seen =<span class="st"> </span>diary <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, social_life_saw_people, created_diary) <span class="op">%&gt;%</span></span>
<span id="cb950-4"><a href="#cb950-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">person =</span> social_life_saw_people, <span class="dt">person_seen =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb950-5"><a href="#cb950-5"></a><span class="st">  </span><span class="kw">separate_rows</span>(person, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb950-6"><a href="#cb950-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">person =</span> stringr<span class="op">::</span><span class="kw">str_trim</span>(person)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb950-7"><a href="#cb950-7"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb950-8"><a href="#cb950-8"></a><span class="st">  </span><span class="kw">select</span>(session, person, created_diary, person_seen) <span class="op">%&gt;%</span></span>
<span id="cb950-9"><a href="#cb950-9"></a><span class="st">  </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb950-10"><a href="#cb950-10"></a><span class="st">  </span><span class="kw">distinct</span>()</span></code></pre></div>
<pre><code>## select: dropped 677 variables (created_date, modified_diary, ended_diary, expired_diary, browser, …)</code></pre>
<pre><code>## mutate (grouped): new variable &#39;person&#39; with 9,467 unique values and 80% NA</code></pre>
<pre><code>##                   new variable &#39;person_seen&#39; with one unique value and 0% NA</code></pre>
<pre><code>## mutate (grouped): changed 483 values (&lt;1%) of &#39;person&#39; (0 new NA)</code></pre>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## select: dropped one variable (social_life_saw_people)</code></pre>
<pre><code>## distinct: removed 13 rows (&lt;1%), 37,934 rows remaining</code></pre>
<div class="sourceCode" id="cb958"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb958-1"><a href="#cb958-1"></a><span class="co"># dummy dataset thought about</span></span>
<span id="cb958-2"><a href="#cb958-2"></a>thought_about =<span class="st"> </span>diary <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(session, social_life_thought_about, created_diary) <span class="op">%&gt;%</span></span>
<span id="cb958-3"><a href="#cb958-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">person =</span> social_life_thought_about, <span class="dt">person_thought_about =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb958-4"><a href="#cb958-4"></a><span class="st">  </span><span class="kw">separate_rows</span>(person, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb958-5"><a href="#cb958-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">person =</span> stringr<span class="op">::</span><span class="kw">str_trim</span>(person)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb958-6"><a href="#cb958-6"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb958-7"><a href="#cb958-7"></a><span class="st">  </span><span class="kw">select</span>(session, person, created_diary, person_thought_about) <span class="op">%&gt;%</span></span>
<span id="cb958-8"><a href="#cb958-8"></a><span class="st">  </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb958-9"><a href="#cb958-9"></a><span class="st">  </span><span class="kw">distinct</span>()</span></code></pre></div>
<pre><code>## select: dropped 677 variables (created_date, modified_diary, ended_diary, expired_diary, browser, …)</code></pre>
<pre><code>## mutate (grouped): new variable &#39;person&#39; with 3,076 unique values and 88% NA</code></pre>
<pre><code>##                   new variable &#39;person_thought_about&#39; with one unique value and 0% NA</code></pre>
<pre><code>## mutate (grouped): changed 155 values (&lt;1%) of &#39;person&#39; (0 new NA)</code></pre>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## select: dropped one variable (social_life_thought_about)</code></pre>
<pre><code>## distinct: removed 4 rows (&lt;1%), 13,577 rows remaining</code></pre>
<div class="sourceCode" id="cb966"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb966-1"><a href="#cb966-1"></a><span class="co"># merge in</span></span>
<span id="cb966-2"><a href="#cb966-2"></a>diary_social =<span class="st"> </span>diary_social <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(seen, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>, <span class="st">&quot;person&quot;</span>, <span class="st">&quot;created_diary&quot;</span>))</span></code></pre></div>
<pre><code>## left_join: added one column (person_seen)</code></pre>
<pre><code>##            &gt; rows only in x   60,198</code></pre>
<pre><code>##            &gt; rows only in y  (     0)</code></pre>
<pre><code>##            &gt; matched rows     37,934</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       98,132</code></pre>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb973-1"><a href="#cb973-1"></a>diary_social =<span class="st"> </span>diary_social <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(thought_about, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>, <span class="st">&quot;person&quot;</span>, <span class="st">&quot;created_diary&quot;</span>))</span></code></pre></div>
<pre><code>## left_join: added one column (person_thought_about)</code></pre>
<pre><code>##            &gt; rows only in x   84,555</code></pre>
<pre><code>##            &gt; rows only in y  (     0)</code></pre>
<pre><code>##            &gt; matched rows     13,577</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       98,132</code></pre>
<div class="sourceCode" id="cb980"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb980-1"><a href="#cb980-1"></a><span class="co"># xtabs(~ person_seen + person_thought_about, diary_social)</span></span>
<span id="cb980-2"><a href="#cb980-2"></a></span>
<span id="cb980-3"><a href="#cb980-3"></a><span class="kw">stopifnot</span>(diary_social <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, created_diary, person) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb980-4"><a href="#cb980-4"></a><span class="st">            </span><span class="kw">group_by</span>(session, created_diary, person) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>() <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## drop_na: removed 47,466 rows (48%), 50,666 rows remaining</code></pre>
<pre><code>## group_by: 3 grouping variables (session, created_diary, person)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
<div class="sourceCode" id="cb984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb984-1"><a href="#cb984-1"></a>network &lt;-<span class="st"> </span>network <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(person))</span></code></pre></div>
<pre><code>## filter: removed 92 rows (4%), 2,245 rows remaining</code></pre>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb986-1"><a href="#cb986-1"></a>diary_social =<span class="st"> </span>diary_social <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(network, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>, <span class="st">&quot;short&quot;</span>, <span class="st">&quot;person&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">interaction_partner =</span> <span class="kw">paste0</span>(short, <span class="st">&quot;_&quot;</span>, person))</span></code></pre></div>
<pre><code>## left_join: added 31 columns (created, modified, ended, expired, person_nr, …)</code></pre>
<pre><code>##            &gt; rows only in x   70,553</code></pre>
<pre><code>##            &gt; rows only in y  (     0)</code></pre>
<pre><code>##            &gt; matched rows     27,579</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       98,132</code></pre>
<pre><code>## mutate: new variable &#39;interaction_partner&#39; with 13,065 unique values and 0% NA</code></pre>
<div class="sourceCode" id="cb994"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb994-1"><a href="#cb994-1"></a>diary_social =<span class="st"> </span>diary_social <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(</span>
<span id="cb994-2"><a href="#cb994-2"></a>  <span class="dt">person_is_related_inferred =</span> <span class="kw">if_else</span>(person_relationship_to_anchor <span class="op">==</span><span class="st"> &quot;biological_relative&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>, </span>
<span id="cb994-3"><a href="#cb994-3"></a>    <span class="kw">if_else</span>(<span class="kw">is.na</span>(person_is_related_inferred), <span class="ot">NA_real_</span>, person_is_related_inferred)),</span>
<span id="cb994-4"><a href="#cb994-4"></a>  <span class="dt">person_is_related_man_inferred =</span> <span class="kw">if_else</span>(<span class="op">!</span><span class="kw">is.na</span>(person_is_related_man), person_is_related_man,</span>
<span id="cb994-5"><a href="#cb994-5"></a>                                           <span class="kw">if_else</span>(person_is_related_inferred <span class="op">&amp;</span><span class="st"> </span>person_sex_inferred <span class="op">==</span><span class="st"> &quot;male&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="ot">NA_real_</span>)),</span>
<span id="cb994-6"><a href="#cb994-6"></a>  <span class="dt">person_is_unrelated_man_inferred =</span> <span class="kw">if_else</span>(<span class="op">!</span><span class="kw">is.na</span>(person_is_unrelated_man), person_is_unrelated_man,</span>
<span id="cb994-7"><a href="#cb994-7"></a>                                           <span class="kw">if_else</span>( <span class="op">!</span>person_is_related_inferred <span class="op">&amp;</span><span class="st"> </span>person_sex_inferred <span class="op">==</span><span class="st"> &quot;male&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="ot">NA_real_</span>))</span>
<span id="cb994-8"><a href="#cb994-8"></a>)</span></code></pre></div>
<pre><code>## mutate: changed 24,668 values (25%) of &#39;person_is_related_inferred&#39; (24659 fewer NA)</code></pre>
<pre><code>##         new variable &#39;person_is_related_man_inferred&#39; with 3 unique values and 63% NA</code></pre>
<pre><code>##         new variable &#39;person_is_unrelated_man_inferred&#39; with 3 unique values and 63% NA</code></pre>
<div class="sourceCode" id="cb998"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb998-1"><a href="#cb998-1"></a><span class="kw">crosstabs</span>(<span class="op">~</span><span class="st"> </span>person_is_related_inferred <span class="op">+</span><span class="st"> </span>person_is_related_man_inferred, diary_social)</span></code></pre></div>
<pre><code>##                           person_is_related_man_inferred
## person_is_related_inferred     0     1  &lt;NA&gt;
##                       0    20500     0     0
##                       1     3947  1684   338
##                       &lt;NA&gt;  9743     0 61920</code></pre>
<div class="sourceCode" id="cb1000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1000-1"><a href="#cb1000-1"></a><span class="kw">stopifnot</span>(diary_social <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, created_diary, person) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb1000-2"><a href="#cb1000-2"></a><span class="st">            </span><span class="kw">group_by</span>(session, created_diary, person) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>() <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## drop_na: removed 47,466 rows (48%), 50,666 rows remaining</code></pre>
<pre><code>## group_by: 3 grouping variables (session, created_diary, person)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
<div class="sourceCode" id="cb1004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1004-1"><a href="#cb1004-1"></a><span class="co"># xtabs(~ person_sex + person_sex_inferred, data = diary_social, exclude = NULL, na.action = na.pass)</span></span>
<span id="cb1004-2"><a href="#cb1004-2"></a></span>
<span id="cb1004-3"><a href="#cb1004-3"></a>diary_social<span class="op">$</span>person_BMI &lt;-<span class="st"> </span>(diary_social<span class="op">$</span>person_weight<span class="op">/</span>((diary_social<span class="op">$</span>person_height<span class="op">/</span><span class="dv">100</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb1004-4"><a href="#cb1004-4"></a></span>
<span id="cb1004-5"><a href="#cb1004-5"></a></span>
<span id="cb1004-6"><a href="#cb1004-6"></a>s4_timespent <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(person_attractiveness_short_term, person_funny, person_financial, person_strength) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">cor</span>(<span class="dt">use =</span> <span class="st">&quot;na.or.complete&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## select: dropped 26 variables (session, created, modified, ended, expired, …)</code></pre>
<pre><code>##                                  person_attractiveness_short_term person_funny person_financial
## person_attractiveness_short_term                             1.00         0.12             0.11
## person_funny                                                 0.12         1.00             0.15
## person_financial                                             0.11         0.15             1.00
## person_strength                                              0.28         0.13             0.06
##                                  person_strength
## person_attractiveness_short_term            0.28
## person_funny                                0.13
## person_financial                            0.06
## person_strength                             1.00</code></pre>
</div>
<div id="nominations-for-conjoint-analysis" class="section level3">
<h3>Nominations for conjoint analysis</h3>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1007-1"><a href="#cb1007-1"></a>diary_social <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(hormonal_contraception, person, session) <span class="op">%&gt;%</span></span>
<span id="cb1007-2"><a href="#cb1007-2"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">seen_fertile =</span> <span class="kw">sum</span>(person_seen <span class="op">&amp;</span><span class="st"> </span>fertile_broad <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.1</span>, <span class="dt">na.rm =</span> T),</span>
<span id="cb1007-3"><a href="#cb1007-3"></a>            <span class="dt">thought_about_fertile =</span> <span class="kw">sum</span>(person_thought_about <span class="op">&amp;</span><span class="st"> </span>fertile_broad <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.1</span>, <span class="dt">na.rm =</span> T),</span>
<span id="cb1007-4"><a href="#cb1007-4"></a>            <span class="dt">seen_infertile =</span> <span class="kw">sum</span>(person_seen <span class="op">&amp;</span><span class="st"> </span>fertile_broad <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.1</span>, <span class="dt">na.rm =</span> T),</span>
<span id="cb1007-5"><a href="#cb1007-5"></a>            <span class="dt">thought_about_infertile =</span> <span class="kw">sum</span>(person_thought_about <span class="op">&amp;</span><span class="st"> </span>fertile_broad <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.1</span>, <span class="dt">na.rm =</span> T)) -&gt;</span>
<span id="cb1007-6"><a href="#cb1007-6"></a><span class="st">  </span>nominations</span></code></pre></div>
<pre><code>## group_by: 3 grouping variables (hormonal_contraception, person, session)</code></pre>
<pre><code>## summarise: now 13,065 rows and 7 columns, 2 group variables remaining (hormonal_contraception, person)</code></pre>
<div class="sourceCode" id="cb1010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1010-1"><a href="#cb1010-1"></a>network_nominations =<span class="st"> </span><span class="kw">inner_join</span>(nominations, s4_timespent, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;session&quot;</span>, <span class="st">&quot;person&quot;</span>))</span></code></pre></div>
<pre><code>## inner_join: added 28 columns (created, modified, ended, expired, person_nr, …)</code></pre>
<pre><code>##             &gt; rows only in x  (10,761)</code></pre>
<pre><code>##             &gt; rows only in y  (     3)</code></pre>
<pre><code>##             &gt; matched rows      2,334    (includes duplicates)</code></pre>
<pre><code>##             &gt;                 ========</code></pre>
<pre><code>##             &gt; rows total        2,334</code></pre>
<div class="sourceCode" id="cb1017"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1017-1"><a href="#cb1017-1"></a><span class="kw">stopifnot</span>(diary_social <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, created_diary, person) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb1017-2"><a href="#cb1017-2"></a><span class="st">            </span><span class="kw">group_by</span>(session, created_diary, person) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>() <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## drop_na: removed 47,466 rows (48%), 50,666 rows remaining</code></pre>
<pre><code>## group_by: 3 grouping variables (session, created_diary, person)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
</div>
</div>
<div id="sex-dummy-variables" class="section level2">
<h2>Sex dummy variables</h2>
<div class="sourceCode" id="cb1021"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1021-1"><a href="#cb1021-1"></a><span class="co"># get choice labels in english</span></span>
<span id="cb1021-2"><a href="#cb1021-2"></a>choices &lt;-<span class="st"> </span>rio<span class="op">::</span><span class="kw">import</span>(<span class="st">&quot;https://docs.google.com/spreadsheets/d/1Xo4fRvIzPYbWibVgJ9nm7vES39DSAWQBztnB8j7PdIo/edit#gid=1837266155&quot;</span>)</span>
<span id="cb1021-3"><a href="#cb1021-3"></a></span>
<span id="cb1021-4"><a href="#cb1021-4"></a>sex_acts_in_diary &lt;-<span class="st"> </span>diary <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">drop_na</span>(short, created_diary) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">acts =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(sex_<span class="dv">1</span>_time)) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(sex_<span class="dv">2</span>_time))) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(acts)</span></code></pre></div>
<pre><code>## drop_na (grouped): removed 16,870 rows (21%), 62,666 rows remaining</code></pre>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## summarise: now one row and one column, ungrouped</code></pre>
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1025-1"><a href="#cb1025-1"></a>sex_long &lt;-<span class="st"> </span>diary <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1025-2"><a href="#cb1025-2"></a><span class="st">  </span><span class="kw">drop_na</span>(short, created_diary) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1025-3"><a href="#cb1025-3"></a><span class="st">  </span><span class="kw">group_by</span>(short) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1025-4"><a href="#cb1025-4"></a><span class="st">  </span><span class="kw">select</span>(short, created_diary, <span class="kw">matches</span>(<span class="st">&quot;^sex_</span><span class="ch">\\</span><span class="st">d&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1025-5"><a href="#cb1025-5"></a><span class="st">  </span><span class="kw">gather</span>(key, value, <span class="kw">matches</span>(<span class="st">&quot;^sex_</span><span class="ch">\\</span><span class="st">d&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1025-6"><a href="#cb1025-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> <span class="kw">str_sub</span>(key, <span class="dv">5</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1025-7"><a href="#cb1025-7"></a><span class="st">  </span><span class="kw">separate</span>(key, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;sex_nr&quot;</span>, <span class="st">&quot;key&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>, <span class="dt">extra =</span> <span class="st">&quot;merge&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1025-8"><a href="#cb1025-8"></a><span class="st">  </span><span class="kw">spread</span>(key, value, <span class="dt">convert =</span> T) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1025-9"><a href="#cb1025-9"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1025-10"><a href="#cb1025-10"></a><span class="st">  </span></span>
<span id="cb1025-11"><a href="#cb1025-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sex_active =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(time), <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1025-12"><a href="#cb1025-12"></a>         <span class="dt">sex_active_solo =</span> <span class="kw">if_else</span>(withwhom <span class="op">==</span><span class="st"> &quot;alleine&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1025-13"><a href="#cb1025-13"></a>         <span class="dt">sex_active_partnered =</span> <span class="kw">if_else</span>(withwhom <span class="op">!=</span><span class="st"> &quot;alleine&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1025-14"><a href="#cb1025-14"></a><span class="st">  </span></span>
<span id="cb1025-15"><a href="#cb1025-15"></a><span class="st">  </span><span class="kw">filter</span>(sex_active <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## drop_na (grouped): removed 16,870 rows (21%), 62,666 rows remaining</code></pre>
<pre><code>## group_by: one grouping variable (short)</code></pre>
<pre><code>## select: dropped 660 variables (session, created_date, modified_diary, ended_diary, expired_diary, …)</code></pre>
<pre><code>## gather: reorganized (sex_1_time, sex_1_withwhom, sex_1_activity, sex_1_contraception, sex_1_happy, …) into (key, value) [was 62666x20, now 1127988x4]</code></pre>
<pre><code>## mutate (grouped): changed 1,127,988 values (100%) of &#39;key&#39; (0 new NA)</code></pre>
<pre><code>## spread: reorganized (key, value) into (activity, contraception, enjoyed, fantasy_actions, fantasy_partner, …) [was 1127988x5, now 125332x12]</code></pre>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## mutate: new variable &#39;sex_active&#39; with 2 unique values and 0% NA</code></pre>
<pre><code>##         new variable &#39;sex_active_solo&#39; with 3 unique values and 81% NA</code></pre>
<pre><code>##         new variable &#39;sex_active_partnered&#39; with 3 unique values and 81% NA</code></pre>
<pre><code>## filter: removed 101,207 rows (81%), 24,125 rows remaining</code></pre>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="#cb1037-1"></a>to_code_sex_acts &lt;-<span class="st"> </span>sex_long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1037-2"><a href="#cb1037-2"></a><span class="st">  </span><span class="kw">separate_rows</span>(activity, <span class="dt">convert =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1037-3"><a href="#cb1037-3"></a><span class="st">  </span><span class="kw">left_join</span>(choices <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="dt">activity =</span> label, <span class="dt">activity_en =</span> name) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1037-4"><a href="#cb1037-4"></a><span class="st">  </span><span class="kw">bind_rows</span>(</span>
<span id="cb1037-5"><a href="#cb1037-5"></a>    sex_long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1037-6"><a href="#cb1037-6"></a><span class="st">    </span><span class="kw">select</span>(fantasy_actions) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1037-7"><a href="#cb1037-7"></a><span class="st">    </span><span class="kw">separate_rows</span>(fantasy_actions, <span class="dt">convert =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1037-8"><a href="#cb1037-8"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">activity =</span> fantasy_actions) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1037-9"><a href="#cb1037-9"></a><span class="st">    </span><span class="kw">left_join</span>(choices <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="dt">activity =</span> label, <span class="dt">activity_en =</span> name) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>())) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1037-10"><a href="#cb1037-10"></a><span class="st">  </span><span class="kw">drop_na</span>(activity) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1037-11"><a href="#cb1037-11"></a><span class="st">  </span><span class="kw">group_by</span>(activity) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1037-12"><a href="#cb1037-12"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>(), <span class="dt">activity_en =</span> <span class="kw">first</span>(activity_en)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1037-13"><a href="#cb1037-13"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1037-14"><a href="#cb1037-14"></a><span class="st">  </span><span class="kw">select</span>(n, activity, activity_en)</span></code></pre></div>
<pre><code>## select: renamed 2 variables (activity, activity_en) and dropped 3 variables</code></pre>
<pre><code>## distinct: removed 35 rows (19%), 146 rows remaining</code></pre>
<pre><code>## Joining, by = &quot;activity&quot;</code></pre>
<pre><code>## left_join: added one column (activity_en)</code></pre>
<pre><code>##            &gt; rows only in x       83</code></pre>
<pre><code>##            &gt; rows only in y  (   133)</code></pre>
<pre><code>##            &gt; matched rows     51,069</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       51,152</code></pre>
<pre><code>## select: dropped 14 variables (short, created_diary, sex_nr, activity, contraception, …)</code></pre>
<pre><code>## rename: renamed one variable (activity)</code></pre>
<pre><code>## select: renamed 2 variables (activity, activity_en) and dropped 3 variables</code></pre>
<pre><code>## distinct: removed 35 rows (19%), 146 rows remaining</code></pre>
<pre><code>## Joining, by = &quot;activity&quot;</code></pre>
<pre><code>## left_join: added one column (activity_en)</code></pre>
<pre><code>##            &gt; rows only in x   15,306</code></pre>
<pre><code>##            &gt; rows only in y  (   132)</code></pre>
<pre><code>##            &gt; matched rows     14,493</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       29,799</code></pre>
<pre><code>## drop_na: removed 15,231 rows (19%), 65,720 rows remaining</code></pre>
<pre><code>## group_by: one grouping variable (activity)</code></pre>
<pre><code>## summarise: now 121 rows and 3 columns, ungrouped</code></pre>
<pre><code>## select: columns reordered (n, activity, activity_en)</code></pre>
<div class="sourceCode" id="cb1062"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1062-1"><a href="#cb1062-1"></a>writexl<span class="op">::</span><span class="kw">write_xlsx</span>(to_code_sex_acts, <span class="st">&quot;codings/to_code_sex_acts.xlsx&quot;</span>)</span>
<span id="cb1062-2"><a href="#cb1062-2"></a>to_code_sex_acts =<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_xlsx</span>(<span class="st">&quot;codings/to_code_sex_acts_coded.xlsx&quot;</span>,<span class="dv">1</span>)</span>
<span id="cb1062-3"><a href="#cb1062-3"></a></span>
<span id="cb1062-4"><a href="#cb1062-4"></a>to_code_sex_partners &lt;-<span class="st"> </span>sex_long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1062-5"><a href="#cb1062-5"></a><span class="st">  </span><span class="kw">separate_rows</span>(withwhom, <span class="dt">convert =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1062-6"><a href="#cb1062-6"></a><span class="st">  </span><span class="kw">left_join</span>(choices <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="dt">withwhom =</span> label_parsed, <span class="dt">withwhom_en =</span> name) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1062-7"><a href="#cb1062-7"></a><span class="st">  </span><span class="kw">drop_na</span>(withwhom) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1062-8"><a href="#cb1062-8"></a><span class="st">  </span><span class="kw">group_by</span>(withwhom) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1062-9"><a href="#cb1062-9"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>(), <span class="dt">withwhom_en =</span> <span class="kw">first</span>(withwhom_en)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1062-10"><a href="#cb1062-10"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1062-11"><a href="#cb1062-11"></a><span class="st">  </span><span class="kw">select</span>(n, withwhom, withwhom_en)</span></code></pre></div>
<pre><code>## select: renamed 2 variables (withwhom, withwhom_en) and dropped 3 variables</code></pre>
<pre><code>## distinct: removed 51 rows (28%), 130 rows remaining</code></pre>
<pre><code>## Joining, by = &quot;withwhom&quot;</code></pre>
<pre><code>## left_join: added one column (withwhom_en)</code></pre>
<pre><code>##            &gt; rows only in x      230</code></pre>
<pre><code>##            &gt; rows only in y  (   125)</code></pre>
<pre><code>##            &gt; matched rows     23,994</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       24,224</code></pre>
<pre><code>## drop_na: removed one row (&lt;1%), 24,223 rows remaining</code></pre>
<pre><code>## group_by: one grouping variable (withwhom)</code></pre>
<pre><code>## summarise: now 100 rows and 3 columns, ungrouped</code></pre>
<pre><code>## select: columns reordered (n, withwhom, withwhom_en)</code></pre>
<div class="sourceCode" id="cb1076"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1076-1"><a href="#cb1076-1"></a>writexl<span class="op">::</span><span class="kw">write_xlsx</span>(to_code_sex_partners, <span class="st">&quot;codings/to_code_sex_partners.xlsx&quot;</span>)</span>
<span id="cb1076-2"><a href="#cb1076-2"></a>to_code_sex_partners =<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_xlsx</span>(<span class="st">&quot;codings/to_code_sex_partners_coded.xlsx&quot;</span>,<span class="dv">1</span>)</span>
<span id="cb1076-3"><a href="#cb1076-3"></a></span>
<span id="cb1076-4"><a href="#cb1076-4"></a>sex_long &lt;-<span class="st"> </span>sex_long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-5"><a href="#cb1076-5"></a><span class="st">  </span></span>
<span id="cb1076-6"><a href="#cb1076-6"></a><span class="st">  </span><span class="kw">separate_rows</span>(contraception, <span class="dt">convert =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;, &quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-7"><a href="#cb1076-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">contraception =</span> <span class="kw">str_c</span>(<span class="st">&quot;sex_contraception_&quot;</span>, <span class="kw">if_else</span>(<span class="kw">is.na</span>(contraception)</span>
<span id="cb1076-8"><a href="#cb1076-8"></a>                                                    <span class="op">&amp;</span><span class="st"> </span>sex_active <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;not_necessary&quot;</span>, contraception)),</span>
<span id="cb1076-9"><a href="#cb1076-9"></a>         <span class="dt">dummy =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-10"><a href="#cb1076-10"></a><span class="st">  </span><span class="co"># distinct() %&gt;% </span></span>
<span id="cb1076-11"><a href="#cb1076-11"></a><span class="st">  </span><span class="kw">spread</span>(contraception, dummy, <span class="dt">fill =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-12"><a href="#cb1076-12"></a></span>
<span id="cb1076-13"><a href="#cb1076-13"></a><span class="st">  </span></span>
<span id="cb1076-14"><a href="#cb1076-14"></a><span class="st">  </span><span class="kw">separate_rows</span>(activity, <span class="dt">convert =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-15"><a href="#cb1076-15"></a><span class="st">  </span><span class="kw">left_join</span>(to_code_sex_acts <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(activity, activity_en)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-16"><a href="#cb1076-16"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">activity =</span> <span class="kw">str_c</span>(<span class="st">&quot;sex_activity_&quot;</span>, <span class="kw">if_else</span>(<span class="kw">is.na</span>(activity_en)</span>
<span id="cb1076-17"><a href="#cb1076-17"></a>                                                    <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(activity), <span class="st">&quot;other&quot;</span>, activity_en)),</span>
<span id="cb1076-18"><a href="#cb1076-18"></a>         <span class="dt">dummy =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-19"><a href="#cb1076-19"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>activity_en) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-20"><a href="#cb1076-20"></a><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-21"><a href="#cb1076-21"></a><span class="st">  </span><span class="kw">spread</span>(activity, dummy, <span class="dt">fill =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-22"><a href="#cb1076-22"></a><span class="st">  </span></span>
<span id="cb1076-23"><a href="#cb1076-23"></a><span class="st">  </span></span>
<span id="cb1076-24"><a href="#cb1076-24"></a><span class="st">  </span><span class="kw">separate_rows</span>(withwhom, <span class="dt">convert =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-25"><a href="#cb1076-25"></a><span class="st">  </span><span class="kw">left_join</span>(to_code_sex_partners <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(withwhom, withwhom_en)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-26"><a href="#cb1076-26"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">withwhom =</span> <span class="kw">str_c</span>(<span class="st">&quot;sex_&quot;</span>, <span class="kw">if_else</span>(<span class="kw">is.na</span>(withwhom_en)</span>
<span id="cb1076-27"><a href="#cb1076-27"></a>                                                    <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(withwhom), <span class="st">&quot;other&quot;</span>, withwhom_en)),</span>
<span id="cb1076-28"><a href="#cb1076-28"></a>         <span class="dt">dummy =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-29"><a href="#cb1076-29"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>withwhom_en) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-30"><a href="#cb1076-30"></a><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-31"><a href="#cb1076-31"></a><span class="st">  </span><span class="kw">spread</span>(withwhom, dummy, <span class="dt">fill =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-32"><a href="#cb1076-32"></a><span class="st">  </span></span>
<span id="cb1076-33"><a href="#cb1076-33"></a><span class="st">  </span><span class="kw">separate_rows</span>(fantasy_actions, <span class="dt">convert =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-34"><a href="#cb1076-34"></a><span class="st">  </span><span class="kw">left_join</span>(to_code_sex_acts <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="dt">fantasy_actions =</span> activity, <span class="dt">fantasy_actions_en =</span> activity_en)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-35"><a href="#cb1076-35"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fantasy_actions =</span> <span class="kw">str_c</span>(<span class="st">&quot;sex_fantasy_act_&quot;</span>, <span class="kw">if_else</span>(<span class="kw">is.na</span>(fantasy_actions_en)</span>
<span id="cb1076-36"><a href="#cb1076-36"></a>                                                    <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(fantasy_actions), <span class="st">&quot;other&quot;</span>, fantasy_actions_en)),</span>
<span id="cb1076-37"><a href="#cb1076-37"></a>         <span class="dt">dummy =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-38"><a href="#cb1076-38"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>fantasy_actions_en) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-39"><a href="#cb1076-39"></a><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-40"><a href="#cb1076-40"></a><span class="st">  </span><span class="kw">spread</span>(fantasy_actions, dummy, <span class="dt">fill =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-41"><a href="#cb1076-41"></a><span class="st">  </span></span>
<span id="cb1076-42"><a href="#cb1076-42"></a><span class="st">  </span><span class="kw">separate_rows</span>(fantasy_partner, <span class="dt">convert =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;, &quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-43"><a href="#cb1076-43"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fantasy_partner =</span> <span class="kw">str_c</span>(<span class="st">&quot;sex_fantasy_about_&quot;</span>, fantasy_partner),</span>
<span id="cb1076-44"><a href="#cb1076-44"></a>         <span class="dt">dummy =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-45"><a href="#cb1076-45"></a><span class="st">  </span><span class="kw">spread</span>(fantasy_partner, dummy, <span class="dt">fill =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1076-46"><a href="#cb1076-46"></a><span class="st">  </span></span>
<span id="cb1076-47"><a href="#cb1076-47"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="st">`</span><span class="dt">&lt;NA&gt;</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## mutate: changed 26,234 values (100%) of &#39;contraception&#39; (8896 fewer NA)</code></pre>
<pre><code>##         new variable &#39;dummy&#39; with one unique value and 0% NA</code></pre>
<pre><code>## spread: reorganized (contraception, dummy) into (sex_contraception_coitus_interruptus, sex_contraception_condom, sex_contraception_counted_days, sex_contraception_diaphragm, sex_contraception_did_not_want, …) [was 26234x16, now 24125x23]</code></pre>
<pre><code>## select: dropped one variable (n)</code></pre>
<pre><code>## Joining, by = &quot;activity&quot;</code></pre>
<pre><code>## left_join: added one column (activity_en)</code></pre>
<pre><code>##            &gt; rows only in x       20</code></pre>
<pre><code>##            &gt; rows only in y  (    72)</code></pre>
<pre><code>##            &gt; matched rows     60,347    (includes duplicates)</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       60,367</code></pre>
<pre><code>## mutate: changed 60,366 values (&gt;99%) of &#39;activity&#39; (0 new NA)</code></pre>
<pre><code>##         new variable &#39;dummy&#39; with one unique value and 0% NA</code></pre>
<pre><code>## select: dropped one variable (activity_en)</code></pre>
<pre><code>## distinct: removed 9,219 rows (15%), 51,148 rows remaining</code></pre>
<pre><code>## spread: reorganized (activity, dummy) into (sex_activity_anal_sex, sex_activity_bdsm_dom, sex_activity_bdsm_sub, sex_activity_cuddling, sex_activity_cunnilingus, …) [was 51148x24, now 24125x42]</code></pre>
<pre><code>## select: dropped one variable (n)</code></pre>
<pre><code>## Joining, by = &quot;withwhom&quot;</code></pre>
<pre><code>## left_join: added one column (withwhom_en)</code></pre>
<pre><code>##            &gt; rows only in x       30</code></pre>
<pre><code>##            &gt; rows only in y  (     8)</code></pre>
<pre><code>##            &gt; matched rows     24,220    (includes duplicates)</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       24,250</code></pre>
<pre><code>## mutate: changed 24,249 values (&gt;99%) of &#39;withwhom&#39; (0 new NA)</code></pre>
<pre><code>##         new variable &#39;dummy&#39; with one unique value and 0% NA</code></pre>
<pre><code>## select: dropped one variable (withwhom_en)</code></pre>
<pre><code>## distinct: removed 43 rows (&lt;1%), 24,207 rows remaining</code></pre>
<pre><code>## spread: reorganized (withwhom, dummy) into (sex_other, sex_solo, sex_unclear, sex_with_other_female, sex_with_other_male, …) [was 24207x43, now 24125x48]</code></pre>
<pre><code>## select: renamed 2 variables (fantasy_actions, fantasy_actions_en) and dropped one variable</code></pre>
<pre><code>## Joining, by = &quot;fantasy_actions&quot;</code></pre>
<pre><code>## left_join: added one column (fantasy_actions_en)</code></pre>
<pre><code>##            &gt; rows only in x   15,241</code></pre>
<pre><code>##            &gt; rows only in y  (    52)</code></pre>
<pre><code>##            &gt; matched rows     19,368    (includes duplicates)</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       34,609</code></pre>
<pre><code>## mutate: changed 19,379 values (56%) of &#39;fantasy_actions&#39; (0 new NA)</code></pre>
<pre><code>##         new variable &#39;dummy&#39; with one unique value and 0% NA</code></pre>
<pre><code>## select: dropped one variable (fantasy_actions_en)</code></pre>
<pre><code>## distinct: removed 4,812 rows (14%), 29,797 rows remaining</code></pre>
<pre><code>## spread: reorganized (fantasy_actions, dummy) into (sex_fantasy_act_anal_sex, sex_fantasy_act_bdsm_dom, sex_fantasy_act_bdsm_sub, sex_fantasy_act_bdsm_watch, sex_fantasy_act_cuddling, …) [was 29797x49, now 24125x79]</code></pre>
<pre><code>## mutate: changed 12,482 values (45%) of &#39;fantasy_partner&#39; (0 new NA)</code></pre>
<pre><code>##         new variable &#39;dummy&#39; with one unique value and 0% NA</code></pre>
<pre><code>## spread: reorganized (fantasy_partner, dummy) into (sex_fantasy_about_another_man_known, sex_fantasy_about_another_man_media, sex_fantasy_about_another_woman_known, sex_fantasy_about_another_woman_media, sex_fantasy_about_man_pornography, …) [was 27712x80, now 24125x87]</code></pre>
<pre><code>## select: dropped one variable (&lt;NA&gt;)</code></pre>
<div class="sourceCode" id="cb1123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1123-1"><a href="#cb1123-1"></a>sex_long<span class="op">$</span>sex_activities &lt;-<span class="st"> </span><span class="kw">rowSums</span>(sex_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;sex_activity_&quot;</span>)))</span></code></pre></div>
<pre><code>## select: dropped 67 variables (short, created_diary, sex_nr, enjoyed, happy, …)</code></pre>
<div class="sourceCode" id="cb1125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1125-1"><a href="#cb1125-1"></a>sex_long &lt;-<span class="st"> </span>sex_long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1125-2"><a href="#cb1125-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sex_active_sexual =</span> <span class="kw">if_else</span>((sex_activities <span class="op">-</span><span class="st"> </span>sex_activity_cuddling <span class="op">-</span><span class="st"> </span>sex_activity_kissing <span class="op">-</span><span class="st"> </span>sex_activity_cybersex <span class="op">-</span><span class="st"> </span>sex_activity_dirty_talk <span class="op">-</span><span class="st"> </span>sex_activity_other <span class="op">-</span><span class="st"> </span>sex_activity_pornography  <span class="op">-</span><span class="st"> </span>sex_activity_touch_other <span class="op">-</span><span class="st"> </span>sex_activity_unclear)  <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1125-3"><a href="#cb1125-3"></a>         <span class="dt">sex_active_partnered =</span> <span class="kw">if_else</span>(sex_active_partnered <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>sex_active_sexual <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## mutate: changed 3,125 values (13%) of &#39;sex_active_partnered&#39; (1 fewer NA)</code></pre>
<pre><code>##         new variable &#39;sex_active_sexual&#39; with 2 unique values and 0% NA</code></pre>
<div class="sourceCode" id="cb1128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1128-1"><a href="#cb1128-1"></a>sex_long &lt;-<span class="st"> </span>sex_long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1128-2"><a href="#cb1128-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">created_date =</span> <span class="kw">if_else</span>(time <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;t0_yesterday_evening&quot;</span>, <span class="st">&quot;t1_before_falling_asleep&quot;</span>, <span class="st">&quot;t2_night_time&quot;</span>),</span>
<span id="cb1128-3"><a href="#cb1128-3"></a>           <span class="kw">as.Date</span>(created_diary <span class="op">-</span><span class="st"> </span><span class="kw">hours</span>(<span class="dv">6</span>)) <span class="op">-</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">1</span>),</span>
<span id="cb1128-4"><a href="#cb1128-4"></a>           <span class="kw">as.Date</span>(created_diary <span class="op">-</span><span class="st"> </span><span class="kw">hours</span>(<span class="dv">6</span>)))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1128-5"><a href="#cb1128-5"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb1128-6"><a href="#cb1128-6"></a>    <span class="dt">time_nonmoved =</span> time,</span>
<span id="cb1128-7"><a href="#cb1128-7"></a>    <span class="dt">time =</span> <span class="kw">recode</span>(time, <span class="st">&quot;t0_yesterday_evening&quot;</span> =<span class="st"> &quot;t6_evening&quot;</span>,</span>
<span id="cb1128-8"><a href="#cb1128-8"></a>                       <span class="st">&quot;t1_before_falling_asleep&quot;</span> =<span class="st"> &quot;t7_before_falling_asleep&quot;</span>,</span>
<span id="cb1128-9"><a href="#cb1128-9"></a>                       <span class="st">&quot;t2_night_time&quot;</span> =<span class="st"> &quot;t8_night_time&quot;</span>))</span></code></pre></div>
<pre><code>## mutate: new variable &#39;created_date&#39; with 311 unique values and 0% NA</code></pre>
<pre><code>## mutate: changed 11,782 values (49%) of &#39;time&#39; (0 new NA)</code></pre>
<pre><code>##         new variable &#39;time_nonmoved&#39; with 7 unique values and 0% NA</code></pre>
<div class="sourceCode" id="cb1132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1132-1"><a href="#cb1132-1"></a>sex_summary &lt;-<span class="st"> </span>sex_long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1132-2"><a href="#cb1132-2"></a><span class="st">  </span><span class="kw">group_by</span>(short, created_date) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1132-3"><a href="#cb1132-3"></a><span class="st">  </span><span class="co"># group_by(short, created_date) %&gt;% </span></span>
<span id="cb1132-4"><a href="#cb1132-4"></a><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(enjoyed<span class="op">:</span>partner_enjoyed), <span class="kw">funs</span>(<span class="kw">mean</span>(., <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1132-5"><a href="#cb1132-5"></a><span class="st">  </span><span class="kw">left_join</span>(</span>
<span id="cb1132-6"><a href="#cb1132-6"></a>    sex_long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1132-7"><a href="#cb1132-7"></a><span class="st">      </span><span class="kw">group_by</span>(short, created_date) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1132-8"><a href="#cb1132-8"></a><span class="st">      </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(sex_active<span class="op">:</span>sex_active_sexual), <span class="kw">funs</span>(max))</span>
<span id="cb1132-9"><a href="#cb1132-9"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1132-10"><a href="#cb1132-10"></a><span class="st">  </span><span class="kw">left_join</span>(</span>
<span id="cb1132-11"><a href="#cb1132-11"></a>    sex_long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1132-12"><a href="#cb1132-12"></a><span class="st">      </span><span class="kw">group_by</span>(short, created_date) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1132-13"><a href="#cb1132-13"></a><span class="st">      </span><span class="kw">summarise</span>(<span class="dt">sex_time =</span> <span class="kw">if_else</span>(<span class="kw">n</span>() <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="kw">first</span>(time), <span class="st">&quot;multiple&quot;</span>))</span>
<span id="cb1132-14"><a href="#cb1132-14"></a>  )</span></code></pre></div>
<pre><code>## group_by: 2 grouping variables (short, created_date)</code></pre>
<pre><code>## summarise_at: now 19,528 rows and 5 columns, one group variable remaining (short)</code></pre>
<pre><code>## group_by: 2 grouping variables (short, created_date)</code></pre>
<pre><code>## summarise_at: now 19,528 rows and 83 columns, one group variable remaining (short)</code></pre>
<pre><code>## Joining, by = c(&quot;short&quot;, &quot;created_date&quot;)</code></pre>
<pre><code>## left_join: added 81 columns (sex_active, sex_active_solo, sex_active_partnered, sex_contraception_coitus_interruptus, sex_contraception_condom, …)</code></pre>
<pre><code>##            &gt; rows only in x        0</code></pre>
<pre><code>##            &gt; rows only in y  (     0)</code></pre>
<pre><code>##            &gt; matched rows     19,528</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       19,528</code></pre>
<pre><code>## group_by: 2 grouping variables (short, created_date)</code></pre>
<pre><code>## summarise: now 19,528 rows and 3 columns, one group variable remaining (short)</code></pre>
<pre><code>## Joining, by = c(&quot;short&quot;, &quot;created_date&quot;)</code></pre>
<pre><code>## left_join: added one column (sex_time)</code></pre>
<pre><code>##            &gt; rows only in x        0</code></pre>
<pre><code>##            &gt; rows only in y  (     0)</code></pre>
<pre><code>##            &gt; matched rows     19,528</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       19,528</code></pre>
<div class="sourceCode" id="cb1153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1153-1"><a href="#cb1153-1"></a><span class="co"># </span></span>
<span id="cb1153-2"><a href="#cb1153-2"></a><span class="co"># </span></span>
<span id="cb1153-3"><a href="#cb1153-3"></a><span class="co"># sex_summary &lt;- sex_long %&gt;%</span></span>
<span id="cb1153-4"><a href="#cb1153-4"></a><span class="co">#   group_by(short, created_diary) %&gt;%</span></span>
<span id="cb1153-5"><a href="#cb1153-5"></a><span class="co">#   # group_by(short, created_date) %&gt;%</span></span>
<span id="cb1153-6"><a href="#cb1153-6"></a><span class="co">#   summarise_at(vars(enjoyed:partner_enjoyed), funs(mean(., na.rm = TRUE))) %&gt;%</span></span>
<span id="cb1153-7"><a href="#cb1153-7"></a><span class="co">#   left_join(</span></span>
<span id="cb1153-8"><a href="#cb1153-8"></a><span class="co">#     sex_long %&gt;%</span></span>
<span id="cb1153-9"><a href="#cb1153-9"></a><span class="co">#       group_by(short, created_diary) %&gt;%</span></span>
<span id="cb1153-10"><a href="#cb1153-10"></a><span class="co">#       summarise_at(vars(sex_active:sex_active_sexual), funs(max))</span></span>
<span id="cb1153-11"><a href="#cb1153-11"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb1153-12"><a href="#cb1153-12"></a><span class="co">#   left_join(</span></span>
<span id="cb1153-13"><a href="#cb1153-13"></a><span class="co">#     sex_long %&gt;%</span></span>
<span id="cb1153-14"><a href="#cb1153-14"></a><span class="co">#       group_by(short, created_diary) %&gt;%</span></span>
<span id="cb1153-15"><a href="#cb1153-15"></a><span class="co">#       summarise(sex_time = if_else(n() == 1, first(time), &quot;multiple&quot;))</span></span>
<span id="cb1153-16"><a href="#cb1153-16"></a><span class="co">#   )</span></span>
<span id="cb1153-17"><a href="#cb1153-17"></a></span>
<span id="cb1153-18"><a href="#cb1153-18"></a>diary &lt;-<span class="st"> </span>diary <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1153-19"><a href="#cb1153-19"></a><span class="st">  </span><span class="kw">left_join</span>(sex_summary <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>sex_active), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;short&quot;</span>, <span class="st">&quot;created_date&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1153-20"><a href="#cb1153-20"></a><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(sex_active_solo<span class="op">:</span>sex_active_sexual), <span class="kw">funs</span>(<span class="kw">if_na</span>(., <span class="dv">0</span>)))</span></code></pre></div>
<pre><code>## select: dropped one variable (sex_active)</code></pre>
<pre><code>## left_join: added 84 columns (enjoyed, happy, partner_enjoyed, sex_active_solo, sex_active_partnered, …)</code></pre>
<pre><code>##            &gt; rows only in x   60,316</code></pre>
<pre><code>##            &gt; rows only in y  (   308)</code></pre>
<pre><code>##            &gt; matched rows     19,220</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       79,536</code></pre>
<pre><code>## mutate_at (grouped): changed 60,317 values (76%) of &#39;sex_active_solo&#39; (60317 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_active_partnered&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_contraception_coitus_interruptus&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_contraception_condom&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_contraception_counted_days&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_contraception_diaphragm&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_contraception_did_not_want&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_contraception_long_term&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_contraception_not_necessary&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_contraception_risked_it&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_contraception_spermicide&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_anal_sex&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_bdsm_dom&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_bdsm_sub&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_cuddling&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_cunnilingus&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_cybersex&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_dirty_talk&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_fellatio&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_kissing&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_masturbated_by_partner&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_masturbated_partner&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_masturbation&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_other&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_phone_skype_sex&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_pornography&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_sex&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_touch_other&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_toys&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activity_unclear&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_other&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_solo&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_unclear&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_with_other_female&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_with_other_male&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_with_partner&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_with_partner_tele&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_anal_sex&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_bdsm_dom&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_bdsm_sub&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_bdsm_watch&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_cuddling&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_cunnilingus&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_dirty_talk&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_double_penetration&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_face_image&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_fellatio&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_group_sex&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_kissing&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_lesbian_sex&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_male_male_fellatio&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_masturbated_by_partner&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_masturbated_partner&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_masturbation&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_nothing_particular&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_oral_sex&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_other&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_partner_masturbated_self&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_phone_skype_sex&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_pornography&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_rape_fantasy&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_sex&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_solo&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_threesome&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_touch_other&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_toys&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_unclear&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_voyeurism_watched&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_act_voyeurism_watcher&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_about_another_man_known&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_about_another_man_media&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_about_another_woman_known&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_about_another_woman_media&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_about_man_pornography&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_about_nobody_in_particular&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_about_not_concrete&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_about_partner&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_fantasy_about_woman_pornography&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_activities&#39; (60316 fewer NA)</code></pre>
<pre><code>##                      changed 60,316 values (76%) of &#39;sex_active_sexual&#39; (60316 fewer NA)</code></pre>
<div class="sourceCode" id="cb1241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1241-1"><a href="#cb1241-1"></a>diary &lt;-<span class="st"> </span>diary <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1241-2"><a href="#cb1241-2"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">sex_happy =</span> happy,</span>
<span id="cb1241-3"><a href="#cb1241-3"></a>         <span class="dt">sex_enjoyed =</span> enjoyed,</span>
<span id="cb1241-4"><a href="#cb1241-4"></a>         <span class="dt">sex_partner_enjoyed =</span> partner_enjoyed)</span></code></pre></div>
<pre><code>## rename: renamed 3 variables (sex_enjoyed, sex_happy, sex_partner_enjoyed)</code></pre>
<div class="sourceCode" id="cb1243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1243-1"><a href="#cb1243-1"></a>testthat<span class="op">::</span><span class="kw">expect_equal</span>(sex_acts_in_diary, <span class="kw">nrow</span>(sex_long))</span>
<span id="cb1243-2"><a href="#cb1243-2"></a></span>
<span id="cb1243-3"><a href="#cb1243-3"></a>diary &lt;-<span class="st"> </span>diary <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1243-4"><a href="#cb1243-4"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb1243-5"><a href="#cb1243-5"></a>    <span class="dt">sex_in_pair =</span> <span class="kw">if_else</span>(hetero_relationship <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>sex_activity_sex <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>sex_with_partner <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1243-6"><a href="#cb1243-6"></a>    <span class="dt">sex_extra_pair_with_male =</span> <span class="kw">if_else</span>(hetero_relationship <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>sex_activity_sex <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>sex_with_partner <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>sex_with_other_male <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1243-7"><a href="#cb1243-7"></a>    <span class="dt">sex_with_female =</span> <span class="kw">if_else</span>(sex_activity_sex <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>sex_with_other_female <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1243-8"><a href="#cb1243-8"></a>    <span class="dt">sex_with_male =</span> <span class="kw">if_else</span>(sex_activity_sex <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>(sex_with_other_male <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>sex_with_partner <span class="op">==</span><span class="st"> </span><span class="dv">1</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1243-9"><a href="#cb1243-9"></a>    <span class="dt">sex_extra_pair_with_female =</span> <span class="kw">if_else</span>(hetero_relationship <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>sex_with_partner <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>sex_with_other_female <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1243-10"><a href="#cb1243-10"></a>    <span class="dt">sex_risked_conception =</span> <span class="kw">if_else</span>(sex_activity_sex <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>(sex_contraception_coitus_interruptus <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>sex_contraception_risked_it <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>sex_contraception_not_necessary <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1243-11"><a href="#cb1243-11"></a>    <span class="dt">sex_had_unprotected_penetrative_sex =</span> <span class="kw">if_else</span>(sex_activity_sex <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>(sex_contraception_did_not_want <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>sex_contraception_coitus_interruptus <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>sex_contraception_risked_it <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>sex_contraception_not_necessary <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb1243-12"><a href="#cb1243-12"></a>  )</span></code></pre></div>
<pre><code>## mutate (grouped): new variable &#39;sex_in_pair&#39; with 2 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;sex_extra_pair_with_male&#39; with 2 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;sex_with_female&#39; with 2 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;sex_with_male&#39; with 2 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;sex_extra_pair_with_female&#39; with 2 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;sex_risked_conception&#39; with 2 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;sex_had_unprotected_penetrative_sex&#39; with 2 unique values and 0% NA</code></pre>
<div class="sourceCode" id="cb1251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1251-1"><a href="#cb1251-1"></a>diary &lt;-<span class="st"> </span>diary <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1251-2"><a href="#cb1251-2"></a><span class="st">  </span><span class="kw">group_by</span>(short) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1251-3"><a href="#cb1251-3"></a><span class="st">  </span><span class="kw">arrange</span>(created_diary) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1251-4"><a href="#cb1251-4"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb1251-5"><a href="#cb1251-5"></a>    <span class="dt">sex_active_date =</span> <span class="kw">if_else</span>(sex_activity_sex <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, created_date, <span class="kw">as.Date</span>(<span class="ot">NA_character_</span>)),</span>
<span id="cb1251-6"><a href="#cb1251-6"></a>    <span class="dt">sex_last_date =</span> zoo<span class="op">::</span><span class="kw">na.locf</span>(sex_active_date, <span class="dt">na.rm =</span> F),</span>
<span id="cb1251-7"><a href="#cb1251-7"></a>    <span class="dt">sex_days_ago =</span> <span class="kw">as.numeric</span>(created_date <span class="op">-</span><span class="st"> </span>sex_last_date),</span>
<span id="cb1251-8"><a href="#cb1251-8"></a>    <span class="dt">sex_masturbation_active_date =</span> <span class="kw">if_else</span>(sex_activity_masturbation <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>sex_active_solo <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, created_date, <span class="kw">as.Date</span>(<span class="ot">NA_character_</span>)),</span>
<span id="cb1251-9"><a href="#cb1251-9"></a>    <span class="dt">sex_masturbation_last_date =</span> zoo<span class="op">::</span><span class="kw">na.locf</span>(sex_masturbation_active_date, <span class="dt">na.rm =</span> F),</span>
<span id="cb1251-10"><a href="#cb1251-10"></a>    <span class="dt">sex_masturbation_days_ago =</span> <span class="kw">as.numeric</span>(created_date <span class="op">-</span><span class="st"> </span>sex_masturbation_last_date)</span>
<span id="cb1251-11"><a href="#cb1251-11"></a>)</span></code></pre></div>
<pre><code>## group_by: one grouping variable (short)</code></pre>
<pre><code>## mutate (grouped): new variable &#39;sex_active_date&#39; with 297 unique values and 90% NA</code></pre>
<pre><code>##                   new variable &#39;sex_last_date&#39; with 297 unique values and 36% NA</code></pre>
<pre><code>##                   new variable &#39;sex_days_ago&#39; with 405 unique values and 36% NA</code></pre>
<pre><code>##                   new variable &#39;sex_masturbation_active_date&#39; with 292 unique values and 91% NA</code></pre>
<pre><code>##                   new variable &#39;sex_masturbation_last_date&#39; with 292 unique values and 32% NA</code></pre>
<pre><code>##                   new variable &#39;sex_masturbation_days_ago&#39; with 434 unique values and 32% NA</code></pre>
<div class="sourceCode" id="cb1259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1259-1"><a href="#cb1259-1"></a><span class="co"># </span></span>
<span id="cb1259-2"><a href="#cb1259-2"></a><span class="co"># table(diary$sex_extra_pair_with_female)</span></span>
<span id="cb1259-3"><a href="#cb1259-3"></a><span class="co"># table(diary$sex_extra_pair_with_male)</span></span>
<span id="cb1259-4"><a href="#cb1259-4"></a><span class="co"># table(diary$sex_had_unprotected_penetrative_sex)</span></span>
<span id="cb1259-5"><a href="#cb1259-5"></a><span class="co"># table(diary$sex_risked_conception)</span></span>
<span id="cb1259-6"><a href="#cb1259-6"></a><span class="co"># table(diary$sex_in_pair)</span></span>
<span id="cb1259-7"><a href="#cb1259-7"></a>diary &lt;-<span class="st"> </span>diary <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1259-8"><a href="#cb1259-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sex_acts =</span> <span class="kw">case_when</span>(</span>
<span id="cb1259-9"><a href="#cb1259-9"></a>    sex_active <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb1259-10"><a href="#cb1259-10"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>sex_acts))</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<pre><code>## mutate: changed 42,415 values (53%) of &#39;sex_acts&#39; (42415 fewer NA)</code></pre>
<div class="sourceCode" id="cb1262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1262-1"><a href="#cb1262-1"></a>diary &lt;-<span class="st"> </span>diary <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1262-2"><a href="#cb1262-2"></a><span class="st">  </span><span class="kw">group_by</span>(short) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1262-3"><a href="#cb1262-3"></a><span class="st">  </span><span class="kw">arrange</span>(created_diary) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1262-4"><a href="#cb1262-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sex_partnered_freq =</span> <span class="kw">mean</span>(sex_active_partnered, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb1262-5"><a href="#cb1262-5"></a>         <span class="dt">lag_libido =</span> <span class="kw">lag</span>(high_libido),</span>
<span id="cb1262-6"><a href="#cb1262-6"></a>         <span class="dt">lag_sex =</span> <span class="kw">lag</span>(sex_activity_sex),</span>
<span id="cb1262-7"><a href="#cb1262-7"></a>         <span class="dt">lag_sex_active_partnered =</span> <span class="kw">lag</span>(sex_active_partnered),</span>
<span id="cb1262-8"><a href="#cb1262-8"></a>         <span class="dt">lag_sex_active =</span> <span class="kw">lag</span>(sex_active),</span>
<span id="cb1262-9"><a href="#cb1262-9"></a>         <span class="dt">lag_sex_acts =</span> <span class="kw">lag</span>(sex_acts),</span>
<span id="cb1262-10"><a href="#cb1262-10"></a>         <span class="dt">lag_stressed =</span> <span class="kw">lag</span>(stressed),</span>
<span id="cb1262-11"><a href="#cb1262-11"></a>         <span class="dt">lag_mood =</span> <span class="kw">lag</span>(good_mood)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1262-12"><a href="#cb1262-12"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
<pre><code>## group_by: one grouping variable (short)</code></pre>
<pre><code>## mutate (grouped): new variable &#39;sex_partnered_freq&#39; with 327 unique values and 0% NA</code></pre>
<pre><code>##                   new variable &#39;lag_libido&#39; with 6 unique values and 23% NA</code></pre>
<pre><code>##                   new variable &#39;lag_sex&#39; with 3 unique values and 2% NA</code></pre>
<pre><code>##                   new variable &#39;lag_sex_active_partnered&#39; with 3 unique values and 2% NA</code></pre>
<pre><code>##                   new variable &#39;lag_sex_active&#39; with 3 unique values and 23% NA</code></pre>
<pre><code>##                   new variable &#39;lag_sex_acts&#39; with 19 unique values and 23% NA</code></pre>
<pre><code>##                   new variable &#39;lag_stressed&#39; with 6 unique values and 69% NA</code></pre>
<pre><code>##                   new variable &#39;lag_mood&#39; with 6 unique values and 38% NA</code></pre>
<pre><code>## ungroup: no grouping variables</code></pre>
</div>
<div id="final-edits" class="section level2">
<h2>Final edits</h2>
<div class="sourceCode" id="cb1273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1273-1"><a href="#cb1273-1"></a><span class="co"># some women let us know in the comments that they are not really using a fertility awareness app/method</span></span>
<span id="cb1273-2"><a href="#cb1273-2"></a>not_aware &lt;-<span class="st"> </span>all_surveys<span class="op">$</span>cycle_awareness_other <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fertile_aware_invalid&quot;</span>, <span class="st">&quot;fertility_awareness_did_not_use&quot;</span>, <span class="st">&quot;not_fertile_aware&quot;</span>)</span>
<span id="cb1273-3"><a href="#cb1273-3"></a>all_surveys[not_aware, <span class="kw">c</span>(<span class="st">&quot;luteal_phase_length&quot;</span>, <span class="st">&quot;follicular_phase_length&quot;</span>)] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb1273-4"><a href="#cb1273-4"></a></span>
<span id="cb1273-5"><a href="#cb1273-5"></a><span class="co"># some women let us know in the comments that they are not really using a fertility awareness app/method</span></span>
<span id="cb1273-6"><a href="#cb1273-6"></a>not_aware &lt;-<span class="st"> </span>diary<span class="op">$</span>cycle_awareness_other <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fertile_aware_invalid&quot;</span>, <span class="st">&quot;fertility_awareness_did_not_use&quot;</span>, <span class="st">&quot;not_fertile_aware&quot;</span>)</span>
<span id="cb1273-7"><a href="#cb1273-7"></a>diary[not_aware, <span class="kw">c</span>(<span class="st">&quot;luteal_phase_length&quot;</span>, <span class="st">&quot;follicular_phase_length&quot;</span>, <span class="st">&quot;DAL&quot;</span>, <span class="st">&quot;date_of_ovulation_avg_luteal_inferred&quot;</span>,</span>
<span id="cb1273-8"><a href="#cb1273-8"></a>                   <span class="st">&quot;date_of_ovulation_avg_luteal&quot;</span>, <span class="st">&quot;date_of_ovulation_avg_follicular&quot;</span>, <span class="st">&quot;fertile_awareness&quot;</span>,</span>
<span id="cb1273-9"><a href="#cb1273-9"></a>                   <span class="st">&quot;date_of_ovulation_awareness&quot;</span>, <span class="st">&quot;prc_stirn_b_aware_luteal&quot;</span>, <span class="st">&quot;prc_wcx_b_aware_luteal&quot;</span>,</span>
<span id="cb1273-10"><a href="#cb1273-10"></a>                   <span class="st">&quot;fertile_narrow_aware_luteal&quot;</span>, <span class="st">&quot;fertile_broad_aware_luteal&quot;</span>, <span class="st">&quot;fertile_window_aware_luteal&quot;</span>, </span>
<span id="cb1273-11"><a href="#cb1273-11"></a>                   <span class="st">&quot;premenstrual_phase_aware_luteal&quot;</span>)] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb1273-12"><a href="#cb1273-12"></a></span>
<span id="cb1273-13"><a href="#cb1273-13"></a><span class="co"># redo weekdays after expanding timeseries</span></span>
<span id="cb1273-14"><a href="#cb1273-14"></a>s3_daily<span class="op">$</span>weekday =<span class="st"> </span><span class="kw">format</span>(s3_daily<span class="op">$</span>created_date, <span class="dt">format =</span> <span class="st">&quot;%w&quot;</span>)</span>
<span id="cb1273-15"><a href="#cb1273-15"></a>s3_daily<span class="op">$</span>weekend &lt;-<span class="st"> </span><span class="kw">ifelse</span>(s3_daily<span class="op">$</span>weekday <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">6</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb1273-16"><a href="#cb1273-16"></a>s3_daily<span class="op">$</span>weekday &lt;-<span class="st"> </span>car<span class="op">::</span><span class="kw">Recode</span>(s3_daily<span class="op">$</span>weekday,                                               <span class="st">&quot;0=&#39;Sunday&#39;;1=&#39;Monday&#39;;2=&#39;Tuesday&#39;;3=&#39;Wednesday&#39;;4=&#39;Thursday&#39;;5=&#39;Friday&#39;;6=&#39;Saturday&#39;&quot;</span>,<span class="dt">as.factor =</span>T, <span class="dt">levels =</span>   <span class="kw">c</span>(<span class="st">&#39;Monday&#39;</span>,<span class="st">&#39;Tuesday&#39;</span>,<span class="st">&#39;Wednesday&#39;</span>,<span class="st">&#39;Thursday&#39;</span>,<span class="st">&#39;Friday&#39;</span>,<span class="st">&#39;Saturday&#39;</span>,<span class="st">&#39;Sunday&#39;</span>))</span>
<span id="cb1273-17"><a href="#cb1273-17"></a></span>
<span id="cb1273-18"><a href="#cb1273-18"></a>diary<span class="op">$</span>weekday =<span class="st"> </span><span class="kw">format</span>(diary<span class="op">$</span>created_date, <span class="dt">format =</span> <span class="st">&quot;%w&quot;</span>)</span>
<span id="cb1273-19"><a href="#cb1273-19"></a>diary<span class="op">$</span>weekend &lt;-<span class="st"> </span><span class="kw">ifelse</span>(diary<span class="op">$</span>weekday <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">6</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb1273-20"><a href="#cb1273-20"></a>diary<span class="op">$</span>weekday &lt;-<span class="st"> </span>car<span class="op">::</span><span class="kw">Recode</span>(diary<span class="op">$</span>weekday, <span class="st">&quot;0=&#39;Sunday&#39;;1=&#39;Monday&#39;;2=&#39;Tuesday&#39;;3=&#39;Wednesday&#39;;4=&#39;Thursday&#39;;5=&#39;Friday&#39;;6=&#39;Saturday&#39;&quot;</span>,<span class="dt">as.factor =</span> T, <span class="dt">levels =</span>  <span class="kw">c</span>(<span class="st">&#39;Monday&#39;</span>,<span class="st">&#39;Tuesday&#39;</span>,<span class="st">&#39;Wednesday&#39;</span>,<span class="st">&#39;Thursday&#39;</span>,<span class="st">&#39;Friday&#39;</span>,<span class="st">&#39;Saturday&#39;</span>,<span class="st">&#39;Sunday&#39;</span>))</span>
<span id="cb1273-21"><a href="#cb1273-21"></a></span>
<span id="cb1273-22"><a href="#cb1273-22"></a><span class="co"># omit extrapolated days</span></span>
<span id="cb1273-23"><a href="#cb1273-23"></a>s3_daily &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(day_number <span class="op">%in%</span><span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">70</span> <span class="op">|</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(ended))</span></code></pre></div>
<pre><code>## filter (grouped): removed 1,885 rows (2%), 77,364 rows remaining</code></pre>
<div class="sourceCode" id="cb1275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1275-1"><a href="#cb1275-1"></a>diary &lt;-<span class="st"> </span>diary <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(day_number <span class="op">%in%</span><span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">70</span> <span class="op">|</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(ended_diary))</span></code></pre></div>
<pre><code>## filter: removed 2,172 rows (3%), 77,364 rows remaining</code></pre>
<div class="sourceCode" id="cb1277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1277-1"><a href="#cb1277-1"></a>diary<span class="op">$</span>premenstrual_phase_fab =<span class="st"> </span><span class="kw">factor</span>(diary<span class="op">$</span>premenstrual_phase_fab)</span>
<span id="cb1277-2"><a href="#cb1277-2"></a>diary<span class="op">$</span>hormonal_contraception =<span class="st"> </span><span class="kw">factor</span>(diary<span class="op">$</span>hormonal_contraception)</span>
<span id="cb1277-3"><a href="#cb1277-3"></a>diary_social<span class="op">$</span>premenstrual_phase_fab =<span class="st"> </span><span class="kw">factor</span>(diary_social<span class="op">$</span>premenstrual_phase_fab)</span>
<span id="cb1277-4"><a href="#cb1277-4"></a>diary_social<span class="op">$</span>hormonal_contraception =<span class="st"> </span><span class="kw">factor</span>(diary_social<span class="op">$</span>hormonal_contraception)</span>
<span id="cb1277-5"><a href="#cb1277-5"></a></span>
<span id="cb1277-6"><a href="#cb1277-6"></a><span class="co"># diary %&gt;% drop_na(day_number) %&gt;% group_by(short, day_number) %&gt;% filter(n() &gt; 1 | day_number &lt; 1 | day_number &gt; 70) %&gt;% select(short, created_demo, created_diary, day_number, ended_diary, notes_to_us) %&gt;% arrange(desc(day_number))</span></span>
<span id="cb1277-7"><a href="#cb1277-7"></a></span>
<span id="cb1277-8"><a href="#cb1277-8"></a>diary =<span class="st"> </span>diary <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1277-9"><a href="#cb1277-9"></a><span class="st">  </span><span class="kw">group_by</span>(session, cycle_nr) <span class="op">%&gt;%</span></span>
<span id="cb1277-10"><a href="#cb1277-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">minimum_cycle_length_diary =</span> <span class="kw">if_else</span>(<span class="op">!</span><span class="kw">is.na</span>(cycle_length), cycle_length,</span>
<span id="cb1277-11"><a href="#cb1277-11"></a>                                              <span class="kw">max</span>(FCD,<span class="dt">na.rm =</span> T)),</span>
<span id="cb1277-12"><a href="#cb1277-12"></a>         <span class="dt">minimum_cycle_length_diary =</span> <span class="kw">if_else</span>(minimum_cycle_length_diary <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="ot">Inf</span>, <span class="ot">NA_real_</span>, minimum_cycle_length_diary)</span>
<span id="cb1277-13"><a href="#cb1277-13"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb1277-14"><a href="#cb1277-14"></a><span class="st">  </span><span class="kw">group_by</span>(session)</span></code></pre></div>
<pre><code>## group_by: 2 grouping variables (session, cycle_nr)</code></pre>
<pre><code>## mutate (grouped): new variable &#39;minimum_cycle_length_diary&#39; with 110 unique values and 17% NA</code></pre>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<div class="sourceCode" id="cb1281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1281-1"><a href="#cb1281-1"></a>diary =<span class="st"> </span>diary <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(session) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1281-2"><a href="#cb1281-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">relationship_satisfaction_diary_avg =</span> <span class="kw">mean</span>(relationship_satisfaction_diary, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>()</span></code></pre></div>
<pre><code>## group_by: one grouping variable (session)</code></pre>
<pre><code>## mutate (grouped): new variable &#39;relationship_satisfaction_diary_avg&#39; with 573 unique values and 33% NA</code></pre>
<pre><code>## ungroup: no grouping variables</code></pre>
<div class="sourceCode" id="cb1285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1285-1"><a href="#cb1285-1"></a>all_surveys<span class="op">$</span>person &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">factor</span>(all_surveys<span class="op">$</span>short))</span>
<span id="cb1285-2"><a href="#cb1285-2"></a>diary &lt;-<span class="st"> </span>all_surveys <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(person, short) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">right_join</span>(diary, <span class="dt">by =</span> <span class="st">&quot;short&quot;</span>)</span></code></pre></div>
<pre><code>## select: dropped 363 variables (session, created_demo, modified_demo, ended_demo, expired_demo, …)</code></pre>
<pre><code>## right_join: added 786 columns (session, created_date, created_diary, modified_diary, ended_diary, …)</code></pre>
<pre><code>##             &gt; rows only in x  (   287)</code></pre>
<pre><code>##             &gt; rows only in y        0</code></pre>
<pre><code>##             &gt; matched rows     77,364</code></pre>
<pre><code>##             &gt;                 ========</code></pre>
<pre><code>##             &gt; rows total       77,364</code></pre>
<div class="sourceCode" id="cb1293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1293-1"><a href="#cb1293-1"></a>diary &lt;-<span class="st"> </span>diary <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>()</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<div class="sourceCode" id="cb1295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1295-1"><a href="#cb1295-1"></a>s3_daily &lt;-<span class="st"> </span>s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>()</span></code></pre></div>
<pre><code>## ungroup: no grouping variables</code></pre>
<div class="sourceCode" id="cb1297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1297-1"><a href="#cb1297-1"></a><span class="co">## Duration objects are difficult for skimr</span></span>
<span id="cb1297-2"><a href="#cb1297-2"></a>s3_daily<span class="op">$</span>sleep_fell_asleep_time &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(s3_daily<span class="op">$</span>sleep_fell_asleep_time)</span>
<span id="cb1297-3"><a href="#cb1297-3"></a>s3_daily<span class="op">$</span>sleep_awoke_time &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(s3_daily<span class="op">$</span>sleep_awoke_time)</span></code></pre></div>
</div>
<div id="sanity-checks" class="section level2">
<h2>Sanity checks</h2>
<div class="sourceCode" id="cb1298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1298-1"><a href="#cb1298-1"></a><span class="kw">library</span>(testthat)</span>
<span id="cb1298-2"><a href="#cb1298-2"></a><span class="kw">expect_false</span>(<span class="kw">any</span>(<span class="kw">names</span>(diary) <span class="op">%contains%</span><span class="st"> &quot;.x&quot;</span>))</span>
<span id="cb1298-3"><a href="#cb1298-3"></a><span class="kw">expect_false</span>(<span class="kw">any</span>(<span class="kw">names</span>(diary) <span class="op">%contains%</span><span class="st"> &quot;.y&quot;</span>))</span>
<span id="cb1298-4"><a href="#cb1298-4"></a><span class="kw">expect_false</span>(<span class="kw">any</span>(<span class="kw">names</span>(all_surveys) <span class="op">%contains%</span><span class="st"> &quot;.y&quot;</span>))</span>
<span id="cb1298-5"><a href="#cb1298-5"></a><span class="kw">expect_equal</span>(<span class="kw">groups</span>(s3_daily), <span class="kw">list</span>())</span>
<span id="cb1298-6"><a href="#cb1298-6"></a><span class="kw">expect_equal</span>(<span class="kw">groups</span>(diary), <span class="kw">list</span>())</span>
<span id="cb1298-7"><a href="#cb1298-7"></a><span class="kw">expect_equal</span>(<span class="kw">groups</span>(all_surveys), <span class="kw">list</span>())</span>
<span id="cb1298-8"><a href="#cb1298-8"></a><span class="kw">expect_equal</span>(<span class="kw">sum</span>(<span class="kw">duplicated</span>(all_surveys<span class="op">$</span>session)), <span class="dv">0</span>)</span>
<span id="cb1298-9"><a href="#cb1298-9"></a><span class="kw">expect_equal</span>(<span class="kw">sum</span>(<span class="kw">duplicated</span>(s1_demo<span class="op">$</span>session)), <span class="dv">0</span>)</span>
<span id="cb1298-10"><a href="#cb1298-10"></a><span class="kw">expect_equal</span>(diary <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, day_number) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1298-11"><a href="#cb1298-11"></a><span class="st">               </span><span class="kw">group_by</span>(short, day_number) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>(), <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## drop_na: no rows removed</code></pre>
<pre><code>## group_by: 2 grouping variables (short, day_number)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
<div class="sourceCode" id="cb1302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1302-1"><a href="#cb1302-1"></a><span class="kw">expect_equal</span>(diary <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, created_diary) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb1302-2"><a href="#cb1302-2"></a><span class="st">            </span><span class="kw">group_by</span>(session, created_diary) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>()<span class="op">&gt;</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>(), <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## drop_na: removed 14,698 rows (19%), 62,666 rows remaining</code></pre>
<pre><code>## group_by: 2 grouping variables (session, created_diary)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
<div class="sourceCode" id="cb1306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1306-1"><a href="#cb1306-1"></a><span class="kw">expect_equal</span>(s3_daily <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, created_date) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb1306-2"><a href="#cb1306-2"></a><span class="st">            </span><span class="kw">group_by</span>(session, created_date) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>()<span class="op">&gt;</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>(), <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## drop_na: no rows removed</code></pre>
<pre><code>## group_by: 2 grouping variables (session, created_date)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
<div class="sourceCode" id="cb1310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1310-1"><a href="#cb1310-1"></a><span class="kw">expect_equal</span>(diary <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, created_date) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb1310-2"><a href="#cb1310-2"></a><span class="st">            </span><span class="kw">group_by</span>(session, created_date) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>()<span class="op">&gt;</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>(), <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## drop_na: no rows removed</code></pre>
<pre><code>## group_by: 2 grouping variables (session, created_date)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
<div class="sourceCode" id="cb1314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1314-1"><a href="#cb1314-1"></a><span class="kw">expect_equal</span>(diary_social <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, created_diary, person) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb1314-2"><a href="#cb1314-2"></a><span class="st">            </span><span class="kw">group_by</span>(session, created_diary, person) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>(), <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## drop_na: removed 47,466 rows (48%), 50,666 rows remaining</code></pre>
<pre><code>## group_by: 3 grouping variables (session, created_diary, person)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
<div class="sourceCode" id="cb1318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1318-1"><a href="#cb1318-1"></a><span class="kw">expect_equal</span>(network <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(session, person) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb1318-2"><a href="#cb1318-2"></a><span class="st">            </span><span class="kw">group_by</span>(session, person) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">n</span>()<span class="op">&gt;</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>(), <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## drop_na: no rows removed</code></pre>
<pre><code>## group_by: 2 grouping variables (session, person)</code></pre>
<pre><code>## filter (grouped): removed all rows (100%)</code></pre>
</div>
<div id="save" class="section level2">
<h2>save</h2>
<div class="sourceCode" id="cb1322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1322-1"><a href="#cb1322-1"></a><span class="kw">save</span>(diary_social, sex_long, lab, diary, network_nominations, network, s1_demo, s1_filter, s2_initial, s3_daily, s4_followup, s4_timespent, withfollowup, s5_hadmenstruation, all_surveys, <span class="dt">file =</span> <span class="st">&quot;data/cleaned.rdata&quot;</span>)</span></code></pre></div>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiRGF0YSBXcmFuZ2xpbmciCm91dHB1dDogCiAgaHRtbF9kb2N1bWVudDoKICAgIHRvYzogeWVzCiAgICB0b2NfZGVwdGg6IDUKICAgIGNvZGVfZm9sZGluZzogInNob3ciCi0tLQoKCmBgYHtyIG1lc3NhZ2U9Rix3YXJuaW5nPUZ9CnNvdXJjZSgiMF9oZWxwZXJzLlIiKQpsaWJyYXJ5KHRpZHlsb2cpCmtuaXRyOjpvcHRzX2NodW5rJHNldChlcnJvciA9IEZBTFNFKQpsb2FkKCJkYXRhL3ByZXR0eV9yYXcucmRhdGEiKQprbml0X3ByaW50LmFscGhhIDwtIGtuaXRyOjo6a25pdF9wcmludC5kZWZhdWx0CnJlZ2lzdGVyUzNtZXRob2QoImtuaXRfcHJpbnQiLCAiYWxwaGEiLCBrbml0X3ByaW50LmFscGhhKQpgYGAKCmBgYHtyIG5pY2VyfQpvcHRzX2NodW5rJHNldChtZXNzYWdlPVQsIHdhcm5pbmcgPSBGKQpgYGAKCgojIyBXZWVrZGF5cwpgYGB7ciB3ZWVrZGF5cywgZXJyb3I9RkFMU0V9CnMzX2RhaWx5JHdlZWtkYXkgPSBmb3JtYXQoYXMuUE9TSVhjdChzM19kYWlseSRjcmVhdGVkKSwgZm9ybWF0ID0gIiV3IikKczNfZGFpbHkkd2Vla2VuZCA8LSBpZmVsc2UoczNfZGFpbHkkd2Vla2RheSAlaW4lIGMoMCw1LDYpLCAxLCAwKQpzM19kYWlseSR3ZWVrZGF5IDwtIGNhcjo6UmVjb2RlKHMzX2RhaWx5JHdlZWtkYXksCQkJCQkJCQkJCQkJIjA9J1N1bmRheSc7MT0nTW9uZGF5JzsyPSdUdWVzZGF5JzszPSdXZWRuZXNkYXknOzQ9J1RodXJzZGF5Jzs1PSdGcmlkYXknOzY9J1NhdHVyZGF5JyIsYXMuZmFjdG9yID1ULCBsZXZlbHMgPSAJYygnTW9uZGF5JywnVHVlc2RheScsJ1dlZG5lc2RheScsJ1RodXJzZGF5JywnRnJpZGF5JywnU2F0dXJkYXknLCdTdW5kYXknKSkKCmhvdXJfc3RyaW5nX3RvX3BlcmlvZCA9IGZ1bmN0aW9uKGhvdXJfc3RyaW5nKSB7CglkdXJhdGlvbihhcy5udW1lcmljKHN0cmluZ3I6OnN0cl9zdWIoaG91cl9zdHJpbmcsIDEsMikpLCB1bml0cyA9ICJob3VycyIpICsgZHVyYXRpb24oYXMubnVtZXJpYyhzdHJpbmdyOjpzdHJfc3ViKGhvdXJfc3RyaW5nLCA0LDUpKSwgdW5pdHMgPSAibWludXRlcyIpIAp9CnMzX2RhaWx5JHNsZWVwX2F3b2tlX3RpbWUgPSBob3VyX3N0cmluZ190b19wZXJpb2QoczNfZGFpbHkkc2xlZXBfYXdva2VfdGltZSkKczNfZGFpbHkkc2xlZXBfZmVsbF9hc2xlZXBfdGltZSA9IGhvdXJfc3RyaW5nX3RvX3BlcmlvZChzM19kYWlseSRzbGVlcF9mZWxsX2FzbGVlcF90aW1lKQoKczNfZGFpbHkkc2xlZXBfZHVyYXRpb24gPSBpZmVsc2UoCglzM19kYWlseSRzbGVlcF9hd29rZV90aW1lID49IHMzX2RhaWx5JHNsZWVwX2ZlbGxfYXNsZWVwX3RpbWUsIAoJczNfZGFpbHkkc2xlZXBfYXdva2VfdGltZSAtIHMzX2RhaWx5JHNsZWVwX2ZlbGxfYXNsZWVwX3RpbWUsIAoJZGhvdXJzKDI0KSAtIHMzX2RhaWx5JHNsZWVwX2ZlbGxfYXNsZWVwX3RpbWUgKyBzM19kYWlseSRzbGVlcF9hd29rZV90aW1lCikgLyA2MCAvIDYwCgpzM19kYWlseSA9IHMzX2RhaWx5ICU+JSAKICAgIG11dGF0ZShjcmVhdGVkX2RhdGUgPSBhcy5EYXRlKGNyZWF0ZWQgLSBob3VycygxMCkpKSAlPiUgICMgZG9uJ3QgY291bnQgbmlnaHQgdGltZSBhcyBuZXh0IGRheQogIGdyb3VwX2J5KHNlc3Npb24pICU+JSAKICBtdXRhdGUoZmlyc3RfZGlhcnlfZGF5ID0gbWluKGNyZWF0ZWRfZGF0ZSkpICU+JSAKICB1bmdyb3VwKCkKCnN0b3BpZm5vdChzM19kYWlseSAlPiUgZHJvcF9uYShzZXNzaW9uLCBjcmVhdGVkX2RhdGUpICU+JSAgCiAgICAgICAgICAgIGdyb3VwX2J5KHNlc3Npb24sIGNyZWF0ZWRfZGF0ZSkgJT4lIGZpbHRlcihuKCk+MSkgJT4lIG5yb3coKSA9PSAwKQpgYGAKCiMjIE1lbnN0cnVhbCBwaGFzZQpgYGB7ciBtZW5zdHJ1YWwucGhhc2UuY2FsY3N9CnMxX2RlbW8gPSBzMV9kZW1vICU+JSBtdXRhdGUoZW5kZWRfZGF0ZSA9IGFzLkRhdGUoZW5kZWQpKQoKIyBzMV9kZW1vICU+JSAKIyAgIGZpbHRlcihtZW5zdHJ1YXRpb25fbGFzdCA8IGVuZGVkX2RhdGUgLSBkYXlzKDQwKSkgJT4lCiMgICBzZWxlY3QobWVuc3RydWF0aW9uX2xhc3QsIGVuZGVkX2RhdGUsIG1lbnN0cnVhdGlvbl9sYXN0X2NlcnRhaW50eSwgY29udHJhY2VwdGlvbl9tZXRob2QpCgpzMV9tZW5zdHJ1YXRpb25fc3RhcnQgPSBzMV9kZW1vICU+JSBmaWx0ZXIoIWlzLm5hKG1lbnN0cnVhdGlvbl9sYXN0KSkgJT4lIAogIGZpbHRlcihtZW5zdHJ1YXRpb25fbGFzdCA+PSBlbmRlZF9kYXRlIC0gZGF5cyg0MCkpICU+JSAjIG9ubHkgbGFzdCBtZW5zdHJ1YXRpb24gdGhhdCB3ZXJlbid0IGFnZXMgYWdvCiAgbXV0YXRlKGNyZWF0ZWRfZGF0ZSA9IGFzLkRhdGUoY3JlYXRlZCkpICU+JQogIHNlbGVjdChzZXNzaW9uLCBjcmVhdGVkX2RhdGUsIG1lbnN0cnVhdGlvbl9sYXN0KSAlPiUgcmVuYW1lKG1lbnN0cnVhbF9vbnNldF9kYXRlX2luZmVycmVkID0gbWVuc3RydWF0aW9uX2xhc3QpCgpzNV9oYWRtZW5zdHJ1YXRpb24gPSBzNV9oYWRtZW5zdHJ1YXRpb24gJT4lIAogIGZpbHRlcighaXMubmEobGFzdF9tZW5zdHJ1YWxfb25zZXRfZGF0ZSkpICU+JSAKICBtdXRhdGUoY3JlYXRlZF9kYXRlID0gYXMuRGF0ZShjcmVhdGVkKSkgJT4lCiAgc2VsZWN0KHNlc3Npb24sIGNyZWF0ZWRfZGF0ZSwgbGFzdF9tZW5zdHJ1YWxfb25zZXRfZGF0ZSkgJT4lIHJlbmFtZShtZW5zdHJ1YWxfb25zZXRfZGF0ZV9pbmZlcnJlZCA9IGxhc3RfbWVuc3RydWFsX29uc2V0X2RhdGUpICU+JSAKICBmaWx0ZXIoIWR1cGxpY2F0ZWQoc2Vzc2lvbikpCnRhYmxlKGR1cGxpY2F0ZWQoczVfaGFkbWVuc3RydWF0aW9uJHNlc3Npb24pKQpgYGAKCiMjIEZlcnRpbGl0eSBlc3RpbWF0aW9uCgojIyMgTEggc3VyZ2VzIGFuZCBzZXggaG9ybW9uZXMKCmBgYHtyfQpsYWIgPSByZWFkeGw6OnJlYWRfeGxzeCgiZGF0YS9EYXRlbnNhdHpfWnlrbHVzc3R1ZGllX0xhYm9yLnhsc3giKQoKbGFiID0gbGFiICU+JSAKICByZW5hbWUoY3JlYXRlZF9kYXRlID0gYERhdHVtIExhYiBTZXNzaW9uYCkgJT4lIAogIGZpbHRlcighaXMubmEoYFZQTi1DT0RFYCksICFpcy5uYShjcmVhdGVkX2RhdGUpKSAlPiUgCiAgbXV0YXRlKHNob3J0ID0gc3RyX3N1YihUYWdlYnVjaGNvZGUsIDEsIDcpLAogICAgICAgICBsYWJfb25seV9ub19kaWFyeSA9IGlzLm5hKHNob3J0KSwKICAgICAgICAgc2hvcnQgPSBpZl9lbHNlKGlzLm5hKHNob3J0KSwgYFZQTi1DT0RFYCwgc2hvcnQpLAogICAgICAgICBjcmVhdGVkX2RhdGUgPSBhcy5EYXRlKGNyZWF0ZWRfZGF0ZSksCiAgICAgICAgIGBEYXRlIExIIHN1cmdlYCA9IGFzLkRhdGUoaWZfZWxzZShgRGF0ZSBMSCBzdXJnZWAgPT0gInh4eCIsIE5BX3JlYWxfLCBhcy5udW1lcmljKGBEYXRlIExIIHN1cmdlYCkpLCBvcmlnaW4gPSAiMTg5OS0xMi0zMCIpKSAjIHNvbWUgZXhjZWwgcHJvYmxlbSwgd2hlcmUgbnJzIGFyZSByZXBlYXRlZCBhdCBlbmQsIHNvIHdlIHNob3J0ZW4gaXQKCmxhYiAlPiUgbXV0YXRlKG5fd29tZW4gPSBuX2Rpc3RpbmN0KGBWUE4tQ09ERWApLAogICAgICAgICAgICAgICBuX2RpYXJ5X3BhcnRpY2lwYW50cyA9IG5fZGlzdGluY3Qoc3RyX3N1YihUYWdlYnVjaGNvZGUsIDEsIDcpLCBuYS5ybSA9IFQpKSAlPiUgCiAgZ3JvdXBfYnkobl93b21lbixuX2RpYXJ5X3BhcnRpY2lwYW50cywgYFZQTi1DT0RFYCkgJT4lIAogIHN1bW1hcmlzZShkYXlzID0gbigpLCBzdXJnZXMgPSBuX25vbm1pc3NpbmcoYERhdGUgTEggc3VyZ2VgKSkgJT4lIAogIHNlbGVjdCgtYFZQTi1DT0RFYCkgJT4lIAogIHN1bW1hcmlzZV9hbGwobWVhbikKCgoKc2V0ZGlmZihsYWIkc2hvcnQsIHMxX2RlbW8kc2hvcnQpICU+JSB1bmlxdWUoKSAlPiUgbGVuZ3RoKCkgIyA3IGRpZG50IGVudGVyIG9ubGluZSBzdHVkeSBhdCBhbGwKc2V0ZGlmZihsYWIkc2hvcnQsIHMzX2RhaWx5JHNob3J0KSAlPiUgdW5pcXVlKCkgJT4lIGxlbmd0aCgpICMgMTggZGlkbnQgZG8gZGlhcnkKc2V0ZGlmZihzM19kYWlseSRzaG9ydCwgbGFiJHNob3J0KSAlPiUgdW5pcXVlKCkgJT4lIGxlbmd0aCgpICMgMTIzNSBkaWRudCBkbyBsYWIKIyBzZXRkaWZmKGxhYiRzaG9ydCwgczFfZGVtbyRzaG9ydF9kZW1vKSAlPiUgdW5pcXVlKCkgIyBhbGwgY29kZXMgZm91bmQKCmxhYiA8LSBsYWIgJT4lIGZpbHRlcighbGFiX29ubHlfbm9fZGlhcnkpICU+JSBzZWxlY3QoLWxhYl9vbmx5X25vX2RpYXJ5KQpnZXRfbG9uZ19zZXNzID0gczNfZGFpbHkgJT4lIHNlbGVjdChzZXNzaW9uLCBzaG9ydCkgJT4lIG5hLm9taXQoKSAlPiUgdW5pcXVlKCkKCnRlc3R0aGF0OjpleHBlY3RfZXF1YWwobGFiICU+JSBmaWx0ZXIoaXMubmEoY3JlYXRlZF9kYXRlKSkgJT4lIG5yb3coKSwgMCkKbGFiIDwtIGdldF9sb25nX3Nlc3MgJT4lIGlubmVyX2pvaW4obGFiLCBieSA9ICJzaG9ydCIpCnRlc3R0aGF0OjpleHBlY3RfZXF1YWwobGFiICU+JSBmaWx0ZXIoaXMubmEoY3JlYXRlZF9kYXRlKSkgJT4lIG5yb3coKSwgMCkKdGVzdHRoYXQ6OmV4cGVjdF9lcXVhbChzM19kYWlseSAlPiUgZmlsdGVyKGlzLm5hKGNyZWF0ZWRfZGF0ZSkpICU+JSBucm93KCksIDApCgpzM19kYWlseSA8LSBzM19kYWlseSAlPiUgZnVsbF9qb2luKGxhYiAlPiUgc2VsZWN0KC1gRGF0ZSBMSCBzdXJnZWAsIC1gTWVuc3RydWFsIE9uc2V0YCksIGJ5ID0gYygic2Vzc2lvbiIsICJzaG9ydCIsICJjcmVhdGVkX2RhdGUiKSwgc3VmZml4ZXMgPSBjKCJfZGlhcnkiLCAiX2xhYiIpKQpzM19kYWlseSAlPiUgc2VsZWN0KGVuZHNfd2l0aCgiX2xhYiIpKSAlPiUgbmNvbCgpCgpzM19kYWlseSAlPiUgc2VsZWN0KGBJQkxfRXN0cmFkaW9sIHBnL21sYCwgZW5kZWQpICU+JSBjb2RlYm9vazo6bWRfcGF0dGVybihtaW5fZnJlcSA9IDApCgpzM19kYWlseSA8LSBzM19kYWlseSAlPiUgCiAgZnVsbF9qb2luKAogICAgbGFiICU+JSAKICAgICAgZmlsdGVyKCFpcy5uYShgRGF0ZSBMSCBzdXJnZWApLCBleGNsdWRlX2x1dGVhbF90b29fbG9uZyA9PSAwKSAlPiUgCiAgICAgIG11dGF0ZShjcmVhdGVkX2RhdGUgPSBgRGF0ZSBMSCBzdXJnZWApICU+JSAKICAgICAgc2VsZWN0KHNlc3Npb24sIHNob3J0LCBjcmVhdGVkX2RhdGUsIGBEYXRlIExIIHN1cmdlYCksIAogICAgYnkgPSBjKCJzZXNzaW9uIiwgInNob3J0IiwgImNyZWF0ZWRfZGF0ZSIpLCBzdWZmaXhlcyA9IGMoIl9kaWFyeSIsICJfbGFiIikpCgp0ZXN0dGhhdDo6ZXhwZWN0X2VxdWFsKHMzX2RhaWx5ICU+JSBmaWx0ZXIoaXMubmEoY3JlYXRlZF9kYXRlKSkgJT4lIG5yb3coKSwgMCkKCiMgYmVjYXVzZSBvZiB0aGUgdHlwb3MgaW4gdGhlIGxhYiBzZXNzaW9uIGNvZGVzLCB3ZSBoYXZlIHRvIG1lcmdlIHRoZSBsb25nIG9uZXMgYmFjayBvbgp4dGFicyh+IGlzLm5hKHNlc3Npb24pICsgaXMubmEoYFZQTi1DT0RFYCksIGRhdGEgPSBzM19kYWlseSkKeHRhYnMofiBpcy5uYShzaG9ydCkgKyBpcy5uYShgVlBOLUNPREVgKSwgZGF0YSA9IHMzX2RhaWx5KQp4dGFicyh+IGlzLm5hKGVuZGVkKSArIGlzLm5hKGBWUE4tQ09ERWApLCBkYXRhID0gczNfZGFpbHkpCnh0YWJzKH4gaXMubmEoZW5kZWQpICsgaXMubmEoYFByb2dlc3Rlcm9uZSBwZy9tbGApLCBkYXRhID0gczNfZGFpbHkpCiMgCiMgZGlhcnkgJT4lIGZpbHRlcighaXMubmEoQWdlKSkgJT4lIAojICAgc2VsZWN0KHNob3J0LCBBZ2UsIGFnZSwgcmVsYXRpb25zaGlwX3N0YXR1cywgUmVsYXRpb25zaGlwX3N0YXR1cywgYE1FQU4gR3LDtsOfZWAsIGBNRUFOIEdld2ljaHRgLCBoZWlnaHQsIHdlaWdodCkgJT4lCiMgICBncm91cF9ieShzaG9ydCkgJT4lIAojICAgc3VtbWFyaXNlX2FsbChmaXJzdCkgJT4lIAojICAgZGlzdGluY3QoKSAlPiUgCiMgICBtdXRhdGUoYWdlX2RpZmYgPSBhYnMoQWdlIC0gYWdlKSwgCiMgICAgICAgICAgaGVpZ2h0X2RpZmYgPSBhYnMoaGVpZ2h0LSBgTUVBTiBHcsO2w59lYCksIAojICAgICAgICAgIHdlaWdodF9kaWZmID0gYWJzKHdlaWdodCAtIGBNRUFOIEdld2ljaHRgKSwKIyAgICAgICAgICByZWxfZGlmZiA9IGFicyhyZWxhdGlvbnNoaXBfc3RhdHVzIC0gUmVsYXRpb25zaGlwX3N0YXR1cykpICU+JSAKIyAgIGFycmFuZ2UoYWdlX2RpZmYpICU+JSBWaWV3CmBgYAoKIyMjIyBDZW50ZXIgc2V4IGhvcm1vbmVzCgpXZSByZW1vdmUgb3V0bGllcnMgdGhhdCBhcmUgbW9yZSB0aGFuIDMgU0QgZnJvbSB0aGUgbWVhbiBhbmQgY2VudGVyIHdpdGhpbiBncm91cHMKKGxvZ2dlZCBhbmQgbm9uLWxvZ2dlZCkuCgpgYGB7cn0Kb3V0bGllcnNfdG9fbWlzc2luZyA8LSBmdW5jdGlvbih4LCBzZF9tdWx0aXBsaWVyID0gMykgewogIGlmX2Vsc2UoeCA+IChtZWFuKHgsIG5hLnJtID0gVCkgKyBzZF9tdWx0aXBsaWVyICogc2QoeCwgbmEucm0gPSBUKSkgfAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHggPCAobWVhbih4LCBuYS5ybSA9IFQpIC0gc2RfbXVsdGlwbGllciAqIHNkKHgsIG5hLnJtID0gVCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5BX3JlYWxfLCB4KQp9CnMzX2RhaWx5IDwtIHMzX2RhaWx5ICU+JSAKICB1bmdyb3VwKCkgJT4lIAogIG11dGF0ZSgKICAgIGBQcm9nZXN0ZXJvbmUgcGcvbWxgID0gb3V0bGllcnNfdG9fbWlzc2luZyhgUHJvZ2VzdGVyb25lIHBnL21sYCksCiAgICBgRXN0cmFkaW9sIHBnL21sYCA9IG91dGxpZXJzX3RvX21pc3NpbmcoYEVzdHJhZGlvbCBwZy9tbGApLAogICAgYElCTF9Fc3RyYWRpb2wgcGcvbWxgID0gb3V0bGllcnNfdG9fbWlzc2luZyhgSUJMX0VzdHJhZGlvbCBwZy9tbGApLAogICAgYFRlc3Rvc3Rlcm9uZSBwZy9tbGAgPSBvdXRsaWVyc190b19taXNzaW5nKGBUZXN0b3N0ZXJvbmUgcGcvbWxgKSwKICAgIGBDb3J0aXNvbCBubW9sL2xgID0gb3V0bGllcnNfdG9fbWlzc2luZyhgQ29ydGlzb2wgbm1vbC9sYCkKICApICU+JSAKICBncm91cF9ieShzZXNzaW9uKSAlPiUgCiAgbXV0YXRlKAogICAgcHJvZ2VzdGVyb25lX21lYW4gPSBtZWFuKGBQcm9nZXN0ZXJvbmUgcGcvbWxgLCBuYS5ybSA9IFQpLAogICAgYHByb2dlc3Rlcm9uZV9kaWZmYCA9IGBQcm9nZXN0ZXJvbmUgcGcvbWxgIC0gcHJvZ2VzdGVyb25lX21lYW4sCiAgICBwcm9nZXN0ZXJvbmVfbG9nX21lYW4gPSBtZWFuKGxvZyhgUHJvZ2VzdGVyb25lIHBnL21sYCksIG5hLnJtID0gVCksCiAgICBwcm9nZXN0ZXJvbmVfbG9nX2RpZmYgPSBsb2coYFByb2dlc3Rlcm9uZSBwZy9tbGApIC0gcHJvZ2VzdGVyb25lX2xvZ19tZWFuLAogICAgCiAgICBlc3RyYWRpb2xfbWVhbiA9IG1lYW4oYEVzdHJhZGlvbCBwZy9tbGAsIG5hLnJtID0gVCksCiAgICBlc3RyYWRpb2xfZGlmZiA9IGBFc3RyYWRpb2wgcGcvbWxgIC0gZXN0cmFkaW9sX21lYW4sCiAgICBlc3RyYWRpb2xfbG9nX21lYW4gPSBtZWFuKGxvZyhgRXN0cmFkaW9sIHBnL21sYCksIG5hLnJtID0gVCksCiAgICBlc3RyYWRpb2xfbG9nX2RpZmYgPSBsb2coYEVzdHJhZGlvbCBwZy9tbGApIC0gZXN0cmFkaW9sX2xvZ19tZWFuLAoKICAgIGlibF9lc3RyYWRpb2xfbWVhbiA9IG1lYW4oYElCTF9Fc3RyYWRpb2wgcGcvbWxgLCBuYS5ybSA9IFQpLAogICAgaWJsX2VzdHJhZGlvbF9kaWZmID0gYElCTF9Fc3RyYWRpb2wgcGcvbWxgIC0gaWJsX2VzdHJhZGlvbF9tZWFuLAogICAgaWJsX2VzdHJhZGlvbF9sb2dfbWVhbiA9IG1lYW4obG9nKGBJQkxfRXN0cmFkaW9sIHBnL21sYCksIG5hLnJtID0gVCksCiAgICBpYmxfZXN0cmFkaW9sX2xvZ19kaWZmID0gbG9nKGBJQkxfRXN0cmFkaW9sIHBnL21sYCkgLSBpYmxfZXN0cmFkaW9sX2xvZ19tZWFuLAogICAgCiAgICB0ZXN0b3N0ZXJvbmVfbWVhbiA9IG1lYW4oYFRlc3Rvc3Rlcm9uZSBwZy9tbGAsIG5hLnJtID0gVCksCiAgICB0ZXN0b3N0ZXJvbmVfZGlmZiA9IGBUZXN0b3N0ZXJvbmUgcGcvbWxgIC0gdGVzdG9zdGVyb25lX21lYW4sCiAgICB0ZXN0b3N0ZXJvbmVfbG9nX21lYW4gPSBtZWFuKGxvZyhgVGVzdG9zdGVyb25lIHBnL21sYCksIG5hLnJtID0gVCksCiAgICB0ZXN0b3N0ZXJvbmVfbG9nX2RpZmYgPSBsb2coYFRlc3Rvc3Rlcm9uZSBwZy9tbGApIC0gdGVzdG9zdGVyb25lX2xvZ19tZWFuLAogICAgCiAgICBjb3J0aXNvbF9tZWFuID0gbWVhbihgQ29ydGlzb2wgbm1vbC9sYCwgbmEucm0gPSBUKSwKICAgIGNvcnRpc29sX2RpZmYgPSBgQ29ydGlzb2wgbm1vbC9sYCAtIGNvcnRpc29sX21lYW4sCiAgICBjb3J0aXNvbF9sb2dfbWVhbiA9IG1lYW4obG9nKGBDb3J0aXNvbCBubW9sL2xgKSwgbmEucm0gPSBUKSwKICAgIGNvcnRpc29sX2xvZ19kaWZmID0gbG9nKGBDb3J0aXNvbCBubW9sL2xgKSAtIGNvcnRpc29sX2xvZ19tZWFuCiAgKSAlPiUgCiAgdW5ncm91cCgpCmBgYAoKIyMjIEZlcnRpbGl0eSBhd2FyZW5lc3MKYGBge3J9CnRyYWNrZWRfd2luZG93cyA8LSAgczRfZm9sbG93dXAgJT4lIHNlbGVjdChzaG9ydCwgc3RhcnRzX3dpdGgoImF3YXJlX2ZlcnRpbGUiKSwgLWVuZHNfd2l0aCgiYmxvY2siKSwgLWF3YXJlX2ZlcnRpbGVfcmVhc29uX3VudXN1YWwsIC1hd2FyZV9mZXJ0aWxlX2VmZmVjdHMpICU+JSAKICBmaWx0ZXIoYXdhcmVfZmVydGlsZV9waGFzZXNfbnVtYmVyID4gMCkgJT4lIAogIG11dGF0ZV9hbGwoYXMuY2hhcmFjdGVyKSAlPiUgCiAgZ2F0aGVyKGN5Y2xlLCBkYXRlLCAtc2hvcnQsIC1hd2FyZV9mZXJ0aWxlX3BoYXNlc19udW1iZXIpICU+JSAKICB0YmxfZGYoKSAlPiUgCiAgbXV0YXRlKGN5Y2xlID0gc3RyX3N1YihjeWNsZSwgc3RyX2xlbmd0aCgiYXdhcmVfZmVydGlsZV8iKSArIDEpKSAlPiUgCiAgc2VwYXJhdGUoY3ljbGUsIGMoImN5Y2xlIiwgInN0YXJ0ZW5kIikpICU+JSAKICBtdXRhdGUoZGF0ZSA9IGFzLkRhdGUoZGF0ZSkpICU+JSAKICBzcHJlYWQoc3RhcnRlbmQsIGRhdGUpICU+JSAKICBtdXRhdGUod2luZG93X2xlbmd0aCA9IGVuZCAtIHN0YXJ0LAogICAgICAgICBkYXRlX29mX292dWxhdGlvbl9hd2FyZW5lc3MgPSBlbmQgLSBkYXlzKDEpKQoKczNfZGFpbHkgPC0gczNfZGFpbHkgJT4lIGxlZnRfam9pbiggdHJhY2tlZF93aW5kb3dzICU+JSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0KHNob3J0LCB3aW5kb3dfbGVuZ3RoLCBkYXRlX29mX292dWxhdGlvbl9hd2FyZW5lc3MpICU+JSAKICAgIG11dGF0ZShjcmVhdGVkX2RhdGUgPSBkYXRlX29mX292dWxhdGlvbl9hd2FyZW5lc3MpLCBieSA9IGMoInNob3J0IiwgImNyZWF0ZWRfZGF0ZSIpKQpgYGAKCgojIyMgQ29tcHV0ZSBtZW5zdHJ1YWwgb25zZXRzCgpUbyBjb21wdXRlIG1lbnN0cnVhbCBvbnNldHMgZnJvbSB0aGUgZGlhcnkgZGF0YSwgd2UgaGF2ZSB0byBjbGVhciBhIGZldyBodXJkbGVzOgoKLSBkaWFyaWVzIGNvdWxkIGJlIGZpbGxlZCBvdXQgdW50aWwgMyBhbSAoYW5kIGxhdGVyIGluIHNwZWNpYWwgY2FzZXMpLCBidXQgcGFydGljaXBhbnRzIHdpbGwgdGVuZCB0byBjb3VudCBiYWNrd2FyZHMgZnJvbSB0aGUgcHJlY2VkaW5nIGRheSB3aGVuIGFza2VkIHdoZW4gdGhlIGxhc3QgbWVuc3RydWF0aW9uIG9jY3VycmVkCi0gd2UgYXNrZWQgd29tZW4gb25seSBldmVyeSB+MyBkYXlzIGFib3V0IG1lbnN0cnVhdGlvbiAoLT4gaW50ZXJwb2xhdGUpCi0gd29tZW4gY291bGQgcmVwb3J0IHRoZSBzYW1lIG1lbnN0cnVhbCBvbnNldCBzZXZlcmFsIHRpbWVzICgtPiB1c2UgdGhlIHJlcG9ydCBjbG9zZXN0IHRvIHRoZSBvbnNldCwgbW9yZSBhY2N1cmF0ZSkKLSB3b21lbiByZXBvcnRlZCBhIGxhc3QgbWVuc3RydWFsIG9uc2V0IGluIHRoZSBkZW1vZ3JhcGhpYyBxdWVzdGlvbm5haXJlIHByZWNlZGluZyB0aGUgZGlhcnkgYW5kIGluIHRoZSBmb2xsb3ctdXAgc3VydmV5IGZvbGxvd2luZyB0aGUgZGlhcnkKLSB3ZSBuZWVkIHRvIGNvdW50IGJhY2t3YXJkIGFuZCBmb3J3YXJkIGZyb20gZWFjaCBtZW5zdHJ1YWwgb25zZXQKLSB3ZSBuZWVkIHRvIGluY2x1ZGUgdGhlIGRhdGVzIGZyb20gdGhlIGRlbW9ncmFwaGljIGFuZCB0aGUgZm9sbG93LXVwIHF1ZXN0aW9ubmFpcmUgd2l0aG91dCBvdmVyd3JpdGluZyBtb3JlIHBlcnRpbmVudCBkYXRlcyBmcm9tIHRoZSBkaWFyeQotIHdlIHdhbnQgdG8gImJyaWRnZSBnYXBzIiBiZXR3ZWVuIHJlcG9ydHMgb2YgbWVuc3RydWF0aW9uIHRoYXQgYXJlIGF0IG1vc3QgNDAgZGF5cyB3aWRlIChiZWNhdXNlIHdpZGVyIGdhcHMgcHJvYmFibHkgbWVhbiB0aGF0IHRoZXJlIHdhcyBzb21ldGhpbmcgZ29pbmcgb24gd2l0aCB0aGUgbWVuc3RydWFsIGN5Y2xlIHN1Y2ggYXMgYSBtaXNjYXJyaWFnZSwgbWVub3BhdXNlLCBldGMuKQoKVGhlcmVmb3JlIHdlIHVzZSBhIG11bHRpLXN0ZXAgcHJvY2VkdXJlOgoKMS4gQ29sbGVjdCB1bmlxdWUgbWVuc3RydWFsIG9uc2V0cyByZXBvcnRlZCBieSBlYWNoIHdvbWFuIGZyb20gcHJlLXN1cnZleSwgZGlhcnksIGFuZCBwb3N0LXN1cnZleQoyLiBFeHBhbmQgdGhlIG9uc2V0cyBpbnRvIHRpbWUtc2VyaWVzIGJ5IHBhcnRpY2lwYW50LgozLiAiTWVyZ2UiL3ByZWZlciByZXBvcnRzIGNsb3NlciB0byB0aGUgb25zZXQgd2hlbiBzZXZlcmFsIGRpZmZlcmVudCByZXBvcnRzIHdlcmUgbWFkZQo0LiBDb3VudCBmb3J3YXJkICYgYmFja3dhcmQuCjUuIEFzc2lnbiBjeWNsZSBudW1iZXJzLgo2LiBNZXJnZSBvbiBwYXJ0aWNpcGFudCAmIGNyZWF0ZWRfZGF0ZS4KCmBgYHtyIG1lbnN0cnVhbF9vbnNldHN9CiMgc3RlcCAxCm1lbnN0cnVhbF9vbnNldHMgPSBzM19kYWlseSAlPiUgCiAgZ3JvdXBfYnkoc2Vzc2lvbikgJT4lCiAgYXJyYW5nZShjcmVhdGVkKSAlPiUgCiAgbXV0YXRlKAogICAgbWVuc3RydWFsX29uc2V0X2RhdGUgPSBhcy5EYXRlKG1lbnN0cnVhbF9vbnNldF9kYXRlKSwKICAgIG1lbnN0cnVhbF9vbnNldF9kYXRlX2luZmVycmVkID0gYXMuRGF0ZShpZmVsc2UoIWlzLm5hKG1lbnN0cnVhbF9vbnNldF9kYXRlKSwgCiAgICBtZW5zdHJ1YWxfb25zZXRfZGF0ZSwgIyBpZiBkYXRlIHdhcyBnaXZlbiwgdGFrZSBpdAogICAgIGlmZWxzZSghaXMubmEobWVuc3RydWFsX29uc2V0KSwgIyBpZiBkYXlzIGFnbyB3YXMgZ2l2ZW4KICAgICAgICAgICAgY3JlYXRlZF9kYXRlIC0gZGF5cyhtZW5zdHJ1YWxfb25zZXQgLSAxKSwgIyBzdWJ0cmFjdCB0aGVtIGZyb20gY3VycmVudCBkYXRlCiAgICAgICAgICAgIGFzLkRhdGUoTkEpKSAKICAgICApLCBvcmlnaW4gPSAiMTk3MC0wMS0wMSIpCiAgKSAlPiUgCiAgc2VsZWN0KHNlc3Npb24sIGNyZWF0ZWRfZGF0ZSwgbWVuc3RydWFsX29uc2V0X2RhdGVfaW5mZXJyZWQpICU+JSAKICBmaWx0ZXIoIWlzLm5hKG1lbnN0cnVhbF9vbnNldF9kYXRlX2luZmVycmVkKSkgJT4lIAogIHVuaXF1ZSgpCgojIyBhZGQgaW4gdGhlIG1lbnN0cnVhbCBvbnNldHMgd2UgZ290IGZyb20gdGhlIHByZSBhbmQgcG9zdCBzdXJ2ZXkgYW5kIHRoZSBsYWIKbGFiX29uc2V0cyA8LSBsYWIgJT4lIHNlbGVjdChzZXNzaW9uLCBjcmVhdGVkX2RhdGUsIG1lbnN0cnVhbF9vbnNldF9kYXRlX2luZmVycmVkID0gYE1lbnN0cnVhbCBPbnNldGApICU+JSAKICBtdXRhdGUobWVuc3RydWFsX29uc2V0X2RhdGVfaW5mZXJyZWQgPSBhcy5EYXRlKG1lbnN0cnVhbF9vbnNldF9kYXRlX2luZmVycmVkKSkgJT4lIAogIGZpbHRlcighaXMubmEobWVuc3RydWFsX29uc2V0X2RhdGVfaW5mZXJyZWQpKQoKbW9ucyA9IG1lbnN0cnVhbF9vbnNldHMgJT4lIAogIHNlbGVjdChzZXNzaW9uLCBjcmVhdGVkX2RhdGUsIG1lbnN0cnVhbF9vbnNldF9kYXRlX2luZmVycmVkKSAlPiUgCiAgbXV0YXRlKGRhdGVfb3JpZ2luID0gImRpYXJ5IikgJT4lIAogICBiaW5kX3Jvd3MoCiAgICAgIHMxX21lbnN0cnVhdGlvbl9zdGFydCAlPiUgbXV0YXRlKGRhdGVfb3JpZ2luID0gImRlbW8iKSwgCiAgICAgIHM1X2hhZG1lbnN0cnVhdGlvbiAlPiUgbXV0YXRlKGRhdGVfb3JpZ2luID0gImZvbGxvd3VwIiksCiAgICAgIGxhYl9vbnNldHMgJT4lIG11dGF0ZShkYXRlX29yaWdpbiA9ICJsYWIiKQogICAgICkgJT4lIAogIGZpbHRlciggIWlzLm5hKG1lbnN0cnVhbF9vbnNldF9kYXRlX2luZmVycmVkKSkgJT4lCiAgYXJyYW5nZShzZXNzaW9uLCBtZW5zdHJ1YWxfb25zZXRfZGF0ZV9pbmZlcnJlZCwgY3JlYXRlZF9kYXRlKSAlPiUKICB1bmlxdWUoKSAlPiUKICBncm91cF9ieShzZXNzaW9uKSAlPiUKICAgICAgIyBzdGVwIDM6IHByZWZlciByZXBvcnRzIGNsb3NlciB0byBldmVudCBpZiB0aGV5IGNvbmZsaWN0CiAgbXV0YXRlKAogICAgb25zZXRfZGlmZiA9IGFicyggYXMuZG91YmxlKCBsYWcobWVuc3RydWFsX29uc2V0X2RhdGVfaW5mZXJyZWQpIC0gbWVuc3RydWFsX29uc2V0X2RhdGVfaW5mZXJyZWQsIHVuaXRzID0gImRheXMiKSksICMgd2FzIHRoZXJlIGEgY2hhbmdlIGNvbXBhcmVkIHRvIHRoZSBsYXN0IHJlcG9ydGVkIG1lbnN0cnVhbCBvbnNldCAoZmlyc3Qgb25lIGdldHMgTkEpCiAgICBtZW5zdHJ1YWxfb25zZXRfZGF0ZV9pbmZlcnJlZCA9IGlmX2Vsc2Uob25zZXRfZGlmZiA8IDcsICMgaWYgbGFzdCBkYXRlIGlzIGtub3duLCBidXQgaXMgc2xpZ2h0bHkgZGlmZmVyZW50IGZyb20gY3VycmVudCBkYXRlIAogICAgICAgICAgICAgICAgIGFzLkRhdGUoTkEpLCAjIGF0dHJpYnV0ZSBpdCB0byBtZW1vcnksIG5vdCBleHRyZW1lbHkgc2hvcnQgY3ljbGUsIHVzZSBmcmVzaGVyIGRhdGUKICAgICAgICAgICAgICAgICBtZW5zdHJ1YWxfb25zZXRfZGF0ZV9pbmZlcnJlZCwgIyBpZiBpdCdzIGEgYmlnIGRpZmZlcmVuY2UsIHVzZSB0aGUgY3VycmVudCBkYXRlIAogICAgICAgICAgICAgICAgIG1lbnN0cnVhbF9vbnNldF9kYXRlX2luZmVycmVkICMgdXNlIGN1cnJlbnQgZGF0ZSBpZiBsYXN0IGRhdGUgbm90IGtub3duL2ZpcnN0IG9uc2V0CiAgICAgICAgICAgICAgICAgKSAjIGlmIG5vIGRhdGUgaXMgYXNzaWduZWQgdG9kYXksIGtlZXAgaXQgbGlrZSB0aGF0CiAgKSAlPiUgIyBjYXJyeSB0aGUgbGFzdCBNTyBmb3J3YXJkCiAgIyBtdXRhdGUoY3JlYXRlZF9kYXRlID0gbWVuc3RydWFsX29uc2V0X2RhdGVfaW5mZXJyZWQpICU+JQogIGZpbHRlcighaXMubmEobWVuc3RydWFsX29uc2V0X2RhdGVfaW5mZXJyZWQpKQoKbnJvdyhtb25zKQojIG1vbnMgJT4lIGZpbHRlcihjcmVhdGVkX2RhdGUgPCBtZW5zdHJ1YWxfb25zZXRfZGF0ZV9pbmZlcnJlZCkgJT4lIFZpZXcKbW9ucyAlPiUgZ3JvdXBfYnkoc2Vzc2lvbiwgY3JlYXRlZF9kYXRlKSAlPiUgZmlsdGVyKG4oKT4gMSkKbW9ucyAlPiUgZGlzdGluY3Qoc2Vzc2lvbiwgY3JlYXRlZF9kYXRlKSAlPiUgbnJvdygpCgptb25zICU+JSBncm91cF9ieShzZXNzaW9uKSAlPiUgZmlsdGVyKCJsYWIiICVpbiUgZGF0ZV9vcmlnaW4pCgojIG1vbnMgJT4lIGZpbHRlcihzZXNzaW9uICVzdGFydHNfd2l0aCUgIjJ4LWp1cSIpICU+JSBWaWV3KCkKCgojIG5vdyB0dXJuIG91ciBkYXRhc2V0IG9mIG1lbnN0cnVhbCBvbnNldHMgaW50byBmdWxsIHRpbWUgc2VyaWVzCm1lbnN0cnVhbF9kYXlzID0gbW9ucyAlPiUgZGlzdGluY3Qoc2Vzc2lvbiwgY3JlYXRlZF9kYXRlKSAlPiUgCiAgYXJyYW5nZShzZXNzaW9uLCBjcmVhdGVkX2RhdGUpICU+JQogICMgc3RlcCAyIGV4cGFuZCBpbnRvIHRpbWUtc2VyaWVzIGZvciBwYXJ0aWNpcGFudAogIGZ1bGxfam9pbihzM19kYWlseSAlPiUgc2VsZWN0KHNlc3Npb24sIGNyZWF0ZWRfZGF0ZSksIGJ5ID0gYygic2Vzc2lvbiIsICJjcmVhdGVkX2RhdGUiKSkgJT4lCiAgZnVsbF9qb2luKG1vbnMgJT4lIG11dGF0ZShjcmVhdGVkX2RhdGUgPSBtZW5zdHJ1YWxfb25zZXRfZGF0ZV9pbmZlcnJlZCksIGJ5ID0gYygic2Vzc2lvbiIsICJjcmVhdGVkX2RhdGUiKSkgJT4lCiAgbXV0YXRlKGRhdGVfb3JpZ2luID0gaWZfZWxzZShpcy5uYShkYXRlX29yaWdpbiksICJub3Rfb25zZXQiLCBkYXRlX29yaWdpbikpICU+JSAKICBncm91cF9ieShzZXNzaW9uKSAlPiUKICBjb21wbGV0ZShjcmVhdGVkX2RhdGUgPSBmdWxsX3NlcShjcmVhdGVkX2RhdGUsIHBlcmlvZCA9IDEpKSAlPiUKICBtdXRhdGUoZGF0ZV9vcmlnaW4gPSBpZl9lbHNlKGlzLm5hKGRhdGVfb3JpZ2luKSwgInVub2JzZXJ2ZWRfZGF5IiwgZGF0ZV9vcmlnaW4pKSAlPiUgCiAgYXJyYW5nZShjcmVhdGVkX2RhdGUpICU+JQogIGRpc3RpbmN0KHNlc3Npb24sIGNyZWF0ZWRfZGF0ZSwgbWVuc3RydWFsX29uc2V0X2RhdGVfaW5mZXJyZWQsIC5rZWVwX2FsbCA9IFRSVUUpICU+JSAKICBhcnJhbmdlKHNlc3Npb24sIGNyZWF0ZWRfZGF0ZSwgbWVuc3RydWFsX29uc2V0X2RhdGVfaW5mZXJyZWQpICU+JSAKICBkaXN0aW5jdChzZXNzaW9uLCBjcmVhdGVkX2RhdGUsIC5rZWVwX2FsbCA9IFRSVUUpCgp0YWJsZShtZW5zdHJ1YWxfZGF5cyRkYXRlX29yaWdpbiwgZXhjbHVkZSA9IE5VTEwpCgptZW5zdHJ1YWxfZGF5cyAlPiUgZmlsdGVyKGRhdGVfb3JpZ2luICE9ICJmaWxsZWRpbiIpICU+JSBncm91cF9ieShzZXNzaW9uKSAlPiUgc3VtbWFyaXNlKG4gPSBuKCkpICU+JSBzdW1tYXJpc2UobWVhbihuKSkKbWVuc3RydWFsX2RheXMgJT4lIGdyb3VwX2J5KHNlc3Npb24pICU+JSBzdW1tYXJpc2UobiA9IG4oKSkgJT4lIHN1bW1hcmlzZShtZWFuKG4pKQptZW5zdHJ1YWxfZGF5cyAlPiUgZ3JvdXBfYnkoc2Vzc2lvbikgJT4lIHN1bW1hcmlzZShuID0gbigpKSAlPiUgcHVsbChuKSAlPiUgcXBsb3QoKQoKCm1lbnN0cnVhbF9kYXlzICU+JSBkcm9wX25hKHNlc3Npb24sIGNyZWF0ZWRfZGF0ZSkgJT4lICAKICAgICAgICAgICAgZ3JvdXBfYnkoc2Vzc2lvbiwgY3JlYXRlZF9kYXRlKSAlPiUgZmlsdGVyKG4oKT4xKSAlPiUgbnJvdygpICU+JSB7IC4gPT0gMH0gJT4lIHN0b3BpZm5vdCgpCgojIG1lbnN0cnVhbF9vbnNldHMgJT4lIGZpbHRlcihzZXNzaW9uID09ICJfMmVmQ2hNZ21zWEFZbWFsWWxSWTllcHhTX3dzZTB5dFdZdHRWNnRMaTZGVWQyRlJFTmtyOUpnVm5tdHphTUNzIikKIyBtb25zICU+JSBmaWx0ZXIoc2Vzc2lvbiAlc3RhcnRzX3dpdGglICJfMnN1ZlNVZklXak5YZzZ4ZlJ6SmFDaWQ5anprWSIpICU+JSBWaWV3KCkKIyBtZW5zdHJ1YWxfb25zZXRzICU+JSBmaWx0ZXIoc2Vzc2lvbiAlc3RhcnRzX3dpdGglICJfMnN1ZlNVZklXak5YZzZ4ZlJ6SmFDaWQ5anprWSIpICU+JSBWaWV3KCkKCm1lbnN0cnVhbF9kYXlzID0gbWVuc3RydWFsX2RheXMgJT4lCiAgZ3JvdXBfYnkoc2Vzc2lvbikgJT4lIAogIG11dGF0ZSgKICAgICMgY2FycnkgdGhlIGxhc3Qgb2JzZXJ2YXRpb24gKHRoZSBsYXN0IG9ic2VydmVkIG1lbnN0cnVhbCBvbnNldCkgYmFja3dhcmQvZm9yd2FyZCAod2l0aGluIHBlcnNvbiksIGJ1dCB3ZSBkb24ndCBkbyB0aGlzIGlmIHdlJ2QgYnJpZGdlIG1vcmUgdGhhbiA0MCBkYXlzIHRoaXMgd2F5CiAgICAjIGZpcnN0IHdlIGNhcnJ5IGl0IGJhY2t3YXJkIChiZWNhdXNlIHJlcG9ydGluZyBpcyByZXRyb3NwZWN0aXZlKQogICAgbmV4dF9tZW5zdHJ1YWxfb25zZXQgPSByY2FtaXNjOjpyZXBlYXRfbGFzdChtZW5zdHJ1YWxfb25zZXRfZGF0ZV9pbmZlcnJlZCwgZm9yd2FyZCA9IEZBTFNFKSwKICAgICMgdGhlbiB3ZSBjYXJyeSBpdCBmb3J3YXJkCiAgICBsYXN0X21lbnN0cnVhbF9vbnNldCA9IHJjYW1pc2M6OnJlcGVhdF9sYXN0KG1lbnN0cnVhbF9vbnNldF9kYXRlX2luZmVycmVkKSwKICAgICMgaW4gdGhlIG5leHQgY3ljbGUsIGNvdW50IHRvIHRoZSBuZXh0IG9uc2V0LCBub3QgdGhlIGxhc3QKICAgIG5leHRfbWVuc3RydWFsX29uc2V0ID0gaWZfZWxzZShuZXh0X21lbnN0cnVhbF9vbnNldCA9PSBsYXN0X21lbnN0cnVhbF9vbnNldCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFkKG5leHRfbWVuc3RydWFsX29uc2V0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0X21lbnN0cnVhbF9vbnNldCksCiAgICAjIGNhbGN1bGF0ZSB0aGUgZGlmZiB0byBjdXJyZW50IGRhdGUKICAgIG1lbnN0cnVhbF9vbnNldF9kYXlzX3VudGlsID0gYXMubnVtZXJpYyhjcmVhdGVkX2RhdGUgLSBuZXh0X21lbnN0cnVhbF9vbnNldCksCiAgICBtZW5zdHJ1YWxfb25zZXRfZGF5c19zaW5jZSA9IGFzLm51bWVyaWMoY3JlYXRlZF9kYXRlIC0gbGFzdF9tZW5zdHJ1YWxfb25zZXQpCiAgICApCgptZW5zdHJ1YWxfZGF5cyAlPiUgZHJvcF9uYShzZXNzaW9uLCBjcmVhdGVkX2RhdGUpICU+JSAgCiAgICAgICAgICAgIGdyb3VwX2J5KHNlc3Npb24sIGNyZWF0ZWRfZGF0ZSkgJT4lIGZpbHRlcihuKCk+MSkgJT4lIG5yb3coKSAlPiUgeyAuID09IDB9ICU+JSBzdG9waWZub3QoKQoKCgphdmdfY3ljbGVfbGVuZ3RocyA9IG1lbnN0cnVhbF9kYXlzICU+JSAKICBzZWxlY3Qoc2Vzc2lvbiwgbGFzdF9tZW5zdHJ1YWxfb25zZXQsIG5leHRfbWVuc3RydWFsX29uc2V0KSAlPiUKICBtdXRhdGUobmV4dF9tZW5zdHJ1YWxfb25zZXRfaWZfbm9fbGFzdCA9IGlmX2Vsc2UoaXMubmEobGFzdF9tZW5zdHJ1YWxfb25zZXQpLCBuZXh0X21lbnN0cnVhbF9vbnNldCwgYXMuRGF0ZShOQV9jaGFyYWN0ZXJfKSkpICU+JSAKICBhcnJhbmdlKHNlc3Npb24sIG5leHRfbWVuc3RydWFsX29uc2V0X2lmX25vX2xhc3QsIGxhc3RfbWVuc3RydWFsX29uc2V0KSAlPiUgCiAgc2VsZWN0KC1uZXh0X21lbnN0cnVhbF9vbnNldCkgJT4lIAogIGRpc3RpbmN0KHNlc3Npb24sIGxhc3RfbWVuc3RydWFsX29uc2V0LCBuZXh0X21lbnN0cnVhbF9vbnNldF9pZl9ub19sYXN0LCAua2VlcF9hbGwgPSBUUlVFKSAlPiUgCiAgZ3JvdXBfYnkoc2Vzc2lvbikgJT4lIAogIG11dGF0ZSgKICAgIG51bWJlcl9vZl9jeWNsZXMgPSBuKCksCiAgICBjeWNsZV9uciA9IHJvd19udW1iZXIoKSwKICAgIGN5Y2xlX2xlbmd0aCA9IGFzLmRvdWJsZShsZWFkKGxhc3RfbWVuc3RydWFsX29uc2V0KSAtIGxhc3RfbWVuc3RydWFsX29uc2V0LCB1bml0cyA9ICJkYXlzIiksCiAgICBjeWNsZV9ucl9mdWxseV9vYnNlcnZlZCA9IHN1bSghaXMubmEoY3ljbGVfbGVuZ3RoKSksCiAgICBtZWFuX2N5Y2xlX2xlbmd0aF9kaWFyeSA9IG1lYW4oY3ljbGVfbGVuZ3RoLCBuYS5ybSA9IFRSVUUpLAogICAgbWVkaWFuX2N5Y2xlX2xlbmd0aF9kaWFyeSA9IG1lZGlhbihjeWNsZV9sZW5ndGgsIG5hLnJtID0gVFJVRSkpICU+JSAKICBmaWx0ZXIoIWlzLm5hKGxhc3RfbWVuc3RydWFsX29uc2V0KSB8ICFpcy5uYShuZXh0X21lbnN0cnVhbF9vbnNldF9pZl9ub19sYXN0KSkKCiMgYXZnX2N5Y2xlX2xlbmd0aHMgJT4lIGZpbHRlcihzZXNzaW9uICVzdGFydHNfd2l0aCUgIl9zcXRNZjUiKSAlPiUgVmlldygiY3ljbGVzIikKCnRhYmxlKGlzLm5hKGF2Z19jeWNsZV9sZW5ndGhzJGN5Y2xlX25yKSkKCiMgbWVuc3RydWFsX29uc2V0cyAlPiUgZmlsdGVyKHNlc3Npb24gJXN0YXJ0c193aXRoJSAiXzJzdWZTVWZJV2pOWGc2eGZSekphQ2lkOWp6a1kiKSAlPiUgVmlldygpCgpnYXBzIDwtIHMzX2RhaWx5ICU+JSBmaWx0ZXIoc2Vzc2lvbiAlc3RhcnRzX3dpdGglICItLV9NZ0ZkIikgJT4lIHRibF9kZigpICU+JSBwdWxsKGNyZWF0ZWRfZGF0ZSkgJT4lIGRpZmYoKSAlPiUgYXMubnVtZXJpYyguKQpzdG9waWZub3QoIWFsbChnYXBzID09IDEpKQoKczNfZGFpbHkgPC0gczNfZGFpbHkgJT4lIAogIGdyb3VwX2J5KHNlc3Npb24pICU+JSAKICBjb21wbGV0ZShjcmVhdGVkX2RhdGUgPSBmdWxsX3NlcShjcmVhdGVkX2RhdGUsIHBlcmlvZCA9IDEpKSAlPiUgIyBpbmNsdWRlIHRoZSBnYXAgZGF5cyBpbiB0aGUgZGlhcnkgKGhhcHBlbnMgYnkgZGVmYXVsdCBpbiBmb3JtciwgdGhpcyBqdXN0IHRvIGVuc3VyZSkKICB1bmdyb3VwKCkgJT4lIAogIG11dGF0ZShkaWFyeV9kYXlfb2JzZXJ2YXRpb24gPSBjYXNlX3doZW4oCiAgICBpcy5uYShjcmVhdGVkKSB+ICJpbnRlcnBvbGF0ZWQiLAogICAgaXMubmEobW9kaWZpZWQpIH4gIm5vdF9hbnN3ZXJlZCIsCiAgICAhaXMubmEoZXhwaXJlZCkgfiAic3RhcnRlZF9ub3RfZmluaXNoZWQiLAogICAgaXMubmEoZW5kZWQpIH4gIm5vdF9maW5pc2hlZCIsCiAgICAhaXMubmEoZW5kZWQpIH4gImZpbmlzaGVkIgogICkpICU+JSAKICBsZWZ0X2pvaW4obWVuc3RydWFsX2RheXMgJT4lIAogICAgc2VsZWN0KHNlc3Npb24sIGNyZWF0ZWRfZGF0ZSwgbmV4dF9tZW5zdHJ1YWxfb25zZXQsIGxhc3RfbWVuc3RydWFsX29uc2V0LCBtZW5zdHJ1YWxfb25zZXRfZGF5c191bnRpbCwgbWVuc3RydWFsX29uc2V0X2RheXNfc2luY2UsIGRhdGVfb3JpZ2luKSwKICAgIGJ5ID0gYygic2Vzc2lvbiIsICJjcmVhdGVkX2RhdGUiKQogICkgJT4lIAogIG11dGF0ZSgKICBtZW5zdHJ1YXRpb25fdG9kYXkgPSBpZl9lbHNlKG1lbnN0cnVhdGlvbl9zaW5jZV9sYXN0X2VudHJ5ID09IDEsIGFzLm51bWVyaWMobWVuc3RydWF0aW9uX3RvZGF5KSwgMCksCiAgbWVuc3RydWF0aW9uX2xhYmVsbGVkID0gZmFjdG9yKGlmX2Vsc2UoISBpcy5uYShtZW5zdHJ1YXRpb25fdG9kYXkpLAogICAgICAgaWZfZWxzZShtZW5zdHJ1YXRpb25fdG9kYXkgPT0gMSwgInllcyIsICJubyIpLAogICAgICAgaWZfZWxzZShtZW5zdHJ1YWxfb25zZXRfZGF5c19zaW5jZSA8PSA1LCAKICAgICAgICAgICAgICBpZl9lbHNlKG1lbnN0cnVhbF9vbnNldF9kYXlzX3NpbmNlID09IDAsICJ5ZXMiLCAicHJvYmFibHkiLCAibm8iKSwgCiAgICAgICAgICAgICAgICAibm8iLCAibm8iKSksCiAJCQkJIGxldmVscyA9IGMoJ3llcycsICdwcm9iYWJseScsICdubycpKQogICkgJT4lIAogICAgbXV0YXRlKG5leHRfbWVuc3RydWFsX29uc2V0X2lmX25vX2xhc3QgPSBpZl9lbHNlKGlzLm5hKGxhc3RfbWVuc3RydWFsX29uc2V0KSwgbmV4dF9tZW5zdHJ1YWxfb25zZXQsIGFzLkRhdGUoTkFfY2hhcmFjdGVyXykpKQoKZ2FwcyA8LSBzM19kYWlseSAlPiUgZmlsdGVyKHNlc3Npb24gJXN0YXJ0c193aXRoJSAiLS1fTWdGZCIpICU+JSB0YmxfZGYoKSAlPiUgcHVsbChjcmVhdGVkX2RhdGUpICU+JSBkaWZmKCkgJT4lIGFzLm51bWVyaWMoLikKc3RvcGlmbm90KGFsbChnYXBzID09IDEpKQoKczNfZGFpbHkgPC0gczNfZGFpbHkgJT4lIAogIGdyb3VwX2J5KHNlc3Npb24pICU+JSAKICBtdXRhdGUoZmlyc3RfZGlhcnlfZGF5ID0gZmlyc3QobmEub21pdChmaXJzdF9kaWFyeV9kYXkpKSwKICAgICAgICAgZGF5X251bWJlciA9IHJvdW5kKGFzLm51bWVyaWMoYXMuRGF0ZShjcmVhdGVkX2RhdGUpIC0gZmlyc3RfZGlhcnlfZGF5LCB1bml0ID0gJ2RheXMnKSkpICU+JSAKICB1bmdyb3VwKCkKCiMgczNfZGFpbHkgJT4lIGZpbHRlcihpcy5uYShkYXlfbnVtYmVyKSkgJT4lIHNlbGVjdChzZXNzaW9uLCBzaG9ydCwgY3JlYXRlZF9kYXRlLCBlbmRlZCwgZmlyc3RfZGlhcnlfZGF5KSAlPiUgYXJyYW5nZShzaG9ydCwgY3JlYXRlZF9kYXRlKSAlPiUgVmlldwp0YWJsZShzM19kYWlseSRkYXlfbnVtYmVyLCBleGNsdWRlID0gTlVMTCkKdGFibGUoczNfZGFpbHkgJT4lIGRyb3BfbmEoZW5kZWQpICU+JSBwdWxsKGRheV9udW1iZXIpLCBleGNsdWRlID0gTlVMTCkKdGVzdHRoYXQ6OmV4cGVjdF90cnVlKGFsbChzM19kYWlseSAlPiUgZHJvcF9uYShlbmRlZCkgJT4lIHB1bGwoZGF5X251bWJlcikgJWluJSAwOjcwKSkKCgpzdG9waWZub3QoczNfZGFpbHkgJT4lIGRyb3BfbmEoc2Vzc2lvbiwgZGF5X251bWJlcikgJT4lIGdyb3VwX2J5KHNlc3Npb24sIGRheV9udW1iZXIpICU+JSBmaWx0ZXIobigpID4gMSkgJT4lIG5yb3coKSA9PSAwKQoKZ2FwcyA8LSBzM19kYWlseSAlPiUgCiAgZHJvcF9uYShzZXNzaW9uKSAlPiUgCiAgZ3JvdXBfYnkoc2Vzc2lvbikgJT4lIAogIHN1bW1hcmlzZShub19nYXBzID0gYWxsKGFzLm51bWVyaWMoZGlmZihjcmVhdGVkX2RhdGUpKSA9PSAxKSwKICAgICAgICAgICAgbiA9IG4oKSwKICAgICAgICAgICAgcmFuZ2UgPSBwYXN0ZShyYW5nZShkYXlfbnVtYmVyKSwgY29sbGFwc2UgPSAnLScpKQoKc3RvcGlmbm90KGFsbChnYXBzJG5vX2dhcHMpKQojIHNvcnQodGFibGUoZ2FwcyRyYW5nZSkpCmBgYAoKIyMjIEVzdGltYXRlIGRheSBvZiBvdnVsYXRpb24KYGBge3J9CiMgczNfZGFpbHkgJT4lIGZpbHRlcihzaG9ydCA9PSAiX3NxdE1mNSIpICU+JSBzZWxlY3Qoc2hvcnQsIGNyZWF0ZWRfZGF0ZSwgZW5kZWQsIG1lbnN0cnVhdGlvbl9sYWJlbGxlZCwgbmV4dF9tZW5zdHJ1YWxfb25zZXRfaWZfbm9fbGFzdCwgbGFzdF9tZW5zdHJ1YWxfb25zZXQpICU+JSBWaWV3KCJkYXlzIikKCiAgCnMzX2RhaWx5IDwtIHMzX2RhaWx5ICU+JSAKICAgIGxlZnRfam9pbihhdmdfY3ljbGVfbGVuZ3RocywgYnkgPSBjKCJzZXNzaW9uIiwgImxhc3RfbWVuc3RydWFsX29uc2V0IiwgIm5leHRfbWVuc3RydWFsX29uc2V0X2lmX25vX2xhc3QiKSkgJT4lIAogIGxlZnRfam9pbihzMV9kZW1vICU+JSBzZWxlY3Qoc2Vzc2lvbiwgbWVuc3RydWF0aW9uX2xlbmd0aCksIGJ5ID0gJ3Nlc3Npb24nKSAlPiUgCiAgbXV0YXRlKAogICAgCW5leHRfbWVuc3RydWFsX29uc2V0X2luZmVycmVkID0gbGFzdF9tZW5zdHJ1YWxfb25zZXQgKyBkYXlzKG1lbnN0cnVhdGlvbl9sZW5ndGgpLAogICAgCVJDRF9pbmZlcnJlZCA9IGFzLm51bWVyaWMoY3JlYXRlZF9kYXRlIC0gbmV4dF9tZW5zdHJ1YWxfb25zZXRfaW5mZXJyZWQpCiAgKQoKczNfZGFpbHkgJT4lIGZpbHRlcihzaG9ydCA9PSAiX3NxdE1mNSIsIGNyZWF0ZWRfZGF0ZSA9PSAiMjAxNi0wOC0yNSIpICU+JSBwdWxsKGN5Y2xlX25yKSAlPiUgaXMubmEoKSAlPiUgaXNGQUxTRSgpICU+JSBzdG9waWZub3QoKQoKeHRhYnMofiBzM19kYWlseSRkaWFyeV9kYXlfb2JzZXJ2YXRpb24gKyBpcy5uYShzM19kYWlseSRjeWNsZV9ucikpCgpzM19kYWlseSA8LSBzM19kYWlseSAlPiUgCiAgZ3JvdXBfYnkoc2Vzc2lvbiwgY3ljbGVfbnIpICU+JSAKICBtdXRhdGUoCiAgICAgICAgIGx1dGVhbF9CQyA9IGlmX2Vsc2UobWVuc3RydWFsX29uc2V0X2RheXNfdW50aWwgPj0gLTE1LCAxLCAwKSwKICAgICAgICAgZm9sbGljdWxhcl9GQyA9IGlmX2Vsc2UobWVuc3RydWFsX29uc2V0X2RheXNfc2luY2UgPD0gMTUsIDEsIDApCiAgICAgICAgICkgJT4lIAogIG11dGF0ZSgKICAgIGRheV9saF9zdXJnZSA9IGlmX2Vsc2UoY3JlYXRlZF9kYXRlID09IGBEYXRlIExIIHN1cmdlYCwgMSwgMCksCiAgICBkYXlfb2Zfb3Z1bGF0aW9uID0gaWZfZWxzZShtZW5zdHJ1YWxfb25zZXRfZGF5c191bnRpbCA9PSAtMTUsIDEsIDApLAogICAgZGF5X29mX292dWxhdGlvbl9pbmZlcnJlZCA9IGlmX2Vsc2UoUkNEX2luZmVycmVkID09IC0xNSwgMSwgMCksCiAgICBkYXlfb2Zfb3Z1bGF0aW9uX2ZvcndhcmRfY291bnRlZCA9IGlmX2Vsc2UobWVuc3RydWFsX29uc2V0X2RheXNfc2luY2UgPT0gMTQsIDEsIDApLAogICAgZGF0ZV9vZl9vdnVsYXRpb25fQkMgPSBtaW4oaWZfZWxzZShkYXlfb2Zfb3Z1bGF0aW9uID09IDEsIGNyZWF0ZWRfZGF0ZSwgc3RydWN0dXJlKE5BX3JlYWxfLCBjbGFzcz0iRGF0ZSIpKSwgbmEucm0gPSBUUlVFKSwKICAgIGRhdGVfb2Zfb3Z1bGF0aW9uX2luZmVycmVkID0gbWluKGlmX2Vsc2UoZGF5X29mX292dWxhdGlvbl9pbmZlcnJlZCA9PSAxLCBjcmVhdGVkX2RhdGUsIHN0cnVjdHVyZShOQV9yZWFsXywgY2xhc3M9IkRhdGUiKSksIG5hLnJtID0gVFJVRSksCiAgICBkYXRlX29mX292dWxhdGlvbl9mb3J3YXJkX2NvdW50ZWQgPSBtaW4oaWZfZWxzZShkYXlfb2Zfb3Z1bGF0aW9uX2ZvcndhcmRfY291bnRlZCA9PSAxLCBjcmVhdGVkX2RhdGUsIHN0cnVjdHVyZShOQV9yZWFsXywgY2xhc3M9IkRhdGUiKSksIG5hLnJtID0gVFJVRSksCiAgICBkYXRlX29mX292dWxhdGlvbl9MSCA9IG1pbihgRGF0ZSBMSCBzdXJnZWAgKyBkYXlzKDEpLCBuYS5ybSA9IFQpLAogICAgRFJMSCA9IGFzLm51bWVyaWMoY3JlYXRlZF9kYXRlIC0gZGF0ZV9vZl9vdnVsYXRpb25fTEgpLAogICAgRFJMSCA9IGlmX2Vsc2UoYmV0d2VlbihEUkxILCAtMTUsIDE1KSwgRFJMSCwgTkFfcmVhbF8pCiAgKSAlPiUgCiAgdW5ncm91cCgpICU+JSAKICBtdXRhdGVfYXQodmFycyhzdGFydHNfd2l0aCgiZGF0ZV9vZl9vdnVsYXRpb25fIikpLCBmdW5zKGlmX2Vsc2UoaXMuaW5maW5pdGUoLiksIGFzLkRhdGUoTkFfY2hhcmFjdGVyXyksLikpKQoKCgpzM19kYWlseSA8LSBzM19kYWlseSAlPiUgCiAgZ3JvdXBfYnkoc2hvcnQsIGN5Y2xlX25yKSAlPiUgCiAgbXV0YXRlKGRhdGVfb2Zfb3Z1bGF0aW9uX2F3YXJlbmVzc19uciA9IG5fbm9ubWlzc2luZyhkYXRlX29mX292dWxhdGlvbl9hd2FyZW5lc3MpLAogICAgICAgICBkYXRlX29mX292dWxhdGlvbl9hd2FyZW5lc3MgPSBpZl9lbHNlKGRhdGVfb2Zfb3Z1bGF0aW9uX2F3YXJlbmVzc19uciA9PSAxICYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvd19sZW5ndGggPiAzICYgd2luZG93X2xlbmd0aCA8IDksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdChuYS5vbWl0KGRhdGVfb2Zfb3Z1bGF0aW9uX2F3YXJlbmVzcykpLCBhcy5EYXRlKE5BX2NoYXJhY3Rlcl8pKSkgJT4lIAogIG11dGF0ZShmZXJ0aWxlX2F3YXJlbmVzcyA9IGNhc2Vfd2hlbigKICAgIGlzLm5hKGRhdGVfb2Zfb3Z1bGF0aW9uX2F3YXJlbmVzcykgfiBOQV9yZWFsXywKICAgIGNyZWF0ZWRfZGF0ZSA8IChkYXRlX29mX292dWxhdGlvbl9hd2FyZW5lc3MgKyAxIC0gd2luZG93X2xlbmd0aCkgfiAwLAogICAgY3JlYXRlZF9kYXRlID4gKGRhdGVfb2Zfb3Z1bGF0aW9uX2F3YXJlbmVzcyArIDEpIH4gMCwKICAgIFRSVUUgfiAxCiAgKSkgJT4lIAogIHVuZ3JvdXAoKQoKdGFibGUoIWlzLm5hKHMzX2RhaWx5JGRhdGVfb2Zfb3Z1bGF0aW9uX2F3YXJlbmVzcykpCnRhYmxlKHRyYWNrZWRfd2luZG93cyR3aW5kb3dfbGVuZ3RoID4gOCkKcXBsb3QodHJhY2tlZF93aW5kb3dzJHdpbmRvd19sZW5ndGgpCgoKCnMzX2RhaWx5IDwtIHMzX2RhaWx5ICU+JSAKICBsZWZ0X2pvaW4oczRfZm9sbG93dXAgJT4lIHNlbGVjdChzZXNzaW9uLCBmb2xsaWN1bGFyX3BoYXNlX2xlbmd0aCwgbHV0ZWFsX3BoYXNlX2xlbmd0aCksIGJ5ID0gJ3Nlc3Npb24nKSAlPiUgCm11dGF0ZSgKICBkYXRlX29mX292dWxhdGlvbl9hdmdfZm9sbGljdWxhciA9IGxhc3RfbWVuc3RydWFsX29uc2V0ICsgZGF5cyhmb2xsaWN1bGFyX3BoYXNlX2xlbmd0aCksCiAgZGF0ZV9vZl9vdnVsYXRpb25fYXZnX2x1dGVhbCA9IG5leHRfbWVuc3RydWFsX29uc2V0IC0gZGF5cyhsdXRlYWxfcGhhc2VfbGVuZ3RoICsgMSksCiAgZGF0ZV9vZl9vdnVsYXRpb25fYXZnX2x1dGVhbF9pbmZlcnJlZCA9IG5leHRfbWVuc3RydWFsX29uc2V0X2luZmVycmVkIC0gZGF5cyhsdXRlYWxfcGhhc2VfbGVuZ3RoKQopICU+JSBzZWxlY3QoCiAgLWx1dGVhbF9waGFzZV9sZW5ndGgsIC1mb2xsaWN1bGFyX3BoYXNlX2xlbmd0aAopCgpzM19kYWlseSAlPiUgCiAgZ3JvdXBfYnkoc2hvcnQpICU+JSAKICBzdW1tYXJpc2Uoc3VyZ2VzID0gbl9kaXN0aW5jdChgRGF0ZSBMSCBzdXJnZWAsIG5hLnJtID0gVCkpICU+JSAKICBmaWx0ZXIoc3VyZ2VzID4gMCkgJT4lIAogIHB1bGwoc3VyZ2VzKSAlPiUgCiAgdGFibGUoKQoKIyBzM19kYWlseSAlPiUKIyAgIGRyb3BfbmEoc2Vzc2lvbiwgY3ljbGVfbnIpICU+JQojICAgZ3JvdXBfYnkoc2hvcnQpICU+JQojICAgZmlsdGVyKDQgPT0gbl9kaXN0aW5jdChgRGF0ZSBMSCBzdXJnZWAsIG5hLnJtID0gVCkpICU+JSBzZWxlY3Qoc2hvcnQsIGVuZGVkLCBEUkxILCBkYXlfbnVtYmVyLCBjeWNsZV9uciwgY3JlYXRlZF9kYXRlLG1lbnN0cnVhbF9vbnNldF9kYXlzX3VudGlsLCBtZW5zdHJ1YWxfb25zZXRfZGF5c19zaW5jZSwgYERhdGUgTEggc3VyZ2VgKSAlPiUgVmlldygpCgojIHMzX2RhaWx5ICU+JSAKIyAgIGRyb3BfbmEoc2Vzc2lvbiwgY3ljbGVfbnIpICU+JSAKIyAgIGdyb3VwX2J5KHNob3J0LCBjeWNsZV9ucikgJT4lIAojICAgZmlsdGVyKDIgPT0gbl9kaXN0aW5jdChgRGF0ZSBMSCBzdXJnZWAsIG5hLnJtID0gVCkpICU+JSBzZWxlY3Qoc2hvcnQsIGVuZGVkLCBkYXlfbnVtYmVyLCBEUkxILCBjeWNsZV9uciwgY3JlYXRlZF9kYXRlLG1lbnN0cnVhbF9vbnNldF9kYXlzX3VudGlsLCBtZW5zdHJ1YWxfb25zZXRfZGF5c19zaW5jZSwgYERhdGUgTEggc3VyZ2VgKSAlPiUgVmlldygpCgojIG9uZSBjYXNlIG9mIGEgd29tYW4gd2hvIHJlcG9ydGVkIHR3byBzdXJnZXMgKGNsb3NlIHRvZ2V0aGVyIGluIG9uZSBjeWNsZSwgd2UgdXNlIHRoZSBmaXJzdCBzdXJnZSkKczNfZGFpbHkgJT4lIAogIGdyb3VwX2J5KHNob3J0LCBjeWNsZV9ucikgJT4lIAogIHN1bW1hcmlzZShzdXJnZXMgPSBuX2Rpc3RpbmN0KGBEYXRlIExIIHN1cmdlYCwgbmEucm0gPSBUKSkgJT4lIAogIGZpbHRlcihzdXJnZXMgPiAwKSAlPiUgCiAgcHVsbChzdXJnZXMpICU+JSAKICB0YWJsZSgpCiAgCnN0b3BpZm5vdChzM19kYWlseSAlPiUgZHJvcF9uYShzZXNzaW9uLCBjcmVhdGVkKSAlPiUgIAogICAgICAgICAgICBncm91cF9ieShzZXNzaW9uLCBjcmVhdGVkKSAlPiUgZmlsdGVyKG4oKT4xKSAlPiUgbnJvdygpID09IDApCgojIHMzX2RhaWx5ICU+JSBmaWx0ZXIoc2Vzc2lvbiAlc3RhcnRzX3dpdGglICJfMnN1ZlNVZklXak5YZzZ4ZlJ6SmFDaWQ5anprWSIpICU+JSBzZWxlY3QoY3JlYXRlZF9kYXRlLCBtZW5zdHJ1YWxfb25zZXQsIG1lbnN0cnVhbF9vbnNldF9kYXRlLCBtZW5zdHJ1YWxfb25zZXRfZGF5c191bnRpbCwgbWVuc3RydWFsX29uc2V0X2RheXNfc2luY2UpICU+JSBWaWV3KCkKIyBzM19kYWlseSAlPiUgZmlsdGVyKHNlc3Npb24gJXN0YXJ0c193aXRoJSAiMngtanVxIikgJT4lIHNlbGVjdChjcmVhdGVkX2RhdGUsIG1lbnN0cnVhbF9vbnNldCwgbWVuc3RydWFsX29uc2V0X2RhdGUsIG1lbnN0cnVhbF9vbnNldF9kYXlzX3VudGlsLCBtZW5zdHJ1YWxfb25zZXRfZGF5c19zaW5jZSkgJT4lIFZpZXcoKQoKczNfZGFpbHkgJT4lIGZpbHRlcihpcy5uYShjeWNsZV9uciksICFpcy5uYShuZXh0X21lbnN0cnVhbF9vbnNldCkpICU+JSBzZWxlY3Qoc2hvcnQsIGN5Y2xlX25yLCBsYXN0X21lbnN0cnVhbF9vbnNldCwgbmV4dF9tZW5zdHJ1YWxfb25zZXQpICU+JSBucm93KCkgJT4lIHsgLiA9PSAwIH0gJT4lIHN0b3BpZm5vdCgpCnMzX2RhaWx5ICU+JSBmaWx0ZXIoaXMubmEoY3ljbGVfbnIpLCAhaXMubmEobGFzdF9tZW5zdHJ1YWxfb25zZXQpKSAlPiUgc2VsZWN0KHNob3J0LCBjeWNsZV9uciwgbGFzdF9tZW5zdHJ1YWxfb25zZXQsIG5leHRfbWVuc3RydWFsX29uc2V0KSAlPiUgbnJvdygpICU+JSB7IC4gPT0gMCB9ICU+JSBzdG9waWZub3QoKQoKCiMgVGhlcmUgYXJlIHNvbWUgNTYgZGF5cyBhY3Jvc3Mgd29tZW4gZm9yIHdob20gd2UgaGF2ZSBhIGxhc3QgbWVuc3RydWFsIG9uc2V0LCBidXQgbm8gY3ljbGUgaW5mby4gVGhpcyBoYXBwZW5zIHdoZW4gYSBsYXN0IG1lbnN0cnVhbCBvbnNldCB3YXMgcmVwb3J0ZWQgdGhhdCB3YXMgbW9yZSB0aGFuIDQwIGRheXMgYmVmb3JlIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGRpYXJ5CmNyb3NzdGFicyh+IGlzLm5hKGN5Y2xlX25yKSArIGlzLm5hKG1lbnN0cnVhdGlvbl9sZW5ndGgpLCBzM19kYWlseSkKY3Jvc3N0YWJzKH4gaXMubmEoY3ljbGVfbnIpICsgaXMubmEobWVuc3RydWF0aW9uX2xlbmd0aCksIHMzX2RhaWx5ICU+JSBmaWx0ZXIoZGlhcnlfZGF5X29ic2VydmF0aW9uID09ICJmaW5pc2hlZCIpKQojIAojIHMzX2RhaWx5ICU+JSBmaWx0ZXIoaXMubmEoY3ljbGVfbnIpLCAhaXMubmEobWVuc3RydWF0aW9uX2xlbmd0aCkpICU+JSBzZWxlY3Qoc2hvcnQsIGNyZWF0ZWRfZGF0ZSwgZW5kZWQsIGN5Y2xlX25yLCBsYXN0X21lbnN0cnVhbF9vbnNldCwgbmV4dF9tZW5zdHJ1YWxfb25zZXQpICU+JSBWaWV3CiMgczFfZGVtbyAlPiUgZmlsdGVyKHNob3J0PT0iLW9udExTUyIpICU+JSBzZWxlY3QoZW5kZWQsIGNvbnRhaW5zKCJtZW5zdCIpKQpgYGAKCiMjIyBFc3RpbWF0ZSBmZXJ0aWxlIHdpbmRvdyBwcm9iYWJpbGl0eQoKYGBge3IgZmVydGlsaXR5X2VzdGltYXRpb259CnMzX2RhaWx5ID0gczNfZGFpbHkgJT4lCiAgbXV0YXRlKAogICAgICAgIEZDRCA9IG1lbnN0cnVhbF9vbnNldF9kYXlzX3NpbmNlICsgMSwKICAgICAgICBSQ0QgPSBtZW5zdHJ1YWxfb25zZXRfZGF5c191bnRpbCwKICAgICAgICBEQUwgPSBjcmVhdGVkX2RhdGUgLSBkYXRlX29mX292dWxhdGlvbl9hdmdfbHV0ZWFsLAogICAgICAgIFJDRF9zcXVpc2hlZCA9IGlmX2Vsc2UoCiAgICAgICAgICBjeWNsZV9sZW5ndGggLSBGQ0QgPCAxNCwKICAgICAgICAgIDI5IC0gKGN5Y2xlX2xlbmd0aCAtIEZDRCksCiAgICAgICAgICAoKEZDRC8gKGN5Y2xlX2xlbmd0aCAtIDE0KSApICogMTUpKSwKICAgICAgICBSQ0Rfc3F1aXNoZWQgPSBpZl9lbHNlKFJDRF9zcXVpc2hlZCA8IDEsIDEsIFJDRF9zcXVpc2hlZCksCiAgICAgICAgUkNEX3NxdWlzaGVkID0gaWZfZWxzZShSQ0QgPCAtNDAsIE5BX3JlYWxfLCBSQ0Rfc3F1aXNoZWQpIC0gMzAsCiAgICAgICAgUkNEX3NxdWlzaGVkX3JvdW5kZWQgPSByb3VuZChSQ0Rfc3F1aXNoZWQpLAogICAgICAgIFJDRF9pbmZlcnJlZF9zcXVpc2hlZCA9IGlmX2Vsc2UoCiAgICAgICAgICBGQ0QgPiBtZW5zdHJ1YXRpb25fbGVuZ3RoLAogICAgICAgICAgICBOQV9yZWFsXywKICAgICAgICAgICAgaWZfZWxzZSgKICAgICAgICAgICAgICBhcy5udW1lcmljKG1lbnN0cnVhdGlvbl9sZW5ndGgpIC0gRkNEIDwgMTQsCiAgICAgICAgICAgICAgMjkgLSAoYXMubnVtZXJpYyhtZW5zdHJ1YXRpb25fbGVuZ3RoKSAtIEZDRCksCiAgICAgICAgICAgICAgcm91bmQoKEZDRC8gKGFzLm51bWVyaWMobWVuc3RydWF0aW9uX2xlbmd0aCkgLSAxNCkgKSAqIDE1KSkKICAgICAgICAgICAgKSwKICAgICAgICBSQ0RfaW5mZXJyZWRfc3F1aXNoZWQgPSBpZl9lbHNlKFJDRF9pbmZlcnJlZF9zcXVpc2hlZCA8IDEsIDEsIFJDRF9pbmZlcnJlZF9zcXVpc2hlZCksCiAgICAgICAgUkNEX2luZmVycmVkX3NxdWlzaGVkID0gaWZfZWxzZShSQ0RfaW5mZXJyZWQgPCAtNDAsIE5BX3JlYWxfLCBSQ0RfaW5mZXJyZWRfc3F1aXNoZWQpIC0gMzAsCiMgYWRkIDE1IGRheXMgdG8gdGhlIHJldmVyc2UgY3ljbGUgZGF5cyB0byBhcnJpdmUgYXQgdGhlIGVzdGltYXRlZCBkYXkgb2Ygb3Z1bGF0aW9uCiAgICAgICAgUkNEX3JlbF90b19vdnVsYXRpb24gPSBSQ0QgKyAxNSwKICAgICAgICBSQ0RfZmFiID0gUkNEX3NxdWlzaGVkCiAgKQoKdGFibGUoczNfZGFpbHkkUkNEX2luZmVycmVkX3NxdWlzaGVkKQp0YWJsZShzM19kYWlseSRSQ0Rfc3F1aXNoZWQpCnRhYmxlKHMzX2RhaWx5JFJDRCkKdGFibGUoczNfZGFpbHkkUkNEX2luZmVycmVkKQp0YWJsZShzM19kYWlseSRSQ0RfaW5mZXJyZWRfc3F1aXNoZWQpCnRhYmxlKHMzX2RhaWx5JFJDRF9pbmZlcnJlZCA+IC0xKQpjcm9zc3RhYnMoczNfZGFpbHkkUkNEX2luZmVycmVkW2lzLm5hKHMzX2RhaWx5JFJDRF9pbmZlcnJlZF9zcXVpc2hlZCldKSAlPiUgc29ydCgpCmNyb3NzdGFicyhzM19kYWlseSRSQ0RbaXMubmEoczNfZGFpbHkkUkNEX3NxdWlzaGVkKV0pICU+JSBzb3J0KCkKY3Jvc3N0YWJzKHMzX2RhaWx5JFJDRF9pbmZlcnJlZF9zcXVpc2hlZCkKdGFibGUoczNfZGFpbHkkRkNEKQoKZGF5cyA8LSBkYXRhLmZyYW1lKAoJUkNEID0gYygtMjg6LTEsIC0yOTotNDApLAoJRkNEID0gYygxOjQwKSwKCXByY19zdGlybl9iID0gYyguMDEsIC4wMSwgLjAyLCAuMDMsIC4wNSwgLjA5LCAuMTYsIC4yNywgLjM4LCAuNDgsIC41NiwgLjU4LCAuNTUsIC40OCwgLjM4LCAuMjgsIC4yMCwgLjE0LCAuMTAsIC4wNywgLjA2LCAuMDQsIC4wMywgLjAyLCAuMDEsIC4wMSwgLjAxLCAuMDEsIHJlcCguMDEsIHRpbWVzID0gMTIpKSwKIyAJICAgICAgICAgICAgICAgIHJlcCguMDEsIHRpbWVzID0gNzApKSwgIyBnYW5nZXN0YWQgdXNlcyAuMDEgaGVyZSwgYnV0IEkgdGhpbmsgc3VjaCBjYXNlcyBhcmUgYmV0dGVyIHRocm93biB0aGFuIGtlcHQsIHNpbmNlIHdlIG1pZ2h0IHNpbXBseSBoYXZlIG1pc3NlZCBhIG1lbnMKCXByY193Y3hfYiA9IGMoLjAwMCwgLjAwMCwgLjAwMSwgLjAwMiwgLjAwNCwgLjAwOSwgLjAxOCwgLjAzMiwgLjA1MCwgLjA2OSwgLjA4NSwgLjA5NCwgLjA5MywgLjA4NSwgLjA3MywgLjA1OSwgLjA0NywgLjAzNiwgLjAyOCwgLjAyMSwgLjAxNiwgLjAxMywgLjAxMCwgLjAwOCwgLjAwNywgLjAwNiwgLjAwNSwgLjAwNSwgcmVwKC4wMDUsIHRpbWVzID0gMTIpKQopCgkgICAgICAgICAgICAgICMgcmVwKE5BX3JlYWxfLCB0aW1lcyA9IDcwKSkgICMgZ2FuZ2VzdGFkIHVzZXMgLjAwNSBoZXJlLCBidXQgSSB0aGluayBzdWNoIGNhc2VzIGFyZSBiZXR0ZXIgdGhyb3duIHRoYW4ga2VwdCwgc2luY2Ugd2UgbWlnaHQgc2ltcGx5IGhhdmUgbWlzc2VkIGEgbWVucwpkYXlzID0gZGF5cyAlPiUgbXV0YXRlKAogZmVydGlsZV9uYXJyb3cgPSBpZl9lbHNlKGJldHdlZW4oUkNELC0xOCwgLTE0KSwgbWVhbihwcmNfc3Rpcm5fYltiZXR3ZWVuKFJDRCwgLTE4LCAtMTQpXSwgbmEucm0gPSBUKSwgCiAgICAgICAgICAgICAgICAgICAgIGlmX2Vsc2UoYmV0d2VlbihSQ0QsIC0xMSwgLTMpLCBtZWFuKHByY19zdGlybl9iW2JldHdlZW4oUkNELC0xMSwgLTMpXSwgbmEucm0gPSBUKSwgTkFfcmVhbF8pKSwgIyB0aGVzZSBkYXlzIGFyZSBsaWtlbHkgaW5mZXJ0aWxlCiAKICBmZXJ0aWxlX2Jyb2FkID0gaWZfZWxzZShiZXR3ZWVuKFJDRCwtMjEsLTEzKSwgbWVhbihwcmNfc3Rpcm5fYltiZXR3ZWVuKFJDRCwtMjEsLTEzKV0sIG5hLnJtID0gVCksIAogICAgICAgICAgICAgICAgICAgICBpZl9lbHNlKGJldHdlZW4oUkNELC0xMSwtMyksIG1lYW4ocHJjX3N0aXJuX2JbYmV0d2VlbihSQ0QsLTExLC0zKV0sIG5hLnJtID0gVCksIE5BX3JlYWxfKSksICMgdGhlc2UgZGF5cyBhcmUgbGlrZWx5IGluZmVydGlsZQogZmVydGlsZV93aW5kb3cgPSBmYWN0b3IoaWZfZWxzZShmZXJ0aWxlX2Jyb2FkID4gMC4xLCBpZl9lbHNlKCFpcy5uYShmZXJ0aWxlX25hcnJvdyksICJuYXJyb3ciLCAiYnJvYWQiKSwiaW5mZXJ0aWxlIiksIGxldmVscyA9IGMoImluZmVydGlsZSIsImJyb2FkIiwgIm5hcnJvdyIpKSwKIHByZW1lbnN0cnVhbF9waGFzZSA9IGlmZWxzZShiZXR3ZWVuKFJDRCwgIC02LCAtMSksIFRSVUUsIEZBTFNFKQopCgojIGxoX2RheXMgPSBkYXlzICU+JSBtdXRhdGUoCiMgICBEUkxIID0gCiMgICAgIEZDRCAKIyAgIC0gMSAjIGJlY2F1c2UgRkNEIHN0YXJ0cyBjb3VudGluZyBhdCAxCiMgICAtIDE1ICMgYmVjYXVzZSBvdnVsYXRpb24gaGFwcGVucyBvbiB+MTQuNiBkYXlzIGFmdGVyIG1lbnN0cnVhbCBvbnNldAojICAgIyArIDEgIyB3ZSBhbHJlYWR5IGFkZGVkIDEgdG8gdGhlIGRhdGUgb2YgdGhlIExIIHN1cmdlIGFib3ZlLCBhcyBpdCBoYXBwZW5zIDI0LTQ4IGhvdXJzIGJlZm9yZSBvdnVsYXRpb24KIyAgICkgJT4lIHNlbGVjdCgtRkNELCAtUkNEX2Zvcl9tZXJnZSkgCgojIGZyb20gSsO8bmdlciBldCBhbC4gMjAxOCBTdXBwbGVtZW50YXJ5IE1hdGVyaWFsCiMgRGF5IHJlbGF0aXZlIHRvIG92dWxhdGlvbglTY2h3YXJ0eiBldCBhbC4sICgxOTgwKQlXaWxjb3ggZXQgYWwuLCAoMTk5OCkJQ29sb21ibyAmIE1hc2Fyb3R0byAoMjAwMCkJV2VpZ2h0ZWQgYXZlcmFnZQpsaF9kYXlzIDwtIHRpYmJsZSgKICBjb25jZXB0aW9uX3Jpc2tfbGggPSBjKDAuMDAsIDAuMDEsIDAuMDIsIDAuMDYsIDAuMTYsIDAuMjAsIDAuMjUsIDAuMjQsIDAuMTAsIDAuMDIsIDAuMDIgKSwKICBEUkxIID0gYygtOCwgLTcsIC02LCAtNSwgLTQsIC0zLCAtMiwgLTEsIDAsIDEsIDIpCikgJT4lIAogIG11dGF0ZShmZXJ0aWxlX2xoID0gY29uY2VwdGlvbl9yaXNrX2xoL21heChjb25jZXB0aW9uX3Jpc2tfbGgpKQoKIyBmcm9tIGJsYWtlIGV0IGFsLiBzdXBwbGVtZW50ICh1bndlaWdodGVkKSAgCmJsYWtlX21ldGEgPC0gdGliYmxlOjp0aWJibGUoRFJMSCA9IC0xMDo2LCBDUiA9IGMoMCwwLDAuMDAyNjcsCjAuMDA5OTgsCjAuMDI2MDAsCjAuMDYxODAsCjAuMTE2MDAsCjAuMTU5MTcsCjAuMjA3MTcsCjAuMjE2MzMsCjAuMTU2NjcsCjAuMDY1NDAsCjAuMDUyNTAsCjAuMDE1NTAsCjAuMDAzMDAsCjAuMDAwMDAsIDApKSAKYmxha2VfbWV0YSAlPiUgbGVmdF9qb2luKGxoX2RheXMpICU+JSAKICBtdXRhdGUoY29uY2VwdGlvbl9yaXNrX2xoID0gbmFfaWYoY29uY2VwdGlvbl9yaXNrX2xoLCAwKSkgJT4lIAogIHN1bW1hcmlzZShjb3IoY29uY2VwdGlvbl9yaXNrX2xoLCBDUiwgdXNlID0gJ3BhaXJ3aXNlLmNvbXBsZXRlLm9icycpKQoKIyBibGFrZSBhbmQganVlbmdlciB2YWx1ZXMgYXJlIHZlcnkgY2xvc2UsIEknbGwgdXNlIEp1ZW5nZXIKCnMzX2RhaWx5ID0gczNfZGFpbHkgJT4lIGxlZnRfam9pbihsaF9kYXlzLCBieSA9ICJEUkxIIikgJT4lIAogIG11dGF0ZShmZXJ0aWxlX2xoID0gaWZfZWxzZShpcy5uYShmZXJ0aWxlX2xoKSAmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmV0d2VlbihEUkxILCAtMTUsIDE1KSwgMCwgZmVydGlsZV9saCkpCgpyY2RfZGF5cyA9IGRheXMgJT4lIHNlbGVjdCgtRkNEKQpzM19kYWlseSA9IGxlZnRfam9pbihzM19kYWlseSwgcmNkX2RheXMsIGJ5ID0gIlJDRCIpCgpyY2Rfc3F1aXNoZWQgPSBkYXlzICU+JSBzZWxlY3QoLUZDRCkKbmFtZXMocmNkX3NxdWlzaGVkKSA9IHBhc3RlMChuYW1lcyhyY2Rfc3F1aXNoZWQpLCAiX3NxdWlzaGVkIikKczNfZGFpbHkgPSBsZWZ0X2pvaW4oczNfZGFpbHksIHJjZF9zcXVpc2hlZCwgYnkgPSBjKCJSQ0Rfc3F1aXNoZWRfcm91bmRlZCIgPSAiUkNEX3NxdWlzaGVkIikpCgpyY2RfaW5mZXJyZWRfc3F1aXNoZWQgPSBkYXlzICU+JSBzZWxlY3QoLUZDRCkKbmFtZXMocmNkX2luZmVycmVkX3NxdWlzaGVkKSA9IHBhc3RlMChuYW1lcyhyY2RfaW5mZXJyZWRfc3F1aXNoZWQpLCAiX2luZmVycmVkX3NxdWlzaGVkIikKczNfZGFpbHkgPSBsZWZ0X2pvaW4oczNfZGFpbHksIHJjZF9pbmZlcnJlZF9zcXVpc2hlZCwgYnkgPSAiUkNEX2luZmVycmVkX3NxdWlzaGVkIikKCgpmY2RfZGF5cyA9IGRheXMgJT4lIHNlbGVjdCgtUkNEKQpuYW1lcyhmY2RfZGF5cykgPSBwYXN0ZTAobmFtZXMoZmNkX2RheXMpLCAiX2ZvcndhcmRfY291bnRlZCIpCmZjZF9kYXlzID0gZmNkX2RheXMgJT4lIHJlbmFtZShGQ0QgPSBGQ0RfZm9yd2FyZF9jb3VudGVkKQpzM19kYWlseSA9IGxlZnRfam9pbihzM19kYWlseSwgZmNkX2RheXMsIGJ5ID0gIkZDRCIpCgphd2FyZV9sdXRlYWxfc3F1aXNoZWQgPSBkYXlzICU+JSBzZWxlY3QoLUZDRCkgJT4lIG11dGF0ZShSQ0QgPSBSQ0QgKyAxNSkKbmFtZXMoYXdhcmVfbHV0ZWFsX3NxdWlzaGVkKSA9IHBhc3RlMChuYW1lcyhhd2FyZV9sdXRlYWxfc3F1aXNoZWQpLCAiX2F3YXJlX2x1dGVhbCIpCnMzX2RhaWx5JERBTCA8LSBhcy5udW1lcmljKHMzX2RhaWx5JERBTCkKczNfZGFpbHkgPSBsZWZ0X2pvaW4oczNfZGFpbHksIGF3YXJlX2x1dGVhbF9zcXVpc2hlZCwgYnkgPSBjKCJEQUwiID0gIlJDRF9hd2FyZV9sdXRlYWwiKSkKCgpyY2RfaW5mZXJyZWRfZGF5cyA9IGRheXMgJT4lIHNlbGVjdCgtRkNEKQpuYW1lcyhyY2RfaW5mZXJyZWRfZGF5cykgPSBwYXN0ZTAobmFtZXMocmNkX2luZmVycmVkX2RheXMpLCAiX2luZmVycmVkIikKczNfZGFpbHkgPSBsZWZ0X2pvaW4oczNfZGFpbHksIHJjZF9pbmZlcnJlZF9kYXlzLCBieSA9ICJSQ0RfaW5mZXJyZWQiKQp0YWJsZShzM19kYWlseSRwcmNfc3Rpcm5fYl9pbmZlcnJlZCkKCiMgczNfZGFpbHkgJT4lIGZpbHRlcihpcy5uYShwcmNfc3Rpcm5fYl9pbmZlcnJlZF9zcXVpc2hlZCksICFpcy5uYShwcmNfc3Rpcm5fYl9pbmZlcnJlZCkpICU+JSBzZWxlY3Qoc2hvcnQsIG1lbnN0cnVhdGlvbl9sZW5ndGgsIGN5Y2xlX25yLCBjeWNsZV9sZW5ndGgsIGRheV9udW1iZXIsIGNyZWF0ZWRfZGF0ZSwgbGFzdF9tZW5zdHJ1YWxfb25zZXQsIG5leHRfbWVuc3RydWFsX29uc2V0LCBuZXh0X21lbnN0cnVhbF9vbnNldF9pbmZlcnJlZCwgRkNELCBSQ0QsIFJDRF9zcXVpc2hlZCwgUkNEX2luZmVycmVkLCBSQ0RfaW5mZXJyZWRfc3F1aXNoZWQsIFJDRF9pbmZlcnJlZCwgcHJjX3N0aXJuX2JfaW5mZXJyZWRfc3F1aXNoZWQsIHByY19zdGlybl9iKSAlPiUgcmNhbWlzYzo6dmlld19pbl9leGNlbCgpCnh0YWJzKH4gaXMubmEocHJjX3N0aXJuX2JfaW5mZXJyZWRfc3F1aXNoZWQpICsgaXMubmEocHJjX3N0aXJuX2JfaW5mZXJyZWQpLCBkYXRhID0gczNfZGFpbHkpCnh0YWJzKH4gaXMubmEocHJjX3N0aXJuX2Jfc3F1aXNoZWQpICsgaXMubmEocHJjX3N0aXJuX2IpLCBkYXRhID0gczNfZGFpbHkpCnh0YWJzKH4gaXMubmEocHJjX3N0aXJuX2Jfc3F1aXNoZWQpICsgaXMubmEoUkNEX3NxdWlzaGVkKSwgZGF0YSA9IHMzX2RhaWx5KQp4dGFicyh+IGlzLm5hKHByY19zdGlybl9iX2luZmVycmVkX3NxdWlzaGVkKSArIGlzLm5hKHByY19zdGlybl9iX3NxdWlzaGVkKSwgZGF0YSA9IHMzX2RhaWx5KQoKczNfZGFpbHkgPSBzM19kYWlseSAlPiUgCiAgbXV0YXRlKGZlcnRpbGVfZmFiID0gcHJjX3N0aXJuX2IsIAogICAgICAgICBwcmVtZW5zdHJ1YWxfcGhhc2VfZmFiID0gcHJlbWVuc3RydWFsX3BoYXNlCiAgKQoKdmFyX2xhYmVsKHMzX2RhaWx5JGZlcnRpbGVfZmFiKSA8LSAiRXN0LiBmZXJ0aWxlIHdpbmRvdyBwcm9iLiAoQkMraSkiCnZhcl9sYWJlbChzM19kYWlseSRwcmVtZW5zdHJ1YWxfcGhhc2VfZmFiKSA8LSAiRXN0LiBwcmVtZW5zdHJ1YWwgcGhhc2UgKEJDK2kpIgoKczNfZGFpbHkgJT4lIHNlbGVjdChmZXJ0aWxlX2ZhYiwgcHJlbWVuc3RydWFsX3BoYXNlX2ZhYiwgbWVuc3RydWF0aW9uX2xhYmVsbGVkKSAlPiUgbmEub21pdCgpICU+JSBucm93KCkKczNfZGFpbHkgJT4lIHNlbGVjdChmZXJ0aWxlX2ZhYiwgcHJlbWVuc3RydWFsX3BoYXNlX2ZhYiwgbWVuc3RydWF0aW9uX2xhYmVsbGVkKSAlPiUgY29kZWJvb2s6Om1kX3BhdHRlcm4oKQoKIyBzM19kYWlseSAlPiUgZmlsdGVyKGlzLm5hKG1lbnN0cnVhdGlvbl9sYWJlbGxlZCksICFpcy5uYShmZXJ0aWxlX2ZhYikpICU+JSBzZWxlY3Qoc2hvcnQsIGNyZWF0ZWRfZGF0ZSwgZW5kZWQsIG1lbnN0cnVhdGlvbl9sYWJlbGxlZCwgbWVuc3RydWFsX29uc2V0LCBtZW5zdHJ1YWxfb25zZXRfZGF0ZSwgbWVuc3RydWFsX29uc2V0X2RheXNfdW50aWwsIG1lbnN0cnVhbF9vbnNldF9kYXlzX3NpbmNlKSAgJT4lIFZpZXcoKQpgYGAKCnRlc3Qgc29tZSBzcGVjaWFsIGNvcm5lciBjYXNlcwpgYGB7cn0KIyB3ZSBkaWQgY29ycmVjdGx5IGluZmVyIEZDRHMgZnJvbSBvbnNldCByZXBvcnRlZCBiZWZvcmUgdGhlIGRpYXJ5CnMzX2RhaWx5ICU+JSBmaWx0ZXIoc2Vzc2lvbiAlc3RhcnRzX3dpdGglICJfMmVmQ2hNIikgJT4lIHNsaWNlKDEpICU+JSBwdWxsKEZDRCkgJT4lIGlzLm5hKCkgJT4lIGlzRkFMU0UgJT4lIHN0b3BpZm5vdCgpCiMgd2UgZGlkIGNvcnJlY3RseSBhZGQgY3ljbGUgbnJzIGV2ZW4gd2hlbiB3ZSBkaWRudCBvYnNlcnZlIHRoZSBjeWNsZSdzIGVuZApzM19kYWlseSAlPiUgZmlsdGVyKHNob3J0ID09ICJfc3F0TWY1IiwgY3JlYXRlZF9kYXRlID09ICIyMDE2LTA4LTI1IikgJT4lIHB1bGwoY3ljbGVfbnIpICU+JSBpcy5uYSgpICU+JSBpc0ZBTFNFKCkgJT4lIHN0b3BpZm5vdCgpCmBgYAoKCiMjIyBJbmZlciBtZW5zdHJ1YXRpb24KCldlIGRpZCBub3QgYXNrIGFib3V0IG1lbnN0cnVhdGlvbiBvbiBldmVyeSBkYXksIHNvIGFzIG5vdCB0byBnaXZlIGF3YXkgdGhlIHB1cnBvc2Ugb2YgdGhlIHN0dWR5LgpXZSBjYW4gZXN0aW1hdGUgdGhlIHByb2JhYmlsaXR5IG9mIG1lbnN0cnVhdGlvbiBxdWl0ZSB3ZWxsIGZyb20gb3RoZXIgdmFyaWFibGVzLgoKYGBge3J9CmluZmVyX21lbnNfZGYgPC0gczNfZGFpbHkgJT4lIGdyb3VwX2J5KHNob3J0KSAlPiUgCiAgbXV0YXRlKAogICAgcHJlbWVuc3RydWFsX3BoYXNlID0gaWZfZWxzZShwcmVtZW5zdHJ1YWxfcGhhc2VfZmFiID09IDEsICIxIiwgIjAiLCAidW5rbm93biIpLAogICAgcG9zdG1lbnN0cnVhbF9waGFzZSA9IGlmX2Vsc2UobWVuc3RydWFsX29uc2V0X2RheXNfc2luY2UgPCA2LCAiMSIsICIwIiwgInVua25vd24iKSwKICAgIGN5Y2xlX2xlbmd0aCA9IGlmX2Vsc2UoY3ljbGVfbGVuZ3RoID4gMzQsICIzNSsiLCBhcy5jaGFyYWN0ZXIoY3ljbGVfbGVuZ3RoKSwgInVua25vd24iKSwKICAgIG1lbnN0cnVhbF9vbnNldF9kYXlzX3NpbmNlID0gaWZfZWxzZShtZW5zdHJ1YWxfb25zZXRfZGF5c19zaW5jZSA+IDksICIxMCsiLCBhcy5jaGFyYWN0ZXIobWVuc3RydWFsX29uc2V0X2RheXNfc2luY2UpLCAidW5rbm93biIpLAogICAgbWVuc3RydWFsX3BhaW4gPSBpZl9lbHNlKG1lbnN0cnVhbF9wYWluID09IDEsICIxIiwgIjAiLCAiMCIpLAogICAgbWVuc3RydWF0aW9uX2xhZzMgPSBpZl9lbHNlKGxhZyhtZW5zdHJ1YXRpb25fdG9kYXksIDMpID09IDEsICIxIiwgIjAiLCAidW5rbm93biIpLAogICAgbWVuc3RydWF0aW9uX2xlYWQzID0gaWZfZWxzZShsZWFkKG1lbnN0cnVhdGlvbl90b2RheSwgMykgPT0gMSwgIjEiLCAiMCIsICJ1bmtub3duIikpICU+JSAKICB1bmdyb3VwKCkgJT4lIAogIG11dGF0ZV9hdCh2YXJzKG1lbnN0cnVhdGlvbl9sYWczLCBtZW5zdHJ1YXRpb25fbGVhZDMsIG1lbnN0cnVhbF9wYWluLCBwcmVtZW5zdHJ1YWxfcGhhc2UsIHBvc3RtZW5zdHJ1YWxfcGhhc2UpLCBmdW5zKGZhY3RvcikpICU+JSAKICBtdXRhdGUobWVuc3RydWFsX29uc2V0X2RheXNfc2luY2UgPSBmYWN0b3IobWVuc3RydWFsX29uc2V0X2RheXNfc2luY2UsIGxldmVscyA9IGMoInVua25vd24iLCAwOjksICIxMCsiKSkpICU+JSAKICBzZWxlY3Qoc2hvcnQsIG1lbnN0cnVhdGlvbl90b2RheSwgbWVuc3RydWFsX29uc2V0X2RheXNfc2luY2UsIGN5Y2xlX2xlbmd0aCwKICAgICAgICAgbWVuc3RydWF0aW9uX2xhZzMsIG1lbnN0cnVhdGlvbl9sZWFkMywgbWVuc3RydWFsX3BhaW4sIHByZW1lbnN0cnVhbF9waGFzZSwgcG9zdG1lbnN0cnVhbF9waGFzZSkKCmluZmVyX21lbnNfZGYgJT4lIHNlbGVjdCgtbWVuc3RydWF0aW9uX3RvZGF5LCAtc2hvcnQpICU+JSBkcm9wX25hICU+JSBucm93KCkKCmluZmVyX21lbnNfbm9yYW4gPC0gZ2xtKG1lbnN0cnVhdGlvbl90b2RheSB+IHByZW1lbnN0cnVhbF9waGFzZSAqIG1lbnN0cnVhbF9wYWluICsgbWVuc3RydWFsX29uc2V0X2RheXNfc2luY2UsIGRhdGEgPSBpbmZlcl9tZW5zX2RmLCBmYW1pbHkgPSBiaW5vbWlhbCkKaW5mZXJfbWVuc19ub3JhbgpEZXNjVG9vbHM6OlBzZXVkb1IyKGluZmVyX21lbnNfbm9yYW4sIHdoaWNoID0gIk5hZ2Vsa2Vya2UiKQoKaW5mZXJfbWVucyA8LSBsbWU0OjpnbG1lcihtZW5zdHJ1YXRpb25fdG9kYXkgfiBwcmVtZW5zdHJ1YWxfcGhhc2UgKiBtZW5zdHJ1YWxfcGFpbiArIG1lbnN0cnVhbF9vbnNldF9kYXlzX3NpbmNlICsgKDEgKyBtZW5zdHJ1YWxfcGFpbiB8IHNob3J0KSwgZGF0YSA9IGluZmVyX21lbnNfZGYsIGZhbWlseSA9IGJpbm9taWFsLCBuYS5hY3Rpb24gPSBuYS5leGNsdWRlKQoKIyBwbG90KGFsbEVmZmVjdHMoaW5mZXJfbWVucykpCm1lbnN0cnVhdGlvbl9pbXB1dGVkX25vcmFuIDwtIHByZWRpY3QoaW5mZXJfbWVuc19ub3JhbiwgbmV3ZGF0YSA9IGluZmVyX21lbnNfZGYgJT4lIHNlbGVjdCgtbWVuc3RydWF0aW9uX3RvZGF5KSwgdHlwZSA9ICJyZXNwb25zZSIsIGFsbG93Lm5ldy5sZXZlbHMgPSBUUlVFKQpzM19kYWlseSRtZW5zdHJ1YXRpb25faW1wdXRlZCA8LSBwcmVkaWN0KGluZmVyX21lbnMsIG5ld2RhdGEgPSBpbmZlcl9tZW5zX2RmICU+JSBzZWxlY3QoLW1lbnN0cnVhdGlvbl90b2RheSksIHR5cGUgPSAicmVzcG9uc2UiLCBhbGxvdy5uZXcubGV2ZWxzID0gVFJVRSkKY29yLnRlc3QoczNfZGFpbHkkbWVuc3RydWF0aW9uX2ltcHV0ZWQsIHMzX2RhaWx5JG1lbnN0cnVhdGlvbl90b2RheSkKY29yLnRlc3QobWVuc3RydWF0aW9uX2ltcHV0ZWRfbm9yYW4sIHMzX2RhaWx5JG1lbnN0cnVhdGlvbl90b2RheSkKczNfZGFpbHkkbWVuc3RydWF0aW9uIDwtIGlmX2Vsc2UoaXMubmEoczNfZGFpbHkkbWVuc3RydWF0aW9uX3RvZGF5KSwgczNfZGFpbHkkbWVuc3RydWF0aW9uX2ltcHV0ZWQsIGFzLmRvdWJsZShzM19kYWlseSRtZW5zdHJ1YXRpb25fdG9kYXkpKQpzdW0oIWlzLm5hKHMzX2RhaWx5JG1lbnN0cnVhdGlvbl9pbXB1dGVkKSkKcXBsb3QoczNfZGFpbHkkbWVuc3RydWF0aW9uX2ltcHV0ZWQsIGZpbGwgPSBpZl9lbHNlKHMzX2RhaWx5JG1lbnN0cnVhdGlvbl90b2RheSA9PSAxLCAiMSIsICIwIiwgInVua25vd24iKSwpICsgc2NhbGVfZmlsbF9jb2xvcmJsaW5kKCJBY3R1YWwiKQpxcGxvdChtZW5zdHJ1YWxfb25zZXRfZGF5c19zaW5jZSwgbWVuc3RydWF0aW9uLCBkYXRhID0gczNfZGFpbHksIGdlb20gPSAiYmxhbmsiKSArIGdlb21fc21vb3RoKHN0YXQgPSAnc3VtbWFyeScsIGZ1bi5kYXRhID0gJ21lYW5fc2UnKSArIHhsaW0oMCwxNSkKCgpzM19kYWlseSA8LSBzM19kYWlseSAlPiUgc2VsZWN0KC1tZW5zdHJ1YXRpb25fbGVuZ3RoKQoKdmFyX2xhYmVsKHMzX2RhaWx5JG1lbnN0cnVhdGlvbikgPC0gIkVzdC4gbWVuc3RydWF0aW9uIgpgYGAKCgojIyBDb250cmFjZXB0aW9uCgojIyMgT3RoZXIgaG9ybW9uYWwgY29udHJhY2VwdGlvbgpGb3IgcGlsbHMgYW5kIG90aGVyIGhvcm1vbmFsIGNvbnRyYWNlcHRpb24gdGhhdCB3YXMgbm90IGluIG91ciBsaXN0LgoKYGBge3J9CnMxX2RlbW8gJT4lIAogIGZpbHRlcighaXMubmEob3RoZXJfcGlsbF9uYW1lKSB8ICFpcy5uYShjb250cmFjZXB0aW9uX2hvcm1vbmFsX290aGVyKSB8ICFpcy5uYShjb250cmFjZXB0aW9uX21ldGhvZF9vdGhlcikpICU+JSAKICBzZWxlY3Qob3RoZXJfcGlsbF9uYW1lLCBjb250cmFjZXB0aW9uX2hvcm1vbmFsX290aGVyLCBjb250cmFjZXB0aW9uX21ldGhvZF9vdGhlcikgJT4lIAogIG11dGF0ZShvdGhlcl9waWxsX25hbWUgPSBzdHJfdG9fbG93ZXIob3RoZXJfcGlsbF9uYW1lKSkgJT4lIAogIGRpc3RpbmN0KCkgJT4lIAogIG11dGF0ZShjb250cmFjZXB0aW9uX290aGVyX3BpbGxfZXN0cm9nZW4gPSBOQV9yZWFsXywKICAgICAgICAgY29udHJhY2VwdGlvbl9vdGhlcl9waWxsX2dlc3RhZ2VuID0gTkFfcmVhbF8sCiAgICAgICAgIGNvbnRyYWNlcHRpb25fb3RoZXJfcGlsbF9nZXN0YWdlbl90eXBlID0gTkFfcmVhbF8KICAgICAgICAgKSAtPiAKICBvdGhlcl9waWxsX25hbWUKCnJjYW1pc2M6Ojp2aWV3X2luX2V4Y2VsKG90aGVyX3BpbGxfbmFtZSkKCgpyaW86OmV4cG9ydChvdGhlcl9waWxsX25hbWUsICJjb2RpbmdzL290aGVyX3BpbGxfbmFtZS54bHN4IikKb3RoZXJfcGlsbF9uYW1lID0gcmVhZHhsOjpyZWFkX3hsc3goImNvZGluZ3Mvb3RoZXJfcGlsbF9uYW1lX2NvZGVkLnhsc3giLDEpCgpzMV9kZW1vIDwtIHMxX2RlbW8gJT4lIGxlZnRfam9pbigKICBvdGhlcl9waWxsX25hbWUgJT4lIGRpc3RpbmN0KCkpCmBgYAoKYGBge3IgY29udHJhY2VwdGlvbn0KczFfZGVtbyA9IHMxX2RlbW8gJT4lIAogIG11dGF0ZShob3Jtb25hbF9jb250cmFjZXB0aW9uID0gaWZfZWxzZShjb250cmFjZXB0aW9uX21ldGhvZCAlY29udGFpbnMlICJob3Jtb25hbCIsIFQsIEYsIG1pc3NpbmcgPSBGKSwKICBjb250cmFjZXB0aW9uX21ldGhvZF9icm9hZCA9IHN0cmluZ3I6OnN0cl9zcGxpdF9maXhlZChjb250cmFjZXB0aW9uX21ldGhvZCwgIl8iLCAyKVssMV0KKQoKCnNvcnQodGFibGUoczFfZGVtbyRjb250cmFjZXB0aW9uX21ldGhvZCkpCnVuaXF1ZShzMV9kZW1vJGNvbnRyYWNlcHRpb25fbWV0aG9kX290aGVyKSAjIHRvZG86IGNvZGUgbWFudWFsbHkKc29ydCh0YWJsZShzMV9kZW1vJGNvbnRyYWNlcHRpb25fY29tYmkpKQp1bmlxdWUoczFfZGVtbyRjb250cmFjZXB0aW9uX21ldGhvZF9jb21iaW5hdGlvbl9vdGhlcikKCnMxX2RlbW8gPSBzMV9kZW1vICU+JSBtdXRhdGUoCiAgY29udHJhY2VwdGlvbl9jYWxlbmRhcl9hYnN0aW5lbmNlID0gc3RyaW5ncjo6c3RyX3JlcGxhY2UoY29udHJhY2VwdGlvbl9jYWxlbmRhcl9hYnN0aW5lbmNlLCAiMSIsICJhYnN0aW5lbmNlIiksCiAgY29udHJhY2VwdGlvbl9jYWxlbmRhcl9hYnN0aW5lbmNlID0gc3RyaW5ncjo6c3RyX3JlcGxhY2UoY29udHJhY2VwdGlvbl9jYWxlbmRhcl9hYnN0aW5lbmNlLCAiMiIsICJub19wZW5ldHJhdGlvbiIpLAogIGNvbnRyYWNlcHRpb25fY2FsZW5kYXJfYWJzdGluZW5jZSA9IHN0cmluZ3I6OnN0cl9yZXBsYWNlKGNvbnRyYWNlcHRpb25fY2FsZW5kYXJfYWJzdGluZW5jZSwgIjMiLCAibGVzc19zZXgiKSwKICBjb250cmFjZXB0aW9uX2NhbGVuZGFyX2Fic3RpbmVuY2UgPSBzdHJpbmdyOjpzdHJfcmVwbGFjZShjb250cmFjZXB0aW9uX2NhbGVuZGFyX2Fic3RpbmVuY2UsICI0IiwgIm90aGVyX21ldGhvZCIpCikKCgpjaG9pY2VzIDwtIHJpbzo6aW1wb3J0KCJodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9zcHJlYWRzaGVldHMvZC8xdExRRFZ5WVVBWExCa2JsVFQ4Qlhvd19yY2c1RzZ4SzlWaTN4VEdpZU4yMC9lZGl0I2dpZD0xMTE2NzYyNTgwIiwgd2hpY2ggPSAyKQpwaWxscyA8LSBjaG9pY2VzICU+JSAKICBzbGljZSgxOjE4MikgJT4lIAogIGZpbHRlcighaXMubmEobmFtZSksIG5hbWUgIT0gIiIpICU+JSAKICBtdXRhdGUoCiAgICBsaXN0X25hbWUgPSBuYV9pZihsaXN0X25hbWUsICIiKSwKICAgIGxpc3RfbmFtZSA9IHpvbzo6bmEubG9jZihsaXN0X25hbWUpCiAgICApICU+JSAKICBmaWx0ZXIobGlzdF9uYW1lID09ICJwaWxscyIpICU+JSAKICBzZWxlY3QoY29udHJhY2VwdGlvbl9ob3Jtb25hbF9waWxsID0gbmFtZSwgCiAgICAgICAgIGNvbnRyYWNlcHRpb25faG9ybW9uYWxfcGlsbF9lc3Ryb2dlbiA9IAogICAgICAgICAgIGDDlnN0cm9nZW5taWtyb2dyYW1tIHBybyBaeWtsdXNgLAogICAgICAgICBjb250cmFjZXB0aW9uX2hvcm1vbmFsX3BpbGxfZ2VzdGFnZW5fdHlwZSA9IAogICAgICAgICAgIGBBcnQgZGVzIEdlc3RhZ2Vuc2AKICAgICAgICAgKSAlPiUgCiAgbXV0YXRlKGNvbnRyYWNlcHRpb25faG9ybW9uYWxfcGlsbF9lc3Ryb2dlbiA9CiAgICAgICAgICAgYXMubnVtZXJpYyhjb250cmFjZXB0aW9uX2hvcm1vbmFsX3BpbGxfZXN0cm9nZW4pLzIxKQoKczFfZGVtbyA8LSBzMV9kZW1vICU+JSAKICBsZWZ0X2pvaW4ocGlsbHMsIGJ5ID0gImNvbnRyYWNlcHRpb25faG9ybW9uYWxfcGlsbCIpCgpzMV9kZW1vIDwtIHMxX2RlbW8gJT4lIAogIG11dGF0ZShjb250cmFjZXB0aW9uX2hvcm1vbmFsX3BpbGxfZXN0cm9nZW4gPSBpZl9uYShjb250cmFjZXB0aW9uX2hvcm1vbmFsX3BpbGxfZXN0cm9nZW4sIGNvbnRyYWNlcHRpb25fcGlsbF9lc3Ryb2dlbiksCiAgICAgICAgIGNvbnRyYWNlcHRpb25faG9ybW9uYWxfcGlsbF9nZXN0YWdlbl90eXBlID0gaWZfbmEoY29udHJhY2VwdGlvbl9ob3Jtb25hbF9waWxsX2dlc3RhZ2VuX3R5cGUsIGNvbnRyYWNlcHRpb25fcGlsbF9nZXN0YWdlbl90eXBlKSkKCnMxX2RlbW8gPC0gczFfZGVtbyAlPiUgCiAgbXV0YXRlKGVzdHJvZ2VuX3Byb2dlc3RvZ2VuID0gY2FzZV93aGVuKAogICAgICBjb250cmFjZXB0aW9uX2hvcm1vbmFsX290aGVyID09ICJkZXBvX2NsaW5vdmlyIiB+ICJwcm9nZXN0b2dlbl9vbmx5IiwKICAgIGNvbnRyYWNlcHRpb25faG9ybW9uYWxfb3RoZXIgPT0gImltcGxhbm9uIiB+ICJwcm9nZXN0b2dlbl9vbmx5IiwKICAgIGNvbnRyYWNlcHRpb25faG9ybW9uYWxfb3RoZXJfbmFtZSAlY29udGFpbnMlICJheWRlc3MiIH4gInByb2dlc3RvZ2VuX29ubHkiLAogICAgY29udHJhY2VwdGlvbl9ob3Jtb25hbF9vdGhlcl9uYW1lICVjb250YWlucyUgIk1pcmVuYSIgfiAicHJvZ2VzdG9nZW5fb25seSIsCiAgICBjb250cmFjZXB0aW9uX2hvcm1vbmFsX290aGVyX25hbWUgJWNvbnRhaW5zJSAiTGlzdnkiIH4gInByb2dlc3RvZ2VuX2FuZF9lc3Ryb2dlbiIsCiAgICBjb250cmFjZXB0aW9uX2hvcm1vbmFsX290aGVyICVjb250YWlucyUgIm1pcmVuYSIgfiAicHJvZ2VzdG9nZW5fb25seSIsCiAgICBjb250cmFjZXB0aW9uX2hvcm1vbmFsX290aGVyICE9ICJtaXJlbmEiIH4gInByb2dlc3RvZ2VuX2FuZF9lc3Ryb2dlbiIsCiAgICBjb250cmFjZXB0aW9uX2hvcm1vbmFsX3BpbGwgJWluJSBjKCIyOF9taW5pIiwgImNlcmF6ZXR0ZSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY3lwcmVsbGEiLCAiZGFtYXJhIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRlc2lyZXR0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRpYW1pbGxhIiwgImp1YnJlbGUiLCAibWljcm9sdXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2VjdWxhY3QiKSB+ICJwcm9nZXN0b2dlbl9vbmx5IiwKICAgIGNvbnRyYWNlcHRpb25fcGlsbF9lc3Ryb2dlbiA9PSAwICYgY29udHJhY2VwdGlvbl9waWxsX2dlc3RhZ2VuID4gMCB+ICJwcm9nZXN0b2dlbl9vbmx5IiwKICAgIGNvbnRyYWNlcHRpb25fbWV0aG9kICVjb250YWlucyUgImhvcm1vbmFsX3BpbGwiIH4gInByb2dlc3RvZ2VuX2FuZF9lc3Ryb2dlbiIsCiAgICBjb250cmFjZXB0aW9uX21ldGhvZCAlY29udGFpbnMlICJob3Jtb25hbF9tb3JuaW5nX2FmdGVyX3BpbGwiIH4gTkFfY2hhcmFjdGVyXywKICAgIFRSVUUgfiAibm9uX2hvcm1vbmFsIgogICkKICApCmNyb3NzdGFicyh+IGVzdHJvZ2VuX3Byb2dlc3RvZ2VuICsgaG9ybW9uYWxfY29udHJhY2VwdGlvbiwgczFfZGVtbykKIyBzMV9kZW1vICU+JSBkcm9wX25hKG90aGVyX3BpbGxfbmFtZSkgJT4lIHNlbGVjdChvdGhlcl9waWxsX25hbWUsIGNvbnRyYWNlcHRpb25fcGlsbF9lc3Ryb2dlbiwKIyAgICAgICAgICAgICAgICAgICAgY29udHJhY2VwdGlvbl9waWxsX2dlc3RhZ2VuLCBjb250cmFjZXB0aW9uX3BpbGxfZ2VzdGFnZW5fdHlwZSkgJT4lIFZpZXcoKQoKIyBzMV9kZW1vICU+JSBkcm9wX25hKGNvbnRyYWNlcHRpb25faG9ybW9uYWxfb3RoZXJfbmFtZSkgJT4lIHNlbGVjdChjb250cmFjZXB0aW9uX2hvcm1vbmFsX290aGVyX25hbWUsIGNvbnRyYWNlcHRpb25fb3RoZXJfZXN0cm9nZW4sCiAgICAgICAgICAgICAgICAgICAjIGNvbnRyYWNlcHRpb25fb3RoZXJfZ2VzdGFnZW4sIGNvbnRyYWNlcHRpb25fb3RoZXJfZ2VzdGFnZW5fdHlwZSkgJT4lIFZpZXcoKQpzb3J0KHRhYmxlKHMxX2RlbW8kZXN0cm9nZW5fcHJvZ2VzdG9nZW4pKQoKc29ydCh0YWJsZShzMV9kZW1vJGNvbnRyYWNlcHRpb25fY2FsZW5kYXJfYWJzdGluZW5jZSkpCnNvcnQodGFibGUoczFfZGVtbyRjb250cmFjZXB0aW9uX2hvcm1vbmFsX290aGVyKSkKc29ydCh0YWJsZShzMV9kZW1vJGNvbnRyYWNlcHRpb25faG9ybW9uYWxfb3RoZXJfbmFtZSkpCnRhYmxlKHMxX2RlbW8kY29udHJhY2VwdGlvbl9hcHApCmNvbW1vbl9hcHBzID0gdGFibGUodG9sb3dlcihzdHJpbmdyOjpzdHJfdHJpbShzMV9kZW1vJGNvbnRyYWNlcHRpb25fYXBwX25hbWUpKSkKc29ydChjb21tb25fYXBwc1tjb21tb25fYXBwcyA+IDNdKQoKdGFibGUoczFfZGVtbyRwcmVnbmFudF90cnlpbmcpCnNvcnQodGFibGUoczFfZGVtbyR3aXNoX2Zvcl9jaGlsZHJlbikpCmBgYAoKCiMjIFNpbmdsZXMgdnMgY291cGxlcwpgYGB7ciBzaW5nbGVzfQpzMV9kZW1vID0gczFfZGVtbyAlPiUgbXV0YXRlKGhldGVyb19yZWxhdGlvbnNoaXAgPSBhcy5udW1lcmljKGhldGVyb19yZWxhdGlvbnNoaXApKQpzMV9kZW1vICU+JSAKICAgIGNvdW50KGhldGVyb19yZWxhdGlvbnNoaXApCiAgICAKczFfZGVtbyAlPiUgCiAgICBsZWZ0X2pvaW4oczFfZmlsdGVyICU+JSBzZWxlY3Qoc2Vzc2lvbiwgZ2V0c19wYWlkKSkgJT4lCiAgICBjb3VudChnZXRzX3BhaWQsIGhldGVyb19yZWxhdGlvbnNoaXApICU+JQogICAgbmEub21pdCgpCmBgYAoKIyMjIFNPSQpgYGB7cn0Kb2xkX2xhYmVscyA8LSBzMl9pbml0aWFsJHNvaV9yX2Rlc2lyZV83ICU+JSB2YWxfbGFiZWxzKCkKbmV3X2xhYmVscyA8LSAxOjUKbmFtZXMobmV3X2xhYmVscykgPC0gbmFtZXMob2xkX2xhYmVscykKczJfaW5pdGlhbCA8LSBzMl9pbml0aWFsICU+JSBtdXRhdGVfYXQodmFycyhzb2lfcl9kZXNpcmVfNywgc29pX3JfZGVzaXJlXzksIHNvaV9yX2Rlc2lyZV84KSwgZnVucygKICByZWNvZGUoLiwgIm5ldmVyIiA9IDEsICJyYXJlbHkiID0gMiwgIm1vbnRobHkiID0gMywgIndlZWtseSIgID0gNCwgImRhaWx5IiA9IDUpCikpICU+JSAKICBsYWJlbGxlZDo6c2V0X3ZhbHVlX2xhYmVscyhzb2lfcl9kZXNpcmVfNyA9IG5ld19sYWJlbHMsIHNvaV9yX2Rlc2lyZV85ID0gbmV3X2xhYmVscywgc29pX3JfZGVzaXJlXzggPSBuZXdfbGFiZWxzKQpzMl9pbml0aWFsJHNvaV9yX2Rlc2lyZSA9IHMyX2luaXRpYWwgJT4lIHVuZ3JvdXAoKSAlPiUgc2VsZWN0KHNvaV9yX2Rlc2lyZV83LCBzb2lfcl9kZXNpcmVfOSwgc29pX3JfZGVzaXJlXzgpICU+JSBhZ2dyZWdhdGVfYW5kX2RvY3VtZW50X3NjYWxlKGZ1biA9IHJvYnVzdF9yb3dtZWFucykKdmFyX2xhYmVsKHMyX2luaXRpYWwkc29pX3JfZGVzaXJlXzgpIDwtICJTb2Npb3NleHVhbCBpbnZlbnRvcnktcmV2aXNlZDogRGVzaXJlIFN1YnNjYWxlIgoKY3V0cG9pbnRzIDwtIGMoIjAiID0gMSwKICAgICAgICAgICAgICAgIjEiID0gMiwKICAgICAgICAgICAgICAgIjItMyIgPSAzLAogICAgICAgICAgICAgICAiNC03IiA9IDQsCiAgICAgICAgICAgICAgICI4IG9yIG1vcmUiID0gNSkKczJfaW5pdGlhbCA8LSBzMl9pbml0aWFsICU+JSBtdXRhdGVfYXQodmFycyhzb2lfcl9iZWhhdmlvcl8xLCBzb2lfcl9iZWhhdmlvcl8yLCBzb2lfcl9iZWhhdmlvcl8zKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVucyhkaXNjcmV0ZSA9IGNhc2Vfd2hlbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuID09IDAgfiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4gPT0gMSB+IDIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLiAlaW4lIDI6MyB+IDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLiAlaW4lIDQ6NyB+IDQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLiAlaW4lIDg6MWU0IH4gNSkpKSAlPiUgCiAgbGFiZWxsZWQ6OnNldF92YWx1ZV9sYWJlbHMoc29pX3JfYmVoYXZpb3JfMV9kaXNjcmV0ZSA9IGN1dHBvaW50cywgc29pX3JfYmVoYXZpb3JfMl9kaXNjcmV0ZSA9IGN1dHBvaW50cywgc29pX3JfYmVoYXZpb3JfM19kaXNjcmV0ZSA9IGN1dHBvaW50cykKdmFyX2xhYmVsKHMyX2luaXRpYWwkc29pX3JfYmVoYXZpb3JfMV9kaXNjcmV0ZSkgPC0gdmFyX2xhYmVsKHMyX2luaXRpYWwkc29pX3JfYmVoYXZpb3JfMSkKdmFyX2xhYmVsKHMyX2luaXRpYWwkc29pX3JfYmVoYXZpb3JfMl9kaXNjcmV0ZSkgPC0gdmFyX2xhYmVsKHMyX2luaXRpYWwkc29pX3JfYmVoYXZpb3JfMikKdmFyX2xhYmVsKHMyX2luaXRpYWwkc29pX3JfYmVoYXZpb3JfM19kaXNjcmV0ZSkgPC0gdmFyX2xhYmVsKHMyX2luaXRpYWwkc29pX3JfYmVoYXZpb3JfMykKCnMyX2luaXRpYWwkc29pX3JfYmVoYXZpb3IgPSBzMl9pbml0aWFsICU+JSB1bmdyb3VwKCkgJT4lIHNlbGVjdChzb2lfcl9iZWhhdmlvcl8xX2Rpc2NyZXRlLCBzb2lfcl9iZWhhdmlvcl8yX2Rpc2NyZXRlLCBzb2lfcl9iZWhhdmlvcl8zX2Rpc2NyZXRlKSAlPiUgYWdncmVnYXRlX2FuZF9kb2N1bWVudF9zY2FsZShmdW4gPSByb2J1c3Rfcm93bWVhbnMpCnZhcl9sYWJlbChzMl9pbml0aWFsJHNvaV9yX2JlaGF2aW9yKSA8LSAiU29jaW9zZXh1YWwgaW52ZW50b3J5LXJldmlzZWQ6IEJlaGF2aW91ciBTdWJzY2FsZSIKCgpzMl9pbml0aWFsJHNvaV9yID0gczJfaW5pdGlhbCAlPiUgdW5ncm91cCgpICU+JSBzZWxlY3Qoc29pX3JfYXR0aXR1ZGVfNnIsIHNvaV9yX2F0dGl0dWRlXzQsIHNvaV9yX2F0dGl0dWRlXzUsIHNvaV9yX2Rlc2lyZV83LCBzb2lfcl9kZXNpcmVfOSwgc29pX3JfZGVzaXJlXzgsIHNvaV9yX2JlaGF2aW9yXzFfZGlzY3JldGUsIHNvaV9yX2JlaGF2aW9yXzJfZGlzY3JldGUsIHNvaV9yX2JlaGF2aW9yXzNfZGlzY3JldGUpICU+JSBhZ2dyZWdhdGVfYW5kX2RvY3VtZW50X3NjYWxlKGZ1biA9IHJvYnVzdF9yb3dtZWFucykKdmFyX2xhYmVsKHMyX2luaXRpYWwkc29pX3IpIDwtICJTb2Npb3NleHVhbCBpbnZlbnRvcnktcmV2aXNlZCIKYGBgCgoKIyMjIFBhcnRuZXIgYXR0cmFjdGl2ZW5lc3MgaXRlbXMKYGBge3J9CnMyX2luaXRpYWwgPC0gczJfaW5pdGlhbCAlPiUgCiAgcmVuYW1lKHBhcnRuZXJfc2V4aW5lc3MgPSBhdHRyYWN0aXZlbmVzc19zZXh5LAogICAgICAgICBwYXJ0bmVyX2F0dHJhY3RpdmVuZXNzX2JvZHkgPSBhdHRyYWN0aXZlbmVzc19ib2R5LAogICAgICAgICBwYXJ0bmVyX2F0dHJhY3RpdmVuZXNzX2ZhY2UgPSBhdHRyYWN0aXZlbmVzc19mYWNlLAogICAgICAgIHBhcnRuZXJfYXR0cmFjdGl2ZW5lc3Nfc2hvcnR0ZXJtID0gYXR0cmFjdGl2ZW5lc3Nfc3RwLAogICAgICAgIHBhcnRuZXJfYXR0cmFjdGl2ZW5lc3NfbG9uZ3Rlcm0gPSBhdHRyYWN0aXZlbmVzc19sdHAsCiAgICAgICAgcGFydG5lcl9hdHRyYWN0aXZlbmVzc190cnVzdCA9IGF0dHJhY3RpdmVuZXNzX3RydXN0d29ydGhpbmVzcwogICAgICAgICkgJT4lIAogIG11dGF0ZSgKICAgIHNwbXNfcmVsID0gc3Btc19zZWxmIC0gc3Btc19wYXJ0bmVyCiAgKQoKCnMyX2luaXRpYWwkcGFydG5lcl9hdHRyYWN0aXZlbmVzc19zZXh1YWwgPC0gczJfaW5pdGlhbCAlPiUgc2VsZWN0KHBhcnRuZXJfc2V4aW5lc3MsIHBhcnRuZXJfYXR0cmFjdGl2ZW5lc3Nfc2hvcnR0ZXJtLCBwYXJ0bmVyX2F0dHJhY3RpdmVuZXNzX2ZhY2UsIHBhcnRuZXJfYXR0cmFjdGl2ZW5lc3NfYm9keSkgJT4lIGFnZ3JlZ2F0ZV9hbmRfZG9jdW1lbnRfc2NhbGUoZnVuID0gcm9idXN0X3Jvd21lYW5zKQp2YXJfbGFiZWwoczJfaW5pdGlhbCRwYXJ0bmVyX2F0dHJhY3RpdmVuZXNzX3NleHVhbCkgPC0gIlBhcnRuZXIncyBzZXh1YWwgYXR0cmFjdGl2ZW5lc3MiCmBgYAoKIyMjIFJlbGF0aW9uc2hpcCBzYXRpc2ZhY3Rpb24KYGBge3J9CnMyX2luaXRpYWwkcmVsYXRpb25zaGlwX2NvbmZsaWN0X1IgPSA2IC0gczJfaW5pdGlhbCRyZWxhdGlvbnNoaXBfY29uZmxpY3QKczJfaW5pdGlhbCRyZWxhdGlvbnNoaXBfcHJvYmxlbXNfUiA9IDYgLSBzMl9pbml0aWFsJHJlbGF0aW9uc2hpcF9wcm9ibGVtcwpwc3ljaDo6YWxwaGEoczJfaW5pdGlhbCAlPiUgc2VsZWN0KHJlbGF0aW9uc2hpcF9wcm9ibGVtc19SLCByZWxhdGlvbnNoaXBfc2F0aXNmYWN0aW9uX292ZXJhbGwsIHJlbGF0aW9uc2hpcF9jb25mbGljdF9SLCByZWxhdGlvbnNoaXBfc2F0aXNmYWN0aW9uXzIsIHJlbGF0aW9uc2hpcF9zYXRpc2ZhY3Rpb25fMykgJT4lIGRhdGEuZnJhbWUoKSkKczJfaW5pdGlhbCRyZWxhdGlvbnNoaXBfc2F0aXNmYWN0aW9uID0gczJfaW5pdGlhbCAlPiUgdW5ncm91cCgpICU+JSBzZWxlY3QocmVsYXRpb25zaGlwX3Byb2JsZW1zX1IsIHJlbGF0aW9uc2hpcF9zYXRpc2ZhY3Rpb25fb3ZlcmFsbCwgcmVsYXRpb25zaGlwX2NvbmZsaWN0X1IsIHJlbGF0aW9uc2hpcF9zYXRpc2ZhY3Rpb25fMiwgcmVsYXRpb25zaGlwX3NhdGlzZmFjdGlvbl8zKSAlPiUgYWdncmVnYXRlX2FuZF9kb2N1bWVudF9zY2FsZShmdW4gPSByb2J1c3Rfcm93bWVhbnMpCnZhcl9sYWJlbChzMl9pbml0aWFsJHJlbGF0aW9uc2hpcF9zYXRpc2ZhY3Rpb24pIDwtICJSZWxhdGlvbnNoaXAgc2F0aXNmYWN0aW9uIgpgYGAKCiMjIExpdmluZyBzaXR1YXRpb24KYGBge3J9CnMxX2RlbW8gPC0gczFfZGVtbyAlPiUgCiAgbXV0YXRlKAogICAgbGl2aW5nX3NpdHVhdGlvbiA9IGNhc2Vfd2hlbigKICAgICAgYWJvZGVfYWxvbmUgPT0gMSB+ICJhbG9uZSIsCiAgICAgIGFib2RlX3dpdGhfcGFydG5lciA9PSAxIH4gIndpdGggcGFydG5lciIsCiAgICAgIGFib2RlX2ZsYXRfc2hhcmUgPT0gMyB+ICJmbGF0c2hhcmUiLAogICAgICBhYm9kZV9mbGF0X3NoYXJlID09IDIgfiAid2l0aCBmYW1pbHkiLAogICAgICBucl9jaGlsZHJlbiA+IDEgfiAid2l0aCBjaGlsZHJlbiIsCiAgICAgIGhldGVyb19yZWxhdGlvbnNoaXAgPT0gMCB+ICJhbG9uZSIsCiAgICAgIGFib2RlX2ZsYXRfc2hhcmUgPT0gMSB+ICJvdGhlciIsCiAgICAgIFRSVUUgfiAibWlzc2luZyIKICAgICkKICApCnRhYmxlKHMxX2RlbW8kbGl2aW5nX3NpdHVhdGlvbikKIyBzMV9kZW1vICU+JSBmaWx0ZXIobGl2aW5nX3NpdHVhdGlvbiA9PSAib3RoZXIiKSAlPiUgc2VsZWN0KHN0YXJ0c193aXRoKCJhYm9kZSIpKSAlPiUgVmlldwpgYGAKCgoKIyMgTWVyZ2Ugc3VydmV5cwpgYGB7ciBtZXJnZV94c2VjdH0KcHJlX3N1cnZleXMgPSBzMV9kZW1vICU+JQogIGxlZnRfam9pbihzMl9pbml0aWFsLCBieSA9ICJzZXNzaW9uIiwgc3VmZml4ID0gYygiX2RlbW8iLCAiX2luaXRpYWwiKSkgIyBtZXJnZSBkZW1vIGFuZCBwZXJzb25hbGl0eSBzdHVmZgoKYWxsX3N1cnZleXMgPSBwcmVfc3VydmV5cyAlPiUKICBsZWZ0X2pvaW4oczRfZm9sbG93dXAsIGJ5ID0gInNlc3Npb24iKSAjIGFkZCBmb2xsb3cgdXAgc3VydmV5CnN0b3BpZm5vdCghYW55KGR1cGxpY2F0ZWQoYWxsX3N1cnZleXMkc2Vzc2lvbikpKQpgYGAKCgojIyBDb2RlIG9wZW4gYW5zd2VyCgojIyMgR3Vlc3NlZCBoeXBvdGhlc2lzPwpgYGB7cn0KczRfZm9sbG93dXAgJT4lIGZpbHRlcighaXMubmEoaHlwb3RoZXNpc19ndWVzcykgJiBzdHJpbmdyOjpzdHJfdHJpbShoeXBvdGhlc2lzX2d1ZXNzKSAhPSAiIikgJT4lIHNlbGVjdChzZXNzaW9uLCBoeXBvdGhlc2lzX2d1ZXNzKSAlPiUgCiAgbXV0YXRlKAogICAgIyBpZiB0aGV5IG1lbnRpb24gaG9ybW9uZXMgb3IgbWVuc3RydWF0aW9uIG9yIFBNUywgYnV0IG5vdCB0aGUgY3ljbGUsIGZlcnRpbGUgd2luZG93LCBvdnVsYXRpb24KICAgICAgICBoeXBvdGhlc2lzX2hvcm1vbmVzX21lbnRpb25lZCA9IE5BX3JlYWxfLAogICAgIyBpZiB0aGV5IG1lbnRpb24gY3ljbGUvZmVydGlsZSB3aW5kb3csIGJ1dCBvbmx5IGdlbmVyYWxseSBvciBpbiBjb21iaW5hdGlvbiB3aXRoIGdlbmVyaWNzIGxpa2UgIm1vb2QiCiAgICAgICAgaHlwb3RoZXNpc19jeWNsZV9tZW50aW9uZWQgPSAwLAogICAgIyBpZiB0aGV5IG1lbnRpb24gdGhlIGN5Y2xlIGFuZCBzZXgvbGliaWRvL2F0dHJhY3RpdmVuZXNzCiAgICAgICAgIGh5cG90aGVzaXNfY3ljbGVfc2V4ID0gMCkgJT4lIAogIGRhdGEuZnJhbWUoKSAtPiBoeXBvdGhlc2lzX2d1ZXNzZWQKCndyaXRleGw6OndyaXRlX3hsc3goaHlwb3RoZXNpc19ndWVzc2VkLCAiY29kaW5ncy9oeXBvdGhlc2lzX2d1ZXNzZWQueGxzeCIpCmh5cG90aGVzaXNfZ3Vlc3NlZCA9IHJlYWR4bDo6cmVhZF94bHN4KCJjb2RpbmdzL2h5cG90aGVzaXNfZ3Vlc3NlZF9jb2RlZC54bHN4IiwxKQoKYWxsX3N1cnZleXMgPSBhbGxfc3VydmV5cyAlPiUgbGVmdF9qb2luKGh5cG90aGVzaXNfZ3Vlc3NlZCAlPiUgc2VsZWN0KC1oeXBvdGhlc2lzX2d1ZXNzKSwgYnkgPSBjKCJzZXNzaW9uIikpCiAKCiAKYWxsX3N1cnZleXMkaHlwb3RoZXNpc19ndWVzc190b3BpYyA8LSAwCmFsbF9zdXJ2ZXlzIDwtIGFsbF9zdXJ2ZXlzICU+JSAKICBtdXRhdGUoCiAgaHlwb3RoZXNpc19ndWVzc190b3BpYyA9IHJlcGxhY2UoaHlwb3RoZXNpc19ndWVzc190b3BpYywgaHlwb3RoZXNpc19ob3Jtb25lc19tZW50aW9uZWQgPT0gMSwgMSksCiAgaHlwb3RoZXNpc19ndWVzc190b3BpYyA9IHJlcGxhY2UoaHlwb3RoZXNpc19ndWVzc190b3BpYywgaHlwb3RoZXNpc19jeWNsZV9tZW50aW9uZWQgPT0gMSwgMiksCiAgaHlwb3RoZXNpc19ndWVzc190b3BpYyA9IHJlcGxhY2UoaHlwb3RoZXNpc19ndWVzc190b3BpYywgaHlwb3RoZXNpc19jeWNsZV9zZXggPT0gMSwgMyksCiAgaHlwb3RoZXNpc19ndWVzc190b3BpYyA9IGZhY3RvcihoeXBvdGhlc2lzX2d1ZXNzX3RvcGljLCBsZXZlbD1jKDAsMSwyLDMpLCBsYWJlbHM9Yygnbm9fZ3Vlc3MnLCdob3Jtb25lcycsICdjeWNsZScsICdjeWNsZV9zZXgnKSkKICApCmBgYAoKIyMjIGFwcCBhd2FyZW5lc3MKRGlkIHRoZXkgdXNlIGEgbWVuc3RydWFsIGN5Y2xlIG9yIHBpbGwgYXBwIGFuZCB3YXMgaXQgb25lIHRoYXQgd291bGQgZm9zdGVyCmF3YXJlbmVzcyBvZiB0aGUgbWVuc3RydWFsIGN5Y2xlPwoKYGBge3J9CmF3YXJlbmVzcyA8LSByaW86OmltcG9ydCgiY29kaW5ncy9hd2FyZW5lc3NfY29kZWQueGxzeCIpICU+JSB0YmxfZGYoKQpyaW86OmV4cG9ydChhbGxfc3VydmV5cyAlPiUgc2VsZWN0KHNlc3Npb24sIGNvbnRyYWNlcHRpb25fYXBwX25hbWUsIGF3YXJlX2ZlcnRpbGVfcmVhc29uX3VudXN1YWwsIGZlZWRiYWNrX2Zvcl91cykgJT4lIGZ1bGxfam9pbihhd2FyZW5lc3MgJT4lIHNlbGVjdChzZXNzaW9uLCBjeWNsZV9hd2FyZW5lc3NfYXBwLCBjeWNsZV9hd2FyZW5lc3Nfb3RoZXIpICU+JSAKICAgIGRpc3RpbmN0KCksIGJ5ID0gYygic2Vzc2lvbiIpKSAlPiUgZmlsdGVyKGNvbnRyYWNlcHRpb25fYXBwX25hbWUgIT0gIiIgfCBhd2FyZV9mZXJ0aWxlX3JlYXNvbl91bnVzdWFsICE9ICIiICB8IGZlZWRiYWNrX2Zvcl91cyAhPSAiIikgJT4lIHNlbGVjdChzZXNzaW9uLCBjb250cmFjZXB0aW9uX2FwcF9uYW1lLCBhd2FyZV9mZXJ0aWxlX3JlYXNvbl91bnVzdWFsLCBmZWVkYmFja19mb3JfdXMsIGN5Y2xlX2F3YXJlbmVzc19hcHAsIGN5Y2xlX2F3YXJlbmVzc19vdGhlciksICJjb2RpbmdzL2F3YXJlbmVzcy54bHN4IikKCmFsbF9zdXJ2ZXlzIDwtIGFsbF9zdXJ2ZXlzICU+JSBsZWZ0X2pvaW4oCiAgYXdhcmVuZXNzICU+JSBzZWxlY3Qoc2Vzc2lvbiwgY3ljbGVfYXdhcmVuZXNzX2FwcCwgY3ljbGVfYXdhcmVuZXNzX290aGVyKSAlPiUgCiAgICBkaXN0aW5jdCgpLCBieSA9ICJzZXNzaW9uIikgJT4lIAogIG11dGF0ZShjeWNsZV9hd2FyZW5lc3NfYXBwID0gcmVjb2RlKGN5Y2xlX2F3YXJlbmVzc19hcHAsCiAgICAgICAgICAgIGAxYCA9ICJjeWNsZV9waGFzZV9hd2FyZSIsCiAgICAgICAgICAgIGAyYCA9ICJzeW1wdG9tX2RpYXJpZXMiLAogICAgICAgICAgICBgM2AgPSAidW5jbGVhciIsCiAgICAgICAgICAgIGAwYCA9ICJyZW1pbmRlciIsCiAgICAgICAgICAgIC5taXNzaW5nID0gIm5vbmUiKSkKCmNyb3NzdGFicyh+IGN5Y2xlX2F3YXJlbmVzc19hcHAsIGFsbF9zdXJ2ZXlzKQpjcm9zc3RhYnMofiBjeWNsZV9hd2FyZW5lc3NfYXBwICsgaG9ybW9uYWxfY29udHJhY2VwdGlvbiwgYWxsX3N1cnZleXMpCmNyb3NzdGFicyh+IGN5Y2xlX2F3YXJlbmVzc19hcHAgKyBob3Jtb25hbF9jb250cmFjZXB0aW9uLCBhbGxfc3VydmV5cykKYWxsX3N1cnZleXMgJT4lIGdyb3VwX2J5KHRvbG93ZXIoc3RyX3RyaW0oY29udHJhY2VwdGlvbl9hcHBfbmFtZSkpLCBjeWNsZV9hd2FyZW5lc3NfYXBwKSAlPiUgCiAgc3VtbWFyaXNlKG4gPSBuKCkpICU+JSBhcnJhbmdlKGRlc2MobikpCmBgYAoKCiMjIyBjaGFuZ2UgY29udHJhY2VwdGlvbgpgYGB7cn0KCmFsbF9zdXJ2ZXlzICU+JSBzZWxlY3Qoc2Vzc2lvbiwgY2hhbmdlX2NvbnRyYWNlcHRpb24sIGNoYW5nZV9jb250cmFjZXB0aW9uX3RvKSAlPiUgZmlsdGVyKGNoYW5nZV9jb250cmFjZXB0aW9uID09IDEpLT4gY29udHJhY2VwdGlvbl9jaGFuZ2UKCnMxX2RlbW8gJT4lIHNlbGVjdChzZXNzaW9uLCBjb250cmFjZXB0aW9uX21ldGhvZCkgLT4gY29udHJhY2VwdGlvbgoKY29udHJhY2VwdGlvbl9jaGFuZ2UgPC0gbWVyZ2UoY29udHJhY2VwdGlvbl9jaGFuZ2UsIGNvbnRyYWNlcHRpb24sIGJ5PSdzZXNzaW9uJykKCgpjb250cmFjZXB0aW9uX2NoYW5nZSAlPiUgbXV0YXRlKCAKICAjIGNvbnRyYWNlcHRpb24gY2hhbmdlIGRvZXMgbm90IGluZmx1ZW5jZSBncm91cCBtZW1iZXJzaGlwCiAgbm9fcmVsZXZhbnRfY2hhbmdlID0gTkFfcmVhbF8sCiAgIyBub25ob3Jtb25hbCB0byBob3Jtb25hbCBjb250cmFjZXB0aW9uCiAgY2hhbmdlX3RvX2hvcm1vbmFsX2NvbnRyYWNlcHRpb24gPSAwLAogICMgaG9ybW9uYWwgdG8gbm9uaG9ybW9uYWwgY29udHJhY2VwdGlvbiAKICBjaGFuZ2VfdG9fbm9uaG9ybW9uYWwgPSAwKSAlPiUgCiAgZGF0YS5mcmFtZSgpIC0+IGNoYW5nZV9jb250cmFjZXB0aW9uX3RvCgoKd3JpdGV4bDo6d3JpdGVfeGxzeChjaGFuZ2VfY29udHJhY2VwdGlvbl90bywgImNvZGluZ3MvY2hhbmdlX2NvbnRyYWNlcHRpb25fdG8ueGxzeCIpCmNoYW5nZV9jb250cmFjZXB0aW9uX3RvID0gcmVhZHhsOjpyZWFkX3hsc3goImNvZGluZ3MvY2hhbmdlX2NvbnRyYWNlcHRpb25fdG9fY29kZWQueGxzeCIsMSkKCmFsbF9zdXJ2ZXlzID0gYWxsX3N1cnZleXMgJT4lIGxlZnRfam9pbihjaGFuZ2VfY29udHJhY2VwdGlvbl90byAlPiUgc2VsZWN0KHNlc3Npb24sIG5vX3JlbGV2YW50X2NoYW5nZSwgY2hhbmdlX3RvX2hvcm1vbmFsX2NvbnRyYWNlcHRpb24sIGNoYW5nZV90b19ub25ob3Jtb25hbCksIGJ5ID0gYygic2Vzc2lvbiIpKQpgYGAKCiMjIyBNZWRpY2F0aW9uCmBgYHtyfQphbGxfc3VydmV5cyAlPiUgZmlsdGVyKCFpcy5uYShtZWRpY2F0aW9uX25hbWUpICYgbWVkaWNhdGlvbl9uYW1lICE9ICIiKSAlPiUgc2VsZWN0KHNlc3Npb24sIG1lZGljYXRpb25fbmFtZSkgJT4lIGRpc3RpbmN0KCkgJT4lIAogIG11dGF0ZSgKICAgICMgaWYgdGhleSBtZW50aW9uIGhvcm1vbmVzIG9yIG1lbnN0cnVhdGlvbiBvciBQTVMsIGJ1dCBub3QgdGhlIGN5Y2xlLCBmZXJ0aWxlIHdpbmRvdywgb3Z1bGF0aW9uCiAgICAgICAgbWVkaWNhdGlvbl9ob3Jtb25hbCA9IE5BX3JlYWxfLAogICAgIyBpZiB0aGV5IG1lbnRpb24gY3ljbGUvZmVydGlsZSB3aW5kb3csIGJ1dCBvbmx5IGdlbmVyYWxseSBvciBpbiBjb21iaW5hdGlvbiB3aXRoIGdlbmVyaWNzIGxpa2UgIm1vb2QiCiAgICAgICAgbWVkaWNhdGlvbl9wc3ljaG9waGFybWFjb2xvZ2ljYWwgPSAwLAogICAgICAgIG1lZGljYXRpb25fYW50aWJpb3RpY3MgPSAwKSAlPiUgCiAgZGF0YS5mcmFtZSgpIC0+IG1lZGljYXRpb24KCndyaXRleGw6OndyaXRlX3hsc3gobWVkaWNhdGlvbiwgImNvZGluZ3MvbWVkaWNhdGlvbi54bHN4IikKIG1lZGljYXRpb24gPSByZWFkeGw6OnJlYWRfeGxzeCgiY29kaW5ncy9tZWRpY2F0aW9uX2NvZGVkLnhsc3giLDEpCiAKCiAKYWxsX3N1cnZleXMgPSBhbGxfc3VydmV5cyAlPiUgbGVmdF9qb2luKG1lZGljYXRpb24gJT4lIHNlbGVjdCgtbWVkaWNhdGlvbl9uYW1lKSwgYnkgPSBjKCJzZXNzaW9uIikpCmBgYAoKIyMgY3ljbGUgbGVuZ3RoIApgYGB7cn0KYWxsX3N1cnZleXMkbWVuc3RydWF0aW9uX2xlbmd0aF9ncm91cHMgPC0gTkEgCgphbGxfc3VydmV5cyA9IGFsbF9zdXJ2ZXlzICU+JSAKICBtdXRhdGUobWVuc3RydWF0aW9uX2xlbmd0aF9ncm91cHMgPSAoaWZlbHNlKG1lbnN0cnVhdGlvbl9sZW5ndGggPj0gMjAgJiBtZW5zdHJ1YXRpb25fbGVuZ3RoIDw9IDQwLCAxLAogICAgICAgICAgIGlmZWxzZShtZW5zdHJ1YXRpb25fbGVuZ3RoID4gNDAgLCAyLAogICAgICAgICAgICAgICAgICBpZmVsc2UobWVuc3RydWF0aW9uX2xlbmd0aCAgPCAyMCwgMywgTkEpKSkpKQoKYWxsX3N1cnZleXMkbWVuc3RydWF0aW9uX2xlbmd0aF9ncm91cHMgPC0gZmFjdG9yKGFsbF9zdXJ2ZXlzJG1lbnN0cnVhdGlvbl9sZW5ndGhfZ3JvdXBzLCBsZXZlbD1jKDEsMiwzKSwgbGFiZWxzPWMoJ25vcm1hbCcsICdsb25nJywgJ3Nob3J0JykpCmBgYAoKCiMjIGNob2ljZSBvZiBjb250cmFjZXB0aW9uCgpgYGB7ciBjaG9pY2Ugb2YgY29udHJhY2VwdGlvbn0KYWxsX3N1cnZleXMgPSBhbGxfc3VydmV5cyAlPiUgbXV0YXRlKAogICAgY29udHJhY2VwdGlvbl9tZXRob2QgPSBpZl9lbHNlKGlzLm5hKGNvbnRyYWNlcHRpb25fbWV0aG9kKSwgIiIsIGFzLmNoYXJhY3Rlcihjb250cmFjZXB0aW9uX21ldGhvZCkpLAogICAgY29tID0gY29udHJhY2VwdGlvbl9tZXRob2QsCiAgICBjb250cmFjZXB0aW9uX2FwcHJvYWNoID0gaWZfZWxzZSgKICAgICAgICBjb25kaXRpb24gPSBjb20gJWNvbnRhaW5zJSAiaG9ybW9uYWxfcGlsbCIgfCBjb20gJWNvbnRhaW5zJSAiaG9ybW9uYWxfb3RoZXIiLCAjIGNvbmRpdGlvbgogICAgICAgICMgdHJ1ZQogICAgICAgIHRydWUgPSBpZl9lbHNlKAogICAgICAgICAgICBjb25kaXRpb24gPSBjb20gPT0gImhvcm1vbmFsX3BpbGwiIHwgY29tID09ICJob3Jtb25hbF9vdGhlciIgfCBjb20gPT0gImhvcm1vbmFsX21vcm5pbmdfYWZ0ZXJfcGlsbCIsICMgY29uZGl0aW9uCiAgICAgICAgICAgIHRydWUgPSBpZl9lbHNlKGNvbSA9PSAiaG9ybW9uYWxfcGlsbCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydWUgPSAiaG9ybW9uYWxfcGlsbF9vbmx5IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UgPSAiaG9ybW9uYWxfb3RoZXJfb25seSIKICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSA9ICJob3Jtb25hbCtiYXJyaWVyIgogICAgICAgICAgICApLAogICAgICAgIGlmX2Vsc2UoCiAgICAgICAgICAgIGNvbmRpdGlvbiA9ICEgY29tICVjb250YWlucyUgImF3YXJlbmVzcyIsIAogICAgICAgICAgICB0cnVlID0gaWZfZWxzZShjb25kaXRpb24gPSBjb20gIT0gIiIsCiAgICAgICAgICAgICAgICB0cnVlID0gaWZfZWxzZShjb25kaXRpb24gPSBjb20gJWNvbnRhaW5zJSAiYmFycmllcl9pbnRyYXV0ZXJpbmVfcGVzc2FyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlID0gImJhcnJpZXJfcGVzc2FyIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZl9lbHNlKGNvbmRpdGlvbiA9IGNvbSAlY29udGFpbnMlICJiYXJyaWVyX2NvbmRvbXMiLCB0cnVlID0gImNvbmRvbXMiLCBmYWxzZSA9ICJvdGhlciIpKSwKICAgICAgICAgICAgICAgIGZhbHNlID0gIm5vdGhpbmciKSwKICAgICAgICAgICAgICAgIGZhbHNlID0gImF3YXJlbmVzcyIpCiAgICAgICAgKQogICAgICAgICAgIyBmYWxzZQogICAgKQphbGxfc3VydmV5cyRjb250cmFjZXB0aW9uX2FwcHJvYWNoID0gZmFjdG9yKCBhbGxfc3VydmV5cyRjb250cmFjZXB0aW9uX2FwcHJvYWNoLCBsZXZlbHMgPSBjKCJjb25kb21zIiwgImJhcnJpZXJfcGVzc2FyIiwgImhvcm1vbmFsK2JhcnJpZXIiLCAiaG9ybW9uYWxfcGlsbF9vbmx5IiwgImhvcm1vbmFsX290aGVyX29ubHkiLCAiYXdhcmVuZXNzIiwgIm5vdGhpbmciLCAib3RoZXIiKSApCnFwbG90KGFsbF9zdXJ2ZXlzJGNvbnRyYWNlcHRpb25fYXBwcm9hY2gpICsgY29vcmRfZmxpcCgpCgphbGxfc3VydmV5cyA8LSBhbGxfc3VydmV5cyAlPiUgCiAgICAgICAgbXV0YXRlKGNvbnRyYWNlcHRpb25fYXdhcmVuZXNzX2FwcHJvYWNoID0gCiAgICAgICAgICAgICAgICAgY2FzZV93aGVuKAogICAgICAgICAgICAgICAgICAgY29udHJhY2VwdGlvbl9hcHByb2FjaCAlY29udGFpbnMlICJob3Jtb25hbCIgfiBlc3Ryb2dlbl9wcm9nZXN0b2dlbiwKICAgICAgICAgICAgICAgICAgIGNvbnRyYWNlcHRpb25fYXBwcm9hY2ggJWNvbnRhaW5zJSAiYXdhcmVuZXNzIiB8ICAKICAgICAgICAgICAgICAgICAgICAgY3ljbGVfYXdhcmVuZXNzX2FwcCA9PSAiY3ljbGVfcGhhc2VfYXdhcmUiIH4gImF3YXJlbmVzcyIsCiAgICAgICAgICAgICAgICAgICBUUlVFIH4gYXMuY2hhcmFjdGVyKGNvbnRyYWNlcHRpb25fYXBwcm9hY2gpKQogICAgICAgICAgICAgICApCmBgYAoKIyMgRml4IHZhcmlhYmxlcwoKYGBge3J9CnZhbF9sYWJlbHMoYWxsX3N1cnZleXMkcmVsYXRpb25zaGlwX3N0YXR1cykgPC0gYygiU2luZ2xlIiA9IDEsICJsb29zZSByZWxhdGlvbnNoaXAiID0gMiwgInN0ZWFkeSByZWxhdGlvbnNoaXAiID0gMywgImVuZ2FnZWQiID0gNCwgIm1hcnJpZWQiID0gNSwgIm90aGVyIiA9IDYpCmBgYAoKCiMjIyBEaWFyeSBkZXNpcmUgc2NhbGVzCmBgYHtyfQpsaWJyYXJ5KGNvZGVib29rKQoKczNfZGFpbHkkZXh0cmFfcGFpcl9kZXNpcmVfYW5kX2JlaGF2aW91ciA8LSBzM19kYWlseSAlPiUgdW5ncm91cCgpICU+JSBzZWxlY3Qoc3RhcnRzX3dpdGgoImV4dHJhX3BhaXJfZGVzaXJlXyIpKSAlPiUgYWdncmVnYXRlX2FuZF9kb2N1bWVudF9zY2FsZShmdW4gPSByb2J1c3Rfcm93bWVhbnMpCnZhcl9sYWJlbChzM19kYWlseSRleHRyYV9wYWlyX2Rlc2lyZV9hbmRfYmVoYXZpb3VyKSA8LSAiRXh0cmEtcGFpciBkZXNpcmUgYW5kIGJlaGF2aW91ciIKCnMzX2RhaWx5JGV4dHJhX3BhaXJfZGVzaXJlIDwtIHMzX2RhaWx5ICU+JSB1bmdyb3VwKCkgJT4lIHNlbGVjdCggZXh0cmFfcGFpcl9kZXNpcmVfNywgZXh0cmFfcGFpcl9kZXNpcmVfOCwgZXh0cmFfcGFpcl9kZXNpcmVfMTAsIGV4dHJhX3BhaXJfZGVzaXJlXzExLCBleHRyYV9wYWlyX2Rlc2lyZV8xMywgZXh0cmFfcGFpcl9kZXNpcmVfMTQsIGV4dHJhX3BhaXJfZGVzaXJlXzE2KSAlPiUgYWdncmVnYXRlX2FuZF9kb2N1bWVudF9zY2FsZShmdW4gPSByb2J1c3Rfcm93bWVhbnMpCnZhcl9sYWJlbChzM19kYWlseSRleHRyYV9wYWlyX2Rlc2lyZSkgPC0gIkV4dHJhLXBhaXIgZGVzaXJlIgoKczNfZGFpbHkkZXh0cmFfcGFpcl9pbnRlcmVzdCA8LSBzM19kYWlseSAlPiUgdW5ncm91cCgpICU+JSBzZWxlY3QoZXh0cmFfcGFpcl9kZXNpcmVfNCwgZXh0cmFfcGFpcl9kZXNpcmVfOSwgZXh0cmFfcGFpcl9kZXNpcmVfMTIsIGV4dHJhX3BhaXJfZGVzaXJlXzVSKSAlPiUgYWdncmVnYXRlX2FuZF9kb2N1bWVudF9zY2FsZShmdW4gPSByb2J1c3Rfcm93bWVhbnMpCnZhcl9sYWJlbChzM19kYWlseSRleHRyYV9wYWlyX2ludGVyZXN0KSA8LSAiRXh0cmEtcGFpciBpbnRlcmVzdCIKCgpzM19kYWlseSRpbl9wYWlyX2Rlc2lyZV9hbmRfYmVoYXZpb3VyID0gczNfZGFpbHkgJT4lIHVuZ3JvdXAoKSAlPiUgc2VsZWN0KHN0YXJ0c193aXRoKCJpbl9wYWlyX2Rlc2lyZV8iKSkgJT4lIGFnZ3JlZ2F0ZV9hbmRfZG9jdW1lbnRfc2NhbGUoZnVuID0gcm9idXN0X3Jvd21lYW5zKQp2YXJfbGFiZWwoczNfZGFpbHkkaW5fcGFpcl9kZXNpcmVfYW5kX2JlaGF2aW91cikgPC0gIkluLXBhaXIgZGVzaXJlIGFuZCBiZWhhdmlvdXIiCgpzM19kYWlseSRpbl9wYWlyX2Rlc2lyZSA9IHMzX2RhaWx5ICU+JSB1bmdyb3VwKCkgJT4lIHNlbGVjdChpbl9wYWlyX2Rlc2lyZV83LCBpbl9wYWlyX2Rlc2lyZV84LCBpbl9wYWlyX2Rlc2lyZV8xMCwgaW5fcGFpcl9kZXNpcmVfMTEsIGluX3BhaXJfZGVzaXJlXzEzLCBpbl9wYWlyX2Rlc2lyZV8xNCkgJT4lIGFnZ3JlZ2F0ZV9hbmRfZG9jdW1lbnRfc2NhbGUoZnVuID0gcm9idXN0X3Jvd21lYW5zKQp2YXJfbGFiZWwoczNfZGFpbHkkaW5fcGFpcl9kZXNpcmUpIDwtICJJbi1wYWlyIGRlc2lyZSIKCnMzX2RhaWx5JGluX3BhaXJfaW50ZXJlc3QgPC0gczNfZGFpbHkgJT4lIHVuZ3JvdXAoKSAlPiUgc2VsZWN0KGluX3BhaXJfZGVzaXJlXzQsIGluX3BhaXJfZGVzaXJlXzksIGluX3BhaXJfZGVzaXJlXzEyLCBpbl9wYWlyX2Rlc2lyZV81UikgJT4lIGFnZ3JlZ2F0ZV9hbmRfZG9jdW1lbnRfc2NhbGUoZnVuID0gcm9idXN0X3Jvd21lYW5zKQp2YXJfbGFiZWwoczNfZGFpbHkkaW5fcGFpcl9pbnRlcmVzdCkgPC0gIkluLXBhaXIgaW50ZXJlc3QiCgpzM19kYWlseSRncm9vbWluZyA9IHMzX2RhaWx5ICU+JSB1bmdyb3VwKCkgJT4lIHNlbGVjdChtYXRjaGVzKCJeZ3Jvb21pbmdfXFxkJCIpKSAlPiUgYWdncmVnYXRlX2FuZF9kb2N1bWVudF9zY2FsZShmdW4gPSByb2J1c3Rfcm93bWVhbnMpCnZhcl9sYWJlbChzM19kYWlseSRncm9vbWluZykgPC0gIlNlbGYtZ3Jvb21pbmciCgojIGdyb29taW5nIHRpbWUgc3BlbnQgZG9lc24ndCBmaXQgc28gd2VsbCB3aXRoIHRoZSBvdGhlciBpdGVtcwpncm9vbWluZ192YXJzIDwtIHMzX2RhaWx5ICU+JSB1bmdyb3VwKCkgJT4lIHNlbGVjdChtYXRjaGVzKCJeZ3Jvb21pbmdfXFxkIiksIGdyb29taW5nX3RpbWVfc3BlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm9vbWluZ19hY3Rpdml0aWVzKSAlPiUgbXV0YXRlKGdyb29taW5nX3RpbWVfc3BlbnQgPSBsb2cxcChhcy5udW1lcmljKGdyb29taW5nX3RpbWVfc3BlbnQpKSwKICAgICAgICBncm9vbWluZ19hY3Rpdml0aWVzID0gaWZfZWxzZShzdHJfbGVuZ3RoKGdyb29taW5nX2FjdGl2aXRpZXMpID4gMCwgc3RyX2NvdW50KGdyb29taW5nX2FjdGl2aXRpZXMsICIsIiksIDBMKSkgJT4lIG11dGF0ZV9hbGwoZnVucyhzY2FsZSkpCiMgZ3Jvb21pbmdfdmFycyAlPiUgcHN5Y2g6OmFscGhhKCkKczNfZGFpbHkkZ3Jvb21pbmdfYnJvYWQgPSBncm9vbWluZ192YXJzICU+JSBhZ2dyZWdhdGVfYW5kX2RvY3VtZW50X3NjYWxlKGZ1biA9IHJvYnVzdF9yb3dtZWFucykKdmFyX2xhYmVsKHMzX2RhaWx5JGdyb29taW5nKSA8LSAiU2VsZi1ncm9vbWluZyAoYnJvYWQpIgoKCnMzX2RhaWx5JHZhbml0eSA9IHMzX2RhaWx5ICU+JSB1bmdyb3VwKCkgJT4lIHNlbGVjdChtYXRjaGVzKCJedmFuaXR5X1xcZCQiKSkgJT4lIGFnZ3JlZ2F0ZV9hbmRfZG9jdW1lbnRfc2NhbGUoZnVuID0gcm9idXN0X3Jvd21lYW5zKQp2YXJfbGFiZWwoczNfZGFpbHkkdmFuaXR5KSA8LSAiU2F0aXNmaWVkIHdpdGggbG9va3MiCgoKczNfZGFpbHkkbWF0ZV9yZXRlbnRpb24gPSBzM19kYWlseSAlPiUgdW5ncm91cCgpICU+JSBzZWxlY3QobWF0Y2hlcygiXm1hdGVfcmV0ZW50aW9uXFxkJCIpKSAlPiUgYWdncmVnYXRlX2FuZF9kb2N1bWVudF9zY2FsZShmdW4gPSByb2J1c3Rfcm93bWVhbnMpCnZhcl9sYWJlbChzM19kYWlseSRtYXRlX3JldGVudGlvbikgPC0gIlBhcnRuZXIgbWF0ZSByZXRlbnRpb24iCmBgYAoKCiMjIyBTZXBhcmF0aW9uIGZyb20gcGFydG5lcgpgYGB7cn0KczNfZGFpbHkgPC0gczNfZGFpbHkgJT4lIAogIG11dGF0ZShzYXdfcGFydG5lciA9IGlmX2Vsc2UoY29udGFjdF9wYXJ0bmVyIDwgNSwgMSwgMCkpICU+JSAKICBncm91cF9ieShzZXNzaW9uKSAlPiUgCiAgYXJyYW5nZShzZXNzaW9uLCBjcmVhdGVkX2RhdGUpICU+JSAKICBtdXRhdGUobGFzdF9zYXdfcGFydG5lcl9kYXRlID0gaWZfZWxzZShzYXdfcGFydG5lciA9PSAxLCBjcmVhdGVkX2RhdGUsIGFzLkRhdGUoTkFfY2hhcmFjdGVyXykpLAogICAgICAgICBsYXN0X3Nhd19wYXJ0bmVyX2RhdGUgPSBpZl9lbHNlKGlzLm5hKHNhd19wYXJ0bmVyX2xhc3QpLCBsYXN0X3Nhd19wYXJ0bmVyX2RhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZF9kYXRlIC0gcmVjb2RlKGFzLm51bWVyaWMoc2F3X3BhcnRuZXJfbGFzdCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA3YCA9IDgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA4YCA9IDE1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGVmYXVsdCA9IGFzLm51bWVyaWMoc2F3X3BhcnRuZXJfbGFzdCkpKSwKICAgICAgICAgbGFzdF9zYXdfcGFydG5lcl9kYXRlID0gem9vOjpuYS5sb2NmKGxhc3Rfc2F3X3BhcnRuZXJfZGF0ZSwgbmEucm0gPSBGQUxTRSksCiAgICAgICAgIGRheXNfc2luY2Vfc2VlaW5nX3BhcnRuZXIgPSBhcy5udW1lcmljKGNyZWF0ZWRfZGF0ZSAtIGxhc3Rfc2F3X3BhcnRuZXJfZGF0ZSksCiAgICAgICAgIHRpbWVfc2luY2Vfc2VlaW5nX3BhcnRuZXIgPSBpZl9lbHNlKCFpcy5uYShzYXdfcGFydG5lcl9sYXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMubnVtZXJpYyhzYXdfcGFydG5lcl9sYXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZV93aGVuKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJldHdlZW4oZGF5c19zaW5jZV9zZWVpbmdfcGFydG5lciwgMCwgMSkgfiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheXNfc2luY2Vfc2VlaW5nX3BhcnRuZXIgPT0gMiB+IDIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF5c19zaW5jZV9zZWVpbmdfcGFydG5lciA9PSAzIH4gMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXlzX3NpbmNlX3NlZWluZ19wYXJ0bmVyID09IDQgfiA0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheXNfc2luY2Vfc2VlaW5nX3BhcnRuZXIgPT0gNSB+IDUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF5c19zaW5jZV9zZWVpbmdfcGFydG5lciA9PSA2IH4gNiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZXR3ZWVuKGRheXNfc2luY2Vfc2VlaW5nX3BhcnRuZXIsIDcsIDE0KSB+IDcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF5c19zaW5jZV9zZWVpbmdfcGFydG5lciA+IDE0IH4gOAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApKSkKCiNub3RlOiBkYXlzX3NpbmNlX3NlZWluZ19wYXJ0bmVyIGlzIG1pbmltYWwgd2hlcmUgaW5mZXJyZWQsIG5vdCBhY2N1cmF0ZQojIHRpbWVfc2luY2Vfc2VlaW5nX3BhcnRuZXIgaXMgb3JkaW5hbCBvbmx5CgojIHMzX2RhaWx5ICU+JSBzZWxlY3Qoc2hvcnQsIGNyZWF0ZWRfZGF0ZSwgbGFzdF9zYXdfcGFydG5lcl9kYXRlLCBzYXdfcGFydG5lcixzYXdfcGFydG5lcl9sYXN0LCBkYXlzX3NpbmNlX3NlZWluZ19wYXJ0bmVyLCB0aW1lX3NpbmNlX3NlZWluZ19wYXJ0bmVyKSAlPiUgVmlldygpCiMgY3Jvc3N0YWJzKH4gc2F3X3BhcnRuZXIgKyBkYXlzX3NpbmNlX3NlZWluZ19wYXJ0bmVyLCBzM19kYWlseSkKIyBjcm9zc3RhYnMofiBzYXdfcGFydG5lcl9sYXN0ICsgaXMubmEoZGF5c19zaW5jZV9zZWVpbmdfcGFydG5lciksIHMzX2RhaWx5KQpjcm9zc3RhYnMofiBzYXdfcGFydG5lcl9sYXN0ICsgdGltZV9zaW5jZV9zZWVpbmdfcGFydG5lciwgczNfZGFpbHkpCmBgYAoKCgojIyMgYWdlIGdyb3VwcwoKYGBge3J9CmFsbF9zdXJ2ZXlzJGFnZV9ncm91cCA8LSBOQQphbGxfc3VydmV5cyA8LSBhbGxfc3VydmV5cyAlPiUgbXV0YXRlKGFnZV9ncm91cCA9IHJlcGxhY2UoYWdlX2dyb3VwLCBhZ2UgPj0gMTggJiBhZ2UgPCAyNSwgMSkpCmFsbF9zdXJ2ZXlzIDwtIGFsbF9zdXJ2ZXlzICU+JSBtdXRhdGUoYWdlX2dyb3VwID0gcmVwbGFjZShhZ2VfZ3JvdXAsIGFnZSA+PSAyNSwgMikpCmFsbF9zdXJ2ZXlzJGFnZV9ncm91cCA8LSBmYWN0b3IoYWxsX3N1cnZleXMkYWdlX2dyb3VwLCBsZXZlbHM9YygxLDIpLCBsYWJlbHM9YygnMTgtMjUnLCAnPjI1JykpCmBgYAoKIyMgRmVydGlsaXR5IGF3YXJlbmVzcwpgYGB7cn0KYWxsX3N1cnZleXMgPC0gYWxsX3N1cnZleXMgJT4lIAogIG11dGF0ZSgKICAgIGF3YXJlID0gaWZfZWxzZShob3Jtb25hbF9jb250cmFjZXB0aW9uID09ICJGQUxTRSIgJgogICAgICAgICAgICAgICAgICAgICAgKHByZWduYW50X3RyeWluZyA+IDMgfAogICAgICAgICAgICAgICAgICAgICAgaHlwb3RoZXNpc19ndWVzc190b3BpYyAhPSAibm9fZ3Vlc3MiIHwKICAgICAgICAgICAgICAgICAgICAgIChjb250cmFjZXB0aW9uX2FwcHJvYWNoID09ICJhd2FyZW5lc3MiIHwgCiAgICAgICAgICAgICAgICAgICAgICBjb250cmFjZXB0aW9uX2FwcCA9PSAxKSAmIAogICAgICAgICAgICAgICAgICAgICAgIShjeWNsZV9hd2FyZW5lc3Nfb3RoZXIgJWluJSBjKCJmZXJ0aWxlX2F3YXJlX2ludmFsaWQiLCAiZmVydGlsaXR5X2F3YXJlbmVzc19kaWRfbm90X3VzZSIsICJub3RfZmVydGlsZV9hd2FyZSIpKSksIDEsIDAsIDApKQpgYGAKCiMjIE1lcmdlIGRpYXJ5CmBgYHtyIG1lcmdlX2RpYXJ5fQpzM19kYWlseSA9IHMzX2RhaWx5ICU+JSBtdXRhdGUoc2hvcnQgPSBzdHJpbmdyOjpzdHJfc3ViKHNlc3Npb24sIDEsIDcpKQphbGxfc3VydmV5cyA9IGFsbF9zdXJ2ZXlzICU+JSBtdXRhdGUoc2hvcnQgPSBzdHJpbmdyOjpzdHJfc3ViKHNlc3Npb24sIDEsIDcpKSAlPiUgc2VsZWN0KC1zaG9ydF9kZW1vLCAtc2hvcnRfaW5pdGlhbCkKZGlhcnkgPSBzM19kYWlseSAlPiUgZnVsbF9qb2luKGFsbF9zdXJ2ZXlzLCBieSA9IGMoInNlc3Npb24iLCJzaG9ydCIpLCBzdWZmaXggPSBjKCJfZGlhcnkiLCAiX2ZvbGxvd3VwIikpCmBgYAoKCiMjIFNpbmdsZXMgCmBgYHtyfQpzNF90aW1lc3BlbnQgPSBzNF90aW1lc3BlbnQgJT4lIAogIGZpbHRlcighc2Vzc2lvbiAlY29udGFpbnMlICdYWFgnKQoKU2luZ2xlcyA9IG5yb3coc2luZ2xlcyA8LSBmaWx0ZXIoczFfZGVtbywgcmVsYXRpb25zaGlwX3N0YXR1cyA9PSAxKSkKUGFpZCA9IG5yb3cocGFpZCA8LSBmaWx0ZXIoczFfZmlsdGVyLCBnZXRzX3BhaWQgPT0gMSkpClBhaWRfU2luZ2xlID0gbnJvdyhwYWlkX3NpbmdsZXMgPC0gaW5uZXJfam9pbihzaW5nbGVzLCBwYWlkLCBieT0gJ3Nlc3Npb24nKSkKd2l0aF9GVSA9IG5yb3cod2l0aGZvbGxvd3VwIDwtIGlubmVyX2pvaW4ocGFpZF9zaW5nbGVzLCBzNF9mb2xsb3d1cCwgYnk9J3Nlc3Npb24nKSkKYGBgCgoxLiBfX2ByIFNpbmdsZXNgX18gbnVtYmVyIG9mIHNpbmdsZSB3b21lbi4KMi4gX19gciBQYWlkYF9fIG51bWJlciBvZiB3b21lbiBnZXR0aW5nIHBhaWQgZm9yIHBhcnRpY2lwYXRpb24uIAozLiBfX2ByIFBhaWRfU2luZ2xlYF9fIG51bWJlciBvZiBTaW5nbGVzIGdldHRpbmcgcGFpZCBmb3IgcGFydGljaXBhdGlvbi4gCjQuIF9fYHIgd2l0aF9GVWBfXyBudW1iZXIgb2Ygc2luZ2xlIHdvbWVuIGdldHRpbmcgcGFpZCBhbmQgYW5zd2VyaW5nIGZvbGxvdy11cCBxdWVzdGlvbm5haXJlLgoKIyMgbmV0d29yayAKYGBge3J9Cm5ldHdvcmsgPC0gczRfdGltZXNwZW50Cgpucm93KG5ldHdvcmspCgpzdW1tYXJ5KGFzLmZhY3RvcihuZXR3b3JrJHBlcnNvbl9yZWxhdGlvbnNoaXBfc3RhdHVzKSkKCm5ldHdvcmsgPSBuZXR3b3JrICU+JSAKICBtdXRhdGUoCiAgICBwZXJzb25faXNfdW5yZWxhdGVkX21hbiA9IGlmX2Vsc2UocGVyc29uX3NleCA9PSAyICYgICAgIHBlcnNvbl9yZWxhdGlvbnNoaXBfdG9fYW5jaG9yICE9ICJiaW9sb2dpY2FsX3JlbGF0aXZlIiwgMSwgMCksCiAgICBwZXJzb25faXNfcmVsYXRlZF9tYW4gPSBpZl9lbHNlKHBlcnNvbl9zZXggPT0gMiAmICAgICBwZXJzb25fcmVsYXRpb25zaGlwX3RvX2FuY2hvciA9PSAiYmlvbG9naWNhbF9yZWxhdGl2ZSIsIDEsIDApCiAgICApCgpzdW1tYXJ5KGFzLmZhY3RvcihuZXR3b3JrJHBlcnNvbl9zZXgpKQpuZXR3b3JrICU+JSAKICAgIGdyb3VwX2J5KHNlc3Npb24pICU+JSAKICAgIHN1bW1hcmlzZShmZW1hbGUgPSBzdW0ocGVyc29uX3NleCA9PSAxLCBuYS5ybT1UKSwgbWFsZSA9IHN1bShwZXJzb25fc2V4ID09IDIsIG5hLnJtPVQpLCBuPSBuKCksCiAgICAgICAgICAgICAgdW5yZWxhdGVkX21hbGVzID0gc3VtKCFpcy5uYShwZXJzb25fYXR0cmFjdGl2ZW5lc3Nfc2hvcnRfdGVybSkpKSAlPiUgCiAgICBzZWxlY3QoZmVtYWxlLCBtYWxlLG4sIHVucmVsYXRlZF9tYWxlcykgLT4KICByZXBvcnRlZF9wZXJzb25zCnRhYmxlKHJlcG9ydGVkX3BlcnNvbnMkdW5yZWxhdGVkX21hbGVzID4gMCkKCiMgS29udGFrdCB6dSAyODAgTcOkbm5lcm4gCiMgcXBsb3QobmV0d29yayRwZXJzb25fcmVsYXRpb25zaGlwX3RvX2FuY2hvcikKIyB3YXMgc2luZCBkaWUgbWFlbm5lciBmdWVyIGJlemllaHVuZ3N0eXBlbgoKIyBxcGxvdChuZXR3b3JrW25ldHdvcmskcGVyc29uX3NleCA9PSAyLF0kcGVyc29uX3JlbGF0aW9uc2hpcF90b19hbmNob3IgLCB4bGFiID0gJ0JlemllaHVuZ3NzdGF0dXMgenUgTcOkbm5lcm4nKQpzdW1tYXJ5KG5ldHdvcmskcGVyc29uX3JlbGF0aW9uc2hpcF90b19hbmNob3IpCiMgNDI1IFZlcndhbmR0ZSAKCnNvcnQodGFibGUobmEub21pdChuZXR3b3JrJHBlcnNvbl9raW5zaGlwKSkpCiMgcXBsb3QobmEub21pdChoYXZlbjo6YXNfZmFjdG9yKG5ldHdvcmskcGVyc29uX2tpbnNoaXApKSkgKyBjb29yZF9mbGlwKCkKIyBxcGxvdChoYXZlbjo6YXNfZmFjdG9yKG5ldHdvcmskcGVyc29uX3JvbWFudGljX2V4cGVyaWVuY2UsImJvdGgiKSkgKyBjb29yZF9mbGlwKCkKCgojIHh0YWJzKH4gcGVyc29uX3JlbGF0aW9uc2hpcF90b19hbmNob3IgKyBwZXJzb25fc2V4LCBuZXR3b3JrKQoKCgpuZXR3b3JrICU+JSBmaWx0ZXIoIWlzLm5hKHBlcnNvbl9raW5zaGlwKSkgJT4lIHNlbGVjdChzZXNzaW9uLCBjcmVhdGVkLCBwZXJzb25fa2luc2hpcCkgJT4lIG11dGF0ZShraW5zaGlwX2NsZWFuZWQgPSAwKSAlPiUgZGF0YS5mcmFtZSgpIC0+IGtpbnNoaXAKCgp3cml0ZXhsOjp3cml0ZV94bHN4KGtpbnNoaXAsICJjb2RpbmdzL2tpbnNoaXAueGxzeCIpCiBraW5zaGlwX2NsZWFuZWQgPSByZWFkeGw6OnJlYWRfeGxzeCgiY29kaW5ncy9raW5zaGlwX2NsZWFuZWQueGxzeCIsMSkKIG5ldHdvcmsgPSBuZXR3b3JrICU+JSBsZWZ0X2pvaW4oa2luc2hpcF9jbGVhbmVkLCBieSA9IGMoInNlc3Npb24iICwgJ2NyZWF0ZWQnKSkKYGBgCgojIyBDb2RlIG9wZW4gYW5zd2VycyBkaWFyeQoKIyMjIEFuc3dlcmVkIGhvbmVzdGx5IGluIGRpYXJ5CmBgYHtyfQoKZGlhcnkgJT4lIGZpbHRlcihhbnN3ZXJlZF9ob25lc3RseV90b2RheSAhPSAxLCAhaXMubmEoZGlzaG9uZXN0X2Fuc3dlcnMpKSAlPiUgc2VsZWN0KHNlc3Npb24sIGNyZWF0ZWRfZGlhcnksIGRpc2hvbmVzdF9hbnN3ZXJzKSAlPiUgbXV0YXRlKGRpc2hvbmVzdF9kaXNjYXJkID0gTkFfcmVhbF8pICU+JSBkYXRhLmZyYW1lKCkgLT4gZGlzaG9uZXN0CndyaXRleGw6OndyaXRlX3hsc3goZGlzaG9uZXN0LCAiY29kaW5ncy9kaXNob25lc3QueGxzeCIpCgpkaXNob25lc3QgPSByZWFkeGw6OnJlYWRfeGxzeCgiY29kaW5ncy9kaXNob25lc3RfY29kZWQueGxzeCIsMSkKZGlhcnkgPSBkaWFyeSAlPiUgbGVmdF9qb2luKGRpc2hvbmVzdCAlPiUgc2VsZWN0KC1kaXNob25lc3RfYW5zd2VycyksIGJ5ID0gYygic2Vzc2lvbiIsICJjcmVhdGVkX2RpYXJ5IikpICU+JSAKbXV0YXRlKGRpc2hvbmVzdF9kaXNjYXJkID0gaWZfZWxzZSggYW5zd2VyZWRfaG9uZXN0bHlfdG9kYXkgIT0gMSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmX2Vsc2UoZGlzaG9uZXN0X2Rpc2NhcmQgPT0gMSwgMSwgMCwgMSksIDAsIDAgKSkKYGBgCgojIyBTb2NpYWwgZGlhcnkKYGBge3J9CiMgZm9yIG5vdywgd2UgZG9uJ3QgY2FyZSB3aGV0aGVyIHBlb3BsZSB3ZXJlIHNlZW4gb3IgdGhvdWdodCBhYm91dApkaWFyeV9zb2NpYWwgPSBkaWFyeSAlPiUKICBtdXRhdGUoCiAgICBzb2NpYWxfbGlmZV90aG91Z2h0X2Fib3V0ID0gYXMuY2hhcmFjdGVyKHNvY2lhbF9saWZlX3Rob3VnaHRfYWJvdXQpLAogICAgc29jaWFsX2xpZmVfc2F3X3Blb3BsZSA9IGFzLmNoYXJhY3Rlcihzb2NpYWxfbGlmZV9zYXdfcGVvcGxlKSwKICAgIHBlcnNvbiA9IAogICAgICAgICAgIGlmX2Vsc2UoaXMubmEoc29jaWFsX2xpZmVfc2F3X3Blb3BsZSksCiAgICAgICAgICAgICAgICAgICBpZl9lbHNlKGlzLm5hKHNvY2lhbF9saWZlX3Rob3VnaHRfYWJvdXQpLCBOQV9jaGFyYWN0ZXJfLCBzb2NpYWxfbGlmZV90aG91Z2h0X2Fib3V0KSwKICAgICAgICAgICAgICAgICAgIGlmX2Vsc2UoaXMubmEoc29jaWFsX2xpZmVfdGhvdWdodF9hYm91dCksIHNvY2lhbF9saWZlX3Nhd19wZW9wbGUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICBwYXN0ZTAoc29jaWFsX2xpZmVfc2F3X3Blb3BsZSwgIiwiLCBzb2NpYWxfbGlmZV90aG91Z2h0X2Fib3V0KSkKICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICApICU+JQogIHNlcGFyYXRlX3Jvd3MocGVyc29uLCBzZXAgPSAiLCIpICU+JQogIG11dGF0ZShwZXJzb24gPSBzdHJpbmdyOjpzdHJfdHJpbShwZXJzb24pKSAlPiUgCiAgZ3JvdXBfYnkoc2Vzc2lvbiwgY3JlYXRlZF9kaWFyeSwgcGVyc29uKSAlPiUgCiAgZmlsdGVyKHJvd19udW1iZXIoKSA9PSAxKSAlPiUgCiAgdW5ncm91cCgpICMgYnJ1dGUgd2F5IG9mIGVuc3VyaW5nIHRoYXQgdGhlcmUgYXJlIG5vIGR1cGxpY2F0ZWQgcGVyc29ucwoKc3RvcGlmbm90KGRpYXJ5X3NvY2lhbCAlPiUgZHJvcF9uYShzZXNzaW9uLCBjcmVhdGVkX2RpYXJ5LCBwZXJzb24pICU+JSAgCiAgICAgICAgICAgIGdyb3VwX2J5KHNlc3Npb24sIGNyZWF0ZWRfZGlhcnksIHBlcnNvbikgJT4lIGZpbHRlcihuKCkgPiAxKSAlPiUgbnJvdygpID09IDApCmBgYAoKIyMjIEdlbmRlcml6ZQpgYGB7cn0KdW5pcXVlX25hbWVzX2RmID0gZGlhcnlfc29jaWFsICU+JSBzZWxlY3QocGVyc29uKSAlPiUgZ3JvdXBfYnkocGVyc29uKSAlPiUgc3VtbWFyaXNlKGZyZXEgPSBuKCkpICU+JSBhcnJhbmdlKGRlc2MoZnJlcSkpICU+JSBmaWx0ZXIoIWlzLm5hKHBlcnNvbikpICU+JSBmaWx0ZXIoc3RyX2xlbmd0aChwZXJzb24pID4gMiB8IHN0cl90b191cHBlcihwZXJzb24pICE9IHBlcnNvbikKaWYgKGZpbGUuZXhpc3RzKCdjb2RpbmdzL2NvZGVkX2dlbmRlcnMucmRzJykpIHsKICBnZW5kZXJzX2RmID0gcmVhZFJEUygnY29kaW5ncy9jb2RlZF9nZW5kZXJzLnJkcycpCn0gZWxzZSB7CiAgbGlicmFyeShnZW5kZXJpemVSKQogIEVuY29kaW5nKGRpYXJ5X3NvY2lhbCRwZXJzb24pID0gIlVURi04IgogIEVuY29kaW5nKHVuaXF1ZV9uYW1lc19kZiRwZXJzb24pID0gIlVURi04IgogIGdpdmVuTmFtZXMgPSBmaW5kR2l2ZW5OYW1lcyh1bmlxdWVfbmFtZXNfZGYkcGVyc29uLCBhcGlrZXkgPSBnZW5kZXJpemVfYXBpa2V5KSAjIGV4dHJhY3QsIGNvZGUgcG9zc2libGUgZmlyc3QgbmFtZXMKICBFbmNvZGluZyhnaXZlbk5hbWVzJG5hbWUpID0gIlVURi04IgogIGdlbmRlcnMgPSBnZW5kZXJpemUodW5pcXVlX25hbWVzX2RmJHBlcnNvbiwgZ2l2ZW5OYW1lcykgIyBhc3NpZ24gZ2VuZGVycyB0byBzdHJpbmdzCiAgRW5jb2RpbmcoZ2VuZGVycyR0ZXh0KSA9ICJVVEYtOCIKICBFbmNvZGluZyhnZW5kZXJzJGdpdmVuTmFtZSkgPSAiVVRGLTgiCiAgZ2VuZGVyc19kZiA9IGZ1bGxfam9pbihnZW5kZXJzLCB1bmlxdWVfbmFtZXNfZGYsIGJ5ID0gYygidGV4dCIgPSAicGVyc29uIikpICU+JSBsZWZ0X2pvaW4oZ2l2ZW5OYW1lcyAlPiUgZGF0YS5mcmFtZSgpICU+JSByZW5hbWUoZmlyc3RuYW1lX2dlbmRlciA9IGdlbmRlciksIGJ5ID0gYygiZ2l2ZW5OYW1lIiA9ICduYW1lJykpCiAgc2F2ZVJEUyhnZW5kZXJzX2RmLCBmaWxlID0gJ2NvZGluZ3MvY29kZWRfZ2VuZGVycy5yZHMnKQp9CndyaXRleGw6OndyaXRlX3hsc3goZ2VuZGVyc19kZiAlPiUgZmlsdGVyKGZyZXEgPiAzMCwgaXMubmEoZ2VuZGVyKSksICJjb2RpbmdzL2dlbmRlcnNfdG9fY29kZS54bHN4IikKZ2VuZGVyc19oYW5kX2NvZGVkID0gcmVhZHhsOjpyZWFkX3hsc3goJ2NvZGluZ3MvZ2VuZGVyc19jb2RlZC54bHN4JywgMSkKZ2VuZGVyc19kZiA9IGJpbmRfcm93cyhnZW5kZXJzX2RmICU+JSBmaWx0ZXIoZnJlcSA8PSAzMCB8ICFpcy5uYShnZW5kZXIpKSwgZ2VuZGVyc19oYW5kX2NvZGVkKQpnZW5kZXJzX2RmID0gZ2VuZGVyc19kZiAlPiUgCiAgc2VsZWN0KC1naXZlbk5hbWUsIC1nZW5kZXJJbmRpY2F0b3JzLCAtZmlyc3RuYW1lX2dlbmRlcikgJT4lIAogIHJlbmFtZShwZXJzb24gPSB0ZXh0LCBwZXJzb25fc2V4X2luZmVycmVkID0gZ2VuZGVyLCBwZXJzb25fbmFtZV9jb3VudCA9IGNvdW50LCBwZXJzb25fbmFtZV9mcmVxX2luX2RpYXJ5ID0gZnJlcSwgcGVyc29uX211bHRpcGxlID0gbXVsdGlwbGUsIHBlcnNvbl9pc19yZWxhdGVkX2luZmVycmVkID0gcmVsYXRlZCkgJT4lIAogIG11dGF0ZShwZXJzb25fcHJvYl9tYWxlID0gaWZfZWxzZShwZXJzb25fc2V4X2luZmVycmVkID09ICJtYWxlIiwgYXMubnVtZXJpYyhwcm9iYWJpbGl0eSksIDEgLSBhcy5udW1lcmljKHByb2JhYmlsaXR5KSkpICU+JSAKICBzZWxlY3QoLXByb2JhYmlsaXR5KQoKZGlhcnlfc29jaWFsID0gZGlhcnlfc29jaWFsICU+JSBsZWZ0X2pvaW4oZ2VuZGVyc19kZiAsIGJ5ID0gInBlcnNvbiIpCgpzdG9waWZub3QoZGlhcnlfc29jaWFsICU+JSBkcm9wX25hKHNlc3Npb24sIGNyZWF0ZWRfZGlhcnksIHBlcnNvbikgJT4lICAKICAgICAgICAgICAgZ3JvdXBfYnkoc2Vzc2lvbiwgY3JlYXRlZF9kaWFyeSwgcGVyc29uKSAlPiUgZmlsdGVyKG4oKSA+IDEpICU+JSBucm93KCkgPT0gMCkKYGBgCgojIyMgU2Vlbi90aG91Z2h0IGFib3V0CmBgYHtyfQojIGJ1dCB3ZSB3YW50IHRvIG1ha2UgYSB2YXJpYWJsZSBzYXlpbmcgd2hldGhlciB0aGF0IHBlcnNvbiB3YXMgc2VlbiBvciB0aG91Z2h0IGFib3V0IG9yIGJvdGgKIyBkdW1teSBkYXRhc2V0IHNlZW4Kc2VlbiA9IGRpYXJ5ICU+JSBzZWxlY3Qoc2Vzc2lvbiwgc29jaWFsX2xpZmVfc2F3X3Blb3BsZSwgY3JlYXRlZF9kaWFyeSkgJT4lCiAgbXV0YXRlKHBlcnNvbiA9IHNvY2lhbF9saWZlX3Nhd19wZW9wbGUsIHBlcnNvbl9zZWVuID0gVFJVRSkgJT4lCiAgc2VwYXJhdGVfcm93cyhwZXJzb24sIHNlcCA9ICIsIikgJT4lCiAgbXV0YXRlKHBlcnNvbiA9IHN0cmluZ3I6OnN0cl90cmltKHBlcnNvbikpICU+JSAKICB1bmdyb3VwKCkgJT4lCiAgc2VsZWN0KHNlc3Npb24sIHBlcnNvbiwgY3JlYXRlZF9kaWFyeSwgcGVyc29uX3NlZW4pICU+JQogIG5hLm9taXQoKSAlPiUgCiAgZGlzdGluY3QoKQoKIyBkdW1teSBkYXRhc2V0IHRob3VnaHQgYWJvdXQKdGhvdWdodF9hYm91dCA9IGRpYXJ5ICU+JSBzZWxlY3Qoc2Vzc2lvbiwgc29jaWFsX2xpZmVfdGhvdWdodF9hYm91dCwgY3JlYXRlZF9kaWFyeSkgJT4lCiAgbXV0YXRlKHBlcnNvbiA9IHNvY2lhbF9saWZlX3Rob3VnaHRfYWJvdXQsIHBlcnNvbl90aG91Z2h0X2Fib3V0ID0gVFJVRSkgJT4lCiAgc2VwYXJhdGVfcm93cyhwZXJzb24sIHNlcCA9ICIsIikgJT4lCiAgbXV0YXRlKHBlcnNvbiA9IHN0cmluZ3I6OnN0cl90cmltKHBlcnNvbikpICU+JSAKICB1bmdyb3VwKCkgJT4lCiAgc2VsZWN0KHNlc3Npb24sIHBlcnNvbiwgY3JlYXRlZF9kaWFyeSwgcGVyc29uX3Rob3VnaHRfYWJvdXQpICU+JQogIG5hLm9taXQoKSAlPiUgCiAgZGlzdGluY3QoKQoKIyBtZXJnZSBpbgpkaWFyeV9zb2NpYWwgPSBkaWFyeV9zb2NpYWwgJT4lIGxlZnRfam9pbihzZWVuLCBieSA9IGMoInNlc3Npb24iLCAicGVyc29uIiwgImNyZWF0ZWRfZGlhcnkiKSkKZGlhcnlfc29jaWFsID0gZGlhcnlfc29jaWFsICU+JSBsZWZ0X2pvaW4odGhvdWdodF9hYm91dCwgYnkgPSBjKCJzZXNzaW9uIiwgInBlcnNvbiIsICJjcmVhdGVkX2RpYXJ5IikpCiMgeHRhYnMofiBwZXJzb25fc2VlbiArIHBlcnNvbl90aG91Z2h0X2Fib3V0LCBkaWFyeV9zb2NpYWwpCgpzdG9waWZub3QoZGlhcnlfc29jaWFsICU+JSBkcm9wX25hKHNlc3Npb24sIGNyZWF0ZWRfZGlhcnksIHBlcnNvbikgJT4lICAKICAgICAgICAgICAgZ3JvdXBfYnkoc2Vzc2lvbiwgY3JlYXRlZF9kaWFyeSwgcGVyc29uKSAlPiUgZmlsdGVyKG4oKSA+IDEpICU+JSBucm93KCkgPT0gMCkKCm5ldHdvcmsgPC0gbmV0d29yayAlPiUgZmlsdGVyKCFpcy5uYShwZXJzb24pKQpkaWFyeV9zb2NpYWwgPSBkaWFyeV9zb2NpYWwgJT4lIGxlZnRfam9pbihuZXR3b3JrLCBieSA9IGMoInNlc3Npb24iLCAic2hvcnQiLCAicGVyc29uIikpICU+JSBtdXRhdGUoaW50ZXJhY3Rpb25fcGFydG5lciA9IHBhc3RlMChzaG9ydCwgIl8iLCBwZXJzb24pKQoKCmRpYXJ5X3NvY2lhbCA9IGRpYXJ5X3NvY2lhbCAlPiUgbXV0YXRlKAogIHBlcnNvbl9pc19yZWxhdGVkX2luZmVycmVkID0gaWZfZWxzZShwZXJzb25fcmVsYXRpb25zaGlwX3RvX2FuY2hvciA9PSAiYmlvbG9naWNhbF9yZWxhdGl2ZSIsIDEsIDAsIAogICAgaWZfZWxzZShpcy5uYShwZXJzb25faXNfcmVsYXRlZF9pbmZlcnJlZCksIE5BX3JlYWxfLCBwZXJzb25faXNfcmVsYXRlZF9pbmZlcnJlZCkpLAogIHBlcnNvbl9pc19yZWxhdGVkX21hbl9pbmZlcnJlZCA9IGlmX2Vsc2UoIWlzLm5hKHBlcnNvbl9pc19yZWxhdGVkX21hbiksIHBlcnNvbl9pc19yZWxhdGVkX21hbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmX2Vsc2UocGVyc29uX2lzX3JlbGF0ZWRfaW5mZXJyZWQgJiBwZXJzb25fc2V4X2luZmVycmVkID09ICJtYWxlIiwgMSwgMCwgTkFfcmVhbF8pKSwKICBwZXJzb25faXNfdW5yZWxhdGVkX21hbl9pbmZlcnJlZCA9IGlmX2Vsc2UoIWlzLm5hKHBlcnNvbl9pc191bnJlbGF0ZWRfbWFuKSwgcGVyc29uX2lzX3VucmVsYXRlZF9tYW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZl9lbHNlKCAhcGVyc29uX2lzX3JlbGF0ZWRfaW5mZXJyZWQgJiBwZXJzb25fc2V4X2luZmVycmVkID09ICJtYWxlIiwgMSwgMCwgTkFfcmVhbF8pKQopCgpjcm9zc3RhYnMofiBwZXJzb25faXNfcmVsYXRlZF9pbmZlcnJlZCArIHBlcnNvbl9pc19yZWxhdGVkX21hbl9pbmZlcnJlZCwgZGlhcnlfc29jaWFsKQoKc3RvcGlmbm90KGRpYXJ5X3NvY2lhbCAlPiUgZHJvcF9uYShzZXNzaW9uLCBjcmVhdGVkX2RpYXJ5LCBwZXJzb24pICU+JSAgCiAgICAgICAgICAgIGdyb3VwX2J5KHNlc3Npb24sIGNyZWF0ZWRfZGlhcnksIHBlcnNvbikgJT4lIGZpbHRlcihuKCkgPiAxKSAlPiUgbnJvdygpID09IDApCgojIHh0YWJzKH4gcGVyc29uX3NleCArIHBlcnNvbl9zZXhfaW5mZXJyZWQsIGRhdGEgPSBkaWFyeV9zb2NpYWwsIGV4Y2x1ZGUgPSBOVUxMLCBuYS5hY3Rpb24gPSBuYS5wYXNzKQoKZGlhcnlfc29jaWFsJHBlcnNvbl9CTUkgPC0gKGRpYXJ5X3NvY2lhbCRwZXJzb25fd2VpZ2h0LygoZGlhcnlfc29jaWFsJHBlcnNvbl9oZWlnaHQvMTAwKV4yKSkKCgpzNF90aW1lc3BlbnQgJT4lIHNlbGVjdChwZXJzb25fYXR0cmFjdGl2ZW5lc3Nfc2hvcnRfdGVybSwgcGVyc29uX2Z1bm55LCBwZXJzb25fZmluYW5jaWFsLCBwZXJzb25fc3RyZW5ndGgpICU+JSBjb3IodXNlID0gIm5hLm9yLmNvbXBsZXRlIikgJT4lIHJvdW5kKDIpCmBgYAoKCiMjIyBOb21pbmF0aW9ucyBmb3IgY29uam9pbnQgYW5hbHlzaXMKYGBge3J9CmRpYXJ5X3NvY2lhbCAlPiUgZ3JvdXBfYnkoaG9ybW9uYWxfY29udHJhY2VwdGlvbiwgcGVyc29uLCBzZXNzaW9uKSAlPiUKICBzdW1tYXJpc2Uoc2Vlbl9mZXJ0aWxlID0gc3VtKHBlcnNvbl9zZWVuICYgZmVydGlsZV9icm9hZCA+IDAuMSwgbmEucm0gPSBUKSwKICAgICAgICAgICAgdGhvdWdodF9hYm91dF9mZXJ0aWxlID0gc3VtKHBlcnNvbl90aG91Z2h0X2Fib3V0ICYgZmVydGlsZV9icm9hZCA+IDAuMSwgbmEucm0gPSBUKSwKICAgICAgICAgICAgc2Vlbl9pbmZlcnRpbGUgPSBzdW0ocGVyc29uX3NlZW4gJiBmZXJ0aWxlX2Jyb2FkIDwgMC4xLCBuYS5ybSA9IFQpLAogICAgICAgICAgICB0aG91Z2h0X2Fib3V0X2luZmVydGlsZSA9IHN1bShwZXJzb25fdGhvdWdodF9hYm91dCAmIGZlcnRpbGVfYnJvYWQgPCAwLjEsIG5hLnJtID0gVCkpIC0+CiAgbm9taW5hdGlvbnMKCm5ldHdvcmtfbm9taW5hdGlvbnMgPSBpbm5lcl9qb2luKG5vbWluYXRpb25zLCBzNF90aW1lc3BlbnQsIGJ5ID0gYygic2Vzc2lvbiIsICJwZXJzb24iKSkKCnN0b3BpZm5vdChkaWFyeV9zb2NpYWwgJT4lIGRyb3BfbmEoc2Vzc2lvbiwgY3JlYXRlZF9kaWFyeSwgcGVyc29uKSAlPiUgIAogICAgICAgICAgICBncm91cF9ieShzZXNzaW9uLCBjcmVhdGVkX2RpYXJ5LCBwZXJzb24pICU+JSBmaWx0ZXIobigpID4gMSkgJT4lIG5yb3coKSA9PSAwKQpgYGAKCgojIyBTZXggZHVtbXkgdmFyaWFibGVzCmBgYHtyfQojIGdldCBjaG9pY2UgbGFiZWxzIGluIGVuZ2xpc2gKY2hvaWNlcyA8LSByaW86OmltcG9ydCgiaHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvMVhvNGZSdkl6UFliV2liVmdKOW5tN3ZFUzM5RFNBV1FCenRuQjhqN1BkSW8vZWRpdCNnaWQ9MTgzNzI2NjE1NSIpCgpzZXhfYWN0c19pbl9kaWFyeSA8LSBkaWFyeSAlPiUgIGRyb3BfbmEoc2hvcnQsIGNyZWF0ZWRfZGlhcnkpICU+JSB1bmdyb3VwKCkgJT4lIHN1bW1hcmlzZShhY3RzID0gc3VtKCFpcy5uYShzZXhfMV90aW1lKSkgKyBzdW0oIWlzLm5hKHNleF8yX3RpbWUpKSkgJT4lIHB1bGwoYWN0cykKCnNleF9sb25nIDwtIGRpYXJ5ICU+JSAKICBkcm9wX25hKHNob3J0LCBjcmVhdGVkX2RpYXJ5KSAlPiUgCiAgZ3JvdXBfYnkoc2hvcnQpICU+JSAKICBzZWxlY3Qoc2hvcnQsIGNyZWF0ZWRfZGlhcnksIG1hdGNoZXMoIl5zZXhfXFxkIikpICU+JSAKICBnYXRoZXIoa2V5LCB2YWx1ZSwgbWF0Y2hlcygiXnNleF9cXGQiKSkgJT4lIAogIG11dGF0ZShrZXkgPSBzdHJfc3ViKGtleSwgNSkpICU+JSAKICBzZXBhcmF0ZShrZXksIGludG8gPSBjKCJzZXhfbnIiLCAia2V5IiksIHNlcCA9ICJfIiwgZXh0cmEgPSAibWVyZ2UiKSAlPiUgCiAgc3ByZWFkKGtleSwgdmFsdWUsIGNvbnZlcnQgPSBUKSAlPiUgCiAgdW5ncm91cCgpICU+JSAKICAKICBtdXRhdGUoc2V4X2FjdGl2ZSA9IGlmX2Vsc2UoaXMubmEodGltZSksIDAsIDEpLAogICAgICAgICBzZXhfYWN0aXZlX3NvbG8gPSBpZl9lbHNlKHdpdGh3aG9tID09ICJhbGxlaW5lIiwgMSwgMCksCiAgICAgICAgIHNleF9hY3RpdmVfcGFydG5lcmVkID0gaWZfZWxzZSh3aXRod2hvbSAhPSAiYWxsZWluZSIsIDEsIDApKSAlPiUgCiAgCiAgZmlsdGVyKHNleF9hY3RpdmUgPT0gMSkKCgp0b19jb2RlX3NleF9hY3RzIDwtIHNleF9sb25nICU+JSAKICBzZXBhcmF0ZV9yb3dzKGFjdGl2aXR5LCBjb252ZXJ0ID0gVFJVRSwgc2VwID0gIiwiKSAlPiUgCiAgbGVmdF9qb2luKGNob2ljZXMgJT4lIHNlbGVjdChhY3Rpdml0eSA9IGxhYmVsLCBhY3Rpdml0eV9lbiA9IG5hbWUpICU+JSBkaXN0aW5jdCgpKSAlPiUgCiAgYmluZF9yb3dzKAogICAgc2V4X2xvbmcgJT4lIAogICAgc2VsZWN0KGZhbnRhc3lfYWN0aW9ucykgJT4lIAogICAgc2VwYXJhdGVfcm93cyhmYW50YXN5X2FjdGlvbnMsIGNvbnZlcnQgPSBUUlVFLCBzZXAgPSAiLCIpICU+JSAKICAgIHJlbmFtZShhY3Rpdml0eSA9IGZhbnRhc3lfYWN0aW9ucykgJT4lIAogICAgbGVmdF9qb2luKGNob2ljZXMgJT4lIHNlbGVjdChhY3Rpdml0eSA9IGxhYmVsLCBhY3Rpdml0eV9lbiA9IG5hbWUpICU+JSBkaXN0aW5jdCgpKSkgJT4lIAogIGRyb3BfbmEoYWN0aXZpdHkpICU+JSAKICBncm91cF9ieShhY3Rpdml0eSkgJT4lIAogIHN1bW1hcmlzZShuID0gbigpLCBhY3Rpdml0eV9lbiA9IGZpcnN0KGFjdGl2aXR5X2VuKSkgJT4lIAogIGFycmFuZ2UoZGVzYyhuKSkgJT4lIAogIHNlbGVjdChuLCBhY3Rpdml0eSwgYWN0aXZpdHlfZW4pCgp3cml0ZXhsOjp3cml0ZV94bHN4KHRvX2NvZGVfc2V4X2FjdHMsICJjb2RpbmdzL3RvX2NvZGVfc2V4X2FjdHMueGxzeCIpCnRvX2NvZGVfc2V4X2FjdHMgPSByZWFkeGw6OnJlYWRfeGxzeCgiY29kaW5ncy90b19jb2RlX3NleF9hY3RzX2NvZGVkLnhsc3giLDEpCgp0b19jb2RlX3NleF9wYXJ0bmVycyA8LSBzZXhfbG9uZyAlPiUgCiAgc2VwYXJhdGVfcm93cyh3aXRod2hvbSwgY29udmVydCA9IFRSVUUsIHNlcCA9ICIsIikgJT4lIAogIGxlZnRfam9pbihjaG9pY2VzICU+JSBzZWxlY3Qod2l0aHdob20gPSBsYWJlbF9wYXJzZWQsIHdpdGh3aG9tX2VuID0gbmFtZSkgJT4lIGRpc3RpbmN0KCkpICU+JSAKICBkcm9wX25hKHdpdGh3aG9tKSAlPiUgCiAgZ3JvdXBfYnkod2l0aHdob20pICU+JSAKICBzdW1tYXJpc2UobiA9IG4oKSwgd2l0aHdob21fZW4gPSBmaXJzdCh3aXRod2hvbV9lbikpICU+JSAKICBhcnJhbmdlKGRlc2MobikpICU+JSAKICBzZWxlY3Qobiwgd2l0aHdob20sIHdpdGh3aG9tX2VuKQoKd3JpdGV4bDo6d3JpdGVfeGxzeCh0b19jb2RlX3NleF9wYXJ0bmVycywgImNvZGluZ3MvdG9fY29kZV9zZXhfcGFydG5lcnMueGxzeCIpCnRvX2NvZGVfc2V4X3BhcnRuZXJzID0gcmVhZHhsOjpyZWFkX3hsc3goImNvZGluZ3MvdG9fY29kZV9zZXhfcGFydG5lcnNfY29kZWQueGxzeCIsMSkKCnNleF9sb25nIDwtIHNleF9sb25nICU+JSAKICAKICBzZXBhcmF0ZV9yb3dzKGNvbnRyYWNlcHRpb24sIGNvbnZlcnQgPSBUUlVFLCBzZXAgPSAiLCAiKSAlPiUgCiAgbXV0YXRlKGNvbnRyYWNlcHRpb24gPSBzdHJfYygic2V4X2NvbnRyYWNlcHRpb25fIiwgaWZfZWxzZShpcy5uYShjb250cmFjZXB0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiBzZXhfYWN0aXZlID09IDEsICJub3RfbmVjZXNzYXJ5IiwgY29udHJhY2VwdGlvbikpLAogICAgICAgICBkdW1teSA9IDEpICU+JSAKICAjIGRpc3RpbmN0KCkgJT4lIAogIHNwcmVhZChjb250cmFjZXB0aW9uLCBkdW1teSwgZmlsbCA9IDApICU+JSAKCiAgCiAgc2VwYXJhdGVfcm93cyhhY3Rpdml0eSwgY29udmVydCA9IFRSVUUsIHNlcCA9ICIsIikgJT4lIAogIGxlZnRfam9pbih0b19jb2RlX3NleF9hY3RzICU+JSBzZWxlY3QoYWN0aXZpdHksIGFjdGl2aXR5X2VuKSkgJT4lIAogIG11dGF0ZShhY3Rpdml0eSA9IHN0cl9jKCJzZXhfYWN0aXZpdHlfIiwgaWZfZWxzZShpcy5uYShhY3Rpdml0eV9lbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYgIWlzLm5hKGFjdGl2aXR5KSwgIm90aGVyIiwgYWN0aXZpdHlfZW4pKSwKICAgICAgICAgZHVtbXkgPSAxKSAlPiUgCiAgc2VsZWN0KC1hY3Rpdml0eV9lbikgJT4lIAogIGRpc3RpbmN0KCkgJT4lIAogIHNwcmVhZChhY3Rpdml0eSwgZHVtbXksIGZpbGwgPSAwKSAlPiUgCiAgCiAgCiAgc2VwYXJhdGVfcm93cyh3aXRod2hvbSwgY29udmVydCA9IFRSVUUsIHNlcCA9ICIsIikgJT4lIAogIGxlZnRfam9pbih0b19jb2RlX3NleF9wYXJ0bmVycyAlPiUgc2VsZWN0KHdpdGh3aG9tLCB3aXRod2hvbV9lbikpICU+JSAKICBtdXRhdGUod2l0aHdob20gPSBzdHJfYygic2V4XyIsIGlmX2Vsc2UoaXMubmEod2l0aHdob21fZW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmICFpcy5uYSh3aXRod2hvbSksICJvdGhlciIsIHdpdGh3aG9tX2VuKSksCiAgICAgICAgIGR1bW15ID0gMSkgJT4lIAogIHNlbGVjdCgtd2l0aHdob21fZW4pICU+JSAKICBkaXN0aW5jdCgpICU+JSAKICBzcHJlYWQod2l0aHdob20sIGR1bW15LCBmaWxsID0gMCkgJT4lIAogIAogIHNlcGFyYXRlX3Jvd3MoZmFudGFzeV9hY3Rpb25zLCBjb252ZXJ0ID0gVFJVRSwgc2VwID0gIiwiKSAlPiUgCiAgbGVmdF9qb2luKHRvX2NvZGVfc2V4X2FjdHMgJT4lIHNlbGVjdChmYW50YXN5X2FjdGlvbnMgPSBhY3Rpdml0eSwgZmFudGFzeV9hY3Rpb25zX2VuID0gYWN0aXZpdHlfZW4pKSAlPiUgCiAgbXV0YXRlKGZhbnRhc3lfYWN0aW9ucyA9IHN0cl9jKCJzZXhfZmFudGFzeV9hY3RfIiwgaWZfZWxzZShpcy5uYShmYW50YXN5X2FjdGlvbnNfZW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmICFpcy5uYShmYW50YXN5X2FjdGlvbnMpLCAib3RoZXIiLCBmYW50YXN5X2FjdGlvbnNfZW4pKSwKICAgICAgICAgZHVtbXkgPSAxKSAlPiUgCiAgc2VsZWN0KC1mYW50YXN5X2FjdGlvbnNfZW4pICU+JSAKICBkaXN0aW5jdCgpICU+JSAKICBzcHJlYWQoZmFudGFzeV9hY3Rpb25zLCBkdW1teSwgZmlsbCA9IDApICU+JSAKICAKICBzZXBhcmF0ZV9yb3dzKGZhbnRhc3lfcGFydG5lciwgY29udmVydCA9IFRSVUUsIHNlcCA9ICIsICIpICU+JSAKICBtdXRhdGUoZmFudGFzeV9wYXJ0bmVyID0gc3RyX2MoInNleF9mYW50YXN5X2Fib3V0XyIsIGZhbnRhc3lfcGFydG5lciksCiAgICAgICAgIGR1bW15ID0gMSkgJT4lIAogIHNwcmVhZChmYW50YXN5X3BhcnRuZXIsIGR1bW15LCBmaWxsID0gMCkgJT4lIAogIAogIHNlbGVjdCgtYDxOQT5gKQoKc2V4X2xvbmckc2V4X2FjdGl2aXRpZXMgPC0gcm93U3VtcyhzZXhfbG9uZyAlPiUgc2VsZWN0KHN0YXJ0c193aXRoKCJzZXhfYWN0aXZpdHlfIikpKQpzZXhfbG9uZyA8LSBzZXhfbG9uZyAlPiUgCiAgbXV0YXRlKHNleF9hY3RpdmVfc2V4dWFsID0gaWZfZWxzZSgoc2V4X2FjdGl2aXRpZXMgLSBzZXhfYWN0aXZpdHlfY3VkZGxpbmcgLSBzZXhfYWN0aXZpdHlfa2lzc2luZyAtIHNleF9hY3Rpdml0eV9jeWJlcnNleCAtIHNleF9hY3Rpdml0eV9kaXJ0eV90YWxrIC0gc2V4X2FjdGl2aXR5X290aGVyIC0gc2V4X2FjdGl2aXR5X3Bvcm5vZ3JhcGh5ICAtIHNleF9hY3Rpdml0eV90b3VjaF9vdGhlciAtIHNleF9hY3Rpdml0eV91bmNsZWFyKSAgPiAwLCAxLCAwKSwKICAgICAgICAgc2V4X2FjdGl2ZV9wYXJ0bmVyZWQgPSBpZl9lbHNlKHNleF9hY3RpdmVfcGFydG5lcmVkID09IDEgJiBzZXhfYWN0aXZlX3NleHVhbCA9PSAxLCAxLCAwKSkKCgoKCnNleF9sb25nIDwtIHNleF9sb25nICU+JSAKICBtdXRhdGUoY3JlYXRlZF9kYXRlID0gaWZfZWxzZSh0aW1lICVpbiUgYygidDBfeWVzdGVyZGF5X2V2ZW5pbmciLCAidDFfYmVmb3JlX2ZhbGxpbmdfYXNsZWVwIiwgInQyX25pZ2h0X3RpbWUiKSwKICAgICAgICAgICBhcy5EYXRlKGNyZWF0ZWRfZGlhcnkgLSBob3Vycyg2KSkgLSBkYXlzKDEpLAogICAgICAgICAgIGFzLkRhdGUoY3JlYXRlZF9kaWFyeSAtIGhvdXJzKDYpKSkpICU+JSAKICBtdXRhdGUoCiAgICB0aW1lX25vbm1vdmVkID0gdGltZSwKICAgIHRpbWUgPSByZWNvZGUodGltZSwgInQwX3llc3RlcmRheV9ldmVuaW5nIiA9ICJ0Nl9ldmVuaW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAidDFfYmVmb3JlX2ZhbGxpbmdfYXNsZWVwIiA9ICJ0N19iZWZvcmVfZmFsbGluZ19hc2xlZXAiLAogICAgICAgICAgICAgICAgICAgICAgICJ0Ml9uaWdodF90aW1lIiA9ICJ0OF9uaWdodF90aW1lIikpCgoKc2V4X3N1bW1hcnkgPC0gc2V4X2xvbmcgJT4lIAogIGdyb3VwX2J5KHNob3J0LCBjcmVhdGVkX2RhdGUpICU+JSAKICAjIGdyb3VwX2J5KHNob3J0LCBjcmVhdGVkX2RhdGUpICU+JSAKICBzdW1tYXJpc2VfYXQodmFycyhlbmpveWVkOnBhcnRuZXJfZW5qb3llZCksIGZ1bnMobWVhbiguLCBuYS5ybSA9IFRSVUUpKSkgJT4lIAogIGxlZnRfam9pbigKICAgIHNleF9sb25nICU+JSAKICAgICAgZ3JvdXBfYnkoc2hvcnQsIGNyZWF0ZWRfZGF0ZSkgJT4lIAogICAgICBzdW1tYXJpc2VfYXQodmFycyhzZXhfYWN0aXZlOnNleF9hY3RpdmVfc2V4dWFsKSwgZnVucyhtYXgpKQogICkgJT4lIAogIGxlZnRfam9pbigKICAgIHNleF9sb25nICU+JSAKICAgICAgZ3JvdXBfYnkoc2hvcnQsIGNyZWF0ZWRfZGF0ZSkgJT4lIAogICAgICBzdW1tYXJpc2Uoc2V4X3RpbWUgPSBpZl9lbHNlKG4oKSA9PSAxLCBmaXJzdCh0aW1lKSwgIm11bHRpcGxlIikpCiAgKQojIAojIAojIHNleF9zdW1tYXJ5IDwtIHNleF9sb25nICU+JQojICAgZ3JvdXBfYnkoc2hvcnQsIGNyZWF0ZWRfZGlhcnkpICU+JQojICAgIyBncm91cF9ieShzaG9ydCwgY3JlYXRlZF9kYXRlKSAlPiUKIyAgIHN1bW1hcmlzZV9hdCh2YXJzKGVuam95ZWQ6cGFydG5lcl9lbmpveWVkKSwgZnVucyhtZWFuKC4sIG5hLnJtID0gVFJVRSkpKSAlPiUKIyAgIGxlZnRfam9pbigKIyAgICAgc2V4X2xvbmcgJT4lCiMgICAgICAgZ3JvdXBfYnkoc2hvcnQsIGNyZWF0ZWRfZGlhcnkpICU+JQojICAgICAgIHN1bW1hcmlzZV9hdCh2YXJzKHNleF9hY3RpdmU6c2V4X2FjdGl2ZV9zZXh1YWwpLCBmdW5zKG1heCkpCiMgICApICU+JQojICAgbGVmdF9qb2luKAojICAgICBzZXhfbG9uZyAlPiUKIyAgICAgICBncm91cF9ieShzaG9ydCwgY3JlYXRlZF9kaWFyeSkgJT4lCiMgICAgICAgc3VtbWFyaXNlKHNleF90aW1lID0gaWZfZWxzZShuKCkgPT0gMSwgZmlyc3QodGltZSksICJtdWx0aXBsZSIpKQojICAgKQoKZGlhcnkgPC0gZGlhcnkgJT4lIAogIGxlZnRfam9pbihzZXhfc3VtbWFyeSAlPiUgc2VsZWN0KC1zZXhfYWN0aXZlKSwgYnkgPSBjKCJzaG9ydCIsICJjcmVhdGVkX2RhdGUiKSkgJT4lIAogIG11dGF0ZV9hdCh2YXJzKHNleF9hY3RpdmVfc29sbzpzZXhfYWN0aXZlX3NleHVhbCksIGZ1bnMoaWZfbmEoLiwgMCkpKQoKZGlhcnkgPC0gZGlhcnkgJT4lIAogIHJlbmFtZShzZXhfaGFwcHkgPSBoYXBweSwKICAgICAgICAgc2V4X2Vuam95ZWQgPSBlbmpveWVkLAogICAgICAgICBzZXhfcGFydG5lcl9lbmpveWVkID0gcGFydG5lcl9lbmpveWVkKQoKdGVzdHRoYXQ6OmV4cGVjdF9lcXVhbChzZXhfYWN0c19pbl9kaWFyeSwgbnJvdyhzZXhfbG9uZykpCgpkaWFyeSA8LSBkaWFyeSAlPiUgCiAgbXV0YXRlKAogICAgc2V4X2luX3BhaXIgPSBpZl9lbHNlKGhldGVyb19yZWxhdGlvbnNoaXAgPT0gMSAmIHNleF9hY3Rpdml0eV9zZXggPT0gMSAmIHNleF93aXRoX3BhcnRuZXIgPT0gMSwgMSwgMCksCiAgICBzZXhfZXh0cmFfcGFpcl93aXRoX21hbGUgPSBpZl9lbHNlKGhldGVyb19yZWxhdGlvbnNoaXAgPT0gMSAmIHNleF9hY3Rpdml0eV9zZXggPT0gMSAmIHNleF93aXRoX3BhcnRuZXIgPT0gMCAmIHNleF93aXRoX290aGVyX21hbGUgPT0gMSwgMSwgMCksCiAgICBzZXhfd2l0aF9mZW1hbGUgPSBpZl9lbHNlKHNleF9hY3Rpdml0eV9zZXggPT0gMSAmIHNleF93aXRoX290aGVyX2ZlbWFsZSA9PSAxLCAxLCAwKSwKICAgIHNleF93aXRoX21hbGUgPSBpZl9lbHNlKHNleF9hY3Rpdml0eV9zZXggPT0gMSAmIChzZXhfd2l0aF9vdGhlcl9tYWxlID09IDEgfCBzZXhfd2l0aF9wYXJ0bmVyID09IDEpLCAxLCAwKSwKICAgIHNleF9leHRyYV9wYWlyX3dpdGhfZmVtYWxlID0gaWZfZWxzZShoZXRlcm9fcmVsYXRpb25zaGlwID09IDEgJiBzZXhfd2l0aF9wYXJ0bmVyID09IDAgJiBzZXhfd2l0aF9vdGhlcl9mZW1hbGUgPT0gMSwgMSwgMCksCiAgICBzZXhfcmlza2VkX2NvbmNlcHRpb24gPSBpZl9lbHNlKHNleF9hY3Rpdml0eV9zZXggPT0gMSAmIChzZXhfY29udHJhY2VwdGlvbl9jb2l0dXNfaW50ZXJydXB0dXMgPT0gMSB8IHNleF9jb250cmFjZXB0aW9uX3Jpc2tlZF9pdCA9PSAxKSAmICFzZXhfY29udHJhY2VwdGlvbl9ub3RfbmVjZXNzYXJ5ID09IDEsIDEsIDApLAogICAgc2V4X2hhZF91bnByb3RlY3RlZF9wZW5ldHJhdGl2ZV9zZXggPSBpZl9lbHNlKHNleF9hY3Rpdml0eV9zZXggPT0gMSAmIChzZXhfY29udHJhY2VwdGlvbl9kaWRfbm90X3dhbnQgPT0gMSB8IHNleF9jb250cmFjZXB0aW9uX2NvaXR1c19pbnRlcnJ1cHR1cyA9PSAxIHwgc2V4X2NvbnRyYWNlcHRpb25fcmlza2VkX2l0ID09IDEpICYgIXNleF9jb250cmFjZXB0aW9uX25vdF9uZWNlc3NhcnkgPT0gMSwgMSwgMCkKICApCgoKZGlhcnkgPC0gZGlhcnkgJT4lIAogIGdyb3VwX2J5KHNob3J0KSAlPiUgCiAgYXJyYW5nZShjcmVhdGVkX2RpYXJ5KSAlPiUgCiAgbXV0YXRlKAogICAgc2V4X2FjdGl2ZV9kYXRlID0gaWZfZWxzZShzZXhfYWN0aXZpdHlfc2V4ID09IDEsIGNyZWF0ZWRfZGF0ZSwgYXMuRGF0ZShOQV9jaGFyYWN0ZXJfKSksCiAgICBzZXhfbGFzdF9kYXRlID0gem9vOjpuYS5sb2NmKHNleF9hY3RpdmVfZGF0ZSwgbmEucm0gPSBGKSwKICAgIHNleF9kYXlzX2FnbyA9IGFzLm51bWVyaWMoY3JlYXRlZF9kYXRlIC0gc2V4X2xhc3RfZGF0ZSksCiAgICBzZXhfbWFzdHVyYmF0aW9uX2FjdGl2ZV9kYXRlID0gaWZfZWxzZShzZXhfYWN0aXZpdHlfbWFzdHVyYmF0aW9uID09IDEgJiBzZXhfYWN0aXZlX3NvbG8gPT0gMSwgY3JlYXRlZF9kYXRlLCBhcy5EYXRlKE5BX2NoYXJhY3Rlcl8pKSwKICAgIHNleF9tYXN0dXJiYXRpb25fbGFzdF9kYXRlID0gem9vOjpuYS5sb2NmKHNleF9tYXN0dXJiYXRpb25fYWN0aXZlX2RhdGUsIG5hLnJtID0gRiksCiAgICBzZXhfbWFzdHVyYmF0aW9uX2RheXNfYWdvID0gYXMubnVtZXJpYyhjcmVhdGVkX2RhdGUgLSBzZXhfbWFzdHVyYmF0aW9uX2xhc3RfZGF0ZSkKKQojIAojIHRhYmxlKGRpYXJ5JHNleF9leHRyYV9wYWlyX3dpdGhfZmVtYWxlKQojIHRhYmxlKGRpYXJ5JHNleF9leHRyYV9wYWlyX3dpdGhfbWFsZSkKIyB0YWJsZShkaWFyeSRzZXhfaGFkX3VucHJvdGVjdGVkX3BlbmV0cmF0aXZlX3NleCkKIyB0YWJsZShkaWFyeSRzZXhfcmlza2VkX2NvbmNlcHRpb24pCiMgdGFibGUoZGlhcnkkc2V4X2luX3BhaXIpCmRpYXJ5IDwtIGRpYXJ5ICU+JSB1bmdyb3VwKCkgJT4lIAogIG11dGF0ZShzZXhfYWN0cyA9IGNhc2Vfd2hlbigKICAgIHNleF9hY3RpdmUgPT0gMCB+IDAsCiAgICBUUlVFIH4gc2V4X2FjdHMpKQoKZGlhcnkgPC0gZGlhcnkgJT4lIAogIGdyb3VwX2J5KHNob3J0KSAlPiUgCiAgYXJyYW5nZShjcmVhdGVkX2RpYXJ5KSAlPiUgCiAgbXV0YXRlKHNleF9wYXJ0bmVyZWRfZnJlcSA9IG1lYW4oc2V4X2FjdGl2ZV9wYXJ0bmVyZWQsIG5hLnJtID0gVFJVRSksCiAgICAgICAgIGxhZ19saWJpZG8gPSBsYWcoaGlnaF9saWJpZG8pLAogICAgICAgICBsYWdfc2V4ID0gbGFnKHNleF9hY3Rpdml0eV9zZXgpLAogICAgICAgICBsYWdfc2V4X2FjdGl2ZV9wYXJ0bmVyZWQgPSBsYWcoc2V4X2FjdGl2ZV9wYXJ0bmVyZWQpLAogICAgICAgICBsYWdfc2V4X2FjdGl2ZSA9IGxhZyhzZXhfYWN0aXZlKSwKICAgICAgICAgbGFnX3NleF9hY3RzID0gbGFnKHNleF9hY3RzKSwKICAgICAgICAgbGFnX3N0cmVzc2VkID0gbGFnKHN0cmVzc2VkKSwKICAgICAgICAgbGFnX21vb2QgPSBsYWcoZ29vZF9tb29kKSkgJT4lIAogIHVuZ3JvdXAoKQpgYGAKCiMjIEZpbmFsIGVkaXRzCgpgYGB7cn0KIyBzb21lIHdvbWVuIGxldCB1cyBrbm93IGluIHRoZSBjb21tZW50cyB0aGF0IHRoZXkgYXJlIG5vdCByZWFsbHkgdXNpbmcgYSBmZXJ0aWxpdHkgYXdhcmVuZXNzIGFwcC9tZXRob2QKbm90X2F3YXJlIDwtIGFsbF9zdXJ2ZXlzJGN5Y2xlX2F3YXJlbmVzc19vdGhlciAlaW4lIGMoImZlcnRpbGVfYXdhcmVfaW52YWxpZCIsICJmZXJ0aWxpdHlfYXdhcmVuZXNzX2RpZF9ub3RfdXNlIiwgIm5vdF9mZXJ0aWxlX2F3YXJlIikKYWxsX3N1cnZleXNbbm90X2F3YXJlLCBjKCJsdXRlYWxfcGhhc2VfbGVuZ3RoIiwgImZvbGxpY3VsYXJfcGhhc2VfbGVuZ3RoIildIDwtIE5BCgojIHNvbWUgd29tZW4gbGV0IHVzIGtub3cgaW4gdGhlIGNvbW1lbnRzIHRoYXQgdGhleSBhcmUgbm90IHJlYWxseSB1c2luZyBhIGZlcnRpbGl0eSBhd2FyZW5lc3MgYXBwL21ldGhvZApub3RfYXdhcmUgPC0gZGlhcnkkY3ljbGVfYXdhcmVuZXNzX290aGVyICVpbiUgYygiZmVydGlsZV9hd2FyZV9pbnZhbGlkIiwgImZlcnRpbGl0eV9hd2FyZW5lc3NfZGlkX25vdF91c2UiLCAibm90X2ZlcnRpbGVfYXdhcmUiKQpkaWFyeVtub3RfYXdhcmUsIGMoImx1dGVhbF9waGFzZV9sZW5ndGgiLCAiZm9sbGljdWxhcl9waGFzZV9sZW5ndGgiLCAiREFMIiwgImRhdGVfb2Zfb3Z1bGF0aW9uX2F2Z19sdXRlYWxfaW5mZXJyZWQiLAogICAgICAgICAgICAgICAgICAgImRhdGVfb2Zfb3Z1bGF0aW9uX2F2Z19sdXRlYWwiLCAiZGF0ZV9vZl9vdnVsYXRpb25fYXZnX2ZvbGxpY3VsYXIiLCAiZmVydGlsZV9hd2FyZW5lc3MiLAogICAgICAgICAgICAgICAgICAgImRhdGVfb2Zfb3Z1bGF0aW9uX2F3YXJlbmVzcyIsICJwcmNfc3Rpcm5fYl9hd2FyZV9sdXRlYWwiLCAicHJjX3djeF9iX2F3YXJlX2x1dGVhbCIsCiAgICAgICAgICAgICAgICAgICAiZmVydGlsZV9uYXJyb3dfYXdhcmVfbHV0ZWFsIiwgImZlcnRpbGVfYnJvYWRfYXdhcmVfbHV0ZWFsIiwgImZlcnRpbGVfd2luZG93X2F3YXJlX2x1dGVhbCIsIAogICAgICAgICAgICAgICAgICAgInByZW1lbnN0cnVhbF9waGFzZV9hd2FyZV9sdXRlYWwiKV0gPC0gTkEKCiMgcmVkbyB3ZWVrZGF5cyBhZnRlciBleHBhbmRpbmcgdGltZXNlcmllcwpzM19kYWlseSR3ZWVrZGF5ID0gZm9ybWF0KHMzX2RhaWx5JGNyZWF0ZWRfZGF0ZSwgZm9ybWF0ID0gIiV3IikKczNfZGFpbHkkd2Vla2VuZCA8LSBpZmVsc2UoczNfZGFpbHkkd2Vla2RheSAlaW4lIGMoMCw1LDYpLCAxLCAwKQpzM19kYWlseSR3ZWVrZGF5IDwtIGNhcjo6UmVjb2RlKHMzX2RhaWx5JHdlZWtkYXksCQkJCQkJCQkJCQkJIjA9J1N1bmRheSc7MT0nTW9uZGF5JzsyPSdUdWVzZGF5JzszPSdXZWRuZXNkYXknOzQ9J1RodXJzZGF5Jzs1PSdGcmlkYXknOzY9J1NhdHVyZGF5JyIsYXMuZmFjdG9yID1ULCBsZXZlbHMgPSAJYygnTW9uZGF5JywnVHVlc2RheScsJ1dlZG5lc2RheScsJ1RodXJzZGF5JywnRnJpZGF5JywnU2F0dXJkYXknLCdTdW5kYXknKSkKCmRpYXJ5JHdlZWtkYXkgPSBmb3JtYXQoZGlhcnkkY3JlYXRlZF9kYXRlLCBmb3JtYXQgPSAiJXciKQpkaWFyeSR3ZWVrZW5kIDwtIGlmZWxzZShkaWFyeSR3ZWVrZGF5ICVpbiUgYygwLDUsNiksIDEsIDApCmRpYXJ5JHdlZWtkYXkgPC0gY2FyOjpSZWNvZGUoZGlhcnkkd2Vla2RheSwJIjA9J1N1bmRheSc7MT0nTW9uZGF5JzsyPSdUdWVzZGF5JzszPSdXZWRuZXNkYXknOzQ9J1RodXJzZGF5Jzs1PSdGcmlkYXknOzY9J1NhdHVyZGF5JyIsYXMuZmFjdG9yID0gVCwgbGV2ZWxzID0gCWMoJ01vbmRheScsJ1R1ZXNkYXknLCdXZWRuZXNkYXknLCdUaHVyc2RheScsJ0ZyaWRheScsJ1NhdHVyZGF5JywnU3VuZGF5JykpCgojIG9taXQgZXh0cmFwb2xhdGVkIGRheXMKczNfZGFpbHkgPC0gczNfZGFpbHkgJT4lIGZpbHRlcihkYXlfbnVtYmVyICVpbiUgMDo3MCB8ICFpcy5uYShlbmRlZCkpCmRpYXJ5IDwtIGRpYXJ5ICU+JSBmaWx0ZXIoZGF5X251bWJlciAlaW4lIDA6NzAgfCAhaXMubmEoZW5kZWRfZGlhcnkpKQoKCmRpYXJ5JHByZW1lbnN0cnVhbF9waGFzZV9mYWIgPSBmYWN0b3IoZGlhcnkkcHJlbWVuc3RydWFsX3BoYXNlX2ZhYikKZGlhcnkkaG9ybW9uYWxfY29udHJhY2VwdGlvbiA9IGZhY3RvcihkaWFyeSRob3Jtb25hbF9jb250cmFjZXB0aW9uKQpkaWFyeV9zb2NpYWwkcHJlbWVuc3RydWFsX3BoYXNlX2ZhYiA9IGZhY3RvcihkaWFyeV9zb2NpYWwkcHJlbWVuc3RydWFsX3BoYXNlX2ZhYikKZGlhcnlfc29jaWFsJGhvcm1vbmFsX2NvbnRyYWNlcHRpb24gPSBmYWN0b3IoZGlhcnlfc29jaWFsJGhvcm1vbmFsX2NvbnRyYWNlcHRpb24pCgojIGRpYXJ5ICU+JSBkcm9wX25hKGRheV9udW1iZXIpICU+JSBncm91cF9ieShzaG9ydCwgZGF5X251bWJlcikgJT4lIGZpbHRlcihuKCkgPiAxIHwgZGF5X251bWJlciA8IDEgfCBkYXlfbnVtYmVyID4gNzApICU+JSBzZWxlY3Qoc2hvcnQsIGNyZWF0ZWRfZGVtbywgY3JlYXRlZF9kaWFyeSwgZGF5X251bWJlciwgZW5kZWRfZGlhcnksIG5vdGVzX3RvX3VzKSAlPiUgYXJyYW5nZShkZXNjKGRheV9udW1iZXIpKQoKZGlhcnkgPSBkaWFyeSAlPiUgCiAgZ3JvdXBfYnkoc2Vzc2lvbiwgY3ljbGVfbnIpICU+JQogIG11dGF0ZShtaW5pbXVtX2N5Y2xlX2xlbmd0aF9kaWFyeSA9IGlmX2Vsc2UoIWlzLm5hKGN5Y2xlX2xlbmd0aCksIGN5Y2xlX2xlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heChGQ0QsbmEucm0gPSBUKSksCiAgICAgICAgIG1pbmltdW1fY3ljbGVfbGVuZ3RoX2RpYXJ5ID0gaWZfZWxzZShtaW5pbXVtX2N5Y2xlX2xlbmd0aF9kaWFyeSA9PSAtSW5mLCBOQV9yZWFsXywgbWluaW11bV9jeWNsZV9sZW5ndGhfZGlhcnkpCiAgKSAlPiUKICBncm91cF9ieShzZXNzaW9uKQoKZGlhcnkgPSBkaWFyeSAlPiUgZ3JvdXBfYnkoc2Vzc2lvbikgJT4lIAogIG11dGF0ZShyZWxhdGlvbnNoaXBfc2F0aXNmYWN0aW9uX2RpYXJ5X2F2ZyA9IG1lYW4ocmVsYXRpb25zaGlwX3NhdGlzZmFjdGlvbl9kaWFyeSwgbmEucm0gPSBUKSkgJT4lIHVuZ3JvdXAoKQoKYWxsX3N1cnZleXMkcGVyc29uIDwtIGFzLm51bWVyaWMoZmFjdG9yKGFsbF9zdXJ2ZXlzJHNob3J0KSkKZGlhcnkgPC0gYWxsX3N1cnZleXMgJT4lIHNlbGVjdChwZXJzb24sIHNob3J0KSAlPiUgcmlnaHRfam9pbihkaWFyeSwgYnkgPSAic2hvcnQiKQoKZGlhcnkgPC0gZGlhcnkgJT4lIHVuZ3JvdXAoKQpzM19kYWlseSA8LSBzM19kYWlseSAlPiUgdW5ncm91cCgpCgojIyBEdXJhdGlvbiBvYmplY3RzIGFyZSBkaWZmaWN1bHQgZm9yIHNraW1yCnMzX2RhaWx5JHNsZWVwX2ZlbGxfYXNsZWVwX3RpbWUgPC0gYXMubnVtZXJpYyhzM19kYWlseSRzbGVlcF9mZWxsX2FzbGVlcF90aW1lKQpzM19kYWlseSRzbGVlcF9hd29rZV90aW1lIDwtIGFzLm51bWVyaWMoczNfZGFpbHkkc2xlZXBfYXdva2VfdGltZSkKYGBgCgojIyBTYW5pdHkgY2hlY2tzCgpgYGB7cn0KbGlicmFyeSh0ZXN0dGhhdCkKZXhwZWN0X2ZhbHNlKGFueShuYW1lcyhkaWFyeSkgJWNvbnRhaW5zJSAiLngiKSkKZXhwZWN0X2ZhbHNlKGFueShuYW1lcyhkaWFyeSkgJWNvbnRhaW5zJSAiLnkiKSkKZXhwZWN0X2ZhbHNlKGFueShuYW1lcyhhbGxfc3VydmV5cykgJWNvbnRhaW5zJSAiLnkiKSkKZXhwZWN0X2VxdWFsKGdyb3VwcyhzM19kYWlseSksIGxpc3QoKSkKZXhwZWN0X2VxdWFsKGdyb3VwcyhkaWFyeSksIGxpc3QoKSkKZXhwZWN0X2VxdWFsKGdyb3VwcyhhbGxfc3VydmV5cyksIGxpc3QoKSkKZXhwZWN0X2VxdWFsKHN1bShkdXBsaWNhdGVkKGFsbF9zdXJ2ZXlzJHNlc3Npb24pKSwgMCkKZXhwZWN0X2VxdWFsKHN1bShkdXBsaWNhdGVkKHMxX2RlbW8kc2Vzc2lvbikpLCAwKQpleHBlY3RfZXF1YWwoZGlhcnkgJT4lIGRyb3BfbmEoc2Vzc2lvbiwgZGF5X251bWJlcikgJT4lIAogICAgICAgICAgICAgICBncm91cF9ieShzaG9ydCwgZGF5X251bWJlcikgJT4lIGZpbHRlcihuKCkgPiAxKSAlPiUgbnJvdygpLCAwKQpleHBlY3RfZXF1YWwoZGlhcnkgJT4lIGRyb3BfbmEoc2Vzc2lvbiwgY3JlYXRlZF9kaWFyeSkgJT4lICAKICAgICAgICAgICAgZ3JvdXBfYnkoc2Vzc2lvbiwgY3JlYXRlZF9kaWFyeSkgJT4lIGZpbHRlcihuKCk+MSkgJT4lIG5yb3coKSwgMCkKZXhwZWN0X2VxdWFsKHMzX2RhaWx5ICU+JSBkcm9wX25hKHNlc3Npb24sIGNyZWF0ZWRfZGF0ZSkgJT4lICAKICAgICAgICAgICAgZ3JvdXBfYnkoc2Vzc2lvbiwgY3JlYXRlZF9kYXRlKSAlPiUgZmlsdGVyKG4oKT4xKSAlPiUgbnJvdygpLCAwKQpleHBlY3RfZXF1YWwoZGlhcnkgJT4lIGRyb3BfbmEoc2Vzc2lvbiwgY3JlYXRlZF9kYXRlKSAlPiUgIAogICAgICAgICAgICBncm91cF9ieShzZXNzaW9uLCBjcmVhdGVkX2RhdGUpICU+JSBmaWx0ZXIobigpPjEpICU+JSBucm93KCksIDApCmV4cGVjdF9lcXVhbChkaWFyeV9zb2NpYWwgJT4lIGRyb3BfbmEoc2Vzc2lvbiwgY3JlYXRlZF9kaWFyeSwgcGVyc29uKSAlPiUgIAogICAgICAgICAgICBncm91cF9ieShzZXNzaW9uLCBjcmVhdGVkX2RpYXJ5LCBwZXJzb24pICU+JSBmaWx0ZXIobigpID4gMSkgJT4lIG5yb3coKSwgMCkKZXhwZWN0X2VxdWFsKG5ldHdvcmsgJT4lIGRyb3BfbmEoc2Vzc2lvbiwgcGVyc29uKSAlPiUgIAogICAgICAgICAgICBncm91cF9ieShzZXNzaW9uLCBwZXJzb24pICU+JSBmaWx0ZXIobigpPjEpICU+JSBucm93KCksIDApCmBgYAoKCiMjIHNhdmUKYGBge3J9CnNhdmUoZGlhcnlfc29jaWFsLCBzZXhfbG9uZywgbGFiLCBkaWFyeSwgbmV0d29ya19ub21pbmF0aW9ucywgbmV0d29yaywgczFfZGVtbywgczFfZmlsdGVyLCBzMl9pbml0aWFsLCBzM19kYWlseSwgczRfZm9sbG93dXAsIHM0X3RpbWVzcGVudCwgd2l0aGZvbGxvd3VwLCBzNV9oYWRtZW5zdHJ1YXRpb24sIGFsbF9zdXJ2ZXlzLCBmaWxlID0gImRhdGEvY2xlYW5lZC5yZGF0YSIpCmBgYAo=</div>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("0_wrangle_data.Rmd");
  window.initializeCodeFolding("show" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
